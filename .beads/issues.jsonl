{"id":"butlers-0qp","title":"Butlers v1 MVP","description":"Complete implementation of the Butlers AI agent framework v1 MVP. Encompasses the core daemon framework, module system, 5 specialized butlers (Switchboard, Heartbeat, Relationship, Health, General), 2 communication modules (Telegram, Email), CLI, Docker deployment, and OpenTelemetry instrumentation. See openspec/changes/v1-mvp-spec for full specifications.","acceptance_criteria":"1. All 5 butlers start and serve MCP tools\n2. Switchboard routes messages to correct butler\n3. Heartbeat ticks all butlers on 10-min cycle\n4. CC spawner generates locked-down ephemeral configs\n5. All core tools (state, scheduler, sessions) work across butlers\n6. Docker Compose brings up full stack\n7. End-to-end tracing works from ingress to CC execution","status":"open","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:05:36.754557265+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:05:36.754557265+08:00"}
{"id":"butlers-0qp.1","title":"Set up project skeleton","description":"Initialize project structure: pyproject.toml with hatchling build backend, ruff config, pytest-asyncio, src/butlers layout, Makefile targets, GitHub Actions CI workflow with PostgreSQL service. Foundation for all subsequent work.","acceptance_criteria":"1. uv sync --dev installs all deps without error\n2. make check passes (lint + test)\n3. CI workflow runs on push and PR\n4. Project follows src layout convention","status":"open","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:06:54.876948162+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:06:54.876948162+08:00","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:06:54.878359929+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.1","title":"Create pyproject.toml with hatchling build and dev dependencies","description":"Set up pyproject.toml with hatchling build backend, src/butlers layout. Dev dependencies: ruff, pytest, pytest-asyncio, testcontainers. Runtime dependencies: fastmcp, claude-code-sdk, asyncpg, croniter, opentelemetry-sdk, click.","acceptance_criteria":"1. pyproject.toml parses without error\n2. Build backend is hatchling with src layout\n3. All runtime and dev dependencies declared\n4. Ruff config included: target py312, line-length 100, rules E,F,I,UP","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:09:52.754473928+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.238295365+08:00","closed_at":"2026-02-09T12:28:23.238295365+08:00","close_reason":"Skeleton implemented and merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1.1","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:09:52.755954014+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.2","title":"Create src/butlers package and type marker","description":"Create src/butlers/__init__.py (can be empty or with version) and src/butlers/py.typed marker file for PEP 561 type checking support.","acceptance_criteria":"1. src/butlers/__init__.py exists\n2. src/butlers/py.typed exists\n3. Package importable after uv sync","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:09:54.454582037+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.253118145+08:00","closed_at":"2026-02-09T12:28:23.253118145+08:00","close_reason":"Skeleton implemented and merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1.2","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:09:54.456028609+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.3","title":"Create test infrastructure","description":"Create tests/__init__.py and tests/conftest.py with SpawnerResult dataclass (result, tool_calls, error, duration_ms) and MockSpawner pytest fixture that returns configurable SpawnerResult without invoking real CC.","acceptance_criteria":"1. tests/conftest.py contains SpawnerResult dataclass\n2. MockSpawner fixture available in all tests\n3. MockSpawner records invocations for assertion","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:09:58.053555877+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.261285042+08:00","closed_at":"2026-02-09T12:28:23.261285042+08:00","close_reason":"Skeleton implemented and merged to main","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.1.3","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:09:58.055445816+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.4","title":"Create .python-version file","description":"Create .python-version file specifying Python 3.12 for uv and other tooling.","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":5,"created_at":"2026-02-09T12:10:02.801563425+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.269551838+08:00","closed_at":"2026-02-09T12:28:23.269551838+08:00","close_reason":"Skeleton implemented and merged to main","dependencies":[{"issue_id":"butlers-0qp.1.4","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:10:02.803530601+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.5","title":"Create Makefile with dev targets","description":"Create Makefile with targets: lint (uv run ruff check src/ tests/), format (uv run ruff format src/ tests/), test (uv run pytest -v), check (lint + test).","acceptance_criteria":"1. make lint runs ruff check\n2. make format runs ruff format\n3. make test runs pytest -v\n4. make check runs lint then test","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:10:03.789282531+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.27783777+08:00","closed_at":"2026-02-09T12:28:23.27783777+08:00","close_reason":"Skeleton implemented and merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1.5","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:10:03.791042865+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.6","title":"Create GitHub Actions CI workflow","description":"Create .github/workflows/ci.yml that runs on push and PR. Steps: checkout, set up Python 3.12 with uv, PostgreSQL service container, uv sync --dev, make check.","acceptance_criteria":"1. Workflow triggers on push and PR\n2. PostgreSQL service container running\n3. make check executed and must pass\n4. uv used for dependency installation","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:05.229430117+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.286151534+08:00","closed_at":"2026-02-09T12:28:23.286151534+08:00","close_reason":"Skeleton implemented and merged to main","labels":["ci","infra"],"dependencies":[{"issue_id":"butlers-0qp.1.6","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:10:05.231397412+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.7","title":"Verify project skeleton builds clean","description":"Run uv sync --dev and verify make check passes with no errors. Smoke test that the full skeleton is wired correctly.","acceptance_criteria":"1. uv sync --dev completes without error\n2. make check passes (lint + test)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:10:07.628327377+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.294598801+08:00","closed_at":"2026-02-09T12:28:23.294598801+08:00","close_reason":"Skeleton implemented and merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1.7","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:10:07.630086489+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.10","title":"Implement Telegram module","description":"Module implementation with send_message and get_updates MCP tools. Polling mode for dev (no public URL needed) and webhook mode for production, configurable via butler.toml [modules.telegram] section. Requires TELEGRAM_BOT_TOKEN credential.","acceptance_criteria":"1. Module registers send_message and get_updates tools\n2. Polling mode works for local development\n3. Webhook mode configurable for production\n4. Module declares TELEGRAM_BOT_TOKEN in credentials_env","status":"open","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:44.707081615+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:07:44.707081615+08:00","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.10","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:44.708512478+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.10.1","title":"Implement Telegram module with send and receive tools","description":"Create src/butlers/modules/telegram.py implementing the Module ABC. Register MCP tools: send_message(chat_id, text) and get_updates(). Declare TELEGRAM_BOT_TOKEN in credentials_env. Config schema includes mode (polling/webhook) and webhook_url (for production).","acceptance_criteria":"1. Module implements all Module ABC members\n2. send_message tool registered and calls Telegram Bot API\n3. get_updates tool registered and returns messages\n4. TELEGRAM_BOT_TOKEN declared in credentials_env","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:06.775600425+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:06.775600425+08:00","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.10.1","depends_on_id":"butlers-0qp.10","type":"parent-child","created_at":"2026-02-09T12:12:06.777029054+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.10.2","title":"Implement Telegram polling and webhook modes","description":"Support polling mode for dev (getUpdates long-polling, no public URL needed) and webhook mode for production (setWebhook, receive POSTs). Mode configured via [modules.telegram] in butler.toml. on_startup starts the appropriate mode, on_shutdown cleans up.","acceptance_criteria":"1. Polling mode works without public URL\n2. Webhook mode sets webhook URL on startup\n3. Mode selected from config\n4. Graceful cleanup on shutdown","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:12:08.003122958+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:08.003122958+08:00","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.10.2","depends_on_id":"butlers-0qp.10","type":"parent-child","created_at":"2026-02-09T12:12:08.005131161+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.10.3","title":"Write Telegram module tests","description":"Write tests/test_module_telegram.py covering: tool registration, mocked API calls (send_message, get_updates), config validation, credential declaration.","acceptance_criteria":"1. Tool registration verified\n2. API calls mocked (no real Telegram calls)\n3. Config validation tested\n4. Tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:08.899573509+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:08.899573509+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.10.3","depends_on_id":"butlers-0qp.10","type":"parent-child","created_at":"2026-02-09T12:12:08.900982981+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.11","title":"Implement task scheduler","description":"Cron-driven task dispatch. TOML-to-DB sync on startup (insert new, update changed, mark removed). tick() handler evaluates cron expressions via croniter, dispatches due task prompts to CC spawner serially. Runtime CRUD MCP tools: schedule_list, schedule_create (validate cron), schedule_update, schedule_delete (reject toml-source deletion).","acceptance_criteria":"1. TOML schedules synced to DB on startup\n2. tick() dispatches due tasks to CC spawner\n3. No-op tick when nothing due\n4. Disabled tasks skipped\n5. schedule_create validates cron syntax\n6. schedule_delete rejects toml-source tasks\n7. next_run_at computed correctly from cron expression","status":"open","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:48.306483672+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:07:48.306483672+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.11","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:48.308047636+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.11","depends_on_id":"butlers-0qp.4","type":"blocks","created_at":"2026-02-09T12:15:48.731288429+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.11","depends_on_id":"butlers-0qp.8","type":"blocks","created_at":"2026-02-09T12:15:48.853046222+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.11.1","title":"Implement TOML-to-DB schedule sync and cron evaluation","description":"Create src/butlers/core/scheduler.py. On startup, sync [[butler.schedule]] entries from TOML to scheduled_tasks table: insert new tasks (source='toml'), update changed ones, mark removed ones. Use croniter to compute next_run_at for each task. tick() handler checks for due tasks and dispatches prompts to CC spawner serially.","design":"TOML sync: match by name. Source='toml' for config-sourced, source='runtime' for API-created. tick() flow: query tasks WHERE enabled=true AND next_run_at \u003c= now(), dispatch each to CC spawner, update next_run_at after dispatch.","acceptance_criteria":"1. TOML tasks synced on first startup\n2. Changed TOML tasks updated in DB\n3. Removed TOML tasks marked appropriately\n4. tick() dispatches due tasks to CC spawner\n5. next_run_at computed correctly via croniter\n6. Disabled tasks skipped by tick()","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T12:11:24.507483557+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:24.507483557+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.11.1","depends_on_id":"butlers-0qp.11","type":"parent-child","created_at":"2026-02-09T12:11:24.509245155+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.11.2","title":"Implement schedule CRUD MCP tools","description":"Add MCP tools: schedule_list() returns all tasks, schedule_create(name, cron, prompt) creates runtime task (validates cron syntax via croniter), schedule_update(id, fields) modifies task, schedule_delete(id) removes task but rejects deletion of toml-source tasks.","acceptance_criteria":"1. schedule_list returns all tasks with their fields\n2. schedule_create validates cron syntax and creates with source='runtime'\n3. schedule_update modifies specified fields\n4. schedule_delete removes runtime tasks\n5. schedule_delete rejects toml-source tasks with clear error","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:31.676869967+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:31.676869967+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.11.2","depends_on_id":"butlers-0qp.11","type":"parent-child","created_at":"2026-02-09T12:11:31.678601718+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.11.3","title":"Write task scheduler tests","description":"Write tests/test_core_scheduler.py covering: TOML sync (first run, update, removal), tick dispatch (due task dispatched), no-op tick (nothing due), disabled tasks skipped, error handling (dispatch failure doesn't stop tick), next_run_at computation, CRUD operations (list, create with valid/invalid cron, update, delete runtime, reject delete toml).","acceptance_criteria":"1. All scenarios tested\n2. MockSpawner used for dispatch verification\n3. Croniter used for next_run_at verification\n4. Tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:37.397770786+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:37.397770786+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.11.3","depends_on_id":"butlers-0qp.11","type":"parent-child","created_at":"2026-02-09T12:11:37.399702054+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.12","title":"Implement Email module","description":"Module implementation with send_email, search_inbox, read_email MCP tools. IMAP for inbox access, SMTP for sending. Configurable via butler.toml [modules.email] section.","acceptance_criteria":"1. Module registers send_email, search_inbox, read_email tools\n2. IMAP connection for inbox operations\n3. SMTP connection for sending\n4. Module declares email credentials in credentials_env","status":"open","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:48.490238233+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:07:48.490238233+08:00","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.12","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:48.491616346+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.12.1","title":"Implement Email module with send and inbox tools","description":"Create src/butlers/modules/email.py implementing the Module ABC. Register MCP tools: send_email(to, subject, body), search_inbox(query), read_email(id). IMAP for inbox access, SMTP for sending. Declare email credentials in credentials_env.","acceptance_criteria":"1. Module implements all Module ABC members\n2. send_email, search_inbox, read_email tools registered\n3. IMAP used for inbox operations\n4. SMTP used for sending\n5. Email credentials declared in credentials_env","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:10.317789812+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:10.317789812+08:00","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.12.1","depends_on_id":"butlers-0qp.12","type":"parent-child","created_at":"2026-02-09T12:12:10.319852578+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.12.2","title":"Write Email module tests","description":"Write tests/test_module_email.py covering: tool registration, mocked IMAP/SMTP calls, config validation, credential declaration.","acceptance_criteria":"1. Tool registration verified\n2. IMAP/SMTP calls mocked\n3. Config validation tested\n4. Tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:11.725477278+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:11.725477278+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.12.2","depends_on_id":"butlers-0qp.12","type":"parent-child","created_at":"2026-02-09T12:12:11.727457439+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13","title":"Implement Switchboard butler","description":"Public ingress butler on port 8100. Owns butler_registry and routing_log tables. MCP tools: route(butler_name, tool_name, args) for inter-butler forwarding via SSE MCP client, list_butlers() for registry query, discover() for config directory scanning. Routing flow: message intake -\u003e CC classification -\u003e route to target butler -\u003e return response. Default-to-general fallback. Telegram and Email modules for message intake.","acceptance_criteria":"1. butler_registry and routing_log tables provisioned\n2. route() forwards tool calls to target butler via MCP client\n3. list_butlers() returns full registry\n4. discover() scans config dirs and updates registry\n5. Trace context propagated through routing\n6. Unknown routes fall back to general butler","status":"open","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:52.670290425+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:07:52.670290425+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.13","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:52.671598907+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.13","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.242535254+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.13","depends_on_id":"butlers-0qp.10","type":"blocks","created_at":"2026-02-09T12:15:49.299449497+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.13","depends_on_id":"butlers-0qp.12","type":"blocks","created_at":"2026-02-09T12:15:49.354005806+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.1","title":"Create Switchboard Alembic revision","description":"Create Alembic revision in alembic/versions/switchboard/ with butler_registry table (name TEXT PK, endpoint_url TEXT NOT NULL, description TEXT, modules JSONB DEFAULT '[]', last_seen_at TIMESTAMPTZ, registered_at TIMESTAMPTZ DEFAULT now()) and routing_log table (id UUID PK, source_channel TEXT NOT NULL, source_id TEXT, routed_to TEXT NOT NULL, prompt_summary TEXT, trace_id TEXT, created_at TIMESTAMPTZ DEFAULT now()). Uses op.execute() with raw SQL.","acceptance_criteria":"1. butler_registry table created with correct schema\n2. routing_log table created with correct schema\n3. Migration idempotent via migration runner","notes":"NOTE: Acceptance criteria #3 is stale — should read 'Migration idempotent via Alembic' instead of 'via migration runner'.","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:12:13.296400213+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:32.429824479+08:00","labels":["butler","database"],"dependencies":[{"issue_id":"butlers-0qp.13.1","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:13.297797453+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.2","title":"Implement Switchboard MCP tools","description":"Create src/butlers/tools/switchboard.py with three tools: route(butler_name, tool_name, args) forwards tool calls to target butler via MCP SSE client with trace context propagation; list_butlers() returns full registry; discover() scans butler config directories and updates registry (add new, update changed, mark stale).","design":"route() creates an MCP client connection to target butler's SSE endpoint, calls the specified tool, propagates _trace_context, logs to routing_log, returns result. discover() walks the butlers/ config directory, reads each butler.toml, upserts into butler_registry.","acceptance_criteria":"1. route() forwards to correct butler endpoint\n2. route() propagates trace context\n3. route() logs to routing_log\n4. list_butlers() returns all registered butlers\n5. discover() finds and registers new butlers","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T12:12:15.264861615+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:15.264861615+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.13.2","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:15.266406593+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.3","title":"Implement MCP client for inter-butler communication","description":"Implement SSE-based MCP client that connects to other butlers' MCP endpoints for the route() tool. Must handle connection lifecycle, trace context injection via _trace_context arg, and error handling for unreachable butlers.","acceptance_criteria":"1. MCP client connects via SSE transport\n2. Tool calls forwarded correctly\n3. _trace_context injected into tool args\n4. Unreachable butler returns clear error","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:17.019866984+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:17.019866984+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.13.3","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:17.021240909+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.4","title":"Implement Switchboard routing flow","description":"Implement the full routing flow: message intake (from Telegram/Email modules or direct MCP) -\u003e CC classification (spawn CC to determine target butler) -\u003e route to target butler -\u003e return response. Default-to-general fallback when no specialist matches.","design":"CC is spawned with a classification prompt listing available butlers and their descriptions. CC returns the target butler name. Switchboard then calls route() to forward. If CC can't classify, defaults to 'general' butler.","acceptance_criteria":"1. Messages classified by CC to correct butler\n2. Route forwarded to target\n3. Response returned to caller\n4. Unknown classification defaults to general\n5. Routing logged","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:19.097920975+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:19.097920975+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.13.4","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:19.099817848+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.5","title":"Create Switchboard butler config","description":"Create butlers/switchboard/butler.toml (name=switchboard, port=8100, modules: telegram, email) and butlers/switchboard/CLAUDE.md (personality: message classifier and router, instructions for classifying incoming messages to the correct specialist butler).","acceptance_criteria":"1. butler.toml has correct name and port\n2. Telegram and email modules enabled\n3. CLAUDE.md contains classification instructions","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:12:21.70130235+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:21.70130235+08:00","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.13.5","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:21.703406535+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.6","title":"Write Switchboard tests","description":"Write tests/test_tools_switchboard.py covering: registry CRUD (discover, list), routing (forward to target, return response), trace context propagation through route(), default-to-general fallback, discover() finding new butlers.","acceptance_criteria":"1. All scenarios tested\n2. MockSpawner used for CC classification\n3. MCP client mocked for inter-butler calls\n4. Trace propagation verified\n5. Tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:22.688350265+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:22.688350265+08:00","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.13.6","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:22.690891115+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.14","title":"Implement Heartbeat butler","description":"Infrastructure butler on port 8199. Calls tick() on every registered butler on a 10-minute cycle. Enumerates butlers from Switchboard's list_butlers(), excludes self, logs results. Error-resilient: one butler's tick failure doesn't stop the cycle.","acceptance_criteria":"1. tick() cycle calls all registered butlers\n2. Self-exclusion from tick targets\n3. Single butler failure doesn't stop cycle\n4. Results logged as sessions\n5. 10-minute cron schedule configured in butler.toml","status":"open","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:56.497043409+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:07:56.497043409+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.14","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:56.49847899+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.14","depends_on_id":"butlers-0qp.13","type":"blocks","created_at":"2026-02-09T12:15:49.410036741+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.14.1","title":"Create Heartbeat butler config and implementation","description":"Create butlers/heartbeat/butler.toml (name=heartbeat, port=8199, schedule: tick every 10 min) and butlers/heartbeat/CLAUDE.md. Heartbeat's tick() enumerates butlers from Switchboard's list_butlers(), excludes itself, calls tick() on each butler via route(). Error-resilient: one failure doesn't stop the cycle.","design":"Heartbeat is a regular butler with a 10-min cron schedule. Its CC prompt: enumerate butlers via list_butlers(), call tick() on each. The CC handles the iteration, Switchboard's route() handles the forwarding.","acceptance_criteria":"1. butler.toml has correct name, port, 10-min schedule\n2. tick cycle enumerates all butlers\n3. Self (heartbeat) excluded from tick targets\n4. Single butler failure doesn't stop cycle\n5. Results logged as sessions","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:12:24.77430292+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:24.77430292+08:00","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.14.1","depends_on_id":"butlers-0qp.14","type":"parent-child","created_at":"2026-02-09T12:12:24.77610824+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.14.2","title":"Write Heartbeat butler tests","description":"Write tests/test_heartbeat.py covering: tick cycle dispatches to all butlers, self-exclusion, error resilience (one butler failing doesn't stop others), session logging of tick results.","acceptance_criteria":"1. All scenarios tested\n2. MockSpawner used for CC\n3. Switchboard mocked for butler enumeration\n4. Error resilience verified\n5. Tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:26.86649374+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:26.86649374+08:00","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.14.2","depends_on_id":"butlers-0qp.14","type":"parent-child","created_at":"2026-02-09T12:12:26.867916608+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15","title":"Implement OpenTelemetry instrumentation","description":"OpenTelemetry SDK integration with Jaeger export. init_telemetry(service_name) sets up tracer with OTLP exporter. Span wrappers for MCP tool handlers (butler.tool.\u003cname\u003e with butler.name attribute). Trace context propagation via _trace_context in MCP args and TRACEPARENT env var for CC instances. No-op when OTEL_EXPORTER_OTLP_ENDPOINT not set.","acceptance_criteria":"1. Spans created for each MCP tool invocation\n2. Parent-child span relationships preserved across butler calls\n3. Trace context propagates to CC instances via TRACEPARENT env var\n4. No-op mode when endpoint not configured (no errors, no overhead)\n5. Errors recorded on spans","status":"open","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:56.788446322+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:07:56.788446322+08:00","labels":["backend","infra"],"dependencies":[{"issue_id":"butlers-0qp.15","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:56.79012853+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15.1","title":"Implement telemetry initialization and tracer setup","description":"Create src/butlers/core/telemetry.py with init_telemetry(service_name) function. Sets up OpenTelemetry TracerProvider with OTLP exporter when OTEL_EXPORTER_OTLP_ENDPOINT env var is set. No-op mode when endpoint not configured (returns a no-op tracer, no errors, no overhead).","acceptance_criteria":"1. Tracer initialized when endpoint configured\n2. No-op mode when endpoint not set\n3. No errors in either mode\n4. Service name set correctly on spans","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:42.037804081+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:42.037804081+08:00","labels":["backend","infra"],"dependencies":[{"issue_id":"butlers-0qp.15.1","depends_on_id":"butlers-0qp.15","type":"parent-child","created_at":"2026-02-09T12:11:42.03928614+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15.2","title":"Implement MCP tool span wrappers","description":"Add span creation wrappers for MCP tool handlers. Each tool invocation creates a span named butler.tool.\u003ctool_name\u003e with butler.name attribute. Errors recorded on spans. Designed as a decorator or context manager for easy application.","acceptance_criteria":"1. Each MCP tool call creates a span\n2. Span named butler.tool.\u003cname\u003e\n3. butler.name attribute set on span\n4. Errors recorded on spans with stack trace","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:48.663308199+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:48.663308199+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.15.2","depends_on_id":"butlers-0qp.15","type":"parent-child","created_at":"2026-02-09T12:11:48.664768948+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15.3","title":"Implement trace context propagation","description":"Add trace context propagation helpers. Inter-butler MCP calls include _trace_context in args (W3C Trace Context format). CC spawner sets TRACEPARENT env var for spawned CC instances. Extract and inject helpers for both directions.","acceptance_criteria":"1. _trace_context injected into inter-butler MCP args\n2. TRACEPARENT env var set for CC instances\n3. Parent-child span relationships preserved across butler boundaries\n4. W3C Trace Context format used","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:52.894003238+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:52.894003238+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.15.3","depends_on_id":"butlers-0qp.15","type":"parent-child","created_at":"2026-02-09T12:11:52.896318672+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15.4","title":"Write telemetry tests","description":"Write tests/test_core_telemetry.py using InMemorySpanExporter. Test: span creation for tool calls, parent-child relationships, error recording on spans, no-op mode (no spans exported when endpoint not set).","acceptance_criteria":"1. InMemorySpanExporter captures test spans\n2. Parent-child relationships verified\n3. Error recording verified\n4. No-op mode verified (no spans)\n5. Tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:57.193345546+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:57.193345546+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.15.4","depends_on_id":"butlers-0qp.15","type":"parent-child","created_at":"2026-02-09T12:11:57.194943314+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16","title":"Implement Relationship butler","description":"Personal CRM butler on port 8102. 16 database tables covering contacts, relationships (bidirectional), important dates (partial date support), notes (with emotion), interactions, reminders (one-time/recurring), gifts (status pipeline), loans, groups, labels, quick facts, and activity feed. Full CRUD MCP tools for each domain.","acceptance_criteria":"1. All 16 tables created via migration\n2. Contact CRUD (create, update, get, search, archive) works\n3. Bidirectional relationships maintained\n4. Upcoming dates computed via month/day matching\n5. Activity feed auto-populated from mutating tools\n6. All tool categories have full CRUD coverage","status":"open","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:00.617968247+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:08:00.617968247+08:00","labels":["backend","butler","database"],"dependencies":[{"issue_id":"butlers-0qp.16","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:00.619699307+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.16","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.464647222+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.1","title":"Create Relationship Alembic revision","description":"Create Alembic revision in alembic/versions/relationship/ with all 16 tables: contacts, relationships, important_dates, notes, interactions, reminders, gifts, loans, groups, group_members, labels, contact_labels, quick_facts, activity_feed, plus necessary indexes. Contacts have archive support (archived_at). Uses op.execute() with raw SQL.","acceptance_criteria":"1. All 16 tables created with correct schemas\n2. Appropriate indexes created (especially for search)\n3. Foreign keys reference contacts table\n4. Migration idempotent","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:13:06.550114248+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:59.409554139+08:00","labels":["butler","database"],"dependencies":[{"issue_id":"butlers-0qp.16.1","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:06.551868301+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.10","title":"Write Relationship butler tests","description":"Write tests/test_tools_relationship.py with full CRUD coverage for all tool categories: contacts, relationships (bidirectional verified), dates (partial dates, upcoming), notes (with emotion, search), interactions, reminders (one_time and recurring), gifts (pipeline), loans, groups, labels, quick facts, and activity feed auto-population.","acceptance_criteria":"1. All tool categories have CRUD test coverage\n2. Bidirectional relationships verified\n3. Upcoming dates computation verified\n4. Feed auto-population verified\n5. Tests use testcontainers PostgreSQL\n6. All tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T12:14:05.555441422+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:05.555441422+08:00","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.16.10","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:14:05.557047867+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.2","title":"Implement contact CRUD tools","description":"Create src/butlers/tools/relationship.py. Contact tools: contact_create(name, details JSONB), contact_update(id, fields), contact_get(id), contact_search(query), contact_archive(id). Archive is soft-delete (sets archived_at). Search supports name and details fields.","acceptance_criteria":"1. contact_create stores name and JSONB details\n2. contact_update modifies specified fields\n3. contact_get returns full contact\n4. contact_search finds by name and details content\n5. contact_archive sets archived_at (soft delete)","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:12.276490714+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:12.276490714+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.2","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:12.278160979+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.3","title":"Implement relationship tools","description":"Add relationship tools: relationship_add(contact_a, contact_b, type, notes) creates bidirectional relationship (two rows), relationship_list(contact_id) returns all relationships for a contact, relationship_remove(contact_a, contact_b) removes both directions.","acceptance_criteria":"1. relationship_add creates bidirectional entries\n2. relationship_list returns all for a contact\n3. relationship_remove deletes both directions\n4. Relationship types are freeform strings","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:13:17.277661356+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:17.277661356+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.3","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:17.279507673+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.4","title":"Implement date and note tools","description":"Add date tools: date_add(contact_id, label, month, day, year?) supports partial dates, date_list(contact_id), upcoming_dates(days_ahead) uses month/day matching. Add note tools: note_create(contact_id, content, emotion?), note_list(contact_id), note_search(query) full-text search.","acceptance_criteria":"1. Partial dates supported (month/day without year)\n2. upcoming_dates computes correctly via month/day matching\n3. Notes support optional emotion tag\n4. note_search performs text search","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:24.598571352+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:24.598571352+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.4","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:24.600378536+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.5","title":"Implement interaction and reminder tools","description":"Add interaction tools: interaction_log(contact_id, type, summary, occurred_at), interaction_list(contact_id, limit). Add reminder tools: reminder_create(contact_id, message, type: one_time|recurring, cron?), reminder_list(contact_id), reminder_dismiss(id).","acceptance_criteria":"1. Interactions logged with type and timestamp\n2. interaction_list supports limit\n3. Reminders support one_time and recurring types\n4. Recurring reminders use cron expressions\n5. reminder_dismiss marks as dismissed","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:31.148193949+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:31.148193949+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.5","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:31.150154412+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.6","title":"Implement gift and loan tools","description":"Add gift tools: gift_add(contact_id, description, occasion?), gift_update_status(id, status) with pipeline (idea→purchased→wrapped→given→thanked), gift_list(contact_id, status?). Add loan tools: loan_create(contact_id, amount, direction: lent|borrowed, description), loan_settle(id), loan_list(contact_id).","acceptance_criteria":"1. Gift status pipeline enforced\n2. gift_list filterable by status\n3. Loans track direction (lent/borrowed)\n4. loan_settle marks as settled\n5. loan_list shows outstanding and settled","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:38.368683047+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:38.368683047+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.6","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:38.370303819+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.7","title":"Implement group, label, and quick fact tools","description":"Add group tools: group_create(name), group_add_member(group_id, contact_id), group_list(). Add label tools: label_create(name, color?), label_assign(label_id, contact_id), contact_search_by_label(label_name). Add quick facts: fact_set(contact_id, key, value) upserts, fact_list(contact_id).","acceptance_criteria":"1. Groups support member management\n2. Labels assignable to contacts\n3. contact_search_by_label finds all contacts with label\n4. fact_set upserts (same key updates)\n5. fact_list returns all facts for contact","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:44.554935086+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:44.554935086+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.7","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:44.556417015+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.8","title":"Implement activity feed","description":"Add feed_get(contact_id?, limit) tool. Activity feed auto-populated from all mutating tools (contact created, note added, interaction logged, gift status changed, etc.). Each feed entry has type, description, contact_id, and timestamp.","acceptance_criteria":"1. feed_get returns recent activity\n2. All mutating tools create feed entries\n3. Filterable by contact_id\n4. Supports limit parameter","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:13:50.656783955+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:50.656783955+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.8","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:50.658852192+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.9","title":"Create Relationship butler config","description":"Create butlers/relationship/butler.toml (name=relationship, port=8102) and butlers/relationship/CLAUDE.md (personality: personal CRM assistant, instructions for managing contacts, relationships, and personal data).","acceptance_criteria":"1. butler.toml has correct name and port\n2. CLAUDE.md has appropriate personality and instructions","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:13:57.517006656+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:57.517006656+08:00","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.16.9","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:57.518888911+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17","title":"Implement butler daemon core","description":"ButlerDaemon class orchestrating the full startup sequence: config load -\u003e credential validation -\u003e DB provision -\u003e core migrations -\u003e butler migrations -\u003e module init (topological order) -\u003e tool registration -\u003e FastMCP server start. Core MCP tool wiring: status(), tick(), trigger(), state_*, schedule_*, sessions_*. Graceful shutdown in reverse order.","acceptance_criteria":"1. Startup sequence executes in correct order\n2. All core MCP tools registered and callable\n3. Module tools registered in topological order\n4. status() returns butler identity, modules, health, uptime\n5. Graceful shutdown: stop connections, wait for in-flight CC, module shutdown (reverse order), close DB pool","status":"open","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:01.740428366+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:08:01.740428366+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:01.742111877+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.2","type":"blocks","created_at":"2026-02-09T12:15:48.513249193+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.3","type":"blocks","created_at":"2026-02-09T12:15:48.568728916+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.4","type":"blocks","created_at":"2026-02-09T12:15:48.909758455+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.5","type":"blocks","created_at":"2026-02-09T12:15:48.964838122+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.6","type":"blocks","created_at":"2026-02-09T12:15:49.02041538+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.7","type":"blocks","created_at":"2026-02-09T12:15:49.076717888+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.8","type":"blocks","created_at":"2026-02-09T12:15:49.133485584+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.11","type":"blocks","created_at":"2026-02-09T12:15:49.187240499+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.1","title":"Implement ButlerDaemon class with startup sequence","description":"Create src/butlers/daemon.py with ButlerDaemon class. Orchestrates startup: config load -\u003e credential validation -\u003e DB provision -\u003e core Alembic migrations -\u003e butler-specific Alembic migrations -\u003e module init (topological order, including module Alembic revisions) -\u003e tool registration -\u003e FastMCP server start. The composition root that wires everything together.","design":"ButlerDaemon holds references to config, db pool, spawner, scheduler, modules. Startup is a sequential async flow. FastMCP server created with butler name, runs on configured port with SSE transport.","acceptance_criteria":"1. Startup executes in correct documented order\n2. Failure at any step prevents subsequent steps\n3. All components accessible on daemon instance\n4. FastMCP server starts on configured port","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T12:12:02.345988389+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:02.889998748+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.1","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:02.347898496+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.2","title":"Implement core MCP tool registration","description":"Wire all core MCP tools on the FastMCP server instance: status(), tick(), trigger(prompt), state_get/set/delete/list, schedule_list/create/update/delete, sessions_list/get. Each tool delegates to the appropriate core component.","acceptance_criteria":"1. All core tools registered on FastMCP\n2. Tools callable via MCP protocol\n3. Tools delegate to correct core components\n4. Tool signatures match spec","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:12:10.333829246+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:10.333829246+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.2","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:10.335774421+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.3","title":"Implement module tool registration","description":"Call register_tools(mcp, config, db) for each enabled module in topological order. Module configs validated against their config_schema. Module migrations applied before tool registration.","acceptance_criteria":"1. Modules loaded in topological dependency order\n2. Module configs validated against config_schema\n3. Module migrations applied before register_tools\n4. Module tools registered on shared FastMCP instance","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:14.909502577+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:14.909502577+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.3","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:14.911256801+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.4","title":"Implement graceful shutdown sequence","description":"Graceful shutdown: stop accepting new connections, wait for in-flight CC instances to complete, call module on_shutdown() in reverse topological order, close DB pool. Triggered by SIGINT/SIGTERM or explicit shutdown call.","acceptance_criteria":"1. No new connections accepted during shutdown\n2. In-flight CC instances complete before shutdown\n3. Module on_shutdown called in reverse order\n4. DB pool closed last\n5. Clean exit with no resource leaks","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:12:20.729320572+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:20.729320572+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.4","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:20.731030692+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.5","title":"Implement status() MCP tool","description":"Implement status() tool returning butler identity (name, description, port), loaded modules list, health status, and uptime (time since startup). Used by Heartbeat and for diagnostics.","acceptance_criteria":"1. Returns butler name, description, port\n2. Lists loaded modules\n3. Reports health status\n4. Reports uptime since startup","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:12:27.77168615+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:27.77168615+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.5","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:27.773122944+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.6","title":"Write butler daemon tests","description":"Write tests/test_daemon.py covering: startup sequence order verification, core tool registration, module tool registration, shutdown order (reverse of startup), status() tool output.","acceptance_criteria":"1. Startup sequence order verified\n2. All core tools registered\n3. Module registration in topological order\n4. Shutdown in reverse order\n5. status() returns expected fields\n6. Tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:33.486972898+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:33.486972898+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.17.6","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:33.488891312+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18","title":"Implement Health butler","description":"Health tracking butler on port 8103. Tables for measurements, medications, medication_doses, conditions, meals, symptoms, research. MCP tools for measurement logging/history, medication management with adherence rate, condition tracking, diet/nutrition with aggregation, symptom tracking, research notes, and health summary/trend reports.","acceptance_criteria":"1. All health tables created via migration\n2. Measurement log/history/latest tools work\n3. Medication adherence rate computed correctly\n4. Nutrition summary aggregates meal data\n5. Trend report generates meaningful summaries\n6. All tool categories have full coverage","status":"open","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:04.479165077+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:08:04.479165077+08:00","labels":["backend","butler","database"],"dependencies":[{"issue_id":"butlers-0qp.18","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:04.480751704+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.18","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.520924002+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.1","title":"Create Health database migration","description":"Create migrations/health/001_health.sql with tables: measurements (id, type, value JSONB, unit, measured_at), medications (id, name, dosage, frequency, active), medication_doses (id, medication_id FK, taken_at, notes), conditions (id, name, status, diagnosed_at, notes), meals (id, description, calories, nutrients JSONB, eaten_at), symptoms (id, name, severity, notes, occurred_at), research (id, topic, content, sources JSONB, created_at). Plus appropriate indexes.","acceptance_criteria":"1. All 7 tables created with correct schemas\n2. Foreign key from medication_doses to medications\n3. Appropriate indexes for time-range queries\n4. Migration idempotent","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:13.969283232+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:13.969283232+08:00","labels":["butler","database"],"dependencies":[{"issue_id":"butlers-0qp.18.1","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:13.970835654+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.2","title":"Implement measurement tools","description":"Create src/butlers/tools/health.py. Measurement tools: measurement_log(type, value, unit, measured_at?), measurement_history(type, since?, until?), measurement_latest(type). Types are freeform strings (weight, blood_pressure, heart_rate, etc.). Values stored as JSONB to support compound measurements.","acceptance_criteria":"1. measurement_log stores with timestamp\n2. measurement_history filters by type and date range\n3. measurement_latest returns most recent for type\n4. JSONB values support compound data (e.g., systolic/diastolic)","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:21.715545229+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:21.715545229+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.2","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:21.717811009+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.3","title":"Implement medication tools","description":"Add medication tools: medication_add(name, dosage, frequency), medication_list(active_only?), medication_log_dose(medication_id, taken_at?, notes?), medication_history(medication_id, since?, until?) with adherence rate computation (doses taken / expected doses based on frequency).","acceptance_criteria":"1. medication_add creates active medication\n2. medication_list filterable by active status\n3. medication_log_dose records dose taken\n4. medication_history includes adherence rate\n5. Adherence rate computed correctly","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:28.704068241+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:28.704068241+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.3","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:28.705861979+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.4","title":"Implement condition and symptom tools","description":"Add condition tools: condition_add(name, status, diagnosed_at?, notes?), condition_list(status?), condition_update(id, fields). Add symptom tools: symptom_log(name, severity 1-10, notes?, occurred_at?), symptom_history(name?, since?, until?), symptom_search(query).","acceptance_criteria":"1. Conditions track status (active, resolved, managed)\n2. condition_list filterable by status\n3. symptom_log records with severity scale\n4. symptom_history supports filtering\n5. symptom_search finds by name and notes","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:34.046531237+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:34.046531237+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.4","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:34.048107193+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.5","title":"Implement diet and nutrition tools","description":"Add diet tools: meal_log(description, calories?, nutrients JSONB?, eaten_at?), meal_history(since?, until?), nutrition_summary(since, until) aggregating calories and nutrient totals over a date range.","acceptance_criteria":"1. meal_log stores with optional nutrition data\n2. meal_history returns meals in date range\n3. nutrition_summary aggregates calories and nutrients\n4. Nutrients stored as JSONB for flexibility","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:39.942698291+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:39.942698291+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.5","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:39.944401669+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.6","title":"Implement research and report tools","description":"Add research tools: research_save(topic, content, sources?), research_search(query), research_summarize(topic). Add report tools: health_summary() returns overview of recent measurements/medications/conditions, trend_report(type, since, until) generates trend analysis for a measurement type.","acceptance_criteria":"1. research_save stores with optional sources\n2. research_search finds by topic and content\n3. health_summary covers all health domains\n4. trend_report analyzes measurement trends","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:45.803917756+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:45.803917756+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.6","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:45.805411358+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.7","title":"Create Health butler config","description":"Create butlers/health/butler.toml (name=health, port=8103) and butlers/health/CLAUDE.md (personality: health tracking assistant, instructions for logging and analyzing health data).","acceptance_criteria":"1. butler.toml has correct name and port\n2. CLAUDE.md has appropriate personality and instructions","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:14:50.993440482+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:50.993440482+08:00","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.18.7","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:50.994989267+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.8","title":"Write Health butler tests","description":"Write tests/test_tools_health.py with full coverage: measurements (log, history, latest), medications (add, list, log dose, adherence rate), conditions (add, list, update), diet (meal log, history, nutrition summary), symptoms (log, history, search), research (save, search), reports (health summary, trend report).","acceptance_criteria":"1. All tool categories tested\n2. Adherence rate computation verified\n3. Nutrition aggregation verified\n4. Trend report generation verified\n5. Tests use testcontainers PostgreSQL\n6. All tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:14:56.713963614+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:56.713963614+08:00","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.18.8","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:56.715440694+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19","title":"Implement General butler","description":"Catch-all butler on port 8101. Schema-light freeform JSONB storage with collections and entities tables (GIN indexes). Entity CRUD with deep merge on update. Collection management. Export tools for future migration to specialist butlers. The default routing target when no specialist butler matches.","acceptance_criteria":"1. collections and entities tables with GIN indexes created\n2. Entity CRUD (create, get, update with deep merge, search, delete) works\n3. Collection management tools work\n4. GIN index enables efficient JSONB search\n5. Export tools produce usable output","status":"open","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:09.581501378+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:08:09.581501378+08:00","labels":["backend","butler","database"],"dependencies":[{"issue_id":"butlers-0qp.19","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:09.583583942+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.19","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.578087044+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19.1","title":"Create General database migration","description":"Create migrations/general/001_general.sql with collections table (id UUID PK, name TEXT UNIQUE, description TEXT, created_at TIMESTAMPTZ) and entities table (id UUID PK, collection_id UUID FK, data JSONB NOT NULL, created_at TIMESTAMPTZ, updated_at TIMESTAMPTZ). Add GIN index on entities.data for efficient JSONB search.","acceptance_criteria":"1. collections and entities tables created\n2. GIN index on entities.data\n3. Foreign key from entities to collections\n4. Migration idempotent","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:15:03.112865592+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:15:03.112865592+08:00","labels":["butler","database"],"dependencies":[{"issue_id":"butlers-0qp.19.1","depends_on_id":"butlers-0qp.19","type":"parent-child","created_at":"2026-02-09T12:15:03.114392125+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19.2","title":"Implement General butler entity and collection tools","description":"Create src/butlers/tools/general.py. Entity tools: entity_create(collection, data JSONB), entity_get(id), entity_update(id, data) with deep merge, entity_search(collection?, query JSONB), entity_delete(id). Collection tools: collection_create(name, description?), collection_list(), collection_delete(name). Export tools: export_collection(name) returns all entities as JSON.","design":"entity_update uses JSONB deep merge (jsonb_deep_merge or || operator with recursive merge). entity_search uses GIN index via @\u003e containment operator. Export produces a JSON array of all entities in a collection.","acceptance_criteria":"1. Entity CRUD with deep merge on update\n2. GIN-indexed JSONB search via containment\n3. Collection management works\n4. Export produces complete collection dump\n5. Freeform JSONB data accepted","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:15:12.418318081+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:15:12.418318081+08:00","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.19.2","depends_on_id":"butlers-0qp.19","type":"parent-child","created_at":"2026-02-09T12:15:12.419722404+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19.3","title":"Create General butler config","description":"Create butlers/general/butler.toml (name=general, port=8101) and butlers/general/CLAUDE.md (personality: flexible catch-all assistant, instructions for storing and retrieving freeform data).","acceptance_criteria":"1. butler.toml has correct name and port\n2. CLAUDE.md has appropriate personality and instructions","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:15:17.077605865+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:15:17.077605865+08:00","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.19.3","depends_on_id":"butlers-0qp.19","type":"parent-child","created_at":"2026-02-09T12:15:17.07953562+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19.4","title":"Write General butler tests","description":"Write tests/test_tools_general.py covering: entity CRUD, deep merge on update (nested objects merged correctly), GIN-indexed search (containment queries), collection management, export, freeform JSONB acceptance.","acceptance_criteria":"1. All tool operations tested\n2. Deep merge verified with nested objects\n3. GIN search verified with containment\n4. Export completeness verified\n5. Tests use testcontainers PostgreSQL\n6. All tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:15:22.437261116+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:15:22.437261116+08:00","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.19.4","depends_on_id":"butlers-0qp.19","type":"parent-child","created_at":"2026-02-09T12:15:22.439045156+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2","title":"Implement config loading","description":"Parse butler.toml configuration files with support for [butler] identity (name, port, description), [butler.db] database config, [butler.env] credential declarations (required/optional), [[butler.schedule]] task definitions, and [modules.*] module configs. Validate required fields, apply defaults.","acceptance_criteria":"1. Valid full config loads all sections correctly\n2. Minimal config applies defaults (db name = butler_{name})\n3. Missing/invalid TOML raises clear error\n4. Missing required fields (name, port) prevent startup","status":"open","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:06:58.946023801+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:06:58.946023801+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.2","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:06:58.947296466+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2.1","title":"Implement ButlerConfig dataclass and TOML parser","description":"Create src/butlers/config.py with ButlerConfig dataclass. Parse butler.toml sections: [butler] (name, port, description), [butler.db] (name with default butler_{name}), [[butler.schedule]] (name, cron, prompt), [modules.*] (module-specific config). Use tomllib (stdlib).","design":"ButlerConfig dataclass with fields: name (str), port (int), description (str|None), db_name (str), schedules (list[ScheduleConfig]), modules (dict[str, dict]). ScheduleConfig dataclass: name, cron, prompt. Validation at parse time.","acceptance_criteria":"1. Valid full config loads all sections\n2. Minimal config (name + port only) applies defaults\n3. Config object exposes all parsed fields","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:14.821442559+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:10:14.821442559+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.2.1","depends_on_id":"butlers-0qp.2","type":"parent-child","created_at":"2026-02-09T12:10:14.823012765+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2.2","title":"Add butler.env credential declaration support","description":"Add [butler.env] section parsing to ButlerConfig. Supports required (list[str]) and optional (list[str]) env var declarations. These are used by credential validation at startup.","acceptance_criteria":"1. [butler.env].required parsed as list of env var names\n2. [butler.env].optional parsed as list of env var names\n3. Missing section defaults to empty lists","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:18.113979062+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:10:18.113979062+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.2.2","depends_on_id":"butlers-0qp.2","type":"parent-child","created_at":"2026-02-09T12:10:18.115508922+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2.3","title":"Add config validation for required fields","description":"Validate that butler.toml contains [butler] section with name (str) and port (int). Reject startup with clear error if file is missing, unparseable TOML, or lacks required fields.","acceptance_criteria":"1. Missing butler.toml raises ConfigError\n2. Invalid TOML syntax raises parse error with location info\n3. Missing name field raises validation error\n4. Missing port field raises validation error\n5. Daemon does not proceed past config loading on error","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:19.392429438+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:10:19.392429438+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.2.3","depends_on_id":"butlers-0qp.2","type":"parent-child","created_at":"2026-02-09T12:10:19.394163243+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2.4","title":"Write config loading tests","description":"Write tests/test_config.py covering: valid full config, minimal config with defaults, missing file, invalid TOML, missing required fields (name, port), env section parsing, schedule section parsing, module section parsing.","acceptance_criteria":"1. Test cases for every scenario listed\n2. All tests pass\n3. Edge cases covered (empty sections, extra fields)","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:21.201546671+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:10:21.201546671+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.2.4","depends_on_id":"butlers-0qp.2","type":"parent-child","created_at":"2026-02-09T12:10:21.203415531+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20","title":"Implement CLI commands","description":"Click-based CLI with 4 commands: 'butlers up' (discover all butler.toml configs, start all in single asyncio event loop, --only filtering), 'butlers run --config' (single butler startup), 'butlers list' (discover and display names/ports/modules), 'butlers init \u003cname\u003e --port' (scaffold config dir with butler.toml, CLAUDE.md, AGENTS.md, skills/). Graceful shutdown on SIGINT/SIGTERM. Entry point in pyproject.toml.","acceptance_criteria":"1. butlers up discovers and starts all butlers\n2. butlers up --only filters to specific butlers\n3. butlers run starts a single butler from config path\n4. butlers list displays all discovered butlers\n5. butlers init scaffolds a complete config directory\n6. SIGINT/SIGTERM trigger graceful shutdown\n7. Entry point registered in pyproject.toml","status":"open","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:17.695713261+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:08:17.695713261+08:00","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:17.697466273+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.20","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.635262191+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.1","title":"Implement Click CLI with butlers up command","description":"Create src/butlers/cli.py with Click CLI group. Implement 'butlers up' command: discover all butler.toml configs in butlers/ directory, start all butler daemons in a single asyncio event loop, support --only flag to filter specific butlers.","design":"Click group 'butlers' with subcommands. 'up' discovers config dirs, creates ButlerDaemon per config, runs all in asyncio.gather. --only accepts comma-separated butler names.","acceptance_criteria":"1. butlers up discovers all butler configs\n2. All discovered butlers start in one event loop\n3. --only filters to specified butlers only\n4. Missing butlers/ directory gives clear error","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:46.75134368+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:46.75134368+08:00","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.1","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:46.752872989+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.2","title":"Implement butlers run command","description":"Implement 'butlers run --config \u003cpath\u003e' command: start a single butler daemon from the specified config directory path.","acceptance_criteria":"1. Starts single butler from config path\n2. Missing config path gives clear error\n3. Invalid config gives clear error\n4. Runs until SIGINT/SIGTERM","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:13:49.59251006+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:49.59251006+08:00","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.2","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:49.594832366+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.3","title":"Implement butlers list command","description":"Implement 'butlers list' command: discover all butler.toml configs and display butler names, ports, descriptions, and enabled modules in a formatted table.","acceptance_criteria":"1. Discovers all butler configs\n2. Displays name, port, description, modules\n3. Formatted for readability","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:13:51.559502+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:51.559502+08:00","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.3","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:51.561034836+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.4","title":"Implement butlers init command","description":"Implement 'butlers init \u003cname\u003e --port \u003cport\u003e' command: scaffold a new butler config directory with butler.toml (pre-filled name and port), CLAUDE.md (template), AGENTS.md (empty), and skills/ directory.","acceptance_criteria":"1. Creates butlers/\u003cname\u003e/ directory\n2. butler.toml has correct name and port\n3. CLAUDE.md created with template content\n4. AGENTS.md created (empty or with template)\n5. skills/ directory created\n6. Existing directory not overwritten","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:13:55.377542099+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:55.377542099+08:00","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.4","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:55.409346322+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.5","title":"Implement graceful shutdown on signals","description":"Handle SIGINT and SIGTERM in CLI commands. Trigger graceful shutdown of all running butler daemons. Works for both 'butlers up' (multiple) and 'butlers run' (single).","acceptance_criteria":"1. SIGINT triggers graceful shutdown\n2. SIGTERM triggers graceful shutdown\n3. All butlers shut down cleanly\n4. Exit code 0 on clean shutdown","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:13:58.562950862+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:58.562950862+08:00","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.5","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:58.566326098+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.6","title":"Add CLI entry point to pyproject.toml","description":"Add [project.scripts] entry point to pyproject.toml mapping 'butlers' to src/butlers/cli.py main function. Verify 'butlers --help' works after uv sync.","acceptance_criteria":"1. [project.scripts] entry defined\n2. butlers --help works after installation\n3. All subcommands listed","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":10,"created_at":"2026-02-09T12:14:01.354292834+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:01.354292834+08:00","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.20.6","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:14:01.356183365+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.7","title":"Write CLI tests","description":"Write tests/test_cli.py using Click's CliRunner. Test: command invocation (up, run, list, init), discovery of butler configs, init scaffolding (correct files created), signal handling.","acceptance_criteria":"1. All commands tested via CliRunner\n2. Discovery logic verified\n3. Init scaffolding verified (files exist with correct content)\n4. Tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:04.417757963+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:04.417757963+08:00","labels":["cli","testing"],"dependencies":[{"issue_id":"butlers-0qp.20.7","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:14:04.419483632+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.21","title":"Implement Docker and deployment","description":"Dockerfile with python:3.12-slim base, Node.js 22, claude-code npm package, uv. docker-compose.yml defining postgres:17, jaeger, switchboard, general, relationship, health, heartbeat services. Dev quick start: docker compose up -d postgres jaeger \u0026\u0026 butlers up. Production: docker compose up -d.","acceptance_criteria":"1. Dockerfile builds successfully with all runtime deps\n2. docker-compose.yml defines all services with correct ports\n3. Dev mode: postgres + jaeger containers, butlers up locally\n4. Production mode: full stack via docker compose up -d\n5. Database auto-provisioning works in both modes","status":"open","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:22.006375664+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:08:22.006375664+08:00","labels":["deployment","infra"],"dependencies":[{"issue_id":"butlers-0qp.21","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:22.00884053+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.21","depends_on_id":"butlers-0qp.20","type":"blocks","created_at":"2026-02-09T12:15:49.691993498+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.21.1","title":"Create Dockerfile","description":"Create Dockerfile based on python:3.12-slim. Install Node.js 22 (for claude-code npm package), install claude-code globally, install uv, copy project, run uv sync. Entrypoint: butlers run --config.","acceptance_criteria":"1. Builds successfully\n2. Python 3.12, Node.js 22, claude-code, uv all available\n3. Project dependencies installed\n4. Entrypoint works with --config flag","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:09.715751029+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:09.715751029+08:00","labels":["deployment","infra"],"dependencies":[{"issue_id":"butlers-0qp.21.1","depends_on_id":"butlers-0qp.21","type":"parent-child","created_at":"2026-02-09T12:14:09.718671745+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.21.2","title":"Create docker-compose.yml","description":"Create docker-compose.yml defining services: postgres:17 (with health check), jaeger (all-in-one with OTLP receiver), switchboard (port 8100), general (port 8101), relationship (port 8102), health (port 8103), heartbeat (port 8199). All butler services depend on postgres, share ANTHROPIC_API_KEY env var.","design":"postgres: postgres:17 with POSTGRES_PASSWORD, volume for data persistence, health check. jaeger: jaegertracing/all-in-one with ports 16686 (UI) and 4317 (OTLP). Butler services: built from Dockerfile, each with --config pointing to their butler dir, depends_on postgres healthy.","acceptance_criteria":"1. All services defined with correct ports\n2. postgres has health check\n3. Butler services depend on postgres\n4. ANTHROPIC_API_KEY passed to all butler services\n5. Jaeger configured for OTLP and UI","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:12.351420431+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:12.351420431+08:00","labels":["deployment","infra"],"dependencies":[{"issue_id":"butlers-0qp.21.2","depends_on_id":"butlers-0qp.21","type":"parent-child","created_at":"2026-02-09T12:14:12.352938389+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.21.3","title":"Verify dev and production quick starts","description":"Verify two deployment modes work: Dev mode (docker compose up -d postgres jaeger \u0026\u0026 butlers up), Production mode (docker compose up -d). Document any required .env setup.","acceptance_criteria":"1. Dev mode: postgres + jaeger in Docker, butlers locally\n2. Production mode: full stack via docker compose\n3. Database auto-provisioning works in both modes\n4. Butlers connect to postgres in both modes","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:14.068098688+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:14.068098688+08:00","labels":["deployment","infra"],"dependencies":[{"issue_id":"butlers-0qp.21.3","depends_on_id":"butlers-0qp.21","type":"parent-child","created_at":"2026-02-09T12:14:14.069519131+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22","title":"Write integration tests","description":"End-to-end integration tests using testcontainer PostgreSQL and MockSpawner. Four key test scenarios: full butler startup lifecycle, scheduler tick dispatch, switchboard routing, and trace context propagation across the full chain.","acceptance_criteria":"1. Full butler startup test: config -\u003e DB -\u003e migrations -\u003e tools -\u003e status()\n2. Scheduler tick dispatches to MockSpawner and logs session\n3. Switchboard route() forwards to target and returns result\n4. Trace context propagates from switchboard.route -\u003e butler.trigger -\u003e CC session","status":"open","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:25.898819522+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:08:25.898819522+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:25.900446235+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.22","depends_on_id":"butlers-0qp.13","type":"blocks","created_at":"2026-02-09T12:15:49.750331942+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.22","depends_on_id":"butlers-0qp.14","type":"blocks","created_at":"2026-02-09T12:15:49.808386599+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.22","depends_on_id":"butlers-0qp.15","type":"blocks","created_at":"2026-02-09T12:15:49.867003609+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22.1","title":"Write full butler startup integration test","description":"Integration test: full butler startup with testcontainer PostgreSQL and MockSpawner. Verify: config load -\u003e DB provision -\u003e migrations -\u003e tool registration -\u003e status() returns correct data. Tests the entire ButlerDaemon lifecycle end-to-end.","acceptance_criteria":"1. Real PostgreSQL via testcontainers\n2. Full startup sequence completes\n3. Database provisioned with all tables\n4. MCP tools registered and callable\n5. status() returns correct identity and modules","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:14:18.621003233+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:18.621003233+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22.1","depends_on_id":"butlers-0qp.22","type":"parent-child","created_at":"2026-02-09T12:14:18.62251031+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22.2","title":"Write scheduler tick integration test","description":"Integration test: scheduler tick dispatches to MockSpawner and logs session. Set up a butler with a schedule, advance time past cron trigger, call tick(), verify MockSpawner received the prompt and session was logged.","acceptance_criteria":"1. Schedule task created in DB\n2. tick() dispatches due task to MockSpawner\n3. MockSpawner receives correct prompt\n4. Session logged with trigger_source='schedule'","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:22.531100628+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:22.531100628+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22.2","depends_on_id":"butlers-0qp.22","type":"parent-child","created_at":"2026-02-09T12:14:22.53281709+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22.3","title":"Write switchboard routing integration test","description":"Integration test: switchboard route() forwards to target butler and returns result. Set up switchboard and a target butler, register target in butler_registry, call route() with a tool name and args, verify target receives the call and response is returned.","acceptance_criteria":"1. Both butlers running (switchboard + target)\n2. Target registered in butler_registry\n3. route() forwards tool call to target\n4. Response returned to caller\n5. routing_log entry created","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:14:23.427141692+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:23.427141692+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22.3","depends_on_id":"butlers-0qp.22","type":"parent-child","created_at":"2026-02-09T12:14:23.428802088+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22.4","title":"Write trace context propagation integration test","description":"Integration test: trace context propagates from switchboard.route -\u003e butler.trigger -\u003e CC session. Verify parent-child span relationships across the full chain using InMemorySpanExporter.","acceptance_criteria":"1. Trace context injected at switchboard\n2. Propagated through route() to target butler\n3. Propagated to CC session via TRACEPARENT\n4. Parent-child span relationships verified\n5. All spans share same trace ID","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:24.548055995+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:24.548055995+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22.4","depends_on_id":"butlers-0qp.22","type":"parent-child","created_at":"2026-02-09T12:14:24.54955182+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3","title":"Implement module system","description":"Build the pluggable module system: Module ABC with name, config_schema, dependencies, register_tools, migrations, on_startup, on_shutdown. Module registry with topological dependency sort, circular dependency detection, and config-driven loading from butler.toml [modules.*] sections.","acceptance_criteria":"1. Module ABC enforces all required abstract members\n2. Registry resolves dependencies via topological sort\n3. Circular dependencies detected and rejected\n4. Missing dependencies fail fast with clear error\n5. Modules loaded in correct dependency order","status":"open","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:02.879608473+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:07:02.879608473+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.3","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:02.880944878+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3.1","title":"Implement Module abstract base class","description":"Create src/butlers/modules/base.py with Module ABC. Abstract members: name (str property), config_schema (type[BaseModel] property), dependencies (list[str] property), register_tools(mcp, config, db) async method, migration_revisions() method returning str | None (Alembic branch label for module's revisions, or None if no migrations needed), on_startup(config, db) async method, on_shutdown() async method.","design":"Use abc.ABC and abc.abstractmethod. config_schema returns a Pydantic BaseModel subclass so module configs are validated. Dependencies declared as module name strings. register_tools receives FastMCP instance, validated config, and asyncpg pool.","acceptance_criteria":"1. Cannot instantiate Module directly (ABC)\n2. Subclass missing any abstract member raises TypeError\n3. Minimal concrete implementation instantiates successfully\n4. All abstract members have correct signatures","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:31.971700635+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:54.809198287+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.3.1","depends_on_id":"butlers-0qp.3","type":"parent-child","created_at":"2026-02-09T12:10:31.973741289+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3.2","title":"Implement module registry with topological sort","description":"Create src/butlers/modules/registry.py. Module registry maintains name-\u003eclass mapping. load_from_config(modules_config) instantiates enabled modules, resolves dependency order via topological sort (Kahn's algorithm), detects circular dependencies, and validates all declared dependencies exist in the registry.","design":"Registry is a dict[str, type[Module]]. Topological sort using in-degree counting (Kahn's algorithm). Circular deps detected when sorted result length != input length. Missing deps caught during validation before sort.","acceptance_criteria":"1. Modules registered by name\n2. load_from_config returns modules in topological order\n3. Circular dependencies raise clear error\n4. Missing dependencies raise clear error\n5. Independent modules have no ordering constraints","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:37.455060922+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:10:37.455060922+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.3.2","depends_on_id":"butlers-0qp.3","type":"parent-child","created_at":"2026-02-09T12:10:37.456657337+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3.3","title":"Write Module ABC tests","description":"Write tests/test_module_base.py covering: minimal module implementation with all members, incomplete implementation raises TypeError, module with no dependencies returns empty list, module with no migrations returns empty list.","acceptance_criteria":"1. All scenarios tested\n2. Tests verify ABC enforcement\n3. Tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:40.287952205+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:10:40.287952205+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.3.3","depends_on_id":"butlers-0qp.3","type":"parent-child","created_at":"2026-02-09T12:10:40.289652526+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3.4","title":"Write module registry tests","description":"Write tests/test_module_registry.py covering: registration, dependency ordering (A depends on B → B loads first), circular detection (A→B→A), missing dependencies, config-driven loading, modules not in config excluded.","acceptance_criteria":"1. Dependency ordering verified with 3+ modules\n2. Circular dependency raises error with cycle description\n3. Missing dependency raises error naming the missing module\n4. Only config-enabled modules loaded","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:43.277281263+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:10:43.277281263+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.3.4","depends_on_id":"butlers-0qp.3","type":"parent-child","created_at":"2026-02-09T12:10:43.279165452+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4","title":"Implement database layer","description":"Alembic migration setup, asyncpg connection pool management, and database auto-provisioning (CREATE DATABASE IF NOT EXISTS via maintenance connection). Core Alembic revision creates state, scheduled_tasks, and sessions tables. Each butler gets its own dedicated PostgreSQL database. Alembic uses multiple version chains (core + per-butler) under alembic/versions/.","acceptance_criteria":"1. Database auto-created on first startup\n2. Migrations applied idempotently\n3. _migrations table tracks applied migrations\n4. Connection pool reusable across components","notes":"NOTE: Acceptance criteria #3 is stale — should read 'Alembic alembic_version table tracks applied revisions' instead of '_migrations table'. Updated in design.md D12.","status":"open","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:06.6354237+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:29.111834004+08:00","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.4","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:06.636861536+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4.1","title":"Implement asyncpg connection pool and DB provisioning","description":"Create src/butlers/db.py with Database class. Connect to PostgreSQL maintenance DB to CREATE DATABASE IF NOT EXISTS for the butler's dedicated database. Return asyncpg connection pool for the butler's DB. Support configurable host/port/user/password via environment variables (POSTGRES_HOST, POSTGRES_PORT, POSTGRES_USER, POSTGRES_PASSWORD).","design":"Database class with async init: connect to postgres DB, check if target DB exists, create if not, then create pool to target DB. Pool size configurable. Connection parameters from env vars with sensible defaults (localhost:5432, postgres/postgres).","acceptance_criteria":"1. Database created on first startup\n2. Existing database reused on subsequent startups\n3. Connection pool returned and usable\n4. Env var configuration works","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:52.085375999+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:10:52.085375999+08:00","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.4.1","depends_on_id":"butlers-0qp.4","type":"parent-child","created_at":"2026-02-09T12:10:52.088879637+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4.2","title":"Set up Alembic migration infrastructure","description":"Set up Alembic for database migrations. Create alembic/ directory with alembic.ini, env.py (programmatic env that targets the correct butler DB via alembic.command.upgrade), and versions/ directory structure with subdirectories for each version chain (core/, switchboard/, relationship/, health/, general/). The env.py must support being called programmatically from the daemon at startup, targeting the butler's asyncpg database. Migrations use raw SQL via op.execute() — no SQLAlchemy models.","design":"Alembic env.py handles multi-chain setup. Each chain (core, switchboard, relationship, etc.) has its own versions directory. The daemon calls alembic.command.upgrade programmatically at startup, targeting the butler's DB. Alembic's alembic_version table tracks applied revisions. Each revision uses op.execute() with raw SQL. Idempotent: re-running skips already-applied revisions.","acceptance_criteria":"1. _migrations table created automatically\n2. Migrations applied in order\n3. Re-running is idempotent (no errors, no duplicates)\n4. Failed migration rolls back its transaction","notes":"NOTE: Acceptance criteria are stale — should reference Alembic alembic_version table instead of _migrations table. Updated in design.md D12 and spec files.","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:57.935179883+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:30.122588194+08:00","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.4.2","depends_on_id":"butlers-0qp.4","type":"parent-child","created_at":"2026-02-09T12:10:57.936564578+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4.3","title":"Create core Alembic revision","description":"Create the initial Alembic revision in alembic/versions/core/ that defines the core tables shared by all butlers: state (key TEXT PK, value JSONB, updated_at TIMESTAMPTZ), scheduled_tasks (id UUID PK, name, cron, prompt, source, enabled, next_run_at, last_run_at, created_at, updated_at), sessions (id UUID PK, prompt, trigger_source, result, tool_calls JSONB, duration_ms, trace_id, cost JSONB, started_at, completed_at). Uses op.execute() with raw SQL.","acceptance_criteria":"1. All three tables created with correct columns and types\n2. Primary keys and defaults set correctly\n3. Migration is idempotent (uses IF NOT EXISTS or migration runner handles it)","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:00.820323137+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:13:51.959458127+08:00","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.4.3","depends_on_id":"butlers-0qp.4","type":"parent-child","created_at":"2026-02-09T12:11:00.821973774+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4.4","title":"Write database layer tests","description":"Write tests/test_db.py using testcontainers PostgreSQL. Test: database creation on first connect, Alembic migration application, idempotent re-run of migrations, alembic_version tracking, connection pool usability.","acceptance_criteria":"1. Tests use testcontainers PostgreSQL (real DB, not mocks)\n2. Database creation verified\n3. Migration application verified\n4. Idempotent re-run verified\n5. All tests pass","notes":"NOTE: Acceptance criteria reference _migrations — should read alembic_version. Updated in spec files.","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:03.733051237+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:14:31.444724164+08:00","labels":["database","testing"],"dependencies":[{"issue_id":"butlers-0qp.4.4","depends_on_id":"butlers-0qp.4","type":"parent-child","created_at":"2026-02-09T12:11:03.734914867+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5","title":"Implement credential management","description":"Per-butler credential and environment variable management. Validate ANTHROPIC_API_KEY, [butler.env].required, [butler.env].optional, and module credentials_env at startup. Aggregated error reporting for missing vars. Advisory warning for suspected inline secrets in butler.toml.","acceptance_criteria":"1. All-present credentials pass validation\n2. Missing required vars fail startup with aggregated error listing all missing vars\n3. Missing optional vars log warning but don't block\n4. Secret-in-config detection warns on suspected inline secrets","status":"open","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:12.554933796+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:07:12.554933796+08:00","labels":["backend","security"],"dependencies":[{"issue_id":"butlers-0qp.5","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:12.556293805+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5.1","title":"Implement credential validation at startup","description":"Add credential validation to butler startup. Check for: ANTHROPIC_API_KEY (always required), [butler.env].required env vars, [butler.env].optional env vars (warn if missing), module credentials_env vars. Aggregate all missing vars before failing.","acceptance_criteria":"1. ANTHROPIC_API_KEY checked on every butler\n2. All [butler.env].required vars checked\n3. Missing optional vars produce warnings, not errors\n4. Module credentials_env vars checked\n5. All missing vars reported in a single error message","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:35.006441351+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:10:35.006441351+08:00","labels":["backend","security"],"dependencies":[{"issue_id":"butlers-0qp.5.1","depends_on_id":"butlers-0qp.5","type":"parent-child","created_at":"2026-02-09T12:10:35.007802271+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5.2","title":"Implement aggregated credential error reporting","description":"When multiple required env vars are missing, collect all of them before failing. Error message must list each missing var and which component needs it (core, butler.env, or module name).","acceptance_criteria":"1. Multiple missing vars reported in one error\n2. Each missing var identifies its source component\n3. Error message is actionable (tells user what to set)","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:40.867803524+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:10:40.867803524+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.5.2","depends_on_id":"butlers-0qp.5","type":"parent-child","created_at":"2026-02-09T12:10:40.869604846+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5.3","title":"Implement secret-in-config detection","description":"Scan butler.toml string values for patterns that look like inline secrets (API keys, passwords, tokens). Log advisory warnings during startup. Do not block startup — this is informational only.","design":"Heuristic detection: strings matching common secret patterns (sk-, ghp_, xoxb-, base64-like long strings). Advisory only — log.warning with suggestion to use env vars instead.","acceptance_criteria":"1. Suspected secrets in config values produce warnings\n2. Warnings suggest using env vars instead\n3. Does not block startup (advisory only)\n4. No false positives on short/normal config values","status":"open","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:46.172956217+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:10:46.172956217+08:00","labels":["backend","security"],"dependencies":[{"issue_id":"butlers-0qp.5.3","depends_on_id":"butlers-0qp.5","type":"parent-child","created_at":"2026-02-09T12:10:46.174760304+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5.4","title":"Write credential management tests","description":"Write tests/test_credentials.py covering: all-present (passes), missing required (fails), missing optional (warning), missing module creds (fails), multiple missing (aggregated error), secret-in-config detection.","acceptance_criteria":"1. All 6 scenarios tested\n2. Aggregated error message verified\n3. Warning vs error distinction verified\n4. Tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:50.738360078+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:10:50.738360078+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.5.4","depends_on_id":"butlers-0qp.5","type":"parent-child","created_at":"2026-02-09T12:10:50.747797002+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.6","title":"Implement state store","description":"Key-value JSONB persistence in each butler's PostgreSQL database. MCP tools: state_get (returns null for missing keys), state_set (upsert), state_delete (no-op for missing), state_list (with optional prefix filter). All values stored as JSONB supporting any JSON type.","acceptance_criteria":"1. state_get returns value for existing key, null for missing\n2. state_set inserts new and updates existing (upsert)\n3. state_delete removes existing, no-op for missing\n4. state_list returns all entries, filters by prefix when provided\n5. JSONB values support strings, numbers, objects, arrays, booleans","status":"open","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:18.879501505+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:07:18.879501505+08:00","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.6","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:18.881541779+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.6","depends_on_id":"butlers-0qp.4","type":"blocks","created_at":"2026-02-09T12:15:48.621792957+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.6.1","title":"Implement state store MCP tools","description":"Create src/butlers/core/state.py with state store MCP tools: state_get(key) returns JSONB value or null, state_set(key, value) upserts, state_delete(key) removes (no-op if missing), state_list(prefix?) returns matching entries. All backed by the state table (key TEXT PK, value JSONB, updated_at TIMESTAMPTZ).","design":"state_set uses INSERT ON CONFLICT UPDATE (upsert). state_list uses key LIKE prefix% when prefix provided, otherwise returns all. Values stored as JSONB — any valid JSON type accepted.","acceptance_criteria":"1. state_get returns value for existing, null for missing\n2. state_set inserts new keys and updates existing\n3. state_delete removes existing, no-op for missing\n4. state_list returns all or prefix-filtered entries\n5. JSONB supports strings, numbers, objects, arrays, booleans, null","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:56.608975907+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:10:56.608975907+08:00","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.6.1","depends_on_id":"butlers-0qp.6","type":"parent-child","created_at":"2026-02-09T12:10:56.610970394+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.6.2","title":"Write state store tests","description":"Write tests/test_core_state.py covering: get existing, get missing (null), set insert, set update, delete existing, delete missing (no-op), list all, list with prefix, JSONB value types (string, number, object, array, boolean, null).","acceptance_criteria":"1. All scenarios tested against real PostgreSQL (testcontainers)\n2. JSONB type round-tripping verified\n3. All tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:02.219263147+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:02.219263147+08:00","labels":["database","testing"],"dependencies":[{"issue_id":"butlers-0qp.6.2","depends_on_id":"butlers-0qp.6","type":"parent-child","created_at":"2026-02-09T12:11:02.220849583+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.7","title":"Implement session log","description":"Append-only audit log of every CC invocation. Create session on CC spawn (recording prompt, trigger_source, trace_id), update on completion (result, tool_calls, duration_ms, cost). MCP tools: sessions_list (paginated), sessions_get (by id). No delete capability — append-only by design.","acceptance_criteria":"1. Session created on CC spawn with prompt and trigger_source\n2. Session updated on completion with result, tool_calls, duration_ms\n3. sessions_list supports pagination (limit/offset)\n4. sessions_get returns full session by ID\n5. No delete/update-after-close capability","status":"open","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:25.643942646+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:07:25.643942646+08:00","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.7","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:25.64534759+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.7","depends_on_id":"butlers-0qp.4","type":"blocks","created_at":"2026-02-09T12:15:48.67531344+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.7.1","title":"Implement session log with MCP tools","description":"Create src/butlers/core/sessions.py. Session creation on CC spawn (prompt, trigger_source, trace_id, started_at). Session update on completion (result, tool_calls JSONB, duration_ms, cost JSONB, completed_at). MCP tools: sessions_list(limit, offset) paginated, sessions_get(id). Append-only — no delete or update-after-close.","design":"Sessions table: id UUID PK, prompt TEXT, trigger_source TEXT, result TEXT, tool_calls JSONB, duration_ms INT, trace_id TEXT, cost JSONB, started_at TIMESTAMPTZ, completed_at TIMESTAMPTZ. trigger_source values: schedule, trigger_tool, tick, heartbeat.","acceptance_criteria":"1. Session created with prompt and trigger_source\n2. Session updated on completion with result, tool_calls, duration_ms\n3. sessions_list supports limit/offset pagination\n4. sessions_get returns full session by ID\n5. No delete capability exists","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:07.94358731+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:07.94358731+08:00","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.7.1","depends_on_id":"butlers-0qp.7","type":"parent-child","created_at":"2026-02-09T12:11:07.946172593+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.7.2","title":"Write session log tests","description":"Write tests/test_core_sessions.py covering: create session, complete success, complete failure, duration_ms computation, trigger_source values, list pagination, get by id, append-only verification (no delete/update-after-close).","acceptance_criteria":"1. All scenarios tested\n2. duration_ms correctly computed\n3. Pagination verified (limit/offset)\n4. Append-only constraint verified\n5. Tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:13.141296192+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:13.141296192+08:00","labels":["database","testing"],"dependencies":[{"issue_id":"butlers-0qp.7.2","depends_on_id":"butlers-0qp.7","type":"parent-child","created_at":"2026-02-09T12:11:13.142716805+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8","title":"Implement CC spawner","description":"Ephemeral Claude Code instance management via the CC SDK. Generates locked-down MCP config files in temp directories (single butler endpoint only). Spawns CC with system prompt from CLAUDE.md, credential passthrough (only declared env vars), serial dispatch via asyncio lock, and session logging integration.","acceptance_criteria":"1. MCP config contains only the owning butler's endpoint\n2. Each invocation gets a unique temp directory, cleaned up after\n3. CLAUDE.md content passed as system_prompt\n4. Only declared env vars passed through to CC\n5. Serial dispatch prevents concurrent CC instances\n6. Session created/updated for each spawn","status":"open","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:30.131696619+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:07:30.131696619+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:30.133021141+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.8","depends_on_id":"butlers-0qp.7","type":"blocks","created_at":"2026-02-09T12:15:48.786351896+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.1","title":"Implement ephemeral MCP config generation","description":"Create src/butlers/core/spawner.py with CCSpawner class. Generate locked-down MCP config in /tmp/butler_{name}_{uuid}/mcp.json containing only the owning butler's SSE endpoint. Each invocation gets a unique temp directory.","design":"Config JSON: {mcpServers: {butler_name: {url: 'http://localhost:PORT/sse'}}}. Temp dir: /tmp/butler_{name}_{uuid}/. Cleanup after CC session completes (success or failure).","acceptance_criteria":"1. Config contains exactly one MCP server entry\n2. Entry points to owning butler's SSE endpoint\n3. Each invocation creates unique temp dir\n4. Temp dir cleaned up after session","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:21.233806391+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:21.233806391+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.1","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:21.235278181+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.2","title":"Implement CC SDK invocation and SpawnerResult","description":"Implement claude_code_sdk.query call with generated MCP config, system prompt, and working directory. Define SpawnerResult dataclass (result, tool_calls, error, duration_ms). Handle SDK errors gracefully.","acceptance_criteria":"1. CC SDK called with correct mcp_config path\n2. System prompt and cwd set correctly\n3. SpawnerResult captures success and failure cases\n4. SDK errors wrapped in SpawnerResult.error","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:26.08076857+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:26.08076857+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.2","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:26.082136924+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.3","title":"Implement credential passthrough for CC instances","description":"Build explicit env dict for CC invocation containing only declared vars: ANTHROPIC_API_KEY + [butler.env] required/optional + module credentials_env. No other env vars leak to CC instance.","acceptance_criteria":"1. ANTHROPIC_API_KEY always included\n2. butler.env vars included\n3. Module credential vars included\n4. Undeclared env vars not passed through","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:30.941778301+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:30.941778301+08:00","labels":["backend","security"],"dependencies":[{"issue_id":"butlers-0qp.8.3","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:30.943315224+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.4","title":"Implement CLAUDE.md system prompt reading","description":"Read CLAUDE.md from butler's config directory and pass contents as system_prompt to CC SDK query. If CLAUDE.md is missing or empty, use a default system prompt identifying the butler.","acceptance_criteria":"1. CLAUDE.md content passed as system_prompt\n2. Missing CLAUDE.md uses default prompt\n3. Empty CLAUDE.md uses default prompt\n4. Default prompt includes butler name","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:11:39.068096666+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:39.068096666+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.4","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:39.071330855+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.5","title":"Implement serial CC dispatch with asyncio lock","description":"Add asyncio.Lock to CCSpawner ensuring only one CC instance runs at a time per butler. Subsequent trigger() calls wait for the lock. This is a v1 simplification — concurrent dispatch is a future enhancement.","acceptance_criteria":"1. Only one CC instance active per butler at a time\n2. Concurrent triggers queue and execute serially\n3. Lock released on both success and failure","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:46.784689414+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:46.784689414+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.5","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:46.786273295+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.6","title":"Wire CC spawner session logging","description":"Create session record when CC spawn begins (prompt, trigger_source). Update session on completion with result, tool_calls, duration_ms, cost. Handle both success and failure paths.","acceptance_criteria":"1. Session created before CC invocation\n2. Session updated on success with result and tool_calls\n3. Session updated on failure with error\n4. duration_ms recorded accurately","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:52.137727183+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:52.137727183+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.6","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:52.139374895+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.7","title":"Write CC spawner tests","description":"Write tests/test_core_spawner.py covering: MCP config generation (correct JSON, single endpoint), temp dir cleanup, serial dispatch (lock prevents concurrent), MockSpawner assertions, env passthrough (only declared vars), CLAUDE.md handling (present, missing, empty).","acceptance_criteria":"1. All scenarios tested\n2. MockSpawner used (no real CC invocation)\n3. Config JSON structure verified\n4. Serial dispatch verified via concurrent task simulation\n5. Tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:58.45663044+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:11:58.45663044+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.8.7","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:58.458082864+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.9","title":"Implement butler skills infrastructure","description":"Skill directory structure and CC discovery. CLAUDE.md personality/instructions read by CC spawner as system_prompt. AGENTS.md runtime notes readable/writable by CC instances. skills/\u003cname\u003e/SKILL.md + optional scripts accessible via CC cwd set to butler config dir.","acceptance_criteria":"1. CLAUDE.md content passed as system_prompt to CC\n2. Missing CLAUDE.md falls back to default prompt\n3. AGENTS.md readable and writable by CC instances\n4. skills/ directory accessible when CC cwd set to butler config dir","status":"open","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:37.321931865+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:07:37.321931865+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.9","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:37.323291724+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.9.1","title":"Implement CLAUDE.md and skills directory for CC spawner","description":"Ensure CC spawner reads CLAUDE.md from butler config dir as system_prompt. Set CC cwd to butler config dir so skills/ directory is accessible. CLAUDE.md defines butler personality and instructions. Missing CLAUDE.md uses default fallback.","acceptance_criteria":"1. CLAUDE.md read as system_prompt\n2. Missing CLAUDE.md uses default\n3. CC cwd set to butler config dir\n4. skills/ directory accessible from CC","notes":"This may overlap with the CC spawner CLAUDE.md reading task — coordinate to avoid duplication. The key addition here is the cwd setting for skills access.","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:41.020113716+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:41.020113716+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.9.1","depends_on_id":"butlers-0qp.9","type":"parent-child","created_at":"2026-02-09T12:12:41.021617887+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.9.2","title":"Implement AGENTS.md read/write access","description":"Ensure AGENTS.md in butler config dir is readable and writable by CC instances. CC can append runtime notes during sessions. File created if it doesn't exist on first write.","acceptance_criteria":"1. AGENTS.md readable by CC instances\n2. AGENTS.md writable by CC instances\n3. File created on first write if missing\n4. Content persists across sessions","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:12:46.914816969+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:46.914816969+08:00","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.9.2","depends_on_id":"butlers-0qp.9","type":"parent-child","created_at":"2026-02-09T12:12:46.91687713+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.9.3","title":"Write butler skills tests","description":"Write tests/test_skills.py covering: CLAUDE.md as system prompt, missing CLAUDE.md fallback, AGENTS.md read/write, skill directory structure validation (skills/\u003cname\u003e/SKILL.md exists and is accessible).","acceptance_criteria":"1. All scenarios tested\n2. File system interactions verified\n3. Tests pass","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:52.252884492+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:12:52.252884492+08:00","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.9.3","depends_on_id":"butlers-0qp.9","type":"parent-child","created_at":"2026-02-09T12:12:52.254444018+08:00","created_by":"Tzeusy"}]}
