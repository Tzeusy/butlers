{"id":"butlers-06j","title":"Feature verification: align implementation with v1 MVP specs","description":"Systematic verification of all 15 OpenSpec v1-mvp-spec specifications against current implementation. Each child bead targets a specific gap (missing, divergent, or erroneous) found during spec-vs-code analysis. Gaps were identified by reading every ADDED requirement in each spec and checking whether the code satisfies it.","acceptance_criteria":"1. Every spec requirement has been reviewed\n2. All missing functionality is implemented or explicitly deferred\n3. All divergent implementations are aligned with spec or spec is updated\n4. All erroneous code is fixed\n5. Tests pass for each fixed area","notes":"Specs live in openspec/changes/v1-mvp-spec/specs/. Implementation is in src/butlers/. Gap analysis covered: butler-daemon, state-store, task-scheduler, cc-spawner, session-log, module-system, butler-skills, butler-credentials, telemetry, cli-and-deployment, butler-general, butler-relationship, butler-health, heartbeat, switchboard.","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T20:48:32.884306817+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:09:51.649830337+08:00","closed_at":"2026-02-10T01:09:51.649830337+08:00","close_reason":"All children completed"}
{"id":"butlers-06j.1","title":"Align MCP tool names with butler-daemon spec","description":"All core MCP tool names diverge from the spec. Spec names: state_get, state_set, state_delete, state_list, schedule_list, schedule_create, schedule_update, schedule_delete, sessions_list, sessions_get, tick. Implementation names: get_state, set_state, delete_state, list_state, list_schedules, create_schedule, update_schedule, delete_schedule, list_sessions, get_session, tick_now. Every tool needs renaming.","acceptance_criteria":"1. All core MCP tools use spec-defined names\n2. Tests updated to use new names\n3. Any callers (switchboard, heartbeat) updated","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:03.049431193+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:17:50.281080709+08:00","closed_at":"2026-02-09T21:17:50.281080709+08:00","close_reason":"Closed","labels":["core","daemon"],"dependencies":[{"issue_id":"butlers-06j.1","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:03.05146433+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.10","title":"Fix source value for runtime-created tasks","description":"The spec says runtime-created tasks SHALL have source='db'. The implementation uses source='runtime'. The TOML sync checks source='toml' which still works, but the value diverges from spec.","acceptance_criteria":"1. schedule_create uses source='db' instead of source='runtime'\n2. schedule_delete updated if it checks source value","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:49:23.996053078+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:15:48.624267303+08:00","closed_at":"2026-02-09T22:15:48.624267303+08:00","close_reason":"Fixed source value to 'db' per spec","labels":["core","scheduler"],"dependencies":[{"issue_id":"butlers-06j.10","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:23.99767741+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.11","title":"Fix trigger_source format for scheduled tasks","description":"The scheduler calls dispatch_fn with trigger_source='schedule'. The spec expects trigger_source='schedule:\u003ctask-name\u003e' (e.g., 'schedule:daily-review') to identify which task triggered the session.","acceptance_criteria":"1. tick() passes trigger_source='schedule:\u003ctask-name\u003e' to dispatch\n2. Session log records the full trigger source","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:49:25.439541673+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:29:44.254241369+08:00","closed_at":"2026-02-09T22:29:44.254241369+08:00","close_reason":"Already fixed in butlers-06j.15 — tick() now passes schedule:\u003ctask-name\u003e format","labels":["core","scheduler","sessions"],"dependencies":[{"issue_id":"butlers-06j.11","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:25.440988901+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.11","depends_on_id":"butlers-06j.15","type":"blocks","created_at":"2026-02-09T20:51:25.307218257+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.12","title":"Fix non-atomic schedule_update for cron change","description":"When cron is changed in schedule_update, the code does two separate UPDATE statements — one for fields and one for next_run_at. This is not atomic and could leave the row inconsistent. Should be a single UPDATE.","acceptance_criteria":"1. schedule_update uses a single UPDATE statement for all field changes including next_run_at","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:26.911472802+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:24:48.664048996+08:00","closed_at":"2026-02-09T22:24:48.664048996+08:00","close_reason":"Fixed non-atomic schedule_update - now uses single UPDATE statement for all field changes including next_run_at when cron changes. Added atomicity tests. All 461 tests pass.","labels":["core","scheduler"],"dependencies":[{"issue_id":"butlers-06j.12","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:26.913071887+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.13","title":"Add max_turns and cwd to CC spawner","description":"The spec requires max_turns defaulting to 20 (configurable per trigger call) and options.cwd set to the butler's config directory path. Neither exists in the implementation. ClaudeCodeOptions has no max_turns, and cwd is not set.","acceptance_criteria":"1. CCSpawner passes max_turns=20 as default\n2. max_turns is configurable per trigger call\n3. cwd is set to butler's config directory","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:38.041460551+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:24:19.697862142+08:00","closed_at":"2026-02-09T22:24:19.697862142+08:00","close_reason":"Added max_turns and cwd to CC spawner","labels":["core","spawner"],"dependencies":[{"issue_id":"butlers-06j.13","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:38.043508875+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.14","title":"Add success and error columns to sessions table","description":"The spec schema has success BOOLEAN and error TEXT columns on the sessions table. Neither exists. Error messages are conflated with the result field, making it impossible to distinguish failed from successful sessions. session_complete does not accept success/error params. SpawnerResult lacks success field (uses result vs spec's output).","acceptance_criteria":"1. Alembic migration adds success BOOLEAN and error TEXT columns\n2. session_complete accepts and stores success and error\n3. SpawnerResult has output (not result) and success fields matching spec\n4. Successful sessions have success=true, error=NULL\n5. Failed sessions have success=false, error=\u003cmessage\u003e, result=NULL","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:39.953679406+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:23:19.746591958+08:00","closed_at":"2026-02-09T21:23:19.746591958+08:00","close_reason":"Implementation complete, branch pushed","labels":["core","migrations","sessions"],"dependencies":[{"issue_id":"butlers-06j.14","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:39.955132655+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.15","title":"Fix trigger_source allowed values to match spec","description":"The spec defines trigger_source values: schedule:\u003ctask-name\u003e, tick, external, trigger. The implementation uses: schedule, trigger_tool, tick, heartbeat. Missing 'external', uses 'trigger_tool' instead of 'trigger', and 'heartbeat' is not in spec.","acceptance_criteria":"1. TRIGGER_SOURCES set matches spec values\n2. Callers use correct values (trigger not trigger_tool, external for MCP calls)","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:41.509000352+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:29:11.056982064+08:00","closed_at":"2026-02-09T22:29:11.056982064+08:00","close_reason":"Fixed trigger_source values to match spec","labels":["core","sessions"],"dependencies":[{"issue_id":"butlers-06j.15","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:41.510730895+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.16","title":"Remove dead temp dir code from CC spawner","description":"The spawner writes mcp.json to a temp dir via _write_mcp_config(), but the SDK invocation uses McpSSEServerConfig objects directly. The written mcp.json file is never referenced. This is dead code that creates and cleans up an unused file.","acceptance_criteria":"1. _write_mcp_config() removed or repurposed\n2. _cleanup_temp_dir() removed if no longer needed\n3. Tests still pass","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:49:43.068281205+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:55:06.358360651+08:00","closed_at":"2026-02-10T00:55:06.358360651+08:00","close_reason":"Dead temp dir code removed from spawner","labels":["core","spawner"],"dependencies":[{"issue_id":"butlers-06j.16","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:43.070004495+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.17","title":"Align default system prompt format with spec","description":"The spec says default prompt should be 'You are the \u003cname\u003e butler.' The implementation uses 'You are {butler_name}, a butler AI assistant.' Additionally, there are two duplicate implementations: skills.py::read_system_prompt() and spawner.py::_read_system_prompt(). The spawner should use skills.py.","acceptance_criteria":"1. Default prompt matches spec format: 'You are the \u003cname\u003e butler.'\n2. Single implementation in skills.py\n3. Spawner delegates to skills.py, no duplicate code","status":"closed","priority":3,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:49:44.771355118+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:54:12.055504182+08:00","closed_at":"2026-02-10T00:54:12.055504182+08:00","close_reason":"Default system prompt aligned with spec, duplicate implementation removed","labels":["core","skills","spawner"],"dependencies":[{"issue_id":"butlers-06j.17","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:44.772827733+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.18","title":"Add Pydantic config validation in module loading","description":"The spec requires each module's config to be validated against its config_schema (Pydantic BaseModel) during loading. Currently, raw dicts are passed to on_startup and register_tools without validation. Missing required fields, extra unknown fields, and type mismatches are not detected.","acceptance_criteria":"1. Module config validated against config_schema during loading\n2. Validated Pydantic instance passed to on_startup and register_tools\n3. Missing required fields raise clear error at startup\n4. Extra/unknown fields rejected\n5. Type mismatches detected","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:55.293290716+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:37:17.302098191+08:00","closed_at":"2026-02-09T22:37:17.302098191+08:00","close_reason":"Added Pydantic config validation in module loading","labels":["core","modules"],"dependencies":[{"issue_id":"butlers-06j.18","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:55.295193736+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.19","title":"Add env var resolution in module config values","description":"The spec says butler.toml module config values referencing env vars (e.g., password = '${EMAIL_PASSWORD}') SHALL be resolved before passing to the module. No env var resolution exists in the config loading pipeline.","acceptance_criteria":"1. Config values containing ${VAR_NAME} are resolved from environment\n2. Missing env vars produce clear error\n3. Resolution happens before Pydantic validation","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:56.715791414+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:46:16.037257329+08:00","closed_at":"2026-02-09T22:46:16.037257329+08:00","close_reason":"Added env var resolution in module config values","labels":["core","credentials","modules"],"dependencies":[{"issue_id":"butlers-06j.19","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:56.717817376+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.19","depends_on_id":"butlers-06j.18","type":"blocks","created_at":"2026-02-09T20:51:25.370829229+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.2","title":"Add context parameter to trigger MCP tool","description":"The spec defines trigger(prompt, context?) where context is optional text prepended to the prompt. The implementation has trigger(prompt) with no context parameter. The CCSpawner.trigger() also lacks context.","acceptance_criteria":"1. trigger MCP tool accepts optional context parameter\n2. When provided, context is prepended to prompt before CC invocation\n3. CCSpawner.trigger() signature updated","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:04.414913353+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:47:59.450942221+08:00","closed_at":"2026-02-09T21:47:59.450942221+08:00","close_reason":"Completed and pushed to agent branches","labels":["core","spawner"],"dependencies":[{"issue_id":"butlers-06j.2","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:04.416935168+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.20","title":"Add startup failure cleanup for initialized modules","description":"The spec requires that if module A's on_startup fails, already-initialized modules have on_shutdown() called and the butler halts. Current implementation has no try/except around the module startup loop. An exception would crash without cleaning up already-started modules.","acceptance_criteria":"1. If on_startup fails for a module, all previously-started modules get on_shutdown called\n2. Butler halts with clear error identifying the failing module","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:58.254659126+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:20:18.587320764+08:00","closed_at":"2026-02-09T22:20:18.587320764+08:00","close_reason":"Already implemented in butlers-06j.3 (graceful shutdown) - daemon.py now wraps module on_startup in try/except and calls on_shutdown on already-started modules","labels":["core","daemon","modules"],"dependencies":[{"issue_id":"butlers-06j.20","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:58.25714598+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.21","title":"Call detect_secrets during butler startup","description":"The detect_secrets() function exists in credentials.py but is never called during startup. The spec says at startup the butler SHALL scan all string values in butler.toml and log a warning if any value appears to be an inline secret. Also needs exemptions for credentials_env and [butler.env] lists.","acceptance_criteria":"1. detect_secrets() called during daemon startup after config load\n2. Warnings logged for detected secrets\n3. credentials_env fields and [butler.env] lists are exempt from scanning","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:50:01.086929705+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:41:30.872115149+08:00","closed_at":"2026-02-09T22:41:30.872115149+08:00","close_reason":"Added detect_secrets call during startup","labels":["core","credentials"],"dependencies":[{"issue_id":"butlers-06j.21","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:01.08829665+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.22","title":"Align credentials_env source with spec (TOML-based)","description":"The spec says credentials_env is declared in butler.toml under [modules.\u003cname\u003e]. The implementation reads it from the module class instance's credentials_env property. This is a fundamental architectural difference — config-driven vs code-driven credential declaration.","acceptance_criteria":"1. credentials_env read from butler.toml module config section\n2. Module class credentials_env used as fallback or removed\n3. Credential validation uses TOML-declared vars","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:01.515506614+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:47:16.984702986+08:00","closed_at":"2026-02-09T22:47:16.984702986+08:00","close_reason":"Aligned credentials_env source with TOML spec","labels":["core","credentials","modules"],"dependencies":[{"issue_id":"butlers-06j.22","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:01.517068078+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.23","title":"Add span instrumentation to all MCP tool handlers","description":"The spec requires every MCP tool handler to be wrapped with a butler.tool.\u003cname\u003e span. In daemon.py, none of the 13 registered tool handlers use tool_span. Module-provided tools also lack span wrapping.","acceptance_criteria":"1. All core MCP tools wrapped with tool_span\n2. Module tools wrapped with tool_span\n3. Spans include butler.name attribute","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:11.821127119+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:00:33.161157567+08:00","closed_at":"2026-02-09T23:00:33.161157567+08:00","close_reason":"Added span instrumentation to MCP tool handlers","labels":["core","telemetry"],"dependencies":[{"issue_id":"butlers-06j.23","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:11.822701527+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.23","depends_on_id":"butlers-06j.1","type":"blocks","created_at":"2026-02-09T20:51:25.007298381+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.24","title":"Add butler.cc_session span to CC spawner","description":"The spec requires a butler.cc_session span with session_id and prompt_length attributes when the CC spawner runs. spawner.py has no span creation. Also, session trace_id is never populated despite the column existing.","acceptance_criteria":"1. CC spawner creates butler.cc_session span\n2. Span has session_id and prompt_length attributes\n3. trace_id passed to session_create from active span","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:50:13.372434648+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:59:49.883856942+08:00","closed_at":"2026-02-09T22:59:49.883856942+08:00","close_reason":"Added butler.cc_session span to CC spawner with session_id and prompt_length attributes, trace_id extraction and propagation to session_create","labels":["core","spawner","telemetry"],"dependencies":[{"issue_id":"butlers-06j.24","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:13.374202632+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.24","depends_on_id":"butlers-06j.14","type":"blocks","created_at":"2026-02-09T20:51:25.069419135+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.25","title":"Add switchboard telemetry spans (receive, classify, route)","description":"The spec requires three spans for switchboard operations: switchboard.receive (with channel, source_id), switchboard.classify (with routed_to), and switchboard.route (with target, tool_name). tools/switchboard.py has zero telemetry instrumentation.","acceptance_criteria":"1. switchboard.receive span created on message arrival\n2. switchboard.classify span as child with routed_to\n3. switchboard.route span with target and tool_name\n4. Trace context injected into inter-butler MCP calls","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:15.12931305+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:08:58.290276893+08:00","closed_at":"2026-02-09T23:08:58.290276893+08:00","close_reason":"Added switchboard telemetry spans with receive, classify, and route spans; trace context injection into inter-butler MCP calls","labels":["switchboard","telemetry"],"dependencies":[{"issue_id":"butlers-06j.25","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:15.131241548+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.25","depends_on_id":"butlers-06j.35","type":"blocks","created_at":"2026-02-09T20:51:25.12747335+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.26","title":"Add scheduler tick and heartbeat cycle spans","description":"The spec requires: (a) butler.tick span with tasks_due and tasks_run attributes when tick() is called, (b) heartbeat.cycle span with butlers_ticked and failures attributes. Neither scheduler.py nor heartbeat.py has any telemetry instrumentation.","acceptance_criteria":"1. tick() creates butler.tick span with tasks_due and tasks_run\n2. Heartbeat creates heartbeat.cycle span with butlers_ticked and failures","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:50:16.832203193+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:06:24.930596136+08:00","closed_at":"2026-02-09T23:06:24.930596136+08:00","close_reason":"Added scheduler tick and heartbeat spans","labels":["core","telemetry"],"dependencies":[{"issue_id":"butlers-06j.26","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:16.834174982+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.27","title":"Wire up inter-butler trace context propagation","description":"inject_trace_context() and extract_trace_context() exist in telemetry.py but are never used for inter-butler calls. The spec requires: switchboard injects _trace_context into MCP tool call args when routing; target butlers extract _trace_context and create child spans.","acceptance_criteria":"1. switchboard.route() injects _trace_context into outgoing args\n2. daemon tool handlers extract _trace_context from incoming args\n3. End-to-end trace hierarchy visible in Jaeger","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:18.379690035+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:22:54.764356531+08:00","closed_at":"2026-02-09T23:22:54.764356531+08:00","close_reason":"Wired up inter-butler trace context propagation","labels":["switchboard","telemetry"],"dependencies":[{"issue_id":"butlers-06j.27","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:18.381122915+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.27","depends_on_id":"butlers-06j.35","type":"blocks","created_at":"2026-02-09T20:51:25.189177776+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.28","title":"Pin Jaeger image to v1.62 in docker-compose","description":"The spec requires jaegertracing/all-in-one:1.62. docker-compose.yml uses :latest which is unpinned and may break.","acceptance_criteria":"1. docker-compose.yml uses jaegertracing/all-in-one:1.62","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":5,"created_at":"2026-02-09T20:50:19.79184401+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:52:39.71599085+08:00","closed_at":"2026-02-10T00:52:39.71599085+08:00","close_reason":"Jaeger image pinned to v1.62","labels":["deployment"],"dependencies":[{"issue_id":"butlers-06j.28","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:19.793735788+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.29","title":"Switch to DATABASE_URL env var for DB connection","description":"The spec requires all CLI commands to use DATABASE_URL env var with default postgres://butlers:butlers@localhost/postgres. The implementation uses individual POSTGRES_HOST, POSTGRES_PORT, POSTGRES_USER, POSTGRES_PASSWORD vars. docker-compose.yml also uses individual vars. Defaults differ (postgres/postgres vs butlers/butlers).","acceptance_criteria":"1. Database.from_env() reads DATABASE_URL\n2. Falls back to individual POSTGRES_* vars for compat\n3. Default matches spec: postgres://butlers:butlers@localhost/postgres\n4. docker-compose.yml updated to use DATABASE_URL","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:28.729539069+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:17:35.888211168+08:00","closed_at":"2026-02-09T23:17:35.888211168+08:00","close_reason":"Switched to DATABASE_URL env var with spec-compliant defaults and backward compatibility","labels":["cli","core","deployment"],"dependencies":[{"issue_id":"butlers-06j.29","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:28.731130459+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.3","title":"Implement graceful shutdown with CC session draining","description":"The spec requires graceful shutdown to: (a) stop accepting new MCP connections, (b) wait for in-flight CC sessions to complete up to a configurable timeout, (c) clean up already-initialized modules on startup failure. Current shutdown() goes straight to module shutdown without draining CC sessions or stopping MCP acceptance.","acceptance_criteria":"1. Shutdown stops accepting new MCP connections\n2. In-flight CC sessions are awaited up to configurable timeout\n3. Configurable shutdown timeout in butler.toml\n4. On startup failure, already-initialized modules get on_shutdown() called","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:49:06.286394542+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:58:39.639583342+08:00","closed_at":"2026-02-09T21:58:39.639583342+08:00","close_reason":"Implemented graceful shutdown with CC session draining","labels":["core","daemon"],"dependencies":[{"issue_id":"butlers-06j.3","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:06.288025016+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.30","title":"Fix --only flag to use comma-separated syntax","description":"The spec says butlers up --only switchboard,health (comma-separated single value). Implementation uses Click multiple=True which means --only switchboard --only health (repeated flags).","acceptance_criteria":"1. --only accepts comma-separated butler names\n2. --only switchboard,health works as single argument","status":"closed","priority":3,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:50:30.032639555+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:01:29.942838921+08:00","closed_at":"2026-02-10T01:01:29.942838921+08:00","close_reason":"Fixed --only flag to accept comma-separated values","labels":["cli"],"dependencies":[{"issue_id":"butlers-06j.30","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:30.035116981+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.31","title":"Make --port optional in butlers init","description":"The spec says butlers init mybutler (without --port) should work with a reasonable default port. cli.py has --port required=True.","acceptance_criteria":"1. --port has a reasonable default (e.g., 8100 or auto-increment)\n2. butlers init mybutler works without --port","status":"closed","priority":3,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:50:31.352972043+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:59:57.281362882+08:00","closed_at":"2026-02-10T00:59:57.281362882+08:00","close_reason":"Made --port optional with default 8100","labels":["cli"],"dependencies":[{"issue_id":"butlers-06j.31","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:31.354795722+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.32","title":"Add port conflict detection to butlers up","description":"The spec requires butlers up to detect two butlers with the same configured port and report a conflict error, refusing to start any. No port conflict detection exists.","acceptance_criteria":"1. butlers up checks all discovered butlers for port conflicts\n2. Reports conflict with butler names and port number\n3. Exits non-zero without starting any butler","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:50:32.649639594+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:28:56.532980781+08:00","closed_at":"2026-02-09T23:28:56.532980781+08:00","close_reason":"Added port conflict detection","labels":["cli"],"dependencies":[{"issue_id":"butlers-06j.32","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:32.651231375+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.33","title":"Add running status detection to butlers list","description":"The spec requires butlers list to show which butlers are running vs stopped by probing configured ports. Currently it only shows static config info.","acceptance_criteria":"1. butlers list shows running/stopped status per butler\n2. Status detected by probing configured port","status":"closed","priority":3,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:50:33.841260293+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:01:42.631225108+08:00","closed_at":"2026-02-10T01:01:42.631225108+08:00","close_reason":"Running status detection added to butlers list via port probing","labels":["cli"],"dependencies":[{"issue_id":"butlers-06j.33","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:33.842805866+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.34","title":"Fix Dockerfile and docker-compose config mount paths","description":"Multiple issues: (a) Spec says config mounted at /etc/butler, Dockerfile uses /app/butler.toml, docker-compose uses /app/butler-config. (b) docker-compose --config commands pass file paths but CLI expects directories. (c) Dockerfile CMD references /app/butler.toml which doesn't exist in image.","acceptance_criteria":"1. Config mounted at /etc/butler as per spec\n2. butlers run --config receives a directory path\n3. Dockerfile CMD and docker-compose commands consistent\n4. docker-compose postgres user matches spec defaults","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:50:35.618578249+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:28:28.644982086+08:00","closed_at":"2026-02-09T23:28:28.644982086+08:00","close_reason":"Fixed Dockerfile and docker-compose config paths","labels":["deployment"],"dependencies":[{"issue_id":"butlers-06j.34","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:35.620072495+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.34","depends_on_id":"butlers-06j.29","type":"blocks","created_at":"2026-02-09T20:51:25.427473446+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.35","title":"Implement switchboard inter-butler routing","description":"The switchboard's _call_butler_tool() is literally raise NotImplementedError, blocking ALL inter-butler communication. The route() tool cannot forward requests to target butlers. This is the critical path for the switchboard's primary function.","acceptance_criteria":"1. _call_butler_tool connects to target butler's MCP endpoint\n2. Tool calls are forwarded and responses returned\n3. Trace context propagated to target butler","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:50:56.947359804+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:23:19.755869507+08:00","closed_at":"2026-02-09T21:23:19.755869507+08:00","close_reason":"Implementation complete, branch pushed","labels":["switchboard"],"dependencies":[{"issue_id":"butlers-06j.35","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:56.949507827+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.36","title":"Connect Telegram/Email modules to classification pipeline","description":"The Telegram and Email modules have tool stubs but are not connected to the switchboard's message classification and routing pipeline. Incoming messages from Telegram/Email should flow through classify_message() then route() to the appropriate butler.","acceptance_criteria":"1. Telegram module forwards incoming messages to classify_message\n2. Email module forwards incoming messages to classify_message\n3. Classification result routes to correct butler via route() tool","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:50:58.672999207+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:32:08.525347909+08:00","closed_at":"2026-02-09T21:32:08.525347909+08:00","close_reason":"Implemented: Telegram/Email modules connected to switchboard classification pipeline via MessagePipeline","labels":["modules","switchboard"],"dependencies":[{"issue_id":"butlers-06j.36","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:58.67478786+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.36","depends_on_id":"butlers-06j.35","type":"blocks","created_at":"2026-02-09T20:51:25.248649701+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.37","title":"Align General butler DB schema with spec","description":"General butler spec requires a tags column on entities table for tag-based filtering and text search. The implementation collapses structure into simplified JSONB without proper tags support. The entity_search tool needs to support tag-based queries as per spec.","acceptance_criteria":"1. entities table has tags TEXT[] column\n2. entity_create/update accept tags\n3. entity_search supports tag filtering","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:59.774501704+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:40:27.444741309+08:00","closed_at":"2026-02-09T23:40:27.444741309+08:00","close_reason":"Added tags support to General butler entities","labels":["general","migrations"],"dependencies":[{"issue_id":"butlers-06j.37","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:59.776121498+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.38","title":"Align Relationship butler DB schema and tools with spec","description":"Relationship butler implementation simplifies the spec's rich schema. Tools use JSONB details blobs instead of proper columns (phone, email, birthday, etc.). Missing tables: contact_info, addresses. Tool implementations are stubs/skeletons rather than full implementations per spec.","acceptance_criteria":"1. Contact table has proper columns per spec (not just name+details JSONB)\n2. contact_info and addresses tables exist\n3. All tool functions fully implemented (not stubs)\n4. Relationship, gift, interaction, reminder tools complete","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":240,"created_at":"2026-02-09T20:51:01.482041985+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:45:10.124817355+08:00","closed_at":"2026-02-09T23:45:10.124817355+08:00","close_reason":"Aligned Relationship butler with spec","labels":["migrations","relationship"],"dependencies":[{"issue_id":"butlers-06j.38","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:51:01.484599803+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.39","title":"Align Health butler DB schema and tools with spec","description":"Health butler implementation diverges from spec in column naming (topic vs title, sources vs tags) and tool implementations are largely stubs. Measurement, medication, condition, symptom, and meal tools need full implementation per spec.","acceptance_criteria":"1. Column names match spec (title not topic, tags not sources, etc.)\n2. All measurement/medication/condition/symptom/meal tools fully implemented\n3. Summary and trend report tools working","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":240,"created_at":"2026-02-09T20:51:02.977909987+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:56:57.252464799+08:00","closed_at":"2026-02-09T23:56:57.252464799+08:00","close_reason":"Health butler schema aligned with spec, all tools fully implemented","labels":["health","migrations"],"dependencies":[{"issue_id":"butlers-06j.39","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:51:02.979489333+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.4","title":"Add dynamic health checking to status tool","description":"The status() MCP tool always returns health: ok unconditionally. The spec requires it to reflect actual component health — if the DB pool becomes unavailable, status should report degraded state.","acceptance_criteria":"1. status() checks DB pool health\n2. Returns degraded when DB pool is unavailable\n3. Returns ok only when all components healthy","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:08.196756022+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:54:09.945497879+08:00","closed_at":"2026-02-09T21:54:09.945497879+08:00","close_reason":"Added dynamic health checking to status tool","labels":["core","daemon"],"dependencies":[{"issue_id":"butlers-06j.4","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:08.198269214+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.40","title":"Implement heartbeat butler tick dispatch","description":"Heartbeat butler is supposed to call tick() on all registered butlers every 10 minutes. The tools/heartbeat.py is a skeleton. The scheduled task exists in butler.toml but the tick dispatch logic needs full implementation.","acceptance_criteria":"1. Heartbeat queries butler registry for all butlers\n2. Calls tick endpoint on each butler\n3. Logs successes and failures\n4. Returns summary of ticked/failed butlers","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:51:04.553437716+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:55:14.855279649+08:00","closed_at":"2026-02-09T23:55:14.855279649+08:00","close_reason":"Heartbeat tick dispatch fully implemented with registry query, per-butler tick calls, failure handling, session logging, and summary reporting. Fixed butler.toml schedule format. 22 tests passing.","labels":["heartbeat"],"dependencies":[{"issue_id":"butlers-06j.40","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:51:04.55502065+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.41","title":"Fix butler scheduled task definitions in butler.toml","description":"Scheduled task definitions across butler configs are either missing or incorrectly formatted per spec. The switchboard, relationship, and health butlers need their scheduled tasks properly defined in butler.toml matching the spec's cron expressions and prompt fields.","acceptance_criteria":"1. All butlers have correctly formatted [[butler.schedule]] entries\n2. Cron expressions match spec requirements\n3. Prompts are actionable for CC instances","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:51:06.152613516+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:53:03.730945423+08:00","closed_at":"2026-02-09T23:53:03.730945423+08:00","close_reason":"All butler.toml scheduled task definitions aligned with spec - correct cron expressions and actionable prompts","labels":["core","scheduler"],"dependencies":[{"issue_id":"butlers-06j.41","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:51:06.154202601+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.42","title":"Add skill directory name validation (kebab-case)","description":"The butler-skills spec requires skill directory names to use kebab-case (lowercase + hyphens, starting with letter, no consecutive hyphens). No validation logic exists. This should be enforced when reading the skills directory.","acceptance_criteria":"1. Skills directory names validated for kebab-case\n2. Invalid names logged as warnings\n3. Invalid skill directories skipped with warning","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:51:07.527729536+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:06:53.013732522+08:00","closed_at":"2026-02-10T01:06:53.013732522+08:00","close_reason":"Kebab-case validation added to skill directory names","labels":["core","skills"],"dependencies":[{"issue_id":"butlers-06j.42","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:51:07.530598201+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.43","title":"Add state_list keys-only mode per spec","description":"The spec says state_list SHALL return a list of keys. The implementation returns [{key, value}] dicts with both key and value. While this is a superset, it diverges from the spec's definition of returning just keys.","acceptance_criteria":"1. state_list returns a list of key strings by default\n2. Or: spec updated to document current behavior","status":"closed","priority":3,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:51:08.919379996+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:08:23.062784129+08:00","closed_at":"2026-02-10T01:08:23.062784129+08:00","close_reason":"state_list now returns key strings by default with keys_only parameter","labels":["core","state"],"dependencies":[{"issue_id":"butlers-06j.43","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:51:08.920969922+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.5","title":"Add butler-specific migration chain support","description":"The spec says after core migrations, the daemon SHALL apply butler-specific Alembic migrations if a version chain exists for the butler name. Currently the daemon only applies core chain and module chains. Butler-identity-level migrations (e.g., alembic/versions/relationship/ for the Relationship butler) are treated as module migrations, but there is no explicit lookup by butler name.","acceptance_criteria":"1. Daemon checks for butler-name-specific Alembic version chain\n2. Applies it after core migrations, before module migrations\n3. No-op if no such chain exists","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:09.220046296+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:04:21.167406688+08:00","closed_at":"2026-02-09T22:04:21.167406688+08:00","close_reason":"Added butler-specific migration chain support","labels":["core","daemon","migrations"],"dependencies":[{"issue_id":"butlers-06j.5","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:09.22156037+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.6","title":"Start FastMCP server on configured port in daemon.start()","description":"The spec says daemon startup step 9 starts the FastMCP server on the configured port. The daemon creates the FastMCP instance and registers tools but never calls mcp.run(). The SSE server startup is handled externally in cli.py. This makes ButlerDaemon not self-contained as the spec requires.","acceptance_criteria":"1. ButlerDaemon.start() starts the MCP server on the configured port\n2. Or: document that cli.py is responsible for starting the server and update spec","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:10.928692449+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:10:51.07486253+08:00","closed_at":"2026-02-09T22:10:51.07486253+08:00","close_reason":"Implemented FastMCP SSE server startup as background asyncio task in daemon.start() and corresponding shutdown in daemon.shutdown()","labels":["core","daemon"],"dependencies":[{"issue_id":"butlers-06j.6","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:10.930468268+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.7","title":"Add last_result column to scheduled_tasks table","description":"The spec schema includes last_result JSONB on scheduled_tasks to store CC session outcome after each dispatch. The column does not exist in the Alembic migration or the DB schema. tick() does not write results after dispatch. schedule_list does not select it.","acceptance_criteria":"1. Alembic migration adds last_result JSONB column\n2. tick() writes CC session result to last_result after dispatch\n3. schedule_list includes last_result in output","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:19.748644898+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:07:48.243192951+08:00","closed_at":"2026-02-09T22:07:48.243192951+08:00","close_reason":"Added last_result JSONB column to scheduled_tasks","labels":["core","migrations","scheduler"],"dependencies":[{"issue_id":"butlers-06j.7","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:19.750620485+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.8","title":"Add name UNIQUE constraint to scheduled_tasks","description":"The spec requires name TEXT UNIQUE NOT NULL on scheduled_tasks and schedule_create must reject duplicate names. The migration creates name TEXT NOT NULL without UNIQUE. Duplicate names silently insert.","acceptance_criteria":"1. Alembic migration adds UNIQUE constraint on name\n2. schedule_create rejects duplicate names with clear error message","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:21.037343404+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:19:33.825293546+08:00","closed_at":"2026-02-09T22:19:33.825293546+08:00","close_reason":"Added UNIQUE constraint on scheduled_tasks name","labels":["core","migrations","scheduler"],"dependencies":[{"issue_id":"butlers-06j.8","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:21.038950865+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.9","title":"Handle next_run_at on enabled/disabled toggle","description":"The spec requires: when enabled set to true, recompute next_run_at; when enabled set to false, set next_run_at to NULL. The implementation only recomputes next_run_at when cron changes, ignoring enabled toggling.","acceptance_criteria":"1. schedule_update recomputes next_run_at when enabled changes to true\n2. schedule_update sets next_run_at to NULL when enabled changes to false","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:22.566991601+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:16:44.441541593+08:00","closed_at":"2026-02-09T22:16:44.441541593+08:00","close_reason":"Fixed next_run_at handling on enabled toggle","labels":["core","scheduler"],"dependencies":[{"issue_id":"butlers-06j.9","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:22.568470879+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp","title":"Butlers v1 MVP","description":"Complete implementation of the Butlers AI agent framework v1 MVP. Encompasses the core daemon framework, module system, 5 specialized butlers (Switchboard, Heartbeat, Relationship, Health, General), 2 communication modules (Telegram, Email), CLI, Docker deployment, and OpenTelemetry instrumentation. See openspec/changes/v1-mvp-spec for full specifications.","acceptance_criteria":"1. All 5 butlers start and serve MCP tools\n2. Switchboard routes messages to correct butler\n3. Heartbeat ticks all butlers on 10-min cycle\n4. CC spawner generates locked-down ephemeral configs\n5. All core tools (state, scheduler, sessions) work across butlers\n6. Docker Compose brings up full stack\n7. End-to-end tracing works from ingress to CC execution","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:05:36.754557265+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:41.354784456+08:00","closed_at":"2026-02-09T13:50:41.354784456+08:00","close_reason":"v1 MVP complete — all 22 milestone epics implemented. 449 tests passing. All 5 butlers (Switchboard, General, Relationship, Health, Heartbeat), 2 modules (Telegram, Email), CLI, Docker deployment, integration tests, and OpenTelemetry instrumentation."}
{"id":"butlers-0qp.1","title":"Set up project skeleton","description":"Initialize project structure: pyproject.toml with hatchling build backend, ruff config, pytest-asyncio, src/butlers layout, Makefile targets, GitHub Actions CI workflow with PostgreSQL service. Foundation for all subsequent work.","acceptance_criteria":"1. uv sync --dev installs all deps without error\n2. make check passes (lint + test)\n3. CI workflow runs on push and PR\n4. Project follows src layout convention","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:06:54.876948162+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:51.069385758+08:00","closed_at":"2026-02-09T12:28:51.069385758+08:00","close_reason":"All subtasks completed, skeleton merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:06:54.878359929+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.1","title":"Create pyproject.toml with hatchling build and dev dependencies","description":"Set up pyproject.toml with hatchling build backend, src/butlers layout. Dev dependencies: ruff, pytest, pytest-asyncio, testcontainers. Runtime dependencies: fastmcp, claude-code-sdk, asyncpg, croniter, opentelemetry-sdk, click.","acceptance_criteria":"1. pyproject.toml parses without error\n2. Build backend is hatchling with src layout\n3. All runtime and dev dependencies declared\n4. Ruff config included: target py312, line-length 100, rules E,F,I,UP","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:09:52.754473928+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.238295365+08:00","closed_at":"2026-02-09T12:28:23.238295365+08:00","close_reason":"Skeleton implemented and merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1.1","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:09:52.755954014+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.2","title":"Create src/butlers package and type marker","description":"Create src/butlers/__init__.py (can be empty or with version) and src/butlers/py.typed marker file for PEP 561 type checking support.","acceptance_criteria":"1. src/butlers/__init__.py exists\n2. src/butlers/py.typed exists\n3. Package importable after uv sync","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:09:54.454582037+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.253118145+08:00","closed_at":"2026-02-09T12:28:23.253118145+08:00","close_reason":"Skeleton implemented and merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1.2","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:09:54.456028609+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.3","title":"Create test infrastructure","description":"Create tests/__init__.py and tests/conftest.py with SpawnerResult dataclass (result, tool_calls, error, duration_ms) and MockSpawner pytest fixture that returns configurable SpawnerResult without invoking real CC.","acceptance_criteria":"1. tests/conftest.py contains SpawnerResult dataclass\n2. MockSpawner fixture available in all tests\n3. MockSpawner records invocations for assertion","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:09:58.053555877+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.261285042+08:00","closed_at":"2026-02-09T12:28:23.261285042+08:00","close_reason":"Skeleton implemented and merged to main","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.1.3","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:09:58.055445816+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.4","title":"Create .python-version file","description":"Create .python-version file specifying Python 3.12 for uv and other tooling.","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":5,"created_at":"2026-02-09T12:10:02.801563425+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.269551838+08:00","closed_at":"2026-02-09T12:28:23.269551838+08:00","close_reason":"Skeleton implemented and merged to main","dependencies":[{"issue_id":"butlers-0qp.1.4","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:10:02.803530601+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.5","title":"Create Makefile with dev targets","description":"Create Makefile with targets: lint (uv run ruff check src/ tests/), format (uv run ruff format src/ tests/), test (uv run pytest -v), check (lint + test).","acceptance_criteria":"1. make lint runs ruff check\n2. make format runs ruff format\n3. make test runs pytest -v\n4. make check runs lint then test","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:10:03.789282531+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.27783777+08:00","closed_at":"2026-02-09T12:28:23.27783777+08:00","close_reason":"Skeleton implemented and merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1.5","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:10:03.791042865+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.6","title":"Create GitHub Actions CI workflow","description":"Create .github/workflows/ci.yml that runs on push and PR. Steps: checkout, set up Python 3.12 with uv, PostgreSQL service container, uv sync --dev, make check.","acceptance_criteria":"1. Workflow triggers on push and PR\n2. PostgreSQL service container running\n3. make check executed and must pass\n4. uv used for dependency installation","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:05.229430117+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.286151534+08:00","closed_at":"2026-02-09T12:28:23.286151534+08:00","close_reason":"Skeleton implemented and merged to main","labels":["ci","infra"],"dependencies":[{"issue_id":"butlers-0qp.1.6","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:10:05.231397412+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.7","title":"Verify project skeleton builds clean","description":"Run uv sync --dev and verify make check passes with no errors. Smoke test that the full skeleton is wired correctly.","acceptance_criteria":"1. uv sync --dev completes without error\n2. make check passes (lint + test)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:10:07.628327377+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.294598801+08:00","closed_at":"2026-02-09T12:28:23.294598801+08:00","close_reason":"Skeleton implemented and merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1.7","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:10:07.630086489+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.10","title":"Implement Telegram module","description":"Module implementation with send_message and get_updates MCP tools. Polling mode for dev (no public URL needed) and webhook mode for production, configurable via butler.toml [modules.telegram] section. Requires TELEGRAM_BOT_TOKEN credential.","acceptance_criteria":"1. Module registers send_message and get_updates tools\n2. Polling mode works for local development\n3. Webhook mode configurable for production\n4. Module declares TELEGRAM_BOT_TOKEN in credentials_env","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:44.707081615+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:45.013403808+08:00","closed_at":"2026-02-09T13:09:45.013403808+08:00","close_reason":"All children completed","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.10","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:44.708512478+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.10.1","title":"Implement Telegram module with send and receive tools","description":"Create src/butlers/modules/telegram.py implementing the Module ABC. Register MCP tools: send_message(chat_id, text) and get_updates(). Declare TELEGRAM_BOT_TOKEN in credentials_env. Config schema includes mode (polling/webhook) and webhook_url (for production).","acceptance_criteria":"1. Module implements all Module ABC members\n2. send_message tool registered and calls Telegram Bot API\n3. get_updates tool registered and returns messages\n4. TELEGRAM_BOT_TOKEN declared in credentials_env","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:06.775600425+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.706208083+08:00","closed_at":"2026-02-09T13:09:35.706208083+08:00","close_reason":"Implemented and merged to main","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.10.1","depends_on_id":"butlers-0qp.10","type":"parent-child","created_at":"2026-02-09T12:12:06.777029054+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.10.2","title":"Implement Telegram polling and webhook modes","description":"Support polling mode for dev (getUpdates long-polling, no public URL needed) and webhook mode for production (setWebhook, receive POSTs). Mode configured via [modules.telegram] in butler.toml. on_startup starts the appropriate mode, on_shutdown cleans up.","acceptance_criteria":"1. Polling mode works without public URL\n2. Webhook mode sets webhook URL on startup\n3. Mode selected from config\n4. Graceful cleanup on shutdown","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:12:08.003122958+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.714954266+08:00","closed_at":"2026-02-09T13:09:35.714954266+08:00","close_reason":"Implemented and merged to main","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.10.2","depends_on_id":"butlers-0qp.10","type":"parent-child","created_at":"2026-02-09T12:12:08.005131161+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.10.3","title":"Write Telegram module tests","description":"Write tests/test_module_telegram.py covering: tool registration, mocked API calls (send_message, get_updates), config validation, credential declaration.","acceptance_criteria":"1. Tool registration verified\n2. API calls mocked (no real Telegram calls)\n3. Config validation tested\n4. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:08.899573509+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.723203308+08:00","closed_at":"2026-02-09T13:09:35.723203308+08:00","close_reason":"Implemented and merged to main","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.10.3","depends_on_id":"butlers-0qp.10","type":"parent-child","created_at":"2026-02-09T12:12:08.900982981+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.11","title":"Implement task scheduler","description":"Cron-driven task dispatch. TOML-to-DB sync on startup (insert new, update changed, mark removed). tick() handler evaluates cron expressions via croniter, dispatches due task prompts to CC spawner serially. Runtime CRUD MCP tools: schedule_list, schedule_create (validate cron), schedule_update, schedule_delete (reject toml-source deletion).","acceptance_criteria":"1. TOML schedules synced to DB on startup\n2. tick() dispatches due tasks to CC spawner\n3. No-op tick when nothing due\n4. Disabled tasks skipped\n5. schedule_create validates cron syntax\n6. schedule_delete rejects toml-source tasks\n7. next_run_at computed correctly from cron expression","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:48.306483672+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:44.995841681+08:00","closed_at":"2026-02-09T13:09:44.995841681+08:00","close_reason":"All children completed","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.11","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:48.308047636+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.11","depends_on_id":"butlers-0qp.4","type":"blocks","created_at":"2026-02-09T12:15:48.731288429+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.11","depends_on_id":"butlers-0qp.8","type":"blocks","created_at":"2026-02-09T12:15:48.853046222+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.11.1","title":"Implement TOML-to-DB schedule sync and cron evaluation","description":"Create src/butlers/core/scheduler.py. On startup, sync [[butler.schedule]] entries from TOML to scheduled_tasks table: insert new tasks (source='toml'), update changed ones, mark removed ones. Use croniter to compute next_run_at for each task. tick() handler checks for due tasks and dispatches prompts to CC spawner serially.","design":"TOML sync: match by name. Source='toml' for config-sourced, source='runtime' for API-created. tick() flow: query tasks WHERE enabled=true AND next_run_at \u003c= now(), dispatch each to CC spawner, update next_run_at after dispatch.","acceptance_criteria":"1. TOML tasks synced on first startup\n2. Changed TOML tasks updated in DB\n3. Removed TOML tasks marked appropriately\n4. tick() dispatches due tasks to CC spawner\n5. next_run_at computed correctly via croniter\n6. Disabled tasks skipped by tick()","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T12:11:24.507483557+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.666783402+08:00","closed_at":"2026-02-09T13:09:35.666783402+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.11.1","depends_on_id":"butlers-0qp.11","type":"parent-child","created_at":"2026-02-09T12:11:24.509245155+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.11.2","title":"Implement schedule CRUD MCP tools","description":"Add MCP tools: schedule_list() returns all tasks, schedule_create(name, cron, prompt) creates runtime task (validates cron syntax via croniter), schedule_update(id, fields) modifies task, schedule_delete(id) removes task but rejects deletion of toml-source tasks.","acceptance_criteria":"1. schedule_list returns all tasks with their fields\n2. schedule_create validates cron syntax and creates with source='runtime'\n3. schedule_update modifies specified fields\n4. schedule_delete removes runtime tasks\n5. schedule_delete rejects toml-source tasks with clear error","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:31.676869967+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.684421471+08:00","closed_at":"2026-02-09T13:09:35.684421471+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.11.2","depends_on_id":"butlers-0qp.11","type":"parent-child","created_at":"2026-02-09T12:11:31.678601718+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.11.3","title":"Write task scheduler tests","description":"Write tests/test_core_scheduler.py covering: TOML sync (first run, update, removal), tick dispatch (due task dispatched), no-op tick (nothing due), disabled tasks skipped, error handling (dispatch failure doesn't stop tick), next_run_at computation, CRUD operations (list, create with valid/invalid cron, update, delete runtime, reject delete toml).","acceptance_criteria":"1. All scenarios tested\n2. MockSpawner used for dispatch verification\n3. Croniter used for next_run_at verification\n4. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:37.397770786+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.6942025+08:00","closed_at":"2026-02-09T13:09:35.6942025+08:00","close_reason":"Implemented and merged to main","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.11.3","depends_on_id":"butlers-0qp.11","type":"parent-child","created_at":"2026-02-09T12:11:37.399702054+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.12","title":"Implement Email module","description":"Module implementation with send_email, search_inbox, read_email MCP tools. IMAP for inbox access, SMTP for sending. Configurable via butler.toml [modules.email] section.","acceptance_criteria":"1. Module registers send_email, search_inbox, read_email tools\n2. IMAP connection for inbox operations\n3. SMTP connection for sending\n4. Module declares email credentials in credentials_env","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:48.490238233+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:45.028346022+08:00","closed_at":"2026-02-09T13:09:45.028346022+08:00","close_reason":"All children completed","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.12","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:48.491616346+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.12.1","title":"Implement Email module with send and inbox tools","description":"Create src/butlers/modules/email.py implementing the Module ABC. Register MCP tools: send_email(to, subject, body), search_inbox(query), read_email(id). IMAP for inbox access, SMTP for sending. Declare email credentials in credentials_env.","acceptance_criteria":"1. Module implements all Module ABC members\n2. send_email, search_inbox, read_email tools registered\n3. IMAP used for inbox operations\n4. SMTP used for sending\n5. Email credentials declared in credentials_env","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:10.317789812+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.731504469+08:00","closed_at":"2026-02-09T13:09:35.731504469+08:00","close_reason":"Implemented and merged to main","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.12.1","depends_on_id":"butlers-0qp.12","type":"parent-child","created_at":"2026-02-09T12:12:10.319852578+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.12.2","title":"Write Email module tests","description":"Write tests/test_module_email.py covering: tool registration, mocked IMAP/SMTP calls, config validation, credential declaration.","acceptance_criteria":"1. Tool registration verified\n2. IMAP/SMTP calls mocked\n3. Config validation tested\n4. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:11.725477278+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.741113272+08:00","closed_at":"2026-02-09T13:09:35.741113272+08:00","close_reason":"Implemented and merged to main","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.12.2","depends_on_id":"butlers-0qp.12","type":"parent-child","created_at":"2026-02-09T12:12:11.727457439+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13","title":"Implement Switchboard butler","description":"Public ingress butler on port 8100. Owns butler_registry and routing_log tables. MCP tools: route(butler_name, tool_name, args) for inter-butler forwarding via SSE MCP client, list_butlers() for registry query, discover() for config directory scanning. Routing flow: message intake -\u003e CC classification -\u003e route to target butler -\u003e return response. Default-to-general fallback. Telegram and Email modules for message intake.","acceptance_criteria":"1. butler_registry and routing_log tables provisioned\n2. route() forwards tool calls to target butler via MCP client\n3. list_butlers() returns full registry\n4. discover() scans config dirs and updates registry\n5. Trace context propagated through routing\n6. Unknown routes fall back to general butler","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:52.670290425+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:12.197811357+08:00","closed_at":"2026-02-09T13:28:12.197811357+08:00","close_reason":"Wave 8 epic complete — all children implemented and merged to main. 325 tests passing.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.13","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:52.671598907+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.13","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.242535254+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.13","depends_on_id":"butlers-0qp.10","type":"blocks","created_at":"2026-02-09T12:15:49.299449497+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.13","depends_on_id":"butlers-0qp.12","type":"blocks","created_at":"2026-02-09T12:15:49.354005806+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.1","title":"Create Switchboard Alembic revision","description":"Create Alembic revision in alembic/versions/switchboard/ with butler_registry table (name TEXT PK, endpoint_url TEXT NOT NULL, description TEXT, modules JSONB DEFAULT '[]', last_seen_at TIMESTAMPTZ, registered_at TIMESTAMPTZ DEFAULT now()) and routing_log table (id UUID PK, source_channel TEXT NOT NULL, source_id TEXT, routed_to TEXT NOT NULL, prompt_summary TEXT, trace_id TEXT, created_at TIMESTAMPTZ DEFAULT now()). Uses op.execute() with raw SQL.","acceptance_criteria":"1. butler_registry table created with correct schema\n2. routing_log table created with correct schema\n3. Migration idempotent via migration runner","notes":"NOTE: Acceptance criteria #3 is stale — should read 'Migration idempotent via Alembic' instead of 'via migration runner'.","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:12:13.296400213+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:05.310239406+08:00","closed_at":"2026-02-09T13:28:05.310239406+08:00","close_reason":"Wave 8: Switchboard butler implemented — register, list, discover, route, classify, routing log. 16 tests passing.","labels":["butler","database"],"dependencies":[{"issue_id":"butlers-0qp.13.1","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:13.297797453+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.2","title":"Implement Switchboard MCP tools","description":"Create src/butlers/tools/switchboard.py with three tools: route(butler_name, tool_name, args) forwards tool calls to target butler via MCP SSE client with trace context propagation; list_butlers() returns full registry; discover() scans butler config directories and updates registry (add new, update changed, mark stale).","design":"route() creates an MCP client connection to target butler's SSE endpoint, calls the specified tool, propagates _trace_context, logs to routing_log, returns result. discover() walks the butlers/ config directory, reads each butler.toml, upserts into butler_registry.","acceptance_criteria":"1. route() forwards to correct butler endpoint\n2. route() propagates trace context\n3. route() logs to routing_log\n4. list_butlers() returns all registered butlers\n5. discover() finds and registers new butlers","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T12:12:15.264861615+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:05.32616562+08:00","closed_at":"2026-02-09T13:28:05.32616562+08:00","close_reason":"Wave 8: Switchboard butler implemented — register, list, discover, route, classify, routing log. 16 tests passing.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.13.2","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:15.266406593+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.3","title":"Implement MCP client for inter-butler communication","description":"Implement SSE-based MCP client that connects to other butlers' MCP endpoints for the route() tool. Must handle connection lifecycle, trace context injection via _trace_context arg, and error handling for unreachable butlers.","acceptance_criteria":"1. MCP client connects via SSE transport\n2. Tool calls forwarded correctly\n3. _trace_context injected into tool args\n4. Unreachable butler returns clear error","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:17.019866984+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:05.331001214+08:00","closed_at":"2026-02-09T13:28:05.331001214+08:00","close_reason":"Wave 8: Switchboard butler implemented — register, list, discover, route, classify, routing log. 16 tests passing.","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.13.3","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:17.021240909+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.4","title":"Implement Switchboard routing flow","description":"Implement the full routing flow: message intake (from Telegram/Email modules or direct MCP) -\u003e CC classification (spawn CC to determine target butler) -\u003e route to target butler -\u003e return response. Default-to-general fallback when no specialist matches.","design":"CC is spawned with a classification prompt listing available butlers and their descriptions. CC returns the target butler name. Switchboard then calls route() to forward. If CC can't classify, defaults to 'general' butler.","acceptance_criteria":"1. Messages classified by CC to correct butler\n2. Route forwarded to target\n3. Response returned to caller\n4. Unknown classification defaults to general\n5. Routing logged","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:19.097920975+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:05.336649313+08:00","closed_at":"2026-02-09T13:28:05.336649313+08:00","close_reason":"Wave 8: Switchboard butler implemented — register, list, discover, route, classify, routing log. 16 tests passing.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.13.4","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:19.099817848+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.5","title":"Create Switchboard butler config","description":"Create butlers/switchboard/butler.toml (name=switchboard, port=8100, modules: telegram, email) and butlers/switchboard/CLAUDE.md (personality: message classifier and router, instructions for classifying incoming messages to the correct specialist butler).","acceptance_criteria":"1. butler.toml has correct name and port\n2. Telegram and email modules enabled\n3. CLAUDE.md contains classification instructions","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:12:21.70130235+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:05.341541704+08:00","closed_at":"2026-02-09T13:28:05.341541704+08:00","close_reason":"Wave 8: Switchboard butler implemented — register, list, discover, route, classify, routing log. 16 tests passing.","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.13.5","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:21.703406535+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.6","title":"Write Switchboard tests","description":"Write tests/test_tools_switchboard.py covering: registry CRUD (discover, list), routing (forward to target, return response), trace context propagation through route(), default-to-general fallback, discover() finding new butlers.","acceptance_criteria":"1. All scenarios tested\n2. MockSpawner used for CC classification\n3. MCP client mocked for inter-butler calls\n4. Trace propagation verified\n5. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:22.688350265+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:05.34615067+08:00","closed_at":"2026-02-09T13:28:05.34615067+08:00","close_reason":"Wave 8: Switchboard butler implemented — register, list, discover, route, classify, routing log. 16 tests passing.","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.13.6","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:22.690891115+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.14","title":"Implement Heartbeat butler","description":"Infrastructure butler on port 8199. Calls tick() on every registered butler on a 10-minute cycle. Enumerates butlers from Switchboard's list_butlers(), excludes self, logs results. Error-resilient: one butler's tick failure doesn't stop the cycle.","acceptance_criteria":"1. tick() cycle calls all registered butlers\n2. Self-exclusion from tick targets\n3. Single butler failure doesn't stop cycle\n4. Results logged as sessions\n5. 10-minute cron schedule configured in butler.toml","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:56.497043409+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:38.153204279+08:00","closed_at":"2026-02-09T13:40:38.153204279+08:00","close_reason":"Wave 9 epic complete — all children implemented and merged to main. 429 tests passing.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.14","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:56.49847899+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.14","depends_on_id":"butlers-0qp.13","type":"blocks","created_at":"2026-02-09T12:15:49.410036741+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.14.1","title":"Create Heartbeat butler config and implementation","description":"Create butlers/heartbeat/butler.toml (name=heartbeat, port=8199, schedule: tick every 10 min) and butlers/heartbeat/CLAUDE.md. Heartbeat's tick() enumerates butlers from Switchboard's list_butlers(), excludes itself, calls tick() on each butler via route(). Error-resilient: one failure doesn't stop the cycle.","design":"Heartbeat is a regular butler with a 10-min cron schedule. Its CC prompt: enumerate butlers via list_butlers(), call tick() on each. The CC handles the iteration, Switchboard's route() handles the forwarding.","acceptance_criteria":"1. butler.toml has correct name, port, 10-min schedule\n2. tick cycle enumerates all butlers\n3. Self (heartbeat) excluded from tick targets\n4. Single butler failure doesn't stop cycle\n5. Results logged as sessions","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:12:24.77430292+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:29.295918823+08:00","closed_at":"2026-02-09T13:40:29.295918823+08:00","close_reason":"Wave 9: Heartbeat butler implemented — tick_all tool with self-exclusion and error resilience. 9 tests.","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.14.1","depends_on_id":"butlers-0qp.14","type":"parent-child","created_at":"2026-02-09T12:12:24.77610824+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.14.2","title":"Write Heartbeat butler tests","description":"Write tests/test_heartbeat.py covering: tick cycle dispatches to all butlers, self-exclusion, error resilience (one butler failing doesn't stop others), session logging of tick results.","acceptance_criteria":"1. All scenarios tested\n2. MockSpawner used for CC\n3. Switchboard mocked for butler enumeration\n4. Error resilience verified\n5. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:26.86649374+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:29.309805302+08:00","closed_at":"2026-02-09T13:40:29.309805302+08:00","close_reason":"Wave 9: Heartbeat butler implemented — tick_all tool with self-exclusion and error resilience. 9 tests.","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.14.2","depends_on_id":"butlers-0qp.14","type":"parent-child","created_at":"2026-02-09T12:12:26.867916608+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15","title":"Implement OpenTelemetry instrumentation","description":"OpenTelemetry SDK integration with Jaeger export. init_telemetry(service_name) sets up tracer with OTLP exporter. Span wrappers for MCP tool handlers (butler.tool.\u003cname\u003e with butler.name attribute). Trace context propagation via _trace_context in MCP args and TRACEPARENT env var for CC instances. No-op when OTEL_EXPORTER_OTLP_ENDPOINT not set.","acceptance_criteria":"1. Spans created for each MCP tool invocation\n2. Parent-child span relationships preserved across butler calls\n3. Trace context propagates to CC instances via TRACEPARENT env var\n4. No-op mode when endpoint not configured (no errors, no overhead)\n5. Errors recorded on spans","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:56.788446322+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:29.021934272+08:00","closed_at":"2026-02-09T12:50:29.021934272+08:00","close_reason":"All children completed and merged","labels":["backend","infra"],"dependencies":[{"issue_id":"butlers-0qp.15","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:56.79012853+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15.1","title":"Implement telemetry initialization and tracer setup","description":"Create src/butlers/core/telemetry.py with init_telemetry(service_name) function. Sets up OpenTelemetry TracerProvider with OTLP exporter when OTEL_EXPORTER_OTLP_ENDPOINT env var is set. No-op mode when endpoint not configured (returns a no-op tracer, no errors, no overhead).","acceptance_criteria":"1. Tracer initialized when endpoint configured\n2. No-op mode when endpoint not set\n3. No errors in either mode\n4. Service name set correctly on spans","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:42.037804081+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:43:51.011712975+08:00","closed_at":"2026-02-09T12:43:51.011712975+08:00","close_reason":"Implemented and merged to main in Wave 3","labels":["backend","infra"],"dependencies":[{"issue_id":"butlers-0qp.15.1","depends_on_id":"butlers-0qp.15","type":"parent-child","created_at":"2026-02-09T12:11:42.03928614+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15.2","title":"Implement MCP tool span wrappers","description":"Add span creation wrappers for MCP tool handlers. Each tool invocation creates a span named butler.tool.\u003ctool_name\u003e with butler.name attribute. Errors recorded on spans. Designed as a decorator or context manager for easy application.","acceptance_criteria":"1. Each MCP tool call creates a span\n2. Span named butler.tool.\u003cname\u003e\n3. butler.name attribute set on span\n4. Errors recorded on spans with stack trace","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:48.663308199+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:19.895155634+08:00","closed_at":"2026-02-09T12:50:19.895155634+08:00","close_reason":"Implemented and merged to main in Wave 4","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.15.2","depends_on_id":"butlers-0qp.15","type":"parent-child","created_at":"2026-02-09T12:11:48.664768948+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15.3","title":"Implement trace context propagation","description":"Add trace context propagation helpers. Inter-butler MCP calls include _trace_context in args (W3C Trace Context format). CC spawner sets TRACEPARENT env var for spawned CC instances. Extract and inject helpers for both directions.","acceptance_criteria":"1. _trace_context injected into inter-butler MCP args\n2. TRACEPARENT env var set for CC instances\n3. Parent-child span relationships preserved across butler boundaries\n4. W3C Trace Context format used","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:52.894003238+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:19.905941463+08:00","closed_at":"2026-02-09T12:50:19.905941463+08:00","close_reason":"Implemented and merged to main in Wave 4","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.15.3","depends_on_id":"butlers-0qp.15","type":"parent-child","created_at":"2026-02-09T12:11:52.896318672+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15.4","title":"Write telemetry tests","description":"Write tests/test_core_telemetry.py using InMemorySpanExporter. Test: span creation for tool calls, parent-child relationships, error recording on spans, no-op mode (no spans exported when endpoint not set).","acceptance_criteria":"1. InMemorySpanExporter captures test spans\n2. Parent-child relationships verified\n3. Error recording verified\n4. No-op mode verified (no spans)\n5. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:57.193345546+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:44:11.627523173+08:00","closed_at":"2026-02-09T12:44:11.627523173+08:00","close_reason":"Already implemented by Wave 3 workers — tests exist and pass","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.15.4","depends_on_id":"butlers-0qp.15","type":"parent-child","created_at":"2026-02-09T12:11:57.194943314+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16","title":"Implement Relationship butler","description":"Personal CRM butler on port 8102. 16 database tables covering contacts, relationships (bidirectional), important dates (partial date support), notes (with emotion), interactions, reminders (one-time/recurring), gifts (status pipeline), loans, groups, labels, quick facts, and activity feed. Full CRUD MCP tools for each domain.","acceptance_criteria":"1. All 16 tables created via migration\n2. Contact CRUD (create, update, get, search, archive) works\n3. Bidirectional relationships maintained\n4. Upcoming dates computed via month/day matching\n5. Activity feed auto-populated from mutating tools\n6. All tool categories have full CRUD coverage","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:00.617968247+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:38.163692446+08:00","closed_at":"2026-02-09T13:40:38.163692446+08:00","close_reason":"Wave 9 epic complete — all children implemented and merged to main. 429 tests passing.","labels":["backend","butler","database"],"dependencies":[{"issue_id":"butlers-0qp.16","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:00.619699307+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.16","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.464647222+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.1","title":"Create Relationship Alembic revision","description":"Create Alembic revision in alembic/versions/relationship/ with all 16 tables: contacts, relationships, important_dates, notes, interactions, reminders, gifts, loans, groups, group_members, labels, contact_labels, quick_facts, activity_feed, plus necessary indexes. Contacts have archive support (archived_at). Uses op.execute() with raw SQL.","acceptance_criteria":"1. All 16 tables created with correct schemas\n2. Appropriate indexes created (especially for search)\n3. Foreign keys reference contacts table\n4. Migration idempotent","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:13:06.550114248+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.686815939+08:00","closed_at":"2026-02-09T13:40:31.686815939+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["butler","database"],"dependencies":[{"issue_id":"butlers-0qp.16.1","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:06.551868301+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.10","title":"Write Relationship butler tests","description":"Write tests/test_tools_relationship.py with full CRUD coverage for all tool categories: contacts, relationships (bidirectional verified), dates (partial dates, upcoming), notes (with emotion, search), interactions, reminders (one_time and recurring), gifts (pipeline), loans, groups, labels, quick facts, and activity feed auto-population.","acceptance_criteria":"1. All tool categories have CRUD test coverage\n2. Bidirectional relationships verified\n3. Upcoming dates computation verified\n4. Feed auto-population verified\n5. Tests use testcontainers PostgreSQL\n6. All tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T12:14:05.555441422+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.772461005+08:00","closed_at":"2026-02-09T13:40:31.772461005+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.16.10","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:14:05.557047867+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.2","title":"Implement contact CRUD tools","description":"Create src/butlers/tools/relationship.py. Contact tools: contact_create(name, details JSONB), contact_update(id, fields), contact_get(id), contact_search(query), contact_archive(id). Archive is soft-delete (sets archived_at). Search supports name and details fields.","acceptance_criteria":"1. contact_create stores name and JSONB details\n2. contact_update modifies specified fields\n3. contact_get returns full contact\n4. contact_search finds by name and details content\n5. contact_archive sets archived_at (soft delete)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:12.276490714+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.696856179+08:00","closed_at":"2026-02-09T13:40:31.696856179+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.2","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:12.278160979+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.3","title":"Implement relationship tools","description":"Add relationship tools: relationship_add(contact_a, contact_b, type, notes) creates bidirectional relationship (two rows), relationship_list(contact_id) returns all relationships for a contact, relationship_remove(contact_a, contact_b) removes both directions.","acceptance_criteria":"1. relationship_add creates bidirectional entries\n2. relationship_list returns all for a contact\n3. relationship_remove deletes both directions\n4. Relationship types are freeform strings","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:13:17.277661356+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.708392277+08:00","closed_at":"2026-02-09T13:40:31.708392277+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.3","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:17.279507673+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.4","title":"Implement date and note tools","description":"Add date tools: date_add(contact_id, label, month, day, year?) supports partial dates, date_list(contact_id), upcoming_dates(days_ahead) uses month/day matching. Add note tools: note_create(contact_id, content, emotion?), note_list(contact_id), note_search(query) full-text search.","acceptance_criteria":"1. Partial dates supported (month/day without year)\n2. upcoming_dates computes correctly via month/day matching\n3. Notes support optional emotion tag\n4. note_search performs text search","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:24.598571352+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.71925393+08:00","closed_at":"2026-02-09T13:40:31.71925393+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.4","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:24.600378536+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.5","title":"Implement interaction and reminder tools","description":"Add interaction tools: interaction_log(contact_id, type, summary, occurred_at), interaction_list(contact_id, limit). Add reminder tools: reminder_create(contact_id, message, type: one_time|recurring, cron?), reminder_list(contact_id), reminder_dismiss(id).","acceptance_criteria":"1. Interactions logged with type and timestamp\n2. interaction_list supports limit\n3. Reminders support one_time and recurring types\n4. Recurring reminders use cron expressions\n5. reminder_dismiss marks as dismissed","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:31.148193949+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.729375094+08:00","closed_at":"2026-02-09T13:40:31.729375094+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.5","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:31.150154412+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.6","title":"Implement gift and loan tools","description":"Add gift tools: gift_add(contact_id, description, occasion?), gift_update_status(id, status) with pipeline (idea→purchased→wrapped→given→thanked), gift_list(contact_id, status?). Add loan tools: loan_create(contact_id, amount, direction: lent|borrowed, description), loan_settle(id), loan_list(contact_id).","acceptance_criteria":"1. Gift status pipeline enforced\n2. gift_list filterable by status\n3. Loans track direction (lent/borrowed)\n4. loan_settle marks as settled\n5. loan_list shows outstanding and settled","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:38.368683047+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.737373897+08:00","closed_at":"2026-02-09T13:40:31.737373897+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.6","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:38.370303819+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.7","title":"Implement group, label, and quick fact tools","description":"Add group tools: group_create(name), group_add_member(group_id, contact_id), group_list(). Add label tools: label_create(name, color?), label_assign(label_id, contact_id), contact_search_by_label(label_name). Add quick facts: fact_set(contact_id, key, value) upserts, fact_list(contact_id).","acceptance_criteria":"1. Groups support member management\n2. Labels assignable to contacts\n3. contact_search_by_label finds all contacts with label\n4. fact_set upserts (same key updates)\n5. fact_list returns all facts for contact","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:44.554935086+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.745567059+08:00","closed_at":"2026-02-09T13:40:31.745567059+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.7","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:44.556417015+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.8","title":"Implement activity feed","description":"Add feed_get(contact_id?, limit) tool. Activity feed auto-populated from all mutating tools (contact created, note added, interaction logged, gift status changed, etc.). Each feed entry has type, description, contact_id, and timestamp.","acceptance_criteria":"1. feed_get returns recent activity\n2. All mutating tools create feed entries\n3. Filterable by contact_id\n4. Supports limit parameter","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:13:50.656783955+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.754405749+08:00","closed_at":"2026-02-09T13:40:31.754405749+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.8","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:50.658852192+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.9","title":"Create Relationship butler config","description":"Create butlers/relationship/butler.toml (name=relationship, port=8102) and butlers/relationship/CLAUDE.md (personality: personal CRM assistant, instructions for managing contacts, relationships, and personal data).","acceptance_criteria":"1. butler.toml has correct name and port\n2. CLAUDE.md has appropriate personality and instructions","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:13:57.517006656+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.763760144+08:00","closed_at":"2026-02-09T13:40:31.763760144+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.16.9","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:57.518888911+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17","title":"Implement butler daemon core","description":"ButlerDaemon class orchestrating the full startup sequence: config load -\u003e credential validation -\u003e DB provision -\u003e core migrations -\u003e butler migrations -\u003e module init (topological order) -\u003e tool registration -\u003e FastMCP server start. Core MCP tool wiring: status(), tick(), trigger(), state_*, schedule_*, sessions_*. Graceful shutdown in reverse order.","acceptance_criteria":"1. Startup sequence executes in correct order\n2. All core MCP tools registered and callable\n3. Module tools registered in topological order\n4. status() returns butler identity, modules, health, uptime\n5. Graceful shutdown: stop connections, wait for in-flight CC, module shutdown (reverse order), close DB pool","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:01.740428366+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:29.353673229+08:00","closed_at":"2026-02-09T13:18:29.353673229+08:00","close_reason":"All children completed","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:01.742111877+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.2","type":"blocks","created_at":"2026-02-09T12:15:48.513249193+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.3","type":"blocks","created_at":"2026-02-09T12:15:48.568728916+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.4","type":"blocks","created_at":"2026-02-09T12:15:48.909758455+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.5","type":"blocks","created_at":"2026-02-09T12:15:48.964838122+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.6","type":"blocks","created_at":"2026-02-09T12:15:49.02041538+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.7","type":"blocks","created_at":"2026-02-09T12:15:49.076717888+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.8","type":"blocks","created_at":"2026-02-09T12:15:49.133485584+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.11","type":"blocks","created_at":"2026-02-09T12:15:49.187240499+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.1","title":"Implement ButlerDaemon class with startup sequence","description":"Create src/butlers/daemon.py with ButlerDaemon class. Orchestrates startup: config load -\u003e credential validation -\u003e DB provision -\u003e core Alembic migrations -\u003e butler-specific Alembic migrations -\u003e module init (topological order, including module Alembic revisions) -\u003e tool registration -\u003e FastMCP server start. The composition root that wires everything together.","design":"ButlerDaemon holds references to config, db pool, spawner, scheduler, modules. Startup is a sequential async flow. FastMCP server created with butler name, runs on configured port with SSE transport.","acceptance_criteria":"1. Startup executes in correct documented order\n2. Failure at any step prevents subsequent steps\n3. All components accessible on daemon instance\n4. FastMCP server starts on configured port","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T12:12:02.345988389+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:22.605575067+08:00","closed_at":"2026-02-09T13:18:22.605575067+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.1","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:02.347898496+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.2","title":"Implement core MCP tool registration","description":"Wire all core MCP tools on the FastMCP server instance: status(), tick(), trigger(prompt), state_get/set/delete/list, schedule_list/create/update/delete, sessions_list/get. Each tool delegates to the appropriate core component.","acceptance_criteria":"1. All core tools registered on FastMCP\n2. Tools callable via MCP protocol\n3. Tools delegate to correct core components\n4. Tool signatures match spec","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:12:10.333829246+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:22.619052694+08:00","closed_at":"2026-02-09T13:18:22.619052694+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.2","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:10.335774421+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.3","title":"Implement module tool registration","description":"Call register_tools(mcp, config, db) for each enabled module in topological order. Module configs validated against their config_schema. Module migrations applied before tool registration.","acceptance_criteria":"1. Modules loaded in topological dependency order\n2. Module configs validated against config_schema\n3. Module migrations applied before register_tools\n4. Module tools registered on shared FastMCP instance","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:14.909502577+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:22.626108711+08:00","closed_at":"2026-02-09T13:18:22.626108711+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.3","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:14.911256801+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.4","title":"Implement graceful shutdown sequence","description":"Graceful shutdown: stop accepting new connections, wait for in-flight CC instances to complete, call module on_shutdown() in reverse topological order, close DB pool. Triggered by SIGINT/SIGTERM or explicit shutdown call.","acceptance_criteria":"1. No new connections accepted during shutdown\n2. In-flight CC instances complete before shutdown\n3. Module on_shutdown called in reverse order\n4. DB pool closed last\n5. Clean exit with no resource leaks","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:12:20.729320572+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:22.635657964+08:00","closed_at":"2026-02-09T13:18:22.635657964+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.4","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:20.731030692+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.5","title":"Implement status() MCP tool","description":"Implement status() tool returning butler identity (name, description, port), loaded modules list, health status, and uptime (time since startup). Used by Heartbeat and for diagnostics.","acceptance_criteria":"1. Returns butler name, description, port\n2. Lists loaded modules\n3. Reports health status\n4. Reports uptime since startup","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:12:27.77168615+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:22.645127617+08:00","closed_at":"2026-02-09T13:18:22.645127617+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.5","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:27.773122944+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.6","title":"Write butler daemon tests","description":"Write tests/test_daemon.py covering: startup sequence order verification, core tool registration, module tool registration, shutdown order (reverse of startup), status() tool output.","acceptance_criteria":"1. Startup sequence order verified\n2. All core tools registered\n3. Module registration in topological order\n4. Shutdown in reverse order\n5. status() returns expected fields\n6. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:33.486972898+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:22.654998988+08:00","closed_at":"2026-02-09T13:18:22.654998988+08:00","close_reason":"Implemented and merged to main","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.17.6","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:33.488891312+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18","title":"Implement Health butler","description":"Health tracking butler on port 8103. Tables for measurements, medications, medication_doses, conditions, meals, symptoms, research. MCP tools for measurement logging/history, medication management with adherence rate, condition tracking, diet/nutrition with aggregation, symptom tracking, research notes, and health summary/trend reports.","acceptance_criteria":"1. All health tables created via migration\n2. Measurement log/history/latest tools work\n3. Medication adherence rate computed correctly\n4. Nutrition summary aggregates meal data\n5. Trend report generates meaningful summaries\n6. All tool categories have full coverage","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:04.479165077+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:38.173661782+08:00","closed_at":"2026-02-09T13:40:38.173661782+08:00","close_reason":"Wave 9 epic complete — all children implemented and merged to main. 429 tests passing.","labels":["backend","butler","database"],"dependencies":[{"issue_id":"butlers-0qp.18","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:04.480751704+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.18","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.520924002+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.1","title":"Create Health database migration","description":"Create migrations/health/001_health.sql with tables: measurements (id, type, value JSONB, unit, measured_at), medications (id, name, dosage, frequency, active), medication_doses (id, medication_id FK, taken_at, notes), conditions (id, name, status, diagnosed_at, notes), meals (id, description, calories, nutrients JSONB, eaten_at), symptoms (id, name, severity, notes, occurred_at), research (id, topic, content, sources JSONB, created_at). Plus appropriate indexes.","acceptance_criteria":"1. All 7 tables created with correct schemas\n2. Foreign key from medication_doses to medications\n3. Appropriate indexes for time-range queries\n4. Migration idempotent","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:13.969283232+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.291694528+08:00","closed_at":"2026-02-09T13:40:33.291694528+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["butler","database"],"dependencies":[{"issue_id":"butlers-0qp.18.1","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:13.970835654+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.2","title":"Implement measurement tools","description":"Create src/butlers/tools/health.py. Measurement tools: measurement_log(type, value, unit, measured_at?), measurement_history(type, since?, until?), measurement_latest(type). Types are freeform strings (weight, blood_pressure, heart_rate, etc.). Values stored as JSONB to support compound measurements.","acceptance_criteria":"1. measurement_log stores with timestamp\n2. measurement_history filters by type and date range\n3. measurement_latest returns most recent for type\n4. JSONB values support compound data (e.g., systolic/diastolic)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:21.715545229+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.302071595+08:00","closed_at":"2026-02-09T13:40:33.302071595+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.2","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:21.717811009+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.3","title":"Implement medication tools","description":"Add medication tools: medication_add(name, dosage, frequency), medication_list(active_only?), medication_log_dose(medication_id, taken_at?, notes?), medication_history(medication_id, since?, until?) with adherence rate computation (doses taken / expected doses based on frequency).","acceptance_criteria":"1. medication_add creates active medication\n2. medication_list filterable by active status\n3. medication_log_dose records dose taken\n4. medication_history includes adherence rate\n5. Adherence rate computed correctly","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:28.704068241+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.311389491+08:00","closed_at":"2026-02-09T13:40:33.311389491+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.3","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:28.705861979+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.4","title":"Implement condition and symptom tools","description":"Add condition tools: condition_add(name, status, diagnosed_at?, notes?), condition_list(status?), condition_update(id, fields). Add symptom tools: symptom_log(name, severity 1-10, notes?, occurred_at?), symptom_history(name?, since?, until?), symptom_search(query).","acceptance_criteria":"1. Conditions track status (active, resolved, managed)\n2. condition_list filterable by status\n3. symptom_log records with severity scale\n4. symptom_history supports filtering\n5. symptom_search finds by name and notes","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:34.046531237+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.320561502+08:00","closed_at":"2026-02-09T13:40:33.320561502+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.4","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:34.048107193+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.5","title":"Implement diet and nutrition tools","description":"Add diet tools: meal_log(description, calories?, nutrients JSONB?, eaten_at?), meal_history(since?, until?), nutrition_summary(since, until) aggregating calories and nutrient totals over a date range.","acceptance_criteria":"1. meal_log stores with optional nutrition data\n2. meal_history returns meals in date range\n3. nutrition_summary aggregates calories and nutrients\n4. Nutrients stored as JSONB for flexibility","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:39.942698291+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.329215233+08:00","closed_at":"2026-02-09T13:40:33.329215233+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.5","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:39.944401669+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.6","title":"Implement research and report tools","description":"Add research tools: research_save(topic, content, sources?), research_search(query), research_summarize(topic). Add report tools: health_summary() returns overview of recent measurements/medications/conditions, trend_report(type, since, until) generates trend analysis for a measurement type.","acceptance_criteria":"1. research_save stores with optional sources\n2. research_search finds by topic and content\n3. health_summary covers all health domains\n4. trend_report analyzes measurement trends","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:45.803917756+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.338220568+08:00","closed_at":"2026-02-09T13:40:33.338220568+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.6","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:45.805411358+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.7","title":"Create Health butler config","description":"Create butlers/health/butler.toml (name=health, port=8103) and butlers/health/CLAUDE.md (personality: health tracking assistant, instructions for logging and analyzing health data).","acceptance_criteria":"1. butler.toml has correct name and port\n2. CLAUDE.md has appropriate personality and instructions","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:14:50.993440482+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.347896752+08:00","closed_at":"2026-02-09T13:40:33.347896752+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.18.7","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:50.994989267+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.8","title":"Write Health butler tests","description":"Write tests/test_tools_health.py with full coverage: measurements (log, history, latest), medications (add, list, log dose, adherence rate), conditions (add, list, update), diet (meal log, history, nutrition summary), symptoms (log, history, search), research (save, search), reports (health summary, trend report).","acceptance_criteria":"1. All tool categories tested\n2. Adherence rate computation verified\n3. Nutrition aggregation verified\n4. Trend report generation verified\n5. Tests use testcontainers PostgreSQL\n6. All tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:14:56.713963614+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.357259743+08:00","closed_at":"2026-02-09T13:40:33.357259743+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.18.8","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:56.715440694+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19","title":"Implement General butler","description":"Catch-all butler on port 8101. Schema-light freeform JSONB storage with collections and entities tables (GIN indexes). Entity CRUD with deep merge on update. Collection management. Export tools for future migration to specialist butlers. The default routing target when no specialist butler matches.","acceptance_criteria":"1. collections and entities tables with GIN indexes created\n2. Entity CRUD (create, get, update with deep merge, search, delete) works\n3. Collection management tools work\n4. GIN index enables efficient JSONB search\n5. Export tools produce usable output","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:09.581501378+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:12.218499746+08:00","closed_at":"2026-02-09T13:28:12.218499746+08:00","close_reason":"Wave 8 epic complete — all children implemented and merged to main. 325 tests passing.","labels":["backend","butler","database"],"dependencies":[{"issue_id":"butlers-0qp.19","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:09.583583942+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.19","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.578087044+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19.1","title":"Create General database migration","description":"Create migrations/general/001_general.sql with collections table (id UUID PK, name TEXT UNIQUE, description TEXT, created_at TIMESTAMPTZ) and entities table (id UUID PK, collection_id UUID FK, data JSONB NOT NULL, created_at TIMESTAMPTZ, updated_at TIMESTAMPTZ). Add GIN index on entities.data for efficient JSONB search.","acceptance_criteria":"1. collections and entities tables created\n2. GIN index on entities.data\n3. Foreign key from entities to collections\n4. Migration idempotent","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:15:03.112865592+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:08.167878414+08:00","closed_at":"2026-02-09T13:28:08.167878414+08:00","close_reason":"Wave 8: General butler implemented — collection/entity CRUD, deep merge, GIN search, export. 33 tests passing.","labels":["butler","database"],"dependencies":[{"issue_id":"butlers-0qp.19.1","depends_on_id":"butlers-0qp.19","type":"parent-child","created_at":"2026-02-09T12:15:03.114392125+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19.2","title":"Implement General butler entity and collection tools","description":"Create src/butlers/tools/general.py. Entity tools: entity_create(collection, data JSONB), entity_get(id), entity_update(id, data) with deep merge, entity_search(collection?, query JSONB), entity_delete(id). Collection tools: collection_create(name, description?), collection_list(), collection_delete(name). Export tools: export_collection(name) returns all entities as JSON.","design":"entity_update uses JSONB deep merge (jsonb_deep_merge or || operator with recursive merge). entity_search uses GIN index via @\u003e containment operator. Export produces a JSON array of all entities in a collection.","acceptance_criteria":"1. Entity CRUD with deep merge on update\n2. GIN-indexed JSONB search via containment\n3. Collection management works\n4. Export produces complete collection dump\n5. Freeform JSONB data accepted","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:15:12.418318081+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:08.176503587+08:00","closed_at":"2026-02-09T13:28:08.176503587+08:00","close_reason":"Wave 8: General butler implemented — collection/entity CRUD, deep merge, GIN search, export. 33 tests passing.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.19.2","depends_on_id":"butlers-0qp.19","type":"parent-child","created_at":"2026-02-09T12:15:12.419722404+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19.3","title":"Create General butler config","description":"Create butlers/general/butler.toml (name=general, port=8101) and butlers/general/CLAUDE.md (personality: flexible catch-all assistant, instructions for storing and retrieving freeform data).","acceptance_criteria":"1. butler.toml has correct name and port\n2. CLAUDE.md has appropriate personality and instructions","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:15:17.077605865+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:08.184470736+08:00","closed_at":"2026-02-09T13:28:08.184470736+08:00","close_reason":"Wave 8: General butler implemented — collection/entity CRUD, deep merge, GIN search, export. 33 tests passing.","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.19.3","depends_on_id":"butlers-0qp.19","type":"parent-child","created_at":"2026-02-09T12:15:17.07953562+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19.4","title":"Write General butler tests","description":"Write tests/test_tools_general.py covering: entity CRUD, deep merge on update (nested objects merged correctly), GIN-indexed search (containment queries), collection management, export, freeform JSONB acceptance.","acceptance_criteria":"1. All tool operations tested\n2. Deep merge verified with nested objects\n3. GIN search verified with containment\n4. Export completeness verified\n5. Tests use testcontainers PostgreSQL\n6. All tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:15:22.437261116+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:08.193322667+08:00","closed_at":"2026-02-09T13:28:08.193322667+08:00","close_reason":"Wave 8: General butler implemented — collection/entity CRUD, deep merge, GIN search, export. 33 tests passing.","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.19.4","depends_on_id":"butlers-0qp.19","type":"parent-child","created_at":"2026-02-09T12:15:22.439045156+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2","title":"Implement config loading","description":"Parse butler.toml configuration files with support for [butler] identity (name, port, description), [butler.db] database config, [butler.env] credential declarations (required/optional), [[butler.schedule]] task definitions, and [modules.*] module configs. Validate required fields, apply defaults.","acceptance_criteria":"1. Valid full config loads all sections correctly\n2. Minimal config applies defaults (db name = butler_{name})\n3. Missing/invalid TOML raises clear error\n4. Missing required fields (name, port) prevent startup","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:06:58.946023801+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:30.606019845+08:00","closed_at":"2026-02-09T12:34:30.606019845+08:00","close_reason":"All config loading subtasks completed","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.2","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:06:58.947296466+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2.1","title":"Implement ButlerConfig dataclass and TOML parser","description":"Create src/butlers/config.py with ButlerConfig dataclass. Parse butler.toml sections: [butler] (name, port, description), [butler.db] (name with default butler_{name}), [[butler.schedule]] (name, cron, prompt), [modules.*] (module-specific config). Use tomllib (stdlib).","design":"ButlerConfig dataclass with fields: name (str), port (int), description (str|None), db_name (str), schedules (list[ScheduleConfig]), modules (dict[str, dict]). ScheduleConfig dataclass: name, cron, prompt. Validation at parse time.","acceptance_criteria":"1. Valid full config loads all sections\n2. Minimal config (name + port only) applies defaults\n3. Config object exposes all parsed fields","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:14.821442559+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:33:39.845850967+08:00","closed_at":"2026-02-09T12:33:39.845850967+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.2.1","depends_on_id":"butlers-0qp.2","type":"parent-child","created_at":"2026-02-09T12:10:14.823012765+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2.2","title":"Add butler.env credential declaration support","description":"Add [butler.env] section parsing to ButlerConfig. Supports required (list[str]) and optional (list[str]) env var declarations. These are used by credential validation at startup.","acceptance_criteria":"1. [butler.env].required parsed as list of env var names\n2. [butler.env].optional parsed as list of env var names\n3. Missing section defaults to empty lists","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:18.113979062+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:23.500636742+08:00","closed_at":"2026-02-09T12:34:23.500636742+08:00","close_reason":"Already implemented in butlers-0qp.2.1 worker (env section parsing included in config.py)","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.2.2","depends_on_id":"butlers-0qp.2","type":"parent-child","created_at":"2026-02-09T12:10:18.115508922+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2.3","title":"Add config validation for required fields","description":"Validate that butler.toml contains [butler] section with name (str) and port (int). Reject startup with clear error if file is missing, unparseable TOML, or lacks required fields.","acceptance_criteria":"1. Missing butler.toml raises ConfigError\n2. Invalid TOML syntax raises parse error with location info\n3. Missing name field raises validation error\n4. Missing port field raises validation error\n5. Daemon does not proceed past config loading on error","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:19.392429438+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:33:39.861524113+08:00","closed_at":"2026-02-09T12:33:39.861524113+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.2.3","depends_on_id":"butlers-0qp.2","type":"parent-child","created_at":"2026-02-09T12:10:19.394163243+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2.4","title":"Write config loading tests","description":"Write tests/test_config.py covering: valid full config, minimal config with defaults, missing file, invalid TOML, missing required fields (name, port), env section parsing, schedule section parsing, module section parsing.","acceptance_criteria":"1. Test cases for every scenario listed\n2. All tests pass\n3. Edge cases covered (empty sections, extra fields)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:21.201546671+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:23.567298125+08:00","closed_at":"2026-02-09T12:34:23.567298125+08:00","close_reason":"Already implemented in butlers-0qp.2.1 worker (10 tests in test_config.py)","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.2.4","depends_on_id":"butlers-0qp.2","type":"parent-child","created_at":"2026-02-09T12:10:21.203415531+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20","title":"Implement CLI commands","description":"Click-based CLI with 4 commands: 'butlers up' (discover all butler.toml configs, start all in single asyncio event loop, --only filtering), 'butlers run --config' (single butler startup), 'butlers list' (discover and display names/ports/modules), 'butlers init \u003cname\u003e --port' (scaffold config dir with butler.toml, CLAUDE.md, AGENTS.md, skills/). Graceful shutdown on SIGINT/SIGTERM. Entry point in pyproject.toml.","acceptance_criteria":"1. butlers up discovers and starts all butlers\n2. butlers up --only filters to specific butlers\n3. butlers run starts a single butler from config path\n4. butlers list displays all discovered butlers\n5. butlers init scaffolds a complete config directory\n6. SIGINT/SIGTERM trigger graceful shutdown\n7. Entry point registered in pyproject.toml","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:17.695713261+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:12.208750451+08:00","closed_at":"2026-02-09T13:28:12.208750451+08:00","close_reason":"Wave 8 epic complete — all children implemented and merged to main. 325 tests passing.","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:17.697466273+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.20","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.635262191+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.1","title":"Implement Click CLI with butlers up command","description":"Create src/butlers/cli.py with Click CLI group. Implement 'butlers up' command: discover all butler.toml configs in butlers/ directory, start all butler daemons in a single asyncio event loop, support --only flag to filter specific butlers.","design":"Click group 'butlers' with subcommands. 'up' discovers config dirs, creates ButlerDaemon per config, runs all in asyncio.gather. --only accepts comma-separated butler names.","acceptance_criteria":"1. butlers up discovers all butler configs\n2. All discovered butlers start in one event loop\n3. --only filters to specified butlers only\n4. Missing butlers/ directory gives clear error","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:46.75134368+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:06.974152775+08:00","closed_at":"2026-02-09T13:28:06.974152775+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.1","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:46.752872989+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.2","title":"Implement butlers run command","description":"Implement 'butlers run --config \u003cpath\u003e' command: start a single butler daemon from the specified config directory path.","acceptance_criteria":"1. Starts single butler from config path\n2. Missing config path gives clear error\n3. Invalid config gives clear error\n4. Runs until SIGINT/SIGTERM","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:13:49.59251006+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:06.983063076+08:00","closed_at":"2026-02-09T13:28:06.983063076+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.2","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:49.594832366+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.3","title":"Implement butlers list command","description":"Implement 'butlers list' command: discover all butler.toml configs and display butler names, ports, descriptions, and enabled modules in a formatted table.","acceptance_criteria":"1. Discovers all butler configs\n2. Displays name, port, description, modules\n3. Formatted for readability","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:13:51.559502+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:06.991808426+08:00","closed_at":"2026-02-09T13:28:06.991808426+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.3","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:51.561034836+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.4","title":"Implement butlers init command","description":"Implement 'butlers init \u003cname\u003e --port \u003cport\u003e' command: scaffold a new butler config directory with butler.toml (pre-filled name and port), CLAUDE.md (template), AGENTS.md (empty), and skills/ directory.","acceptance_criteria":"1. Creates butlers/\u003cname\u003e/ directory\n2. butler.toml has correct name and port\n3. CLAUDE.md created with template content\n4. AGENTS.md created (empty or with template)\n5. skills/ directory created\n6. Existing directory not overwritten","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:13:55.377542099+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:06.99986811+08:00","closed_at":"2026-02-09T13:28:06.99986811+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.4","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:55.409346322+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.5","title":"Implement graceful shutdown on signals","description":"Handle SIGINT and SIGTERM in CLI commands. Trigger graceful shutdown of all running butler daemons. Works for both 'butlers up' (multiple) and 'butlers run' (single).","acceptance_criteria":"1. SIGINT triggers graceful shutdown\n2. SIGTERM triggers graceful shutdown\n3. All butlers shut down cleanly\n4. Exit code 0 on clean shutdown","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:13:58.562950862+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:07.008382243+08:00","closed_at":"2026-02-09T13:28:07.008382243+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.5","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:58.566326098+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.6","title":"Add CLI entry point to pyproject.toml","description":"Add [project.scripts] entry point to pyproject.toml mapping 'butlers' to src/butlers/cli.py main function. Verify 'butlers --help' works after uv sync.","acceptance_criteria":"1. [project.scripts] entry defined\n2. butlers --help works after installation\n3. All subcommands listed","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":10,"created_at":"2026-02-09T12:14:01.354292834+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:07.017965435+08:00","closed_at":"2026-02-09T13:28:07.017965435+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.20.6","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:14:01.356183365+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.7","title":"Write CLI tests","description":"Write tests/test_cli.py using Click's CliRunner. Test: command invocation (up, run, list, init), discovery of butler configs, init scaffolding (correct files created), signal handling.","acceptance_criteria":"1. All commands tested via CliRunner\n2. Discovery logic verified\n3. Init scaffolding verified (files exist with correct content)\n4. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:04.417757963+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:07.027214295+08:00","closed_at":"2026-02-09T13:28:07.027214295+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["cli","testing"],"dependencies":[{"issue_id":"butlers-0qp.20.7","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:14:04.419483632+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.21","title":"Implement Docker and deployment","description":"Dockerfile with python:3.12-slim base, Node.js 22, claude-code npm package, uv. docker-compose.yml defining postgres:17, jaeger, switchboard, general, relationship, health, heartbeat services. Dev quick start: docker compose up -d postgres jaeger \u0026\u0026 butlers up. Production: docker compose up -d.","acceptance_criteria":"1. Dockerfile builds successfully with all runtime deps\n2. docker-compose.yml defines all services with correct ports\n3. Dev mode: postgres + jaeger containers, butlers up locally\n4. Production mode: full stack via docker compose up -d\n5. Database auto-provisioning works in both modes","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:22.006375664+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:35.137509555+08:00","closed_at":"2026-02-09T13:50:35.137509555+08:00","close_reason":"Wave 10 epic complete — all children implemented and merged to main. 449 tests passing.","labels":["deployment","infra"],"dependencies":[{"issue_id":"butlers-0qp.21","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:22.00884053+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.21","depends_on_id":"butlers-0qp.20","type":"blocks","created_at":"2026-02-09T12:15:49.691993498+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.21.1","title":"Create Dockerfile","description":"Create Dockerfile based on python:3.12-slim. Install Node.js 22 (for claude-code npm package), install claude-code globally, install uv, copy project, run uv sync. Entrypoint: butlers run --config.","acceptance_criteria":"1. Builds successfully\n2. Python 3.12, Node.js 22, claude-code, uv all available\n3. Project dependencies installed\n4. Entrypoint works with --config flag","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:09.715751029+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:28.432203589+08:00","closed_at":"2026-02-09T13:50:28.432203589+08:00","close_reason":"Wave 10: Docker deployment — Dockerfile, docker-compose.yml, .env.example.","labels":["deployment","infra"],"dependencies":[{"issue_id":"butlers-0qp.21.1","depends_on_id":"butlers-0qp.21","type":"parent-child","created_at":"2026-02-09T12:14:09.718671745+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.21.2","title":"Create docker-compose.yml","description":"Create docker-compose.yml defining services: postgres:17 (with health check), jaeger (all-in-one with OTLP receiver), switchboard (port 8100), general (port 8101), relationship (port 8102), health (port 8103), heartbeat (port 8199). All butler services depend on postgres, share ANTHROPIC_API_KEY env var.","design":"postgres: postgres:17 with POSTGRES_PASSWORD, volume for data persistence, health check. jaeger: jaegertracing/all-in-one with ports 16686 (UI) and 4317 (OTLP). Butler services: built from Dockerfile, each with --config pointing to their butler dir, depends_on postgres healthy.","acceptance_criteria":"1. All services defined with correct ports\n2. postgres has health check\n3. Butler services depend on postgres\n4. ANTHROPIC_API_KEY passed to all butler services\n5. Jaeger configured for OTLP and UI","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:12.351420431+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:28.44238559+08:00","closed_at":"2026-02-09T13:50:28.44238559+08:00","close_reason":"Wave 10: Docker deployment — Dockerfile, docker-compose.yml, .env.example.","labels":["deployment","infra"],"dependencies":[{"issue_id":"butlers-0qp.21.2","depends_on_id":"butlers-0qp.21","type":"parent-child","created_at":"2026-02-09T12:14:12.352938389+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.21.3","title":"Verify dev and production quick starts","description":"Verify two deployment modes work: Dev mode (docker compose up -d postgres jaeger \u0026\u0026 butlers up), Production mode (docker compose up -d). Document any required .env setup.","acceptance_criteria":"1. Dev mode: postgres + jaeger in Docker, butlers locally\n2. Production mode: full stack via docker compose\n3. Database auto-provisioning works in both modes\n4. Butlers connect to postgres in both modes","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:14.068098688+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:28.446317479+08:00","closed_at":"2026-02-09T13:50:28.446317479+08:00","close_reason":"Wave 10: Docker deployment — Dockerfile, docker-compose.yml, .env.example.","labels":["deployment","infra"],"dependencies":[{"issue_id":"butlers-0qp.21.3","depends_on_id":"butlers-0qp.21","type":"parent-child","created_at":"2026-02-09T12:14:14.069519131+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22","title":"Write integration tests","description":"End-to-end integration tests using testcontainer PostgreSQL and MockSpawner. Four key test scenarios: full butler startup lifecycle, scheduler tick dispatch, switchboard routing, and trace context propagation across the full chain.","acceptance_criteria":"1. Full butler startup test: config -\u003e DB -\u003e migrations -\u003e tools -\u003e status()\n2. Scheduler tick dispatches to MockSpawner and logs session\n3. Switchboard route() forwards to target and returns result\n4. Trace context propagates from switchboard.route -\u003e butler.trigger -\u003e CC session","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:25.898819522+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:35.148508549+08:00","closed_at":"2026-02-09T13:50:35.148508549+08:00","close_reason":"Wave 10 epic complete — all children implemented and merged to main. 449 tests passing.","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:25.900446235+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.22","depends_on_id":"butlers-0qp.13","type":"blocks","created_at":"2026-02-09T12:15:49.750331942+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.22","depends_on_id":"butlers-0qp.14","type":"blocks","created_at":"2026-02-09T12:15:49.808386599+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.22","depends_on_id":"butlers-0qp.15","type":"blocks","created_at":"2026-02-09T12:15:49.867003609+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22.1","title":"Write full butler startup integration test","description":"Integration test: full butler startup with testcontainer PostgreSQL and MockSpawner. Verify: config load -\u003e DB provision -\u003e migrations -\u003e tool registration -\u003e status() returns correct data. Tests the entire ButlerDaemon lifecycle end-to-end.","acceptance_criteria":"1. Real PostgreSQL via testcontainers\n2. Full startup sequence completes\n3. Database provisioned with all tables\n4. MCP tools registered and callable\n5. status() returns correct identity and modules","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:14:18.621003233+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:30.069832382+08:00","closed_at":"2026-02-09T13:50:30.069832382+08:00","close_reason":"Wave 10: Integration tests — butler lifecycle, scheduler tick, switchboard routing, trace propagation. 20 tests.","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22.1","depends_on_id":"butlers-0qp.22","type":"parent-child","created_at":"2026-02-09T12:14:18.62251031+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22.2","title":"Write scheduler tick integration test","description":"Integration test: scheduler tick dispatches to MockSpawner and logs session. Set up a butler with a schedule, advance time past cron trigger, call tick(), verify MockSpawner received the prompt and session was logged.","acceptance_criteria":"1. Schedule task created in DB\n2. tick() dispatches due task to MockSpawner\n3. MockSpawner receives correct prompt\n4. Session logged with trigger_source='schedule'","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:22.531100628+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:30.082912849+08:00","closed_at":"2026-02-09T13:50:30.082912849+08:00","close_reason":"Wave 10: Integration tests — butler lifecycle, scheduler tick, switchboard routing, trace propagation. 20 tests.","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22.2","depends_on_id":"butlers-0qp.22","type":"parent-child","created_at":"2026-02-09T12:14:22.53281709+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22.3","title":"Write switchboard routing integration test","description":"Integration test: switchboard route() forwards to target butler and returns result. Set up switchboard and a target butler, register target in butler_registry, call route() with a tool name and args, verify target receives the call and response is returned.","acceptance_criteria":"1. Both butlers running (switchboard + target)\n2. Target registered in butler_registry\n3. route() forwards tool call to target\n4. Response returned to caller\n5. routing_log entry created","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:14:23.427141692+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:30.097702155+08:00","closed_at":"2026-02-09T13:50:30.097702155+08:00","close_reason":"Wave 10: Integration tests — butler lifecycle, scheduler tick, switchboard routing, trace propagation. 20 tests.","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22.3","depends_on_id":"butlers-0qp.22","type":"parent-child","created_at":"2026-02-09T12:14:23.428802088+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22.4","title":"Write trace context propagation integration test","description":"Integration test: trace context propagates from switchboard.route -\u003e butler.trigger -\u003e CC session. Verify parent-child span relationships across the full chain using InMemorySpanExporter.","acceptance_criteria":"1. Trace context injected at switchboard\n2. Propagated through route() to target butler\n3. Propagated to CC session via TRACEPARENT\n4. Parent-child span relationships verified\n5. All spans share same trace ID","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:24.548055995+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:30.108971971+08:00","closed_at":"2026-02-09T13:50:30.108971971+08:00","close_reason":"Wave 10: Integration tests — butler lifecycle, scheduler tick, switchboard routing, trace propagation. 20 tests.","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22.4","depends_on_id":"butlers-0qp.22","type":"parent-child","created_at":"2026-02-09T12:14:24.54955182+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3","title":"Implement module system","description":"Build the pluggable module system: Module ABC with name, config_schema, dependencies, register_tools, migrations, on_startup, on_shutdown. Module registry with topological dependency sort, circular dependency detection, and config-driven loading from butler.toml [modules.*] sections.","acceptance_criteria":"1. Module ABC enforces all required abstract members\n2. Registry resolves dependencies via topological sort\n3. Circular dependencies detected and rejected\n4. Missing dependencies fail fast with clear error\n5. Modules loaded in correct dependency order","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:02.879608473+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:30.665402419+08:00","closed_at":"2026-02-09T12:34:30.665402419+08:00","close_reason":"All module system subtasks completed","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.3","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:02.880944878+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3.1","title":"Implement Module abstract base class","description":"Create src/butlers/modules/base.py with Module ABC. Abstract members: name (str property), config_schema (type[BaseModel] property), dependencies (list[str] property), register_tools(mcp, config, db) async method, migration_revisions() method returning str | None (Alembic branch label for module's revisions, or None if no migrations needed), on_startup(config, db) async method, on_shutdown() async method.","design":"Use abc.ABC and abc.abstractmethod. config_schema returns a Pydantic BaseModel subclass so module configs are validated. Dependencies declared as module name strings. register_tools receives FastMCP instance, validated config, and asyncpg pool.","acceptance_criteria":"1. Cannot instantiate Module directly (ABC)\n2. Subclass missing any abstract member raises TypeError\n3. Minimal concrete implementation instantiates successfully\n4. All abstract members have correct signatures","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:31.971700635+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:33:39.870115873+08:00","closed_at":"2026-02-09T12:33:39.870115873+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.3.1","depends_on_id":"butlers-0qp.3","type":"parent-child","created_at":"2026-02-09T12:10:31.973741289+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3.2","title":"Implement module registry with topological sort","description":"Create src/butlers/modules/registry.py. Module registry maintains name-\u003eclass mapping. load_from_config(modules_config) instantiates enabled modules, resolves dependency order via topological sort (Kahn's algorithm), detects circular dependencies, and validates all declared dependencies exist in the registry.","design":"Registry is a dict[str, type[Module]]. Topological sort using in-degree counting (Kahn's algorithm). Circular deps detected when sorted result length != input length. Missing deps caught during validation before sort.","acceptance_criteria":"1. Modules registered by name\n2. load_from_config returns modules in topological order\n3. Circular dependencies raise clear error\n4. Missing dependencies raise clear error\n5. Independent modules have no ordering constraints","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:37.455060922+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:33:39.878407325+08:00","closed_at":"2026-02-09T12:33:39.878407325+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.3.2","depends_on_id":"butlers-0qp.3","type":"parent-child","created_at":"2026-02-09T12:10:37.456657337+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3.3","title":"Write Module ABC tests","description":"Write tests/test_module_base.py covering: minimal module implementation with all members, incomplete implementation raises TypeError, module with no dependencies returns empty list, module with no migrations returns empty list.","acceptance_criteria":"1. All scenarios tested\n2. Tests verify ABC enforcement\n3. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:40.287952205+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:23.622813102+08:00","closed_at":"2026-02-09T12:34:23.622813102+08:00","close_reason":"Already implemented in butlers-0qp.3.1 worker (9 tests in test_module_base.py)","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.3.3","depends_on_id":"butlers-0qp.3","type":"parent-child","created_at":"2026-02-09T12:10:40.289652526+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3.4","title":"Write module registry tests","description":"Write tests/test_module_registry.py covering: registration, dependency ordering (A depends on B → B loads first), circular detection (A→B→A), missing dependencies, config-driven loading, modules not in config excluded.","acceptance_criteria":"1. Dependency ordering verified with 3+ modules\n2. Circular dependency raises error with cycle description\n3. Missing dependency raises error naming the missing module\n4. Only config-enabled modules loaded","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:43.277281263+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:23.68377011+08:00","closed_at":"2026-02-09T12:34:23.68377011+08:00","close_reason":"Already implemented in butlers-0qp.3.2 worker (12 tests in test_module_registry.py)","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.3.4","depends_on_id":"butlers-0qp.3","type":"parent-child","created_at":"2026-02-09T12:10:43.279165452+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4","title":"Implement database layer","description":"Alembic migration setup, asyncpg connection pool management, and database auto-provisioning (CREATE DATABASE IF NOT EXISTS via maintenance connection). Core Alembic revision creates state, scheduled_tasks, and sessions tables. Each butler gets its own dedicated PostgreSQL database. Alembic uses multiple version chains (core + per-butler) under alembic/versions/.","acceptance_criteria":"1. Database auto-created on first startup\n2. Migrations applied idempotently\n3. _migrations table tracks applied migrations\n4. Connection pool reusable across components","notes":"NOTE: Acceptance criteria #3 is stale — should read 'Alembic alembic_version table tracks applied revisions' instead of '_migrations table'. Updated in design.md D12.","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:06.6354237+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:44:22.066214891+08:00","closed_at":"2026-02-09T12:44:22.066214891+08:00","close_reason":"All children completed — DB layer, Alembic infrastructure, core revision, and tests merged","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.4","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:06.636861536+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4.1","title":"Implement asyncpg connection pool and DB provisioning","description":"Create src/butlers/db.py with Database class. Connect to PostgreSQL maintenance DB to CREATE DATABASE IF NOT EXISTS for the butler's dedicated database. Return asyncpg connection pool for the butler's DB. Support configurable host/port/user/password via environment variables (POSTGRES_HOST, POSTGRES_PORT, POSTGRES_USER, POSTGRES_PASSWORD).","design":"Database class with async init: connect to postgres DB, check if target DB exists, create if not, then create pool to target DB. Pool size configurable. Connection parameters from env vars with sensible defaults (localhost:5432, postgres/postgres).","acceptance_criteria":"1. Database created on first startup\n2. Existing database reused on subsequent startups\n3. Connection pool returned and usable\n4. Env var configuration works","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:52.085375999+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:33:39.887391927+08:00","closed_at":"2026-02-09T12:33:39.887391927+08:00","close_reason":"Implemented and merged to main","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.4.1","depends_on_id":"butlers-0qp.4","type":"parent-child","created_at":"2026-02-09T12:10:52.088879637+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4.2","title":"Set up Alembic migration infrastructure","description":"Set up Alembic for database migrations. Create alembic/ directory with alembic.ini, env.py (programmatic env that targets the correct butler DB via alembic.command.upgrade), and versions/ directory structure with subdirectories for each version chain (core/, switchboard/, relationship/, health/, general/). The env.py must support being called programmatically from the daemon at startup, targeting the butler's asyncpg database. Migrations use raw SQL via op.execute() — no SQLAlchemy models.","design":"Alembic env.py handles multi-chain setup. Each chain (core, switchboard, relationship, etc.) has its own versions directory. The daemon calls alembic.command.upgrade programmatically at startup, targeting the butler's DB. Alembic's alembic_version table tracks applied revisions. Each revision uses op.execute() with raw SQL. Idempotent: re-running skips already-applied revisions.","acceptance_criteria":"1. _migrations table created automatically\n2. Migrations applied in order\n3. Re-running is idempotent (no errors, no duplicates)\n4. Failed migration rolls back its transaction","notes":"NOTE: Acceptance criteria are stale — should reference Alembic alembic_version table instead of _migrations table. Updated in design.md D12 and spec files.","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:57.935179883+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:43:50.967234102+08:00","closed_at":"2026-02-09T12:43:50.967234102+08:00","close_reason":"Implemented and merged to main in Wave 3","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.4.2","depends_on_id":"butlers-0qp.4","type":"parent-child","created_at":"2026-02-09T12:10:57.936564578+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4.3","title":"Create core Alembic revision","description":"Create the initial Alembic revision in alembic/versions/core/ that defines the core tables shared by all butlers: state (key TEXT PK, value JSONB, updated_at TIMESTAMPTZ), scheduled_tasks (id UUID PK, name, cron, prompt, source, enabled, next_run_at, last_run_at, created_at, updated_at), sessions (id UUID PK, prompt, trigger_source, result, tool_calls JSONB, duration_ms, trace_id, cost JSONB, started_at, completed_at). Uses op.execute() with raw SQL.","acceptance_criteria":"1. All three tables created with correct columns and types\n2. Primary keys and defaults set correctly\n3. Migration is idempotent (uses IF NOT EXISTS or migration runner handles it)","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:00.820323137+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:43:50.982431537+08:00","closed_at":"2026-02-09T12:43:50.982431537+08:00","close_reason":"Implemented and merged to main in Wave 3","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.4.3","depends_on_id":"butlers-0qp.4","type":"parent-child","created_at":"2026-02-09T12:11:00.821973774+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4.4","title":"Write database layer tests","description":"Write tests/test_db.py using testcontainers PostgreSQL. Test: database creation on first connect, Alembic migration application, idempotent re-run of migrations, alembic_version tracking, connection pool usability.","acceptance_criteria":"1. Tests use testcontainers PostgreSQL (real DB, not mocks)\n2. Database creation verified\n3. Migration application verified\n4. Idempotent re-run verified\n5. All tests pass","notes":"NOTE: Acceptance criteria reference _migrations — should read alembic_version. Updated in spec files.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:03.733051237+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:23.739313841+08:00","closed_at":"2026-02-09T12:34:23.739313841+08:00","close_reason":"Already implemented in butlers-0qp.4.1 worker (7 tests in test_db.py with testcontainers)","labels":["database","testing"],"dependencies":[{"issue_id":"butlers-0qp.4.4","depends_on_id":"butlers-0qp.4","type":"parent-child","created_at":"2026-02-09T12:11:03.734914867+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5","title":"Implement credential management","description":"Per-butler credential and environment variable management. Validate ANTHROPIC_API_KEY, [butler.env].required, [butler.env].optional, and module credentials_env at startup. Aggregated error reporting for missing vars. Advisory warning for suspected inline secrets in butler.toml.","acceptance_criteria":"1. All-present credentials pass validation\n2. Missing required vars fail startup with aggregated error listing all missing vars\n3. Missing optional vars log warning but don't block\n4. Secret-in-config detection warns on suspected inline secrets","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:12.554933796+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:00:23.893498693+08:00","closed_at":"2026-02-09T13:00:23.893498693+08:00","close_reason":"All children completed","labels":["backend","security"],"dependencies":[{"issue_id":"butlers-0qp.5","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:12.556293805+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5.1","title":"Implement credential validation at startup","description":"Add credential validation to butler startup. Check for: ANTHROPIC_API_KEY (always required), [butler.env].required env vars, [butler.env].optional env vars (warn if missing), module credentials_env vars. Aggregate all missing vars before failing.","acceptance_criteria":"1. ANTHROPIC_API_KEY checked on every butler\n2. All [butler.env].required vars checked\n3. Missing optional vars produce warnings, not errors\n4. Module credentials_env vars checked\n5. All missing vars reported in a single error message","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:35.006441351+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:43:50.991285552+08:00","closed_at":"2026-02-09T12:43:50.991285552+08:00","close_reason":"Implemented and merged to main in Wave 3","labels":["backend","security"],"dependencies":[{"issue_id":"butlers-0qp.5.1","depends_on_id":"butlers-0qp.5","type":"parent-child","created_at":"2026-02-09T12:10:35.007802271+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5.2","title":"Implement aggregated credential error reporting","description":"When multiple required env vars are missing, collect all of them before failing. Error message must list each missing var and which component needs it (core, butler.env, or module name).","acceptance_criteria":"1. Multiple missing vars reported in one error\n2. Each missing var identifies its source component\n3. Error message is actionable (tells user what to set)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:40.867803524+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:43:51.000224408+08:00","closed_at":"2026-02-09T12:43:51.000224408+08:00","close_reason":"Implemented and merged to main in Wave 3","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.5.2","depends_on_id":"butlers-0qp.5","type":"parent-child","created_at":"2026-02-09T12:10:40.869604846+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5.3","title":"Implement secret-in-config detection","description":"Scan butler.toml string values for patterns that look like inline secrets (API keys, passwords, tokens). Log advisory warnings during startup. Do not block startup — this is informational only.","design":"Heuristic detection: strings matching common secret patterns (sk-, ghp_, xoxb-, base64-like long strings). Advisory only — log.warning with suggestion to use env vars instead.","acceptance_criteria":"1. Suspected secrets in config values produce warnings\n2. Warnings suggest using env vars instead\n3. Does not block startup (advisory only)\n4. No false positives on short/normal config values","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:46.172956217+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.546355425+08:00","closed_at":"2026-02-09T12:58:43.546355425+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend","security"],"dependencies":[{"issue_id":"butlers-0qp.5.3","depends_on_id":"butlers-0qp.5","type":"parent-child","created_at":"2026-02-09T12:10:46.174760304+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5.4","title":"Write credential management tests","description":"Write tests/test_credentials.py covering: all-present (passes), missing required (fails), missing optional (warning), missing module creds (fails), multiple missing (aggregated error), secret-in-config detection.","acceptance_criteria":"1. All 6 scenarios tested\n2. Aggregated error message verified\n3. Warning vs error distinction verified\n4. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:50.738360078+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:44:11.612084114+08:00","closed_at":"2026-02-09T12:44:11.612084114+08:00","close_reason":"Already implemented by Wave 3 workers — tests exist and pass","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.5.4","depends_on_id":"butlers-0qp.5","type":"parent-child","created_at":"2026-02-09T12:10:50.747797002+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.6","title":"Implement state store","description":"Key-value JSONB persistence in each butler's PostgreSQL database. MCP tools: state_get (returns null for missing keys), state_set (upsert), state_delete (no-op for missing), state_list (with optional prefix filter). All values stored as JSONB supporting any JSON type.","acceptance_criteria":"1. state_get returns value for existing key, null for missing\n2. state_set inserts new and updates existing (upsert)\n3. state_delete removes existing, no-op for missing\n4. state_list returns all entries, filters by prefix when provided\n5. JSONB values support strings, numbers, objects, arrays, booleans","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:18.879501505+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:28.993656636+08:00","closed_at":"2026-02-09T12:50:28.993656636+08:00","close_reason":"All children completed and merged","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.6","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:18.881541779+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.6","depends_on_id":"butlers-0qp.4","type":"blocks","created_at":"2026-02-09T12:15:48.621792957+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.6.1","title":"Implement state store MCP tools","description":"Create src/butlers/core/state.py with state store MCP tools: state_get(key) returns JSONB value or null, state_set(key, value) upserts, state_delete(key) removes (no-op if missing), state_list(prefix?) returns matching entries. All backed by the state table (key TEXT PK, value JSONB, updated_at TIMESTAMPTZ).","design":"state_set uses INSERT ON CONFLICT UPDATE (upsert). state_list uses key LIKE prefix% when prefix provided, otherwise returns all. Values stored as JSONB — any valid JSON type accepted.","acceptance_criteria":"1. state_get returns value for existing, null for missing\n2. state_set inserts new keys and updates existing\n3. state_delete removes existing, no-op for missing\n4. state_list returns all or prefix-filtered entries\n5. JSONB supports strings, numbers, objects, arrays, booleans, null","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:56.608975907+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:19.842323386+08:00","closed_at":"2026-02-09T12:50:19.842323386+08:00","close_reason":"Implemented and merged to main in Wave 4","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.6.1","depends_on_id":"butlers-0qp.6","type":"parent-child","created_at":"2026-02-09T12:10:56.610970394+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.6.2","title":"Write state store tests","description":"Write tests/test_core_state.py covering: get existing, get missing (null), set insert, set update, delete existing, delete missing (no-op), list all, list with prefix, JSONB value types (string, number, object, array, boolean, null).","acceptance_criteria":"1. All scenarios tested against real PostgreSQL (testcontainers)\n2. JSONB type round-tripping verified\n3. All tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:02.219263147+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:19.860709426+08:00","closed_at":"2026-02-09T12:50:19.860709426+08:00","close_reason":"Implemented and merged to main in Wave 4","labels":["database","testing"],"dependencies":[{"issue_id":"butlers-0qp.6.2","depends_on_id":"butlers-0qp.6","type":"parent-child","created_at":"2026-02-09T12:11:02.220849583+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.7","title":"Implement session log","description":"Append-only audit log of every CC invocation. Create session on CC spawn (recording prompt, trigger_source, trace_id), update on completion (result, tool_calls, duration_ms, cost). MCP tools: sessions_list (paginated), sessions_get (by id). No delete capability — append-only by design.","acceptance_criteria":"1. Session created on CC spawn with prompt and trigger_source\n2. Session updated on completion with result, tool_calls, duration_ms\n3. sessions_list supports pagination (limit/offset)\n4. sessions_get returns full session by ID\n5. No delete/update-after-close capability","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:25.643942646+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:29.00796533+08:00","closed_at":"2026-02-09T12:50:29.00796533+08:00","close_reason":"All children completed and merged","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.7","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:25.64534759+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.7","depends_on_id":"butlers-0qp.4","type":"blocks","created_at":"2026-02-09T12:15:48.67531344+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.7.1","title":"Implement session log with MCP tools","description":"Create src/butlers/core/sessions.py. Session creation on CC spawn (prompt, trigger_source, trace_id, started_at). Session update on completion (result, tool_calls JSONB, duration_ms, cost JSONB, completed_at). MCP tools: sessions_list(limit, offset) paginated, sessions_get(id). Append-only — no delete or update-after-close.","design":"Sessions table: id UUID PK, prompt TEXT, trigger_source TEXT, result TEXT, tool_calls JSONB, duration_ms INT, trace_id TEXT, cost JSONB, started_at TIMESTAMPTZ, completed_at TIMESTAMPTZ. trigger_source values: schedule, trigger_tool, tick, heartbeat.","acceptance_criteria":"1. Session created with prompt and trigger_source\n2. Session updated on completion with result, tool_calls, duration_ms\n3. sessions_list supports limit/offset pagination\n4. sessions_get returns full session by ID\n5. No delete capability exists","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:07.94358731+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:19.872403242+08:00","closed_at":"2026-02-09T12:50:19.872403242+08:00","close_reason":"Implemented and merged to main in Wave 4","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.7.1","depends_on_id":"butlers-0qp.7","type":"parent-child","created_at":"2026-02-09T12:11:07.946172593+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.7.2","title":"Write session log tests","description":"Write tests/test_core_sessions.py covering: create session, complete success, complete failure, duration_ms computation, trigger_source values, list pagination, get by id, append-only verification (no delete/update-after-close).","acceptance_criteria":"1. All scenarios tested\n2. duration_ms correctly computed\n3. Pagination verified (limit/offset)\n4. Append-only constraint verified\n5. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:13.141296192+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:19.883940212+08:00","closed_at":"2026-02-09T12:50:19.883940212+08:00","close_reason":"Implemented and merged to main in Wave 4","labels":["database","testing"],"dependencies":[{"issue_id":"butlers-0qp.7.2","depends_on_id":"butlers-0qp.7","type":"parent-child","created_at":"2026-02-09T12:11:13.142716805+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8","title":"Implement CC spawner","description":"Ephemeral Claude Code instance management via the CC SDK. Generates locked-down MCP config files in temp directories (single butler endpoint only). Spawns CC with system prompt from CLAUDE.md, credential passthrough (only declared env vars), serial dispatch via asyncio lock, and session logging integration.","acceptance_criteria":"1. MCP config contains only the owning butler's endpoint\n2. Each invocation gets a unique temp directory, cleaned up after\n3. CLAUDE.md content passed as system_prompt\n4. Only declared env vars passed through to CC\n5. Serial dispatch prevents concurrent CC instances\n6. Session created/updated for each spawn","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:30.131696619+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:00:23.861384827+08:00","closed_at":"2026-02-09T13:00:23.861384827+08:00","close_reason":"All children completed","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:30.133021141+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.8","depends_on_id":"butlers-0qp.7","type":"blocks","created_at":"2026-02-09T12:15:48.786351896+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.1","title":"Implement ephemeral MCP config generation","description":"Create src/butlers/core/spawner.py with CCSpawner class. Generate locked-down MCP config in /tmp/butler_{name}_{uuid}/mcp.json containing only the owning butler's SSE endpoint. Each invocation gets a unique temp directory.","design":"Config JSON: {mcpServers: {butler_name: {url: 'http://localhost:PORT/sse'}}}. Temp dir: /tmp/butler_{name}_{uuid}/. Cleanup after CC session completes (success or failure).","acceptance_criteria":"1. Config contains exactly one MCP server entry\n2. Entry points to owning butler's SSE endpoint\n3. Each invocation creates unique temp dir\n4. Temp dir cleaned up after session","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:21.233806391+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.45886699+08:00","closed_at":"2026-02-09T12:58:43.45886699+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.1","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:21.235278181+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.2","title":"Implement CC SDK invocation and SpawnerResult","description":"Implement claude_code_sdk.query call with generated MCP config, system prompt, and working directory. Define SpawnerResult dataclass (result, tool_calls, error, duration_ms). Handle SDK errors gracefully.","acceptance_criteria":"1. CC SDK called with correct mcp_config path\n2. System prompt and cwd set correctly\n3. SpawnerResult captures success and failure cases\n4. SDK errors wrapped in SpawnerResult.error","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:26.08076857+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.472285833+08:00","closed_at":"2026-02-09T12:58:43.472285833+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.2","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:26.082136924+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.3","title":"Implement credential passthrough for CC instances","description":"Build explicit env dict for CC invocation containing only declared vars: ANTHROPIC_API_KEY + [butler.env] required/optional + module credentials_env. No other env vars leak to CC instance.","acceptance_criteria":"1. ANTHROPIC_API_KEY always included\n2. butler.env vars included\n3. Module credential vars included\n4. Undeclared env vars not passed through","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:30.941778301+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.480098114+08:00","closed_at":"2026-02-09T12:58:43.480098114+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend","security"],"dependencies":[{"issue_id":"butlers-0qp.8.3","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:30.943315224+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.4","title":"Implement CLAUDE.md system prompt reading","description":"Read CLAUDE.md from butler's config directory and pass contents as system_prompt to CC SDK query. If CLAUDE.md is missing or empty, use a default system prompt identifying the butler.","acceptance_criteria":"1. CLAUDE.md content passed as system_prompt\n2. Missing CLAUDE.md uses default prompt\n3. Empty CLAUDE.md uses default prompt\n4. Default prompt includes butler name","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:11:39.068096666+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.488577828+08:00","closed_at":"2026-02-09T12:58:43.488577828+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.4","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:39.071330855+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.5","title":"Implement serial CC dispatch with asyncio lock","description":"Add asyncio.Lock to CCSpawner ensuring only one CC instance runs at a time per butler. Subsequent trigger() calls wait for the lock. This is a v1 simplification — concurrent dispatch is a future enhancement.","acceptance_criteria":"1. Only one CC instance active per butler at a time\n2. Concurrent triggers queue and execute serially\n3. Lock released on both success and failure","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:46.784689414+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.496725433+08:00","closed_at":"2026-02-09T12:58:43.496725433+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.5","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:46.786273295+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.6","title":"Wire CC spawner session logging","description":"Create session record when CC spawn begins (prompt, trigger_source). Update session on completion with result, tool_calls, duration_ms, cost. Handle both success and failure paths.","acceptance_criteria":"1. Session created before CC invocation\n2. Session updated on success with result and tool_calls\n3. Session updated on failure with error\n4. duration_ms recorded accurately","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:52.137727183+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.50488951+08:00","closed_at":"2026-02-09T12:58:43.50488951+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.6","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:52.139374895+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.7","title":"Write CC spawner tests","description":"Write tests/test_core_spawner.py covering: MCP config generation (correct JSON, single endpoint), temp dir cleanup, serial dispatch (lock prevents concurrent), MockSpawner assertions, env passthrough (only declared vars), CLAUDE.md handling (present, missing, empty).","acceptance_criteria":"1. All scenarios tested\n2. MockSpawner used (no real CC invocation)\n3. Config JSON structure verified\n4. Serial dispatch verified via concurrent task simulation\n5. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:58.45663044+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.513181949+08:00","closed_at":"2026-02-09T12:58:43.513181949+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.8.7","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:58.458082864+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.9","title":"Implement butler skills infrastructure","description":"Skill directory structure and CC discovery. CLAUDE.md personality/instructions read by CC spawner as system_prompt. AGENTS.md runtime notes readable/writable by CC instances. skills/\u003cname\u003e/SKILL.md + optional scripts accessible via CC cwd set to butler config dir.","acceptance_criteria":"1. CLAUDE.md content passed as system_prompt to CC\n2. Missing CLAUDE.md falls back to default prompt\n3. AGENTS.md readable and writable by CC instances\n4. skills/ directory accessible when CC cwd set to butler config dir","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:37.321931865+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:00:23.875512708+08:00","closed_at":"2026-02-09T13:00:23.875512708+08:00","close_reason":"All children completed","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.9","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:37.323291724+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.9.1","title":"Implement CLAUDE.md and skills directory for CC spawner","description":"Ensure CC spawner reads CLAUDE.md from butler config dir as system_prompt. Set CC cwd to butler config dir so skills/ directory is accessible. CLAUDE.md defines butler personality and instructions. Missing CLAUDE.md uses default fallback.","acceptance_criteria":"1. CLAUDE.md read as system_prompt\n2. Missing CLAUDE.md uses default\n3. CC cwd set to butler config dir\n4. skills/ directory accessible from CC","notes":"This may overlap with the CC spawner CLAUDE.md reading task — coordinate to avoid duplication. The key addition here is the cwd setting for skills access.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:41.020113716+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.521484088+08:00","closed_at":"2026-02-09T12:58:43.521484088+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.9.1","depends_on_id":"butlers-0qp.9","type":"parent-child","created_at":"2026-02-09T12:12:41.021617887+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.9.2","title":"Implement AGENTS.md read/write access","description":"Ensure AGENTS.md in butler config dir is readable and writable by CC instances. CC can append runtime notes during sessions. File created if it doesn't exist on first write.","acceptance_criteria":"1. AGENTS.md readable by CC instances\n2. AGENTS.md writable by CC instances\n3. File created on first write if missing\n4. Content persists across sessions","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:12:46.914816969+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.529453286+08:00","closed_at":"2026-02-09T12:58:43.529453286+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.9.2","depends_on_id":"butlers-0qp.9","type":"parent-child","created_at":"2026-02-09T12:12:46.91687713+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.9.3","title":"Write butler skills tests","description":"Write tests/test_skills.py covering: CLAUDE.md as system prompt, missing CLAUDE.md fallback, AGENTS.md read/write, skill directory structure validation (skills/\u003cname\u003e/SKILL.md exists and is accessible).","acceptance_criteria":"1. All scenarios tested\n2. File system interactions verified\n3. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:52.252884492+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.537772135+08:00","closed_at":"2026-02-09T12:58:43.537772135+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.9.3","depends_on_id":"butlers-0qp.9","type":"parent-child","created_at":"2026-02-09T12:12:52.254444018+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-2jx","title":"Add per-butler mailbox module for async message delivery","description":"Each butler gets a mailbox table for async messages from other butlers, users, or external channels. Messages are fire-and-forget: sender posts mail, recipient butler reads/actions at its own pace. Decouples inter-butler and user-to-butler communication from real-time wakeups.\n\nMailbox lives in each butlers own DB (per strict DB isolation constraint). Switchboard exposes a post_mail tool routing mail to the target butler via MCP. Each message records sender identity and the posting mechanism (e.g. alice/telegram, relationship-butler/mcp, system/scheduler).\n\nNon-goals: real-time push notifications (use Telegram/Email), message threading (v2), attachments (v2).","design":"Table: mailbox — id UUID PK, sender TEXT NOT NULL (identity), sender_channel TEXT NOT NULL (posting mechanism: mcp/telegram/email/api/scheduler), subject TEXT, body JSONB NOT NULL, priority INTEGER DEFAULT 2, status TEXT DEFAULT unread (unread/read/actioned/archived), metadata JSONB DEFAULT {}, created_at TIMESTAMPTZ, read_at TIMESTAMPTZ, actioned_at TIMESTAMPTZ. Indexes on (status, created_at) and (sender).\n\nMCP Tools (MailboxModule): mailbox_list, mailbox_read, mailbox_update_status, mailbox_post, mailbox_stats. Switchboard Tool: post_mail routes to target butlers mailbox_post.","acceptance_criteria":"1. Every butler with mailbox module has an isolated mailbox table\n2. Messages postable by other butlers via Switchboard, users via channel modules, and butler itself\n3. Sender identity includes both who (name) and how (channel)\n4. Butler can list, read, triage, and archive messages via MCP tools\n5. Alembic migration in dedicated mailbox chain\n6. Module follows Module ABC pattern","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T20:53:38.224376938+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:09:51.666598122+08:00","closed_at":"2026-02-10T01:09:51.666598122+08:00","close_reason":"All children completed","labels":["backend","core","module"]}
{"id":"butlers-2jx.1","title":"Create mailbox Alembic migration chain and table schema","description":"Create a new Alembic migration chain 'mailbox' under alembic/versions/mailbox/ with the mailbox table DDL. Follow the pattern established by core/001_create_core_tables.py and switchboard/001_switchboard_tables.py.\n\nTable: mailbox\n- id UUID PK DEFAULT gen_random_uuid()\n- sender TEXT NOT NULL — who sent it (butler name, user handle, or system identifier)\n- sender_channel TEXT NOT NULL — how it was sent (mcp, telegram, email, api, scheduler)\n- subject TEXT — optional subject/topic line\n- body JSONB NOT NULL — message payload\n- priority INTEGER NOT NULL DEFAULT 2 — 0=critical to 4=backlog\n- status TEXT NOT NULL DEFAULT 'unread' — unread | read | actioned | archived\n- metadata JSONB NOT NULL DEFAULT '{}'::jsonb — extensible envelope (trace_id, correlation_id, reply_to, etc.)\n- created_at TIMESTAMPTZ NOT NULL DEFAULT now()\n- read_at TIMESTAMPTZ — timestamp when first read\n- actioned_at TIMESTAMPTZ — timestamp when actioned\n\nIndexes:\n- CREATE INDEX idx_mailbox_status_created ON mailbox (status, created_at DESC) — inbox queries\n- CREATE INDEX idx_mailbox_sender ON mailbox (sender) — sender filtering","acceptance_criteria":"1. Migration file exists at alembic/versions/mailbox/001_create_mailbox_table.py\n2. Branch label is 'mailbox'\n3. Table and indexes created on upgrade, dropped on downgrade\n4. Migration runs cleanly against a fresh database","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:53:48.325997915+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:01:40.584401543+08:00","closed_at":"2026-02-10T00:01:40.584401543+08:00","close_reason":"Mailbox migration chain created with table schema matching spec","labels":["backend","migrations","module"],"dependencies":[{"issue_id":"butlers-2jx.1","depends_on_id":"butlers-2jx","type":"parent-child","created_at":"2026-02-09T20:53:48.327672311+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-2jx.2","title":"Implement MailboxModule with MCP tools","description":"Create src/butlers/modules/mailbox.py implementing the Module ABC. This module adds five MCP tools for managing a butlers local mailbox.\n\nTools to implement:\n1. mailbox_post(sender, sender_channel, subject?, body, priority?, metadata?) — insert a new message into the mailbox table. Returns the new message ID. This is the write entry point used by both the butler itself and the Switchboard routing.\n\n2. mailbox_list(status?, sender?, limit=50, offset=0) — query the mailbox with optional filters. Returns list of messages ordered by created_at DESC. Include id, sender, sender_channel, subject, status, priority, created_at in the list view (omit full body for efficiency).\n\n3. mailbox_read(message_id) — fetch a single message by ID including full body and metadata. Auto-updates status from 'unread' to 'read' and sets read_at if not already read.\n\n4. mailbox_update_status(message_id, status) — change message status to read/actioned/archived. Sets the corresponding timestamp (read_at or actioned_at). Validates status is one of the allowed values.\n\n5. mailbox_stats() — return counts grouped by status: {unread: N, read: N, actioned: N, archived: N, total: N}.\n\nModule properties:\n- name: 'mailbox'\n- config_schema: MailboxConfig (Pydantic BaseModel, initially empty or with optional max_retention_days)\n- dependencies: [] (no module dependencies)\n- migration_revisions: 'mailbox'\n- on_startup/on_shutdown: no-op for now","design":"Follow the pattern from email.py and telegram.py. All tools use asyncpg pool directly. Use parameterized queries throughout. The mailbox_post tool should validate sender_channel against a known set (mcp, telegram, email, api, scheduler, system) but accept unknown channels with a warning log rather than rejecting — extensibility over strictness.","acceptance_criteria":"1. Module class MailboxModule passes isinstance check against Module ABC\n2. All five tools registered and callable via FastMCP\n3. mailbox_post inserts and returns UUID\n4. mailbox_read auto-marks unread messages as read\n5. mailbox_list supports filtering by status and sender\n6. mailbox_stats returns accurate counts\n7. All queries use parameterized SQL (no f-string injection)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:54:03.391590609+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:11:34.620937684+08:00","closed_at":"2026-02-10T00:11:34.620937684+08:00","close_reason":"MailboxModule implemented with all 5 MCP tools, parameterized queries, and comprehensive tests","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-2jx.2","depends_on_id":"butlers-2jx","type":"parent-child","created_at":"2026-02-09T20:54:03.393152352+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-2jx.2","depends_on_id":"butlers-2jx.1","type":"blocks","created_at":"2026-02-09T20:54:32.061622825+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-2jx.3","title":"Add post_mail tool to Switchboard for cross-butler mail delivery","description":"Add a post_mail tool to the Switchboard butler that enables any butler (or external caller) to deliver a message to another butlers mailbox. This tool composes the sender identity with the delivery channel and routes through the existing Switchboard route() mechanism.\n\nTool signature:\n  post_mail(target_butler, sender, sender_channel, subject?, body, priority?, metadata?)\n\nBehavior:\n1. Validate target_butler exists in butler_registry\n2. Validate target butler has the mailbox module (check modules JSONB in registry)\n3. Route to the target butlers mailbox_post tool via the existing route() function\n4. Return success with message_id or error with reason\n5. Log the routing in routing_log (already handled by route())\n\nThe sender and sender_channel fields allow documenting the original source. For example:\n- Butler-to-butler: sender='relationship', sender_channel='mcp'\n- User via Telegram: sender='alice', sender_channel='telegram'\n- System scheduled: sender='system', sender_channel='scheduler'\n- External API: sender='webhook/stripe', sender_channel='api'\n\nRegister this tool in the Switchboard butlers tool registration (alongside register_butler, list_butlers, discover_butlers, route, classify_message).","design":"Add post_mail as an async function in src/butlers/tools/switchboard.py. It wraps route() with target tool_name='mailbox_post'. Before routing, check the target butlers modules list in butler_registry to confirm mailbox is enabled — return a clear error if not. Include the original sender identity in the routed args unchanged.","acceptance_criteria":"1. post_mail tool callable via Switchboard MCP\n2. Validates target butler exists and has mailbox module\n3. Returns message_id on success\n4. Returns descriptive error if butler not found or mailbox not enabled\n5. Routing logged in routing_log table\n6. Sender identity preserved end-to-end","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:54:16.971272963+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:17:29.928471074+08:00","closed_at":"2026-02-10T00:17:29.928471074+08:00","close_reason":"post_mail tool added to Switchboard with registry validation, mailbox module check, and routing","labels":["backend","switchboard"],"dependencies":[{"issue_id":"butlers-2jx.3","depends_on_id":"butlers-2jx","type":"parent-child","created_at":"2026-02-09T20:54:16.972752129+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-2jx.3","depends_on_id":"butlers-2jx.2","type":"blocks","created_at":"2026-02-09T20:54:32.127876828+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-2jx.4","title":"Write mailbox module and post_mail integration tests","description":"Comprehensive test coverage for the mailbox module and Switchboard post_mail tool. Follow existing test patterns (testcontainers for PostgreSQL, MockSpawner, direct SQL for setup).\n\nTest cases for MailboxModule:\n1. mailbox_post — insert message, verify all fields stored correctly\n2. mailbox_post — default values (priority=2, status=unread, metadata={})\n3. mailbox_list — returns messages ordered by created_at DESC\n4. mailbox_list — filter by status\n5. mailbox_list — filter by sender\n6. mailbox_list — pagination (limit/offset)\n7. mailbox_list — empty mailbox returns []\n8. mailbox_read — returns full message body and metadata\n9. mailbox_read — auto-marks unread as read, sets read_at\n10. mailbox_read — already-read message stays read (idempotent)\n11. mailbox_read — nonexistent message_id returns error\n12. mailbox_update_status — transitions unread-\u003eread, read-\u003eactioned, actioned-\u003earchived\n13. mailbox_update_status — sets read_at and actioned_at timestamps appropriately\n14. mailbox_update_status — rejects invalid status values\n15. mailbox_stats — accurate counts across all statuses\n\nTest cases for Switchboard post_mail:\n16. post_mail — routes to target butler and returns message_id\n17. post_mail — error when target butler not in registry\n18. post_mail — error when target butler lacks mailbox module\n19. post_mail — sender identity preserved in delivered message","acceptance_criteria":"1. All 19 test cases pass\n2. Tests use real PostgreSQL via testcontainers\n3. No mocking of database layer\n4. Tests run in \u003c10s total","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:54:27.919744817+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:32:31.646883394+08:00","closed_at":"2026-02-10T00:32:31.646883394+08:00","close_reason":"19 integration tests passing for mailbox module and post_mail tool","labels":["backend","module","testing"],"dependencies":[{"issue_id":"butlers-2jx.4","depends_on_id":"butlers-2jx","type":"parent-child","created_at":"2026-02-09T20:54:27.922681198+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-2jx.4","depends_on_id":"butlers-2jx.2","type":"blocks","created_at":"2026-02-09T20:54:32.209746791+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-2jx.4","depends_on_id":"butlers-2jx.3","type":"blocks","created_at":"2026-02-09T20:54:32.287964871+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-30g","title":"Refactor butler tools.py into tools/{category}/{tool}.py with unified imports","description":"Refactor each butler's monolithic tools.py into a structured tools/ directory:\n\n**Current:** butlers/{butler}/tools.py (single file, grows to 1000+ lines)\n\n**Target:**\n```\nbutlers/{butler}/tools/\n├── __init__.py          # Re-exports all tools for unified import\n├── {category}/\n│   ├── __init__.py      # Re-exports category tools\n│   └── {tool_name}.py   # Individual tool implementation\n└── ...\n```\n\n**Requirements:**\n- Each tool function moves to its own file under a logical category subdirectory\n- Category __init__.py re-exports its tools\n- Top-level tools/__init__.py collects all categories so existing imports (from butler.tools import ...) continue to work unchanged\n- No behavioral changes — pure structural refactor\n- Update any imports in tests or other modules that reference the old tools.py path","notes":"The _loader.py in src/butlers/tools/ dynamically imports butler tools at runtime. It currently expects a single tools.py — needs updating to load the tools/ package (__init__.py) instead. The butler config dirs intentionally live at repo root, separate from the src/butlers/ Python package.","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:11:52.169111792+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:14:26.942416087+08:00","dependencies":[{"issue_id":"butlers-30g","depends_on_id":"butlers-4or","type":"blocks","created_at":"2026-02-10T11:25:12.867898218+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-47n","title":"Update project documentation with architecture diagram and README improvements","description":"The README is minimal and missing key operational information. Three improvements needed:\n\n1. Add a visual architecture diagram showing the full system topology (butlers, DB isolation, MCP routing, CC spawner lifecycle, modules)\n2. Document production and development entrypoints (CLI commands, Docker Compose modes, Dockerfile entrypoint)\n3. Document all environment variables — global (PostgreSQL, OTEL, Anthropic) vs butler-specific (module credentials declared in butler.toml)\n\nThese make the project approachable for new contributors and operationally self-documenting.","acceptance_criteria":"1. README contains a detailed ASCII or Mermaid architecture diagram covering: daemon lifecycle, module system, MCP routing, DB isolation, CC spawner flow\n2. README has clearly separated Development and Production quickstart sections with exact commands\n3. README has an Environment Variables section with a table distinguishing global vs per-butler/per-module variables\n4. All information is accurate to the current codebase","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T20:38:17.276607568+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T20:44:41.323636302+08:00","closed_at":"2026-02-09T20:44:41.323636302+08:00","close_reason":"Closed","labels":["docs"]}
{"id":"butlers-47n.1","title":"Add architecture diagram to README","description":"The current README has a basic 6-line ASCII sketch of the switchboard routing. Replace it with a comprehensive architecture diagram that covers:\n\n- Full system topology: Switchboard routing to domain butlers (general, relationship, health, heartbeat)\n- Butler internals: daemon lifecycle (12-step startup), core components (state store, scheduler, session log, CC spawner)\n- Module system: how modules plug in, register tools, run migrations, topological dependency sort\n- Database isolation: each butler owns a dedicated PostgreSQL database\n- CC spawner flow: trigger → lock → session create → MCP config gen → SDK invoke → session complete\n- Telemetry: OpenTelemetry spans propagated via traceparent to CC instances\n- Trigger sources: external MCP, scheduler, heartbeat tick\n\nUse Mermaid for renderability on GitHub. Keep the existing ASCII sketch as a simplified overview above the detailed diagram.","design":"Two diagrams:\n1. Keep existing ASCII as 'System Overview' (simplified topology)\n2. Add Mermaid diagram as 'Detailed Architecture' covering internals\n\nUse ```mermaid code blocks which GitHub renders natively.","acceptance_criteria":"1. Diagram renders correctly on GitHub\n2. Covers all 7 areas listed in description\n3. Accurate to current codebase (not aspirational)\n4. Readable at default GitHub width without horizontal scrolling","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:38:48.751511999+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T20:44:41.293791101+08:00","closed_at":"2026-02-09T20:44:41.293791101+08:00","close_reason":"Closed","labels":["docs"],"dependencies":[{"issue_id":"butlers-47n.1","depends_on_id":"butlers-47n","type":"parent-child","created_at":"2026-02-09T20:38:48.753288622+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-47n.2","title":"Add production and development entrypoint docs to README","description":"The README has a Development section with only lint/test commands. Missing:\n\n- How to actually start butlers in dev mode (docker compose up postgres jaeger + butlers up)\n- How to start in production mode (docker compose up -d with all services)\n- CLI entrypoint: `butlers` command with subcommands (up, run, list, init)\n- Docker entrypoint: `uv run butlers run --config /app/butler.toml`\n- Port assignments: switchboard 8100, general 8101, relationship 8102, health 8103, heartbeat 8199, Jaeger UI 16686\n- Dockerfile build context: Python 3.12-slim + Node.js 22 + claude-code CLI + uv\n\nSource of truth:\n- CLI: src/butlers/cli.py (Click commands: up, run, list, init)\n- Docker: Dockerfile + docker-compose.yml\n- pyproject.toml: `[project.scripts] butlers = 'butlers.cli:cli'`","acceptance_criteria":"1. README has a 'Getting Started' section with Development and Production subsections\n2. Development section shows: install deps, start infra, start butlers, access Jaeger\n3. Production section shows: env setup, docker compose, service ports\n4. CLI commands documented: butlers up, butlers run, butlers list, butlers init\n5. All commands are copy-pasteable and accurate","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:38:48.80404266+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T20:44:41.303276815+08:00","closed_at":"2026-02-09T20:44:41.303276815+08:00","close_reason":"Closed","labels":["docs"],"dependencies":[{"issue_id":"butlers-47n.2","depends_on_id":"butlers-47n","type":"parent-child","created_at":"2026-02-09T20:38:48.805468812+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-47n.3","title":"Add environment variables reference to README","description":"Developers need to know which env vars to set. The codebase has three tiers:\n\n**Global (all butlers):**\n- ANTHROPIC_API_KEY — required, checked by credentials.py for every butler\n- POSTGRES_HOST — default 'localhost', read by Database.from_env()\n- POSTGRES_PORT — default 5432, read by Database.from_env()\n- POSTGRES_USER — default 'postgres', read by Database.from_env()\n- POSTGRES_PASSWORD — default 'postgres', read by Database.from_env()\n- OTEL_EXPORTER_OTLP_ENDPOINT — optional, enables real tracing (otherwise no-op tracer)\n\n**Per-butler (declared in butler.toml):**\n- [butler.env].required — custom required vars per butler\n- [butler.env].optional — custom optional vars per butler (warns if missing)\n\n**Per-module (declared in module code):**\n- Email module: EMAIL_ADDRESS, EMAIL_PASSWORD (credentials_env in email.py)\n- Telegram module: TELEGRAM_BOT_TOKEN (credentials_env in telegram.py)\n- Future modules declare their own via the credentials_env property on Module ABC\n\nSource of truth: src/butlers/credentials.py, src/butlers/db.py, src/butlers/core/telemetry.py, module files","design":"Add an 'Environment Variables' section to README with a table per tier:\n1. Global Variables (always apply)\n2. Butler-Specific Variables (configured in butler.toml)\n3. Module Variables (per enabled module)\n\nInclude: variable name, required/optional, default value, description.","acceptance_criteria":"1. All 6 global env vars documented with defaults and descriptions\n2. Butler-specific env var mechanism explained with butler.toml example\n3. All current module env vars listed (email: 2, telegram: 1)\n4. Clear distinction between tiers\n5. Table format for scanability","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T20:38:48.854993+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T20:44:41.312659334+08:00","closed_at":"2026-02-09T20:44:41.312659334+08:00","close_reason":"Closed","labels":["docs"],"dependencies":[{"issue_id":"butlers-47n.3","depends_on_id":"butlers-47n","type":"parent-child","created_at":"2026-02-09T20:38:48.856449749+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-4or","title":"Rename butlers/ config directory to roster/","description":"Rename the top-level butlers/ directory (butler config dirs) to roster/ to avoid confusion with the repo name and src/butlers/ Python package.\n\n**Current:** butlers/{name}/ (MANIFESTO.md, CLAUDE.md, butler.toml, skills/, tools.py)\n**Target:** roster/{name}/\n\n**Update all references:**\n- src/butlers/tools/_loader.py (auto-detect path, BUTLER_NAMES)\n- CLAUDE.md code layout section\n- AGENTS.md if referenced\n- Any tests that reference the butlers/ config path\n- .gitignore or CI configs if applicable\n\nThis must land before butlers-30g (tools.py refactor) since that changes the tools path inside config dirs.","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:25:09.789999965+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:25:09.789999965+08:00"}
{"id":"butlers-bjr","title":"Scope and create initial skills for each butler","description":"Each butler under butlers/ should have at least one skill in its skills/ directory following the SKILL.md spec. Skills provide specialized workflows, scripts, and reference material that Claude Code instances use when spawned for that butler.\n\nCurrent state: Skills infrastructure is implemented (butlers-0qp.9 closed) but no butler-specific skills exist yet.\n\nButlers to cover:\n- Switchboard (message routing)\n- General (freeform data)\n- Relationship (personal CRM)\n- Health (wellness tracking)\n- Heartbeat (system monitor)\n\nEach skill must follow the SKILL.md format with YAML frontmatter, progressive disclosure, and optional bundled resources.","acceptance_criteria":"1. Every butler under butlers/ has at least one skill in butlers/{identity}/skills/\n2. Each skill has a valid SKILL.md with YAML frontmatter\n3. Skills are domain-appropriate and actionable\n4. Skills follow progressive disclosure pattern","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T20:57:39.849305586+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:21:08.189053937+08:00","closed_at":"2026-02-10T01:21:08.189053937+08:00","close_reason":"All 7 children completed: triage, data-organizer, reconnect, gift-brainstorm, health-check-in, trend-interpreter, tick-diagnostics","labels":["skills"]}
{"id":"butlers-bjr.1","title":"Create message-triage skill for Switchboard butler","description":"Create a skill at butlers/switchboard/skills/message-triage/ that helps the Switchboard butler classify and route incoming messages with structured confidence scoring.\n\nThe Switchboard's core job is classifying messages and routing them to the correct specialist butler. This skill should provide:\n- Classification rubric with routing rules\n- Confidence scoring framework (high/medium/low → route, ask for clarification, or default)\n- Handling for ambiguous messages that span multiple domains\n- Reference table mapping message topics to target butlers","acceptance_criteria":"1. butlers/switchboard/skills/message-triage/SKILL.md exists with valid YAML frontmatter\n2. Skill covers routing logic for all known butlers (general, relationship, health)\n3. Includes confidence scoring guidance\n4. Handles ambiguous/multi-domain messages","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:57:48.101579007+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:03:03.691599495+08:00","closed_at":"2026-02-10T00:03:03.691599495+08:00","close_reason":"Message-triage skill created with classification rubric, confidence scoring, and multi-domain handling","labels":["skills","switchboard"],"dependencies":[{"issue_id":"butlers-bjr.1","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:57:48.103171567+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-bjr.2","title":"Create data-organizer skill for General butler","description":"Create a skill at butlers/general/skills/data-organizer/ that provides structured patterns for organizing collections and entities in the General butler's freeform data store.\n\nThe General butler stores arbitrary JSONB entities in named collections. This skill should provide:\n- Collection naming conventions and taxonomy suggestions\n- Entity schema templates for common use cases (projects, bookmarks, notes, lists)\n- JSONB query patterns for effective searching\n- Data hygiene workflows (dedup, merge, archive stale entities)","acceptance_criteria":"1. butlers/general/skills/data-organizer/SKILL.md exists with valid YAML frontmatter\n2. Includes at least 3 entity schema templates\n3. Covers collection naming conventions\n4. Provides search query patterns","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:57:52.11050004+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:03:55.56128591+08:00","closed_at":"2026-02-10T00:03:55.56128591+08:00","close_reason":"Data-organizer skill created with naming conventions, 6 entity templates (project, bookmark, note, list, recipe, contact), JSONB query patterns, and 5 hygiene workflows (dedup, archive, tag normalization, schema validation, bulk tagging)","labels":["general","skills"],"dependencies":[{"issue_id":"butlers-bjr.2","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:57:52.112390733+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-bjr.3","title":"Create reconnect-planner skill for Relationship butler","description":"Create a skill at butlers/relationship/skills/reconnect-planner/ that helps the Relationship butler proactively identify contacts who haven't been reached out to in a while and plan reconnection outreach.\n\nThe Relationship butler tracks contacts, interactions, and reminders. This skill should provide:\n- Staleness detection logic (configurable thresholds per relationship tier)\n- Outreach suggestion templates based on contact context (shared interests, last interaction topic, upcoming dates)\n- Prioritization framework (close friends vs acquaintances vs professional contacts)\n- Workflow for creating reminders from reconnect recommendations","acceptance_criteria":"1. butlers/relationship/skills/reconnect-planner/SKILL.md exists with valid YAML frontmatter\n2. Defines staleness thresholds per relationship tier\n3. Includes outreach suggestion patterns\n4. Integrates with existing reminder and interaction tools","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:57:57.021493906+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:09:24.690940579+08:00","closed_at":"2026-02-10T00:09:24.690940579+08:00","close_reason":"Reconnect-planner skill created with staleness thresholds, outreach templates, and reminder integration","labels":["relationship","skills"],"dependencies":[{"issue_id":"butlers-bjr.3","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:57:57.023093789+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-bjr.4","title":"Create gift-brainstorm skill for Relationship butler","description":"Create a skill at butlers/relationship/skills/gift-brainstorm/ that helps the Relationship butler generate thoughtful gift ideas based on contact facts, preferences, and upcoming dates.\n\nThe Relationship butler tracks facts, notes, and gift pipelines (idea → purchased → wrapped → given → thanked). This skill should provide:\n- Gift ideation framework using contact facts and past interactions\n- Budget-aware suggestion tiers\n- Occasion-appropriate filtering (birthday, holiday, thank-you, just-because)\n- Integration with the gift pipeline tools to track chosen gifts","acceptance_criteria":"1. butlers/relationship/skills/gift-brainstorm/SKILL.md exists with valid YAML frontmatter\n2. Uses contact facts and notes as input signals\n3. Covers multiple occasion types\n4. Integrates with gift pipeline (idea → purchased → given)","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T20:58:00.865387212+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:07:33.481717209+08:00","closed_at":"2026-02-10T01:07:33.481717209+08:00","close_reason":"Gift-brainstorm skill created with ideation framework, budget tiers, and pipeline integration","labels":["relationship","skills"],"dependencies":[{"issue_id":"butlers-bjr.4","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:58:00.86719596+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-bjr.5","title":"Create health-check-in skill for Health butler","description":"Create a skill at butlers/health/skills/health-check-in/ that provides a guided daily or weekly health check-in workflow for the Health butler.\n\nThe Health butler tracks measurements, medications, symptoms, meals, and conditions. This skill should provide:\n- Structured check-in flow (what to ask, in what order)\n- Adaptive questioning based on active conditions and medications\n- Medication adherence prompts (did you take X today?)\n- Symptom screening based on active conditions\n- Summary generation after check-in completion","acceptance_criteria":"1. butlers/health/skills/health-check-in/SKILL.md exists with valid YAML frontmatter\n2. Defines a structured check-in flow\n3. Adapts to active conditions and medications\n4. Produces a summary at the end of each check-in","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:58:04.995728878+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:09:07.961003687+08:00","closed_at":"2026-02-10T00:09:07.961003687+08:00","close_reason":"Health-check-in skill created with structured flow, adaptive questioning, and summary generation","labels":["health","skills"],"dependencies":[{"issue_id":"butlers-bjr.5","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:58:04.997816343+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-bjr.6","title":"Create trend-interpreter skill for Health butler","description":"Create a skill at butlers/health/skills/trend-interpreter/ that helps the Health butler interpret measurement trends and flag potential anomalies.\n\nThe Health butler has trend_report and measurement_history tools. This skill should provide:\n- Statistical interpretation guidelines for common measurements (BP, weight, blood glucose, heart rate)\n- Anomaly detection heuristics (sudden changes, out-of-range values)\n- Trend narrative templates (improving, stable, concerning, needs attention)\n- Reference ranges for common measurements\n- Clear disclaimers about not providing medical advice","acceptance_criteria":"1. butlers/health/skills/trend-interpreter/SKILL.md exists with valid YAML frontmatter\n2. Covers interpretation for at least 4 common measurements\n3. Includes anomaly detection heuristics\n4. Contains medical disclaimer","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T20:58:09.642520884+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:16:17.417150852+08:00","closed_at":"2026-02-10T01:16:17.417150852+08:00","close_reason":"Created comprehensive trend-interpreter skill at butlers/health/skills/trend-interpreter/SKILL.md with valid YAML frontmatter. Covers interpretation for 4 common measurements (BP, weight, glucose, heart rate) with reference ranges, anomaly detection heuristics, trend narratives, and medical disclaimers. Includes workflow, examples, and priority-based recommendations.","labels":["health","skills"],"dependencies":[{"issue_id":"butlers-bjr.6","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:58:09.644230265+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-bjr.7","title":"Create tick-diagnostics skill for Heartbeat butler","description":"Create a skill at butlers/heartbeat/skills/tick-diagnostics/ that helps the Heartbeat butler diagnose and report on butler health from tick cycle results.\n\nThe Heartbeat butler runs tick_all_butlers every 10 minutes. This skill should provide:\n- Health assessment framework based on tick responses (success, timeout, error, unreachable)\n- Pattern detection for recurring failures (same butler failing multiple ticks)\n- Escalation rules (when to alert vs when to just log)\n- Diagnostic checklist for common failure modes (DB down, port blocked, OOM)\n- Summary report template for tick cycle results","acceptance_criteria":"1. butlers/heartbeat/skills/tick-diagnostics/SKILL.md exists with valid YAML frontmatter\n2. Defines health assessment criteria from tick responses\n3. Includes failure pattern detection guidance\n4. Provides escalation rules","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T20:58:13.92194523+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:17:06.730500141+08:00","closed_at":"2026-02-10T00:17:06.730500141+08:00","close_reason":"Tick-diagnostics skill created with health assessment, failure patterns, escalation rules, and report template","labels":["heartbeat","skills"],"dependencies":[{"issue_id":"butlers-bjr.7","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:58:13.923777814+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cjp","title":"Write MANIFESTO.md for each butler","description":"Create a public-facing MANIFESTO.md file in each butler's config directory (butlers/\u003cname\u003e/MANIFESTO.md). Each manifesto explains what the butler does, what it represents, and how it improves the user's life. Written for a general audience — not developers, but people who want to understand why this butler exists and what it can do for them. Tone should be warm, clear, and aspirational without being salesy. Each manifesto should reflect the butler's unique personality and domain.\n\nThese manifestos also serve as the UX north star for each butler: new features, tools, and design decisions should be deeply aligned with the manifesto. CLAUDE.md and AGENTS.md have been updated to codify this convention.","acceptance_criteria":"1. butlers/switchboard/MANIFESTO.md exists\n2. butlers/general/MANIFESTO.md exists\n3. butlers/health/MANIFESTO.md exists\n4. butlers/relationship/MANIFESTO.md exists\n5. butlers/heartbeat/MANIFESTO.md exists\n6. Each manifesto explains what the butler does, why it matters, and what it can do for you\n7. Tone is warm, clear, and public-audience appropriate\n8. No internal implementation details (no SQL schemas, no port numbers, no MCP internals)","status":"closed","priority":3,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T21:20:05.176052182+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:49:10.336668104+08:00","closed_at":"2026-02-10T01:49:10.336668104+08:00","close_reason":"All 5 children completed: switchboard, general, health, relationship, heartbeat MANIFESTOs written"}
{"id":"butlers-cjp.1","title":"Write MANIFESTO.md for the Switchboard butler","description":"Write butlers/switchboard/MANIFESTO.md. The Switchboard is the front door — it receives every message and makes sure it reaches the right specialist. Frame it as the intelligent receptionist: you never need to know which butler handles what, you just talk, and the Switchboard figures it out. Emphasize simplicity for the user (one entry point), reliability (nothing gets lost), and intelligence (it understands context, not just keywords).","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T21:20:27.100987991+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:28:05.11865032+08:00","closed_at":"2026-02-10T01:28:05.11865032+08:00","close_reason":"MANIFESTO.md created for Switchboard butler, all tests pass, pushed to agent/butlers-cjp.1","dependencies":[{"issue_id":"butlers-cjp.1","depends_on_id":"butlers-cjp","type":"parent-child","created_at":"2026-02-09T21:20:27.102937968+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cjp.2","title":"Write MANIFESTO.md for the General butler","description":"Write butlers/general/MANIFESTO.md. The General butler is the flexible catch-all — a personal notebook that remembers anything. Frame it as the swiss-army-knife assistant: lists, notes, random data, ideas, anything that doesn't fit elsewhere. Emphasize its flexibility (any kind of data), organization (collections keep things tidy), and reliability (it never forgets what you told it).","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T21:20:27.167410662+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:29:41.509611953+08:00","closed_at":"2026-02-10T01:29:41.509611953+08:00","close_reason":"MANIFESTO.md created for General butler, lint passed, pushed to agent/butlers-cjp.2","dependencies":[{"issue_id":"butlers-cjp.2","depends_on_id":"butlers-cjp","type":"parent-child","created_at":"2026-02-09T21:20:27.168895881+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cjp.3","title":"Write MANIFESTO.md for the Health butler","description":"Write butlers/health/MANIFESTO.md. The Health butler tracks your physical wellbeing over time. Frame it as a patient, non-judgmental health companion: it remembers your medications, tracks your measurements, logs symptoms, watches your nutrition, and spots trends you'd miss. Emphasize continuity (it builds a picture over weeks and months), agency (your data, your terms), and insight (trend reports, adherence tracking, nutrition summaries).","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T21:20:27.236979052+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:39:20.528942056+08:00","closed_at":"2026-02-10T01:39:20.528942056+08:00","close_reason":"MANIFESTO.md created for Health butler, all tests pass, pushed to agent/butlers-cjp.3","dependencies":[{"issue_id":"butlers-cjp.3","depends_on_id":"butlers-cjp","type":"parent-child","created_at":"2026-02-09T21:20:27.238640794+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cjp.4","title":"Write MANIFESTO.md for the Relationship butler","description":"Write butlers/relationship/MANIFESTO.md. The Relationship butler is a personal CRM for the people in your life. Frame it as the friend who remembers everything: birthdays, gift ideas, who you talked to last week, the loan you made, the note you took after a meaningful conversation. Emphasize thoughtfulness (never miss an important date), richness (notes with emotion tags, interaction history), and connection (it helps you be more present in your relationships).","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T21:20:27.311569338+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:45:35.832966209+08:00","closed_at":"2026-02-10T01:45:35.832966209+08:00","close_reason":"MANIFESTO.md created for Relationship butler, all tests pass, pushed to agent/butlers-cjp.4","dependencies":[{"issue_id":"butlers-cjp.4","depends_on_id":"butlers-cjp","type":"parent-child","created_at":"2026-02-09T21:20:27.313773476+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cjp.5","title":"Write MANIFESTO.md for the Heartbeat butler","description":"Write butlers/heartbeat/MANIFESTO.md. The Heartbeat butler is the system's pulse — it makes sure every other butler stays alive and responsive. Frame it for a public audience as the reliability layer: you never need to think about it, but it's always working to make sure the system is healthy. Brief and understated, matching the butler's behind-the-scenes nature. Emphasize reliability (runs every 10 minutes, never stops), resilience (one failure doesn't cascade), and peace of mind (the system watches itself so you don't have to).","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T21:20:27.390734083+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:49:09.00245906+08:00","closed_at":"2026-02-10T01:49:09.00245906+08:00","close_reason":"MANIFESTO.md created for Heartbeat butler, all tests pass, pushed to agent/butlers-cjp.5","dependencies":[{"issue_id":"butlers-cjp.5","depends_on_id":"butlers-cjp","type":"parent-child","created_at":"2026-02-09T21:20:27.392412326+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc","title":"Add action approval mechanism with standing approval rules","description":"Butlers performing high-stakes actions (sending emails, making purchases, creating calendar events) need human review before execution. This epic adds a generalized approval framework:\n\n1. **MCP-level interception** — gated tools are wrapped at the daemon level; when called, the action is serialized and parked instead of executed\n2. **Approval queue** — pending actions persisted in the butler's DB with full context (tool, args, agent summary, session ID)\n3. **Standing approval rules** — users can pre-approve recurring action patterns (e.g. 'weekly health email to bob@co.com') so they only approve once\n4. **Rule matching** — tool name + per-argument constraints (exact/pattern/any), with module-declared sensitivity hints and heuristic fallback for arg classification\n5. **Post-approval execution** — approved actions invoke the target tool directly (no CC respawn), with result logging\n6. **Notification** — users are notified of pending actions via existing channels\n\nKey data model:\n- PendingAction: id, butler, tool, args, agent_summary, session_id, status (pending/approved/rejected/expired/executed), timestamps, decision metadata, execution result\n- ApprovalRule: id, butler, tool, arg_constraints, description, expiry, max_uses, use_count, active, created_from (the PendingAction that spawned it)\n- Constraint types: exact, pattern, any — safety-critical args (recipients, amounts, URLs) default to pinned\n\nDesign decisions:\n- Hybrid core+module: interception lives in daemon (wraps MCP dispatch), approval tools live in an opt-in module\n- Sensitivity metadata: modules declare sensitive args via tool_metadata(); heuristic fallback for args named to/recipient/amount/url/etc.\n- When approving, user can choose: reject / approve once / approve \u0026 create standing rule (system suggests constraints)\n- Auto-expiry for pending actions (configurable TTL)\n- Even auto-approved actions are logged for audit trail\n\nPrior art: butlers-r1v.3 (extraction confirmation queue) — similar pattern but Switchboard-specific. This generalizes it.","design":"Architecture:\n- Core daemon change: tool dispatch wrapper checks approval config before invoking tool function. If gated, serialize PendingAction to DB, return {status: 'pending_approval', action_id} to CC.\n- Approval module: registers MCP tools (list_pending, approve_action, reject_action, create_rule, list_rules, revoke_rule). Owns the approval_actions and approval_rules tables.\n- Module.tool_metadata() method returns dict of {tool_name: {arg_name: {sensitive: bool}}}. Convention-based heuristic as fallback.\n- butler.toml config: [modules.approvals] require_approval = ['email_send', 'purchase_create'] with optional per-tool overrides.\n- Standing rule matching: ordered most-specific-first (more pinned args = higher priority). On match: auto-approve, log, increment use_count.\n- Suggested constraints on 'approve \u0026 create rule': sensitive args default to exact (pinned), content args default to any (open). User can adjust before confirming.\n\nTables (in butler's own DB):\n- pending_actions (id UUID PK, tool_name TEXT, tool_args JSONB, agent_summary TEXT, session_id UUID FK, status VARCHAR, requested_at TIMESTAMPTZ, expires_at TIMESTAMPTZ, decided_by TEXT, decided_at TIMESTAMPTZ, execution_result JSONB, approval_rule_id UUID nullable FK)\n- approval_rules (id UUID PK, tool_name TEXT, arg_constraints JSONB, description TEXT, created_from UUID nullable FK, created_at TIMESTAMPTZ, expires_at TIMESTAMPTZ, max_uses INT, use_count INT DEFAULT 0, active BOOL DEFAULT true)","acceptance_criteria":"1. Any butler can opt into approval gating via butler.toml configuration\n2. Gated tool calls are intercepted at MCP dispatch, serialized, and parked in DB\n3. Pending actions include agent-generated human-readable summary\n4. Users can approve, reject, or create standing rules from pending actions\n5. Standing rules auto-approve matching future actions without human intervention\n6. Rule matching supports exact, pattern, and any constraints per argument\n7. Modules can declare which tool args are safety-critical; heuristic fallback exists\n8. Approved actions execute directly (no CC respawn) with result logged\n9. Expired actions are auto-rejected after configurable TTL\n10. Full audit trail: all actions (manual and auto-approved) logged with decision metadata","status":"open","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:27:30.535583906+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:27:30.535583906+08:00"}
{"id":"butlers-clc.1","title":"Define PendingAction and ApprovalRule data models with Alembic migration","description":"Create the two core tables for the approval mechanism in a new Alembic migration branch.\n\nTables:\n- pending_actions: id (UUID PK), tool_name (TEXT NOT NULL), tool_args (JSONB NOT NULL), agent_summary (TEXT), session_id (UUID, FK to sessions), status (VARCHAR NOT NULL DEFAULT 'pending', CHECK IN pending/approved/rejected/expired/executed), requested_at (TIMESTAMPTZ NOT NULL DEFAULT now()), expires_at (TIMESTAMPTZ), decided_by (TEXT), decided_at (TIMESTAMPTZ), execution_result (JSONB), approval_rule_id (UUID, FK to approval_rules, nullable — set when auto-approved by a rule)\n- approval_rules: id (UUID PK), tool_name (TEXT NOT NULL), arg_constraints (JSONB NOT NULL), description (TEXT NOT NULL), created_from (UUID, FK to pending_actions, nullable), created_at (TIMESTAMPTZ NOT NULL DEFAULT now()), expires_at (TIMESTAMPTZ), max_uses (INT), use_count (INT NOT NULL DEFAULT 0), active (BOOL NOT NULL DEFAULT true)\n\nIndexes: pending_actions(status, requested_at), pending_actions(session_id), approval_rules(tool_name, active).\n\nAlso define corresponding Python dataclasses/Pydantic models in src/butlers/modules/approvals/models.py for serialization/deserialization.","acceptance_criteria":"1. Alembic migration creates both tables with correct schema, constraints, and indexes\n2. Python dataclasses match DB schema with JSON serialization support\n3. Migration uses branch label 'approvals'\n4. Tests verify migration applies cleanly and models round-trip through DB","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T11:27:41.593209805+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:45:18.755143357+08:00","closed_at":"2026-02-10T11:45:18.755143357+08:00","close_reason":"Merged to main. PendingAction + ApprovalRule tables, models, migration, and 16 tests.","dependencies":[{"issue_id":"butlers-clc.1","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:27:41.595227428+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc.2","title":"Add tool sensitivity metadata to Module interface with heuristic fallback","description":"Extend the Module abstract base class to allow modules to declare which tool arguments are safety-critical (sensitive). This metadata drives the default constraint suggestions when creating standing approval rules.\n\nChanges to Module ABC:\n- Add optional method tool_metadata() -\u003e dict[str, ToolMeta] where ToolMeta has {arg_sensitivities: dict[str, bool]}. Default implementation returns empty dict (backward compatible).\n\nHeuristic fallback (for tools without explicit metadata):\n- Args named: to, recipient, recipients, email, address, url, uri, amount, price, cost, account → sensitive=True\n- All other args → sensitive=False\n\nResolution order: module declaration \u003e heuristic \u003e default (not sensitive).\n\nPlace heuristic logic in src/butlers/modules/approvals/sensitivity.py so it's co-located with the approval module.","acceptance_criteria":"1. Module ABC has optional tool_metadata() method with sensible default\n2. Existing modules are unaffected (backward compatible)\n3. Heuristic correctly classifies common sensitive arg names\n4. Resolution order: explicit \u003e heuristic \u003e default\n5. Tests cover explicit declaration, heuristic matching, and fallback","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T11:27:49.194712401+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:52:54.857208903+08:00","closed_at":"2026-02-10T11:52:54.857208903+08:00","close_reason":"Merged to main. Module ABC extended with tool_metadata(), sensitivity heuristic, 46 tests.","dependencies":[{"issue_id":"butlers-clc.2","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:27:49.197535916+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc.3","title":"Add approval gating configuration to butler.toml and ButlerConfig","description":"Extend butler.toml schema and ButlerConfig to support approval gating configuration.\n\nConfig shape in butler.toml:\n[modules.approvals]\nenabled = true\ndefault_expiry_hours = 48\n\n[modules.approvals.gated_tools]\nemail_send = {}                          # gate with defaults\npurchase_create = {expiry_hours = 24}    # custom expiry\ncalendar_invite = {}\n\nParsed into ApprovalConfig dataclass with:\n- enabled: bool\n- default_expiry_hours: int = 48\n- gated_tools: dict[str, GatedToolConfig]\n\nGatedToolConfig:\n- expiry_hours: int | None (override default)\n\nValidation: gated tool names must match tools actually registered by the butler's modules (validated at startup after module registration).","acceptance_criteria":"1. butler.toml supports [modules.approvals] section\n2. ButlerConfig parses approval config correctly\n3. Unknown/unregistered gated tool names raise validation error at startup\n4. Default expiry is configurable\n5. Tests cover config parsing, validation, and defaults","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T11:27:55.619784775+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:55:08.816376557+08:00","closed_at":"2026-02-10T11:55:08.816376557+08:00","close_reason":"Merged to main. ApprovalConfig + GatedToolConfig dataclasses, TOML parsing, validation, 26 tests.","dependencies":[{"issue_id":"butlers-clc.3","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:27:55.621552896+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc.4","title":"Implement MCP tool dispatch interception for approval-gated tools","description":"Modify the daemon's MCP tool registration to wrap approval-gated tools. When a gated tool is called by CC:\n\n1. Serialize the call into a PendingAction (tool_name, tool_args, session context)\n2. Check standing approval rules — if a rule matches, auto-approve and execute immediately\n3. If no rule matches, persist PendingAction with status='pending' and return a structured response to CC: {status: 'pending_approval', action_id: '\u003cuuid\u003e', message: 'Action queued for approval: \u003cagent_summary\u003e'}\n\nImplementation in daemon.py's tool registration loop:\n- After module.register_tools(), wrap any tool whose name appears in gated_tools config\n- The wrapper function replaces the original tool handler\n- Original tool function reference is preserved for post-approval direct invocation\n\nThe CC agent will receive the pending_approval response and can inform the user that the action is awaiting approval.\n\nKey: the wrapping happens at the FastMCP level, not inside individual tool functions. Tools remain unaware of the approval layer.","acceptance_criteria":"1. Gated tools are transparently wrapped at MCP registration time\n2. Non-gated tools are completely unaffected\n3. Wrapped tools serialize call into PendingAction and persist to DB\n4. Standing rule check happens before parking (auto-approve path works)\n5. CC receives structured pending_approval response with action ID\n6. Original tool function is preserved for later direct invocation\n7. Tests cover: gated tool interception, non-gated passthrough, auto-approve via rule, serialization correctness","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":180,"created_at":"2026-02-10T11:28:08.069721047+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:28:08.069721047+08:00","dependencies":[{"issue_id":"butlers-clc.4","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:28:08.071429235+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.4","depends_on_id":"butlers-clc.1","type":"blocks","created_at":"2026-02-10T11:28:43.677091058+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.4","depends_on_id":"butlers-clc.3","type":"blocks","created_at":"2026-02-10T11:28:43.788504927+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc.5","title":"Implement approval queue MCP tools (list, approve, reject)","description":"Create the approval module's core MCP tools for managing the pending action queue.\n\nTools:\n- list_pending_actions(status?: str, limit?: int) → list of pending actions with id, tool_name, agent_summary, requested_at, expires_at\n- show_pending_action(action_id: str) → full PendingAction details including tool_args\n- approve_action(action_id: str, create_rule?: bool) → approves and executes the action. If create_rule=true, returns suggested constraints for rule creation (see standing rules task)\n- reject_action(action_id: str, reason?: str) → rejects with optional reason\n- pending_action_count() → count of pending actions (for tick handler surfacing)\n- expire_stale_actions() → mark expired actions past their expires_at (called by tick handler)\n\nAll tools operate on the butler's own DB. Register via the approvals Module.register_tools() method.\n\nStatus transitions: pending → approved → executed, pending → rejected, pending → expired. No backward transitions.","acceptance_criteria":"1. All 6 tools registered and callable via MCP\n2. approve_action triggers direct execution of the original tool and stores result\n3. reject_action records reason and timestamps\n4. expire_stale_actions correctly identifies and expires overdue actions\n5. Status transitions are enforced (no invalid transitions)\n6. Tests cover full lifecycle: create → list → approve → execute, create → reject, create → expire","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T11:28:16.738273107+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:54:36.418750911+08:00","closed_at":"2026-02-10T11:54:36.418750911+08:00","close_reason":"Merged to main. ApprovalsModule with 6 MCP tools, status transitions, 63 tests.","dependencies":[{"issue_id":"butlers-clc.5","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:28:16.740742921+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.5","depends_on_id":"butlers-clc.1","type":"blocks","created_at":"2026-02-10T11:28:43.859989751+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc.6","title":"Implement standing approval rules engine with CRUD tools","description":"Build the rule matching engine and MCP tools for managing standing approval rules.\n\nRule matching engine (src/butlers/modules/approvals/rules.py):\n- match_rules(pool, tool_name, tool_args) → ApprovalRule | None\n- Fetches active, non-expired rules for the tool_name\n- Filters out rules that exceeded max_uses\n- Evaluates arg_constraints against tool_args:\n  - exact: arg value == constraint value\n  - pattern: fnmatch-style glob matching (e.g. '*@mycompany.com')\n  - any: always matches\n- Returns most-specific match (most pinned/exact constraints wins)\n- Returns None if no match\n\nConstraint suggestion (src/butlers/modules/approvals/sensitivity.py):\n- suggest_constraints(tool_name, tool_args, tool_metadata) → dict[str, Constraint]\n- Sensitive args → exact constraint (pinned to current value)\n- Non-sensitive args → any constraint\n- Uses module metadata + heuristic fallback\n\nMCP tools:\n- create_approval_rule(tool_name, arg_constraints, description, expires_at?, max_uses?) → rule_id\n- create_rule_from_action(action_id, constraint_overrides?) → creates rule from a PendingAction, using suggested constraints with optional user overrides\n- list_approval_rules(tool_name?, active_only?: bool) → list of rules\n- show_approval_rule(rule_id) → full rule details with use_count\n- revoke_approval_rule(rule_id) → sets active=false\n- suggest_rule_constraints(action_id) → returns suggested constraints for a pending action (preview before creating)","acceptance_criteria":"1. Rule matching correctly evaluates exact, pattern, and any constraints\n2. Most-specific rule wins when multiple rules match\n3. Expired and max-uses-exceeded rules are skipped\n4. Constraint suggestion correctly classifies sensitive vs non-sensitive args\n5. create_rule_from_action generates rule from pending action with smart defaults\n6. All 6 CRUD tools work end-to-end\n7. Tests cover: matching priority, constraint types, expiry, max_uses, suggestion logic","status":"open","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":180,"created_at":"2026-02-10T11:28:27.515042441+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:28:27.515042441+08:00","dependencies":[{"issue_id":"butlers-clc.6","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:28:27.516858951+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.6","depends_on_id":"butlers-clc.1","type":"blocks","created_at":"2026-02-10T11:28:43.949523687+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.6","depends_on_id":"butlers-clc.2","type":"blocks","created_at":"2026-02-10T11:28:44.032851374+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc.7","title":"Implement post-approval direct tool executor with audit logging","description":"When an action is approved (manually or via standing rule), execute the original tool function directly without spawning a CC session.\n\nExecutor (src/butlers/modules/approvals/executor.py):\n- execute_approved_action(pool, pending_action, original_tool_fn) → ExecutionResult\n- Calls the original tool function with the deserialized args\n- Captures return value or exception\n- Updates PendingAction: status='executed', execution_result={success, result/error, executed_at}\n- If the rule that auto-approved it exists, increment use_count\n\nError handling:\n- Tool function raises → status='executed', execution_result={success: false, error: str(exception)}\n- Action is still marked executed (not retried). User can see the failure and decide what to do.\n\nAudit:\n- All executions (manual-approve and auto-approve) logged to pending_actions table\n- Auto-approved actions include approval_rule_id FK for traceability\n- Support querying: list_executed_actions(tool_name?, rule_id?, since?) for audit review","acceptance_criteria":"1. Approved actions execute the original tool function with correct args\n2. Execution result (success or failure) is persisted\n3. Auto-approved actions link back to the rule that matched\n4. Rule use_count incremented on auto-approve execution\n5. list_executed_actions supports filtering by tool, rule, and date\n6. Tests cover: successful execution, failed execution, auto-approve audit trail","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T11:28:36.120925667+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:28:36.120925667+08:00","dependencies":[{"issue_id":"butlers-clc.7","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:28:36.122749711+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.7","depends_on_id":"butlers-clc.4","type":"blocks","created_at":"2026-02-10T11:28:44.142348012+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.7","depends_on_id":"butlers-clc.5","type":"blocks","created_at":"2026-02-10T11:28:44.225283339+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.7","depends_on_id":"butlers-clc.6","type":"blocks","created_at":"2026-02-10T11:28:44.297455522+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t","title":"Abstract LLM runtime to support multiple CLI agents","description":"The CC spawner (butlers-0qp.8) is hardcoded to the Claude Code SDK — imports, option types, result parsing, and config generation all assume Claude Code. Refactor the spawner into a runtime-agnostic orchestrator backed by pluggable runtime adapters.\n\nMinimum supported runtimes:\n- Claude Code (existing, via claude-code-sdk)\n- Codex CLI (OpenAI)\n- Gemini CLI (Google)\n\nThese are all CLI tools that accept MCP server configs and a system prompt, so the fundamental model is the same — the differences are:\n1. SDK/CLI invocation interface (different query functions, option types, result types)\n2. Config file format and location (.claude/ vs .codex/ vs .gemini/ and their respective MCP config schemas)\n3. How system prompts are passed (CLAUDE.md vs AGENTS.md vs equivalent)\n4. Result parsing (different message type enums and tool-call shapes)\n\nWhat stays the same (must NOT change):\n- MCP config isolation (each instance sees only its butler's tools)\n- Serial dispatch (asyncio.Lock per butler)\n- Credential isolation (only declared env vars)\n- Session logging (every invocation logged)\n- Temp directory cleanup\n- Trace context propagation","design":"Adapter pattern with a RuntimeAdapter ABC in src/butlers/core/runtimes/base.py:\n\n```python\nclass RuntimeAdapter(ABC):\n    @abstractmethod\n    async def invoke(\n        self,\n        prompt: str,\n        system_prompt: str,\n        mcp_servers: dict[str, dict],\n        env: dict[str, str],\n        cwd: Path,\n        timeout: int = 300,\n    ) -\u003e tuple[str | None, list[dict]]:\n        \"\"\"Return (result_text, tool_calls).\"\"\"\n```\n\nConcrete adapters: ClaudeCodeAdapter, CodexAdapter, GeminiAdapter in sibling modules.\n\nCCSpawner becomes the runtime-agnostic orchestrator — keeps lock, session logging, temp dirs, credential passthrough. Delegates invocation to self._adapter.invoke().\n\nRuntime selection via butler.toml:\n```toml\n[runtime]\ntype = \"claude-code\"  # or \"codex\", \"gemini\"\n```\n\nNew module layout:\n```\nsrc/butlers/core/runtimes/\n├── __init__.py\n├── base.py              # RuntimeAdapter ABC\n├── claude_code.py       # ClaudeCodeAdapter\n├── codex.py             # CodexAdapter\n└── gemini.py            # GeminiAdapter\n```","acceptance_criteria":"1. CCSpawner delegates all SDK-specific logic to a RuntimeAdapter\n2. butler.toml `[runtime]` section selects which adapter is used\n3. ClaudeCodeAdapter preserves all existing behavior (no regression)\n4. CodexAdapter can invoke Codex CLI with MCP config and system prompt\n5. GeminiAdapter can invoke Gemini CLI with MCP config and system prompt\n6. All architectural invariants preserved (serial dispatch, credential isolation, session logging, temp cleanup, trace propagation)\n7. Tests parameterized across all three runtimes","notes":"Discovered from: butlers-0qp.8 (original CC spawner epic, now closed). This is post-v1 work — the v1 MVP shipped with Claude Code only. Key files: src/butlers/core/spawner.py, tests/test_core_spawner.py, src/butlers/core/config.py (ButlerConfig).","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T20:49:31.571765013+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:09:51.661945934+08:00","closed_at":"2026-02-10T01:09:51.661945934+08:00","close_reason":"All children completed","labels":["backend","core","refactor"],"dependencies":[{"issue_id":"butlers-f3t","depends_on_id":"butlers-0qp.8","type":"discovered-from","created_at":"2026-02-09T20:50:44.20701239+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.1","title":"Define RuntimeAdapter ABC and adapter registry","description":"Create the abstract base class that all runtime adapters implement, plus a registry/factory function that maps runtime type strings to adapter classes.\n\nCreate src/butlers/core/runtimes/__init__.py and src/butlers/core/runtimes/base.py.\n\nThe ABC defines:\n- invoke(prompt, system_prompt, mcp_servers, env, cwd, timeout) -\u003e (result_text, tool_calls)\n- build_config_file(mcp_servers, tmp_dir) -\u003e Path (runtimes may need different config file formats)\n- parse_system_prompt_file(config_dir) -\u003e str (CLAUDE.md vs equivalent)\n\nThe registry maps 'claude-code' | 'codex' | 'gemini' -\u003e adapter class. Raise ValueError for unknown types.","acceptance_criteria":"1. RuntimeAdapter ABC importable from butlers.core.runtimes\n2. get_adapter(type_str) returns correct class or raises ValueError\n3. ABC enforces invoke(), build_config_file(), parse_system_prompt_file()","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:41.51950919+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:33:45.590904213+08:00","closed_at":"2026-02-09T22:33:45.590904213+08:00","close_reason":"Defined RuntimeAdapter ABC and adapter registry","labels":["backend","core"],"dependencies":[{"issue_id":"butlers-f3t.1","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:49:41.525110856+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.2","title":"Extract ClaudeCodeAdapter from CCSpawner","description":"Refactor the SDK-specific code out of src/butlers/core/spawner.py into src/butlers/core/runtimes/claude_code.py as a ClaudeCodeAdapter implementing RuntimeAdapter.\n\nMove to the adapter:\n- claude_code_sdk imports (ClaudeCodeOptions, ResultMessage, ToolUseBlock, McpSSEServerConfig, query)\n- MCP config file writing (JSON format with mcpServers key)\n- SDK invocation (building ClaudeCodeOptions, calling query(), parsing ResultMessage/ToolUseBlock)\n- CLAUDE.md reading logic\n\nKeep in CCSpawner (the orchestrator):\n- asyncio.Lock and serial dispatch\n- Session logging (create/complete)\n- Credential passthrough (_build_env)\n- Temp directory lifecycle\n- Trace context propagation\n- SpawnerResult dataclass\n\nCCSpawner receives a RuntimeAdapter instance at __init__ instead of sdk_query callable.","acceptance_criteria":"1. All existing spawner tests pass without modification to assertions (only setup changes)\n2. ClaudeCodeAdapter is a standalone module with no imports from spawner.py\n3. CCSpawner has zero imports from claude_code_sdk\n4. Behavior identical to pre-refactor (no regression)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:49:53.92584154+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:51:40.88083812+08:00","closed_at":"2026-02-09T22:51:40.88083812+08:00","close_reason":"Extracted ClaudeCodeAdapter from CCSpawner","labels":["backend","core","refactor"],"dependencies":[{"issue_id":"butlers-f3t.2","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:49:53.934925662+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.2","depends_on_id":"butlers-f3t.1","type":"blocks","created_at":"2026-02-09T20:49:57.257634225+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.3","title":"Add runtime config to butler.toml and ButlerConfig","description":"Extend butler.toml schema and ButlerConfig dataclass to support runtime selection.\n\nAdd a [runtime] section to butler.toml:\n```toml\n[runtime]\ntype = \"claude-code\"   # \"claude-code\" | \"codex\" | \"gemini\"\n# Future: runtime-specific overrides could go here\n```\n\nAdd RuntimeConfig to ButlerConfig:\n```python\n@dataclass\nclass RuntimeConfig:\n    type: str = \"claude-code\"  # default preserves backward compat\n\n@dataclass  \nclass ButlerConfig:\n    runtime: RuntimeConfig = field(default_factory=RuntimeConfig)\n```\n\nButlerDaemon startup uses get_adapter(config.runtime.type) to instantiate the correct adapter and passes it to CCSpawner (or rename to just Spawner).","acceptance_criteria":"1. Existing butler.toml files without [runtime] default to claude-code (backward compat)\n2. Invalid runtime type raises clear error at startup, not at first invocation\n3. ButlerConfig.runtime.type accessible throughout the codebase\n4. Config parsing tested with all three runtime types + missing section + invalid type","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:06.134135358+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:01:08.991832307+08:00","closed_at":"2026-02-09T23:01:08.991832307+08:00","close_reason":"Added runtime config to butler.toml and ButlerConfig","labels":["backend","config","core"],"dependencies":[{"issue_id":"butlers-f3t.3","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:50:06.135889887+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.3","depends_on_id":"butlers-f3t.1","type":"blocks","created_at":"2026-02-09T20:50:06.200121617+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.4","title":"Implement CodexAdapter for Codex CLI","description":"Implement CodexAdapter in src/butlers/core/runtimes/codex.py.\n\nResearch required:\n- Codex CLI invocation interface (likely subprocess-based or SDK)\n- MCP config format for Codex (.codex/ conventions)\n- How Codex ingests system prompts (equivalent of CLAUDE.md — likely AGENTS.md or instructions file)\n- Result format (how to extract text response and tool calls)\n\nThe adapter must:\n- Build Codex-compatible MCP config pointing to the butler's SSE endpoint\n- Pass the system prompt in Codex's expected format\n- Invoke Codex with filtered env vars\n- Parse Codex output into (result_text, tool_calls) matching the RuntimeAdapter contract\n\nIf Codex doesn't have a Python SDK, use subprocess invocation of the CLI binary.","acceptance_criteria":"1. CodexAdapter implements all RuntimeAdapter methods\n2. MCP config generated in Codex-compatible format\n3. System prompt sourced from appropriate file (AGENTS.md or equivalent)\n4. Result parsing extracts text and tool calls correctly\n5. Adapter works with Codex CLI binary installed on PATH","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":180,"created_at":"2026-02-09T20:50:15.601088013+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:11:50.420589571+08:00","closed_at":"2026-02-09T23:11:50.420589571+08:00","close_reason":"Implemented CodexAdapter for Codex CLI","labels":["backend","core"],"dependencies":[{"issue_id":"butlers-f3t.4","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:50:15.603215778+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.4","depends_on_id":"butlers-f3t.1","type":"blocks","created_at":"2026-02-09T20:50:15.666185839+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.5","title":"Implement GeminiAdapter for Gemini CLI","description":"Implement GeminiAdapter in src/butlers/core/runtimes/gemini.py.\n\nResearch required:\n- Gemini CLI invocation interface (subprocess or google-generativeai SDK)\n- MCP config format for Gemini (.gemini/ conventions — note: .gemini/ already has TOML command definitions in this repo)\n- How Gemini ingests system prompts (equivalent of CLAUDE.md)\n- Result format (how to extract text response and tool calls)\n\nThe adapter must:\n- Build Gemini-compatible MCP config pointing to the butler's SSE endpoint\n- Pass the system prompt in Gemini's expected format\n- Invoke Gemini with filtered env vars (GOOGLE_API_KEY instead of ANTHROPIC_API_KEY)\n- Parse Gemini output into (result_text, tool_calls) matching the RuntimeAdapter contract\n\nIf Gemini CLI doesn't have a Python SDK for agentic invocation, use subprocess.","acceptance_criteria":"1. GeminiAdapter implements all RuntimeAdapter methods\n2. MCP config generated in Gemini-compatible format\n3. System prompt passed correctly\n4. Result parsing extracts text and tool calls\n5. Adapter works with Gemini CLI binary installed on PATH\n6. Env passthrough includes GOOGLE_API_KEY (not ANTHROPIC_API_KEY)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":180,"created_at":"2026-02-09T20:50:22.431473906+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:23:48.001730525+08:00","closed_at":"2026-02-09T23:23:48.001730525+08:00","close_reason":"Implemented GeminiAdapter for Gemini CLI","labels":["backend","core"],"dependencies":[{"issue_id":"butlers-f3t.5","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:50:22.432887279+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.5","depends_on_id":"butlers-f3t.1","type":"blocks","created_at":"2026-02-09T20:50:22.491757995+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.6","title":"Wire runtime adapter into ButlerDaemon startup","description":"Update ButlerDaemon (src/butlers/core/daemon.py) to:\n1. Read runtime.type from ButlerConfig\n2. Instantiate the correct RuntimeAdapter via get_adapter()\n3. Pass the adapter to the Spawner (formerly CCSpawner)\n4. Handle missing runtime binaries gracefully (check PATH at startup, warn or fail-fast)\n\nAlso rename CCSpawner -\u003e Spawner (or AgentSpawner) since it's no longer Claude Code-specific. Update all imports across the codebase.","acceptance_criteria":"1. ButlerDaemon correctly wires the adapter based on butler.toml config\n2. Missing runtime binary detected at startup with clear error message\n3. All imports updated — no references to CCSpawner remain\n4. Existing butler configs (no [runtime] section) default to claude-code and work unchanged","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T20:50:30.087481629+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:34:05.280738025+08:00","closed_at":"2026-02-09T23:34:05.280738025+08:00","close_reason":"Wired runtime adapter into daemon startup","labels":["backend","core"],"dependencies":[{"issue_id":"butlers-f3t.6","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:50:30.09425505+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.6","depends_on_id":"butlers-f3t.2","type":"blocks","created_at":"2026-02-09T20:50:30.173585359+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.6","depends_on_id":"butlers-f3t.3","type":"blocks","created_at":"2026-02-09T20:50:30.23863598+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.7","title":"Parameterize spawner tests across all runtimes","description":"Refactor tests/test_core_spawner.py to:\n1. Run the existing orchestration tests (lock, session logging, credential passthrough, cleanup) against a mock adapter — these are runtime-agnostic\n2. Add per-adapter unit tests for each RuntimeAdapter implementation:\n   - ClaudeCodeAdapter: config generation, SDK invocation, result parsing\n   - CodexAdapter: config generation, CLI invocation, result parsing\n   - GeminiAdapter: config generation, CLI invocation, result parsing\n3. Use pytest.mark.parametrize where tests should run identically across adapters\n4. Mock the actual SDK/CLI calls in adapter tests (don't require binaries installed)\n\nThe existing 757-line test file has 10 test classes — preserve all assertions, just restructure.","acceptance_criteria":"1. All existing test assertions preserved (no regression)\n2. Orchestration tests run against mock adapter (not Claude Code-specific)\n3. Each adapter has dedicated unit tests for its specific logic\n4. Tests don't require any CLI binary to be installed (fully mocked)\n5. pytest --co shows parameterized test matrix","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:50:39.742258253+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:44:27.037706773+08:00","closed_at":"2026-02-09T23:44:27.037706773+08:00","close_reason":"Parameterized spawner tests across all runtimes","labels":["backend","core","testing"],"dependencies":[{"issue_id":"butlers-f3t.7","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:50:39.743782085+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.7","depends_on_id":"butlers-f3t.2","type":"blocks","created_at":"2026-02-09T20:50:39.800757992+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.7","depends_on_id":"butlers-f3t.4","type":"blocks","created_at":"2026-02-09T20:50:39.858383978+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.7","depends_on_id":"butlers-f3t.5","type":"blocks","created_at":"2026-02-09T20:50:39.914884918+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.7","depends_on_id":"butlers-f3t.6","type":"blocks","created_at":"2026-02-09T20:50:39.974783071+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.8","title":"Add per-butler model selection to runtime config","description":"Each butler should be able to specify which LLM model it uses, independent of the runtime adapter. The runtime type (claude-code, codex, gemini) determines the CLI tool, but the model parameter selects which specific model within that runtime the butler invokes.\n\nThis matters because different butlers have different cost/capability tradeoffs:\n- Switchboard (classification, routing): fast cheap model (Haiku, GPT-4o-mini)\n- Relationship (nuanced reasoning, empathy): capable model (Opus 4.6, GPT-5.2)\n- Heartbeat (simple ticks): cheapest available\n- General (varied tasks): mid-tier default (Sonnet 4.5)\n\nWithout per-butler model config, all butlers share whatever the runtime default is, wasting money on simple tasks or under-powering complex ones.\n\nThe model field should be optional — when omitted, the runtime adapter uses its own default (e.g. Claude Code SDK default, Codex CLI default). This preserves backward compatibility for existing butler.toml files.","design":"Extend RuntimeConfig with an optional model field:\n\nbutler.toml:\n```toml\n[runtime]\ntype = \"claude-code\"\nmodel = \"claude-opus-4-6\"    # optional, runtime-specific model ID\n```\n\nRuntimeConfig dataclass:\n```python\n@dataclass\nclass RuntimeConfig:\n    type: str = \"claude-code\"\n    model: str | None = None   # None = use runtime default\n```\n\nRuntimeAdapter.invoke() gains a model parameter:\n```python\nasync def invoke(self, prompt, system_prompt, mcp_servers, env, cwd, timeout=300, model=None):\n    ...\n```\n\nEach adapter maps the model string to its SDK/CLI equivalent:\n- ClaudeCodeAdapter: passes model to ClaudeCodeOptions (claude-code-sdk already supports this)\n- CodexAdapter: passes --model flag to codex CLI\n- GeminiAdapter: passes --model flag to gemini CLI\n\nThe Spawner reads config.runtime.model and passes it through to adapter.invoke(). If None, the adapter omits the flag entirely (runtime default).\n\nModel string is opaque to the framework — no validation beyond non-empty. Each runtime defines its own valid model IDs. Invalid models fail at invocation time with a clear error from the underlying CLI/SDK.\n\nSession logging should record the model used (add model TEXT column to sessions table or include in the existing cost JSONB).","acceptance_criteria":"1. butler.toml [runtime] section accepts optional model field\n2. Omitting model preserves backward compat (runtime default used)\n3. Model string passed through to RuntimeAdapter.invoke()\n4. ClaudeCodeAdapter passes model to ClaudeCodeOptions when set\n5. Session log records which model was used for each invocation\n6. Config parsing tested: model present, model absent, model empty string","notes":"Model IDs are runtime-specific and not validated by the framework. Examples: claude-opus-4-6, claude-sonnet-4-5-20250929, claude-haiku-4-5-20251001, gpt-5.2, gpt-4o-mini, gemini-2.0-flash. The framework treats them as opaque strings.","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T21:05:27.945753955+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:24:16.532274429+08:00","closed_at":"2026-02-10T00:24:16.532274429+08:00","close_reason":"Per-butler model selection added to RuntimeConfig, all adapters, and session logging","labels":["backend","config","core"],"dependencies":[{"issue_id":"butlers-f3t.8","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T21:05:27.947689973+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.8","depends_on_id":"butlers-f3t.3","type":"blocks","created_at":"2026-02-09T21:05:32.430965332+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.8","depends_on_id":"butlers-f3t.1","type":"blocks","created_at":"2026-02-09T21:05:32.541901451+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx","title":"Enable multi-butler message decomposition in Switchboard","description":"When a user sends a single message that spans multiple butler domains (e.g., 'Remind me to call Mom on Tuesday and log my weight at 75kg'), the Switchboard should decompose it into sub-messages and route each to the appropriate specialist butler. Currently the entire pipeline is 1:1: classify_message() returns a single butler name, route() forwards to one target, and the CLAUDE.md prompt does not instruct CC to split messages. This epic covers the spec changes, code changes, and prompt engineering needed to enable fan-out routing.","acceptance_criteria":"1. A single multi-domain message produces route() calls to each relevant butler\n2. Each sub-route is independently logged in routing_log\n3. Responses from all targeted butlers are aggregated into a single user-facing reply\n4. Single-domain messages continue to work exactly as before (no regression)\n5. Switchboard CLAUDE.md and triage skill instruct CC on decomposition behavior","notes":"Related existing work: butlers-bjr.1 (message-triage skill) partially covers multi-domain handling but needs decomposition guidance. butlers-06j.35 (inter-butler routing) must land first since route() does not work yet. butlers-06j.36 (module-to-classification pipeline) must land for end-to-end flow. This epic can be designed in parallel but implementation depends on those blockers.","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T21:15:54.507634584+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:09:51.67108062+08:00","closed_at":"2026-02-10T01:09:51.67108062+08:00","close_reason":"All children completed","dependencies":[{"issue_id":"butlers-hzx","depends_on_id":"butlers-06j.35","type":"blocks","created_at":"2026-02-09T21:15:57.639786378+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.1","title":"Update classify_message to return multi-butler decomposition","description":"Refactor classify_message() in src/butlers/tools/switchboard.py to return a list of (butler_name, sub_prompt) tuples instead of a single butler name string. The CC spawner prompt must instruct CC to analyze whether the message spans multiple domains and, if so, decompose it into distinct sub-messages each tagged with the target butler. For single-domain messages, the result is a list with one entry (backward-compatible). The return type changes from str to list[dict] with keys 'butler' and 'prompt'.","design":"Current classify_message asks CC to respond with ONLY the butler name. New prompt should ask CC to respond with JSON: [{\"butler\": \"health\", \"prompt\": \"Log weight at 75kg\"}, {\"butler\": \"relationship\", \"prompt\": \"Remind me to call Mom on Tuesday\"}]. Parse the JSON response; on parse failure, fall back to general.","acceptance_criteria":"1. classify_message returns list[dict] with keys 'butler' and 'prompt'\n2. Single-domain messages return a list with exactly one entry\n3. Multi-domain messages return one entry per target butler with a scoped sub-prompt\n4. The CC prompt instructs decomposition and specifies the expected JSON output format\n5. Fallback to [{'butler': 'general', 'prompt': original_message}] on classification failure","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:16:08.829702388+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:39:11.128999086+08:00","closed_at":"2026-02-09T21:39:11.128999086+08:00","close_reason":"Closed","dependencies":[{"issue_id":"butlers-hzx.1","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:16:08.833557743+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.2","title":"Add multi-route dispatch loop to Switchboard routing flow","description":"After classify_message returns a list of (butler, prompt) pairs, the Switchboard needs a dispatch loop that calls route() for each entry sequentially (respecting v1 serial constraint), collects results, and aggregates responses. Currently the flow is: classify -\u003e route(single_butler). New flow: classify -\u003e for each target: route(butler, trigger, {prompt: sub_prompt}) -\u003e collect results -\u003e aggregate. Each route() call is independently logged in routing_log. Errors in one sub-route must not prevent others from executing.","design":"New async function dispatch_decomposed(pool, targets: list[dict], source_channel, source_id) -\u003e list[dict]. Iterates over targets, calls route() for each, captures result or error. Returns list of {butler, result, error} dicts.","acceptance_criteria":"1. All decomposed sub-messages are dispatched via route() sequentially\n2. Each route() call is independently logged in routing_log\n3. A failure in one sub-route does not prevent subsequent sub-routes\n4. Results from all sub-routes are collected into a list\n5. Single-target messages dispatch exactly one route() call (no regression)","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:16:19.14513489+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:46:09.539656415+08:00","closed_at":"2026-02-09T21:46:09.539656415+08:00","close_reason":"Implemented dispatch_decomposed() with 7 tests, all 456 tests passing","dependencies":[{"issue_id":"butlers-hzx.2","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:16:19.146809308+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-hzx.2","depends_on_id":"butlers-hzx.1","type":"blocks","created_at":"2026-02-09T21:17:06.669033563+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.3","title":"Add response aggregation for multi-butler replies","description":"When a message is decomposed and dispatched to multiple butlers, the individual responses need to be combined into a single coherent reply sent back to the user via the originating channel (Telegram/Email). This task implements the aggregation logic that takes a list of per-butler results and produces one user-facing message. The aggregation should be done by spawning a CC instance that synthesizes the individual responses into a natural-sounding combined reply.","design":"Option A (CC-based): Spawn a CC instance with prompt 'Combine these responses into one natural reply: [results]'. Option B (template-based): Simple concatenation with headers per butler. Recommend Option A for quality since CC is already available and the output needs to feel conversational.","acceptance_criteria":"1. Multiple butler responses are aggregated into a single reply\n2. The aggregated reply reads naturally (not just concatenated text)\n3. If only one butler responded, that response is returned as-is (no aggregation overhead)\n4. If a sub-route failed, the aggregated reply includes a graceful mention or omission\n5. The originating channel receives exactly one response message","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:16:28.648900636+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:55:25.500521143+08:00","closed_at":"2026-02-09T21:55:25.500521143+08:00","close_reason":"Implemented response aggregation for multi-butler replies with CC-based synthesis, fallback concatenation, and 11 tests","dependencies":[{"issue_id":"butlers-hzx.3","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:16:28.650370647+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-hzx.3","depends_on_id":"butlers-hzx.2","type":"blocks","created_at":"2026-02-09T21:17:06.736057158+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.4","title":"Update Switchboard CLAUDE.md with decomposition instructions","description":"The Switchboard butler's CLAUDE.md (butlers/switchboard/CLAUDE.md) currently contains simple 1:1 classification rules. It needs to be updated with explicit instructions for message decomposition so that when CC is spawned for classification, it knows to split multi-domain messages. The prompt must explain: when to decompose (message contains distinct requests for different domains), the expected output format (JSON array), and when NOT to decompose (single-domain messages, ambiguous messages that should go to general).","acceptance_criteria":"1. CLAUDE.md includes decomposition instructions and examples\n2. Output format (JSON array of {butler, prompt} objects) is clearly specified\n3. Examples cover: single-domain, multi-domain, and ambiguous cases\n4. Instructions explain that each sub-prompt should be self-contained (not reference the other parts)\n5. Fallback behavior (default to general) is preserved","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T21:16:36.92503249+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:37:22.383954701+08:00","closed_at":"2026-02-10T00:37:22.383954701+08:00","close_reason":"Switchboard CLAUDE.md updated with decomposition instructions, output format, and examples","dependencies":[{"issue_id":"butlers-hzx.4","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:16:36.926748096+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.5","title":"Update message-triage skill with decomposition rubric","description":"The existing message-triage skill bead (butlers-bjr.1) mentions handling ambiguous/multi-domain messages but does not address decomposition. This task updates the skill spec to include: a decomposition decision tree (decompose vs. route-whole vs. default-to-general), examples of multi-domain messages with expected decompositions, and guidance on crafting self-contained sub-prompts that don't lose context from the original message. This task complements butlers-hzx.4 (CLAUDE.md update) — CLAUDE.md provides the high-level instructions while the triage skill provides the detailed rubric and examples.","acceptance_criteria":"1. Triage skill includes decomposition decision tree\n2. At least 3 examples of multi-domain message decompositions\n3. Guidance on preserving context in sub-prompts (e.g., 'Mom' context shouldn't be lost)\n4. Clear criteria for when NOT to decompose (ambiguous, single-domain, unclear)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T21:16:45.860222502+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:44:14.18135905+08:00","closed_at":"2026-02-10T00:44:14.18135905+08:00","close_reason":"Message-triage skill updated with decomposition decision tree, 3+ examples, and context preservation guidance","dependencies":[{"issue_id":"butlers-hzx.5","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:16:45.862999907+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-hzx.5","depends_on_id":"butlers-bjr.1","type":"blocks","created_at":"2026-02-09T21:17:07.054874051+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.6","title":"Update switchboard spec with message decomposition requirements","description":"Add new requirements to the Switchboard spec (openspec/changes/v1-mvp-spec/specs/switchboard/spec.md) covering message decomposition. The spec currently defines 1:1 classification (one message -\u003e one butler). New requirements should cover: multi-target classification output format, sequential fan-out dispatch, response aggregation, routing_log entries per sub-route, and backward compatibility with single-target classification.","acceptance_criteria":"1. New requirement: Message decomposition via CC classification\n2. New requirement: Sequential fan-out dispatch of decomposed sub-messages\n3. New requirement: Response aggregation for multi-butler replies\n4. New scenarios covering: multi-domain message, single-domain message (no regression), partial failure\n5. Spec is consistent with existing serial dispatch constraint","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:16:53.538920338+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:39:36.73156952+08:00","closed_at":"2026-02-09T21:39:36.73156952+08:00","close_reason":"Spec updated with decomposition requirements","dependencies":[{"issue_id":"butlers-hzx.6","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:16:53.540799694+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.7","title":"Write tests for multi-butler message decomposition","description":"Write pytest tests covering the full decomposition pipeline: classify_message returning multiple targets, the dispatch loop routing to each, response aggregation, and edge cases (single-domain no-regression, classification failure fallback, partial sub-route failure). Tests should mock the CC spawner and route() call_fn.","acceptance_criteria":"1. Test: multi-domain message produces multiple route() calls\n2. Test: single-domain message produces exactly one route() call\n3. Test: classification failure falls back to general with full original message\n4. Test: partial sub-route failure still processes remaining sub-routes\n5. Test: response aggregation combines multiple results into one reply\n6. Test: routing_log contains one entry per sub-route","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:17:00.148817572+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:47:10.689507393+08:00","closed_at":"2026-02-10T00:47:10.689507393+08:00","close_reason":"6 decomposition pipeline tests covering multi-domain, single-domain, fallback, partial failure, aggregation, and routing log","dependencies":[{"issue_id":"butlers-hzx.7","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:17:00.151169772+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-hzx.7","depends_on_id":"butlers-hzx.1","type":"blocks","created_at":"2026-02-09T21:17:06.806864901+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-hzx.7","depends_on_id":"butlers-hzx.2","type":"blocks","created_at":"2026-02-09T21:17:06.867942907+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-hzx.7","depends_on_id":"butlers-hzx.3","type":"blocks","created_at":"2026-02-09T21:17:06.94439071+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-ln3","title":"Organize test suite with markers and subdirectories","description":"The tests/ directory has grown to 50 flat files (1248 tests) with no structural organization. Unit tests (pure logic, no Docker) and integration tests (testcontainers PostgreSQL) are mixed together, making it impossible to run fast feedback loops during development.\n\nGoals:\n- Enable selective test execution: pytest -m unit (fast, no Docker) vs pytest -m integration (full, Docker)\n- Group test files by component area in subdirectories for navigability\n- Add Makefile targets for common test subsets\n- Stay compatible with butlers-vyn.3 (butler-specific tool tests will move to butler dirs later)\n\nNon-goals:\n- Moving butler-specific tool tests (that is butlers-vyn.3)\n- Changing test implementation or coverage","design":"Phase approach:\n1. Add pytest markers to pyproject.toml and annotate every test file\n2. Create subdirectories and move files\n3. Add conftest.py per subdirectory where scoped fixtures are needed\n4. Add Makefile targets\n\nMarker heuristic:\n- integration: any test file that imports testcontainers or has skipif not docker_available\n- unit: everything else\n\nKeep tests/conftest.py as root for shared fixtures.","acceptance_criteria":"1. All 1248 tests still pass\n2. pytest -m unit runs ~750 tests without Docker in \u003c10s\n3. pytest -m integration runs Docker-dependent tests\n4. tests/ has subdirectories grouping files by component area\n5. Makefile has test-unit, test-integration, and test (all) targets\n6. pyproject.toml has marker definitions (no unknown marker warnings)\n7. CI-compatible: markers allow splitting test stages","status":"closed","priority":3,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T10:48:09.854779859+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:45:51.035694787+08:00","closed_at":"2026-02-10T11:45:51.035694787+08:00","close_reason":"All children merged: markers (ln3.1), subdirectories (ln3.2), Makefile targets (ln3.3)."}
{"id":"butlers-ln3.1","title":"Add pytest markers for unit and integration tests","description":"Define pytest markers in pyproject.toml and annotate every test file with the appropriate marker. This enables selective test execution without moving any files.\n\nCurrent state: 20 test files have skipif not docker_available — these are integration tests. The remaining ~30 files are unit tests (mocked dependencies, no Docker).\n\nChanges needed:\n- Add markers section to pyproject.toml [tool.pytest.ini_options]\n- Add pytestmark = pytest.mark.unit or pytestmark = pytest.mark.integration to each test file\n- For files that mix both: split into separate files or use per-test markers","acceptance_criteria":"1. pyproject.toml defines unit and integration markers\n2. Every test file has a pytestmark module-level marker\n3. pytest -m unit runs without Docker and completes in \u003c10s\n4. pytest -m integration runs only Docker-dependent tests\n5. pytest (no marker filter) runs everything as before\n6. No PytestUnknownMarkWarning warnings","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T10:48:20.756377934+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:36:39.544710942+08:00","closed_at":"2026-02-10T11:36:39.544710942+08:00","close_reason":"Merged to main. All 50 test files annotated with unit/integration markers. pytest -m unit runs in ~5s.","dependencies":[{"issue_id":"butlers-ln3.1","depends_on_id":"butlers-ln3","type":"parent-child","created_at":"2026-02-10T10:48:20.757940807+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-ln3.2","title":"Reorganize tests/ into component subdirectories","description":"Move the 50 flat test files into subdirectories grouped by component area. This improves navigability as the suite grows.\n\nProposed structure:\n  tests/\n  ├── conftest.py              (shared fixtures — stays)\n  ├── test_smoke.py            (stays at root)\n  ├── core/\n  │   ├── test_state.py\n  │   ├── test_scheduler.py\n  │   ├── test_sessions.py\n  │   ├── test_spawner.py\n  │   ├── test_spawner_context.py\n  │   └── test_db.py\n  ├── modules/\n  │   ├── test_base.py\n  │   ├── test_registry.py\n  │   ├── test_config_validation.py\n  │   ├── test_email.py\n  │   ├── test_telegram.py\n  │   └── test_pipeline.py\n  ├── daemon/\n  │   ├── test_daemon.py\n  │   ├── test_butler_migrations.py\n  │   ├── test_graceful_shutdown.py\n  │   ├── test_heartbeat.py\n  │   └── test_daemon_spans.py\n  ├── cli/\n  │   ├── test_cli.py\n  │   └── test_cli_port_conflicts.py\n  ├── telemetry/\n  │   ├── test_telemetry.py\n  │   ├── test_telemetry_spans.py\n  │   └── test_trace_propagation.py\n  ├── adapters/\n  │   ├── test_runtime_adapter.py\n  │   ├── test_codex_adapter.py\n  │   └── test_gemini_adapter.py\n  ├── tools/\n  │   ├── test_tools_general.py\n  │   ├── test_tools_health.py\n  │   ├── test_tools_relationship.py\n  │   ├── test_tools_switchboard.py\n  │   ├── test_tools_contact_info.py\n  │   ├── test_tools_extraction_queue.py\n  │   ├── test_extraction.py\n  │   ├── test_decomposition.py\n  │   ├── test_aggregate_responses.py\n  │   └── test_relationship_types.py\n  ├── config/\n  │   ├── test_config.py\n  │   ├── test_config_env_vars.py\n  │   ├── test_credentials.py\n  │   └── test_migrations.py\n  ├── integration/\n  │   ├── test_integration.py\n  │   ├── test_email_pipeline.py\n  │   ├── test_telegram_pipeline.py\n  │   ├── test_mailbox_module.py\n  │   ├── test_mailbox_integration.py\n  │   ├── test_post_mail.py\n  │   └── test_idempotent_ingestion.py\n  └── features/\n      ├── test_skills.py\n      ├── test_skills_validation.py\n      └── test_vcard.py\n\nEach subdirectory gets an empty __init__.py. Add conftest.py only where directory-scoped fixtures are needed.\n\nNote: butler-specific tool tests (general, health, relationship, switchboard) will later move to butlers/\u003cname\u003e/tests/ per butlers-vyn.3 — keep them in tests/tools/ for now.","acceptance_criteria":"1. All test files moved to appropriate subdirectories\n2. Every subdirectory has __init__.py\n3. pytest still discovers and runs all tests\n4. No import errors from moved files\n5. conftest.py fixtures still accessible from subdirectories\n6. git history preserved via git mv","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T10:48:35.816760313+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:43:54.1513566+08:00","closed_at":"2026-02-10T11:43:54.1513566+08:00","close_reason":"Merged to main. 49 test files reorganized into 10 component subdirectories.","dependencies":[{"issue_id":"butlers-ln3.2","depends_on_id":"butlers-ln3","type":"parent-child","created_at":"2026-02-10T10:48:35.818596372+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-ln3.2","depends_on_id":"butlers-ln3.1","type":"blocks","created_at":"2026-02-10T10:48:46.476263362+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-ln3.3","title":"Add Makefile targets for test subsets","description":"Add convenient Makefile targets for running test subsets. Currently only 'make test' exists (runs everything).\n\nNew targets:\n- make test-unit      — pytest -m unit -v (fast, no Docker)\n- make test-integration — pytest -m integration -v (Docker required)\n- make test           — pytest -v (unchanged, runs all)\n- make test-core      — pytest tests/core/ -v\n- make test-modules   — pytest tests/modules/ -v\n\nAlso update pyproject.toml testpaths if needed to ensure discovery works with the new directory structure.","acceptance_criteria":"1. make test-unit runs only unit-marked tests\n2. make test-integration runs only integration-marked tests\n3. make test still runs the full suite\n4. Directory-scoped targets (test-core, test-modules) work\n5. All targets documented in Makefile comments","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T10:48:39.208063633+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:45:49.849263883+08:00","closed_at":"2026-02-10T11:45:49.849263883+08:00","close_reason":"Merged to main. Added test-unit, test-integration, test-core, test-modules Makefile targets.","dependencies":[{"issue_id":"butlers-ln3.3","depends_on_id":"butlers-ln3","type":"parent-child","created_at":"2026-02-10T10:48:39.209927254+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-ln3.3","depends_on_id":"butlers-ln3.1","type":"blocks","created_at":"2026-02-10T10:48:46.537459452+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-mdw","title":"Update frontend-dashboard OpenSpec change to reference LGTM stack","description":"The openspec/changes/frontend-dashboard/ directory still contains 6 Jaeger references (design.md and specs/dashboard-traces/spec.md). These need to be updated to reference LGTM stack (Grafana Tempo) instead of Jaeger, consistent with all other spec files.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T05:17:53.779617604+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:21:09.004705684+08:00","closed_at":"2026-02-10T05:21:09.004705684+08:00","close_reason":"All Jaeger references in frontend-dashboard specs replaced with LGTM stack"}
{"id":"butlers-r1v","title":"Add autonomous multi-butler signal extraction to Switchboard","description":"The core differentiator over Monica CRM: eliminate manual data entry by having the Switchboard autonomously extract signals from ALL incoming messages (Telegram, email) and forward structured data to the appropriate butler(s) — regardless of which butler the message was primarily routed to.\n\nToday, a message like \"Hey, just had coffee with Sarah — she mentioned she is moving to Berlin next month and her birthday is March 15\" would be classified and routed to one butler. The user would then need to manually log the interaction, add the life event, and record the birthday. Instead, the Switchboard should extract all of this and dispatch it to the relevant butler(s) in parallel with normal routing.\n\nThis is a single-pass extraction pipeline:\n1. EXTRACT: A single CC invocation analyzes every incoming message against all registered butler signal schemas (relationship signals, health signals, finance signals, etc.)\n2. DISPATCH: Group extractions by target_butler and forward as tool calls to the appropriate butler(s)\n3. DEFAULT: If no butler-specific signals are detected, the extraction is a no-op (primary routing handles everything)\n\nThe extraction is confidence-gated: high-confidence extractions are dispatched silently, low-confidence ones are queued for user confirmation.\n\nKey constraint: All intelligence lives in the CC instance (no custom NLP). The Switchboard CC prompt and a unified extraction skill guide the LLM to produce structured output.\n\nComplementary to butlers-hzx (multi-butler decomposition): hzx handles explicit multi-domain requests (user asked for things spanning butlers), this epic handles implicit signal extraction (user did not ask, but the message contains data relevant to other butlers).","acceptance_criteria":"1. Every incoming message is analyzed for relationship signals regardless of primary routing target\n2. High-confidence extractions are autonomously dispatched to Relationship butler\n3. Low-confidence extractions are queued for user confirmation\n4. Extraction covers: contacts, interactions, life events, dates, facts, sentiments\n5. No duplicate data: idempotent ingestion handles repeated mentions gracefully\n6. Extraction runs in parallel with normal message routing (no added latency for primary response)\n7. User can review extraction history and correct mistakes","notes":"This epic is the \"zero manual input\" promise that differentiates Butlers from Monica CRM. Monica requires the user to manually create contacts, log interactions, record dates, etc. Butlers should do this automatically from natural conversation.\n\nDesign pivot: originally a relationship-only second pass with a separate task (butlers-r1v.7) to generalize to health. Now a single-pass multi-butler pipeline from the start — one CC call, one unified skill, one dispatch loop parameterized by ExtractorSchema registrations. butlers-r1v.7 has been closed as subsumed.\n\nRelated epics:\n- butlers-hzx: Multi-butler decomposition (complementary — decomposes explicit requests; this epic handles implicit extraction)\n- butlers-yue: Monica parity features (provides the tools extraction dispatches to)\n- butlers-06j.35: Inter-butler routing (hard blocker — extraction needs route() to work)\n- butlers-06j.36: Module-to-pipeline wiring (hard blocker — needs messages flowing in)\n- butlers-2jx: Mailbox module (could be used for confirmation queue)","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T21:20:15.75471685+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:42:40.851652037+08:00","closed_at":"2026-02-10T01:42:40.851652037+08:00","close_reason":"All children completed: r1v.1 (extractor skill), r1v.2 (extraction pipeline), r1v.3 (confirmation queue), r1v.4 (contact resolution), r1v.5 (idempotent guards), r1v.6 (audit log), r1v.7 (subsumed)","labels":["feature","relationship","switchboard"],"dependencies":[{"issue_id":"butlers-r1v","depends_on_id":"butlers-06j.35","type":"blocks","created_at":"2026-02-09T21:21:39.644153365+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v","depends_on_id":"butlers-06j.36","type":"blocks","created_at":"2026-02-09T21:21:39.717280958+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.1","title":"Create relationship-extractor skill for Switchboard butler","description":"Create a skill at butlers/switchboard/skills/relationship-extractor/ that instructs the Switchboard's CC instance how to extract structured relationship data from any incoming message.\n\nThis skill is the intelligence layer — it teaches the LLM what to look for and how to output structured extractions. The skill should define:\n\n1. Signal taxonomy — what relationship data to look for:\n   - Contact mentions (names, possibly new contacts)\n   - Interactions (met, called, texted, emailed someone)\n   - Life events (job change, moved, graduated, married, had a baby, passed away)\n   - Important dates (birthdays, anniversaries, deadlines)\n   - Facts (preferences, allergies, interests, job titles, companies)\n   - Sentiments/emotions (how the user feels about the interaction)\n   - Gifts (mentions of wanting to give/received something)\n   - Loans (mentions of lending/borrowing money)\n\n2. Output schema — structured JSON format for each extraction type, mapping to Relationship butler tool signatures\n\n3. Confidence scoring rubric:\n   - HIGH: Explicit statements ('Sarah's birthday is March 15')\n   - MEDIUM: Strong implication ('had lunch with Tom' → interaction)\n   - LOW: Ambiguous ('might see them next week')\n\n4. Deduplication hints — how to match extracted names to existing contacts\n\nInclude reference material mapping each extraction type to the Relationship butler tool it dispatches to.","acceptance_criteria":"1. Skill exists at butlers/switchboard/skills/relationship-extractor/SKILL.md\n2. Covers all 8 signal types in the taxonomy\n3. Defines structured JSON output schema per extraction type\n4. Includes confidence scoring rubric with examples\n5. Maps each extraction to a specific Relationship butler tool\n6. References include tool signature mappings","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:20:31.125668679+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:38:36.225511393+08:00","closed_at":"2026-02-09T21:38:36.225511393+08:00","close_reason":"Skill created with all 8 signal types, JSON schemas, confidence rubric, dedup hints, and tool mappings","labels":["relationship","skills","switchboard"],"dependencies":[{"issue_id":"butlers-r1v.1","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:20:31.12766851+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.2","title":"Add multi-butler extraction pipeline to Switchboard message flow","description":"Add a single-pass extraction step to the Switchboard message handling pipeline. Instead of classify_message() picking one primary target and a separate second pass for relationship signals, the pipeline should perform a single extraction pass that can output signals for ANY butler — relationship, health, finance, etc. If no butler-specific signals are detected, the message defaults to the general butler.\n\nThis runs in parallel with message routing to avoid adding latency to the user-facing response.\n\nFlow:\n1. Message arrives (Telegram/Email)\n2. classify_message() determines primary target → route() [existing]\n3. IN PARALLEL: extract_signals() analyzes message for ALL butler-relevant signals in a single CC pass\n4. Each extraction includes a target_butler field — dispatch to appropriate butler(s)\n5. Primary response returned to user immediately\n6. Extraction results logged for audit\n\nKey design change from original: this is NOT a relationship-specific second pass. A single CC invocation with a unified extractor prompt produces structured JSON covering all registered butler signal types. The extractor skill is parameterized by which butler signal schemas are active.","design":"New function: extract_signals(pool, message, dispatch_fn, extractor_schemas: list[ExtractorSchema]) -\u003e list[Extraction]. Internally:\n1. Builds a unified extraction prompt from registered extractor schemas (each butler can register what signals it cares about)\n2. Spawns CC with the unified extraction context\n3. CC returns JSON array of extractions, each with: type, confidence, tool_name, tool_args, target_butler\n4. Filter by confidence \u003e= threshold (configurable, default: HIGH only for auto-dispatch)\n5. Group extractions by target_butler, dispatch each group via route(pool, target_butler, ...)\n6. For below-threshold: queue to confirmation store (see separate task)\n7. Return all extractions for logging\n\nExtractorSchema: { butler_name: str, signal_types: list[str], tool_mappings: dict[str, str] }\n- Relationship butler registers: contacts, interactions, life_events, dates, facts, sentiments\n- Health butler registers: symptoms, medications, measurements\n- Default: if no signals match any registered schema, route to general butler\n\nIntegration point: modify the message intake handler (post butlers-06j.36) to call extract_signals() concurrently with the primary route() using asyncio.gather().\n\nThe extraction skill itself is a single unified skill (not per-butler skills) that receives the active schemas as context.","acceptance_criteria":"1. extract_relationship_signals() implemented and tested\n2. Extraction runs concurrently with primary routing (asyncio)\n3. High-confidence extractions dispatched to Relationship butler\n4. Each dispatched extraction logged in routing_log\n5. Below-threshold extractions returned but not dispatched\n6. Pipeline handles extraction failures gracefully (never blocks primary response)\n7. Tests with mocked CC responses covering multi-signal messages","notes":"Design pivot: originally this was a relationship-only second pass with a separate butlers-r1v.7 to generalize later. Now building multi-butler from the start — simpler architecture (one CC call, one skill, one dispatch loop) and avoids the N-extractor-passes scaling problem.\n\nbutlers-r1v.7 (health signal extraction) is now subsumed by this task — health signals are just another registered ExtractorSchema rather than a separate pipeline extension.","status":"closed","priority":1,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":180,"created_at":"2026-02-09T21:20:42.417166641+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:34:26.942533427+08:00","closed_at":"2026-02-10T01:34:26.942533427+08:00","close_reason":"Extraction pipeline implemented: ExtractorSchema, Extraction, extract_signals(), handle_message_with_extraction(), confidence gating, concurrent execution, 41 tests, pushed to agent/butlers-r1v.2","labels":["feature","relationship","switchboard"],"dependencies":[{"issue_id":"butlers-r1v.2","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:20:42.41898534+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.2","depends_on_id":"butlers-r1v.1","type":"blocks","created_at":"2026-02-09T21:21:39.782003158+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.2","depends_on_id":"butlers-r1v.4","type":"blocks","created_at":"2026-02-09T21:21:39.921592901+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.2","depends_on_id":"butlers-yue.5","type":"blocks","created_at":"2026-02-09T21:21:40.258693189+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.2","depends_on_id":"butlers-yue.6","type":"blocks","created_at":"2026-02-09T21:21:40.338486044+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.3","title":"Add extraction confirmation queue for low-confidence signals","description":"Low-confidence extractions from the relationship-extractor should not be silently dispatched — they need user confirmation. Add a confirmation queue where pending extractions are stored and surfaced to the user for approval or dismissal.\n\nExample: Message says 'might grab dinner with Alex sometime'. Extraction: interaction with 'Alex', confidence MEDIUM. Rather than creating an interaction record, queue it and ask the user next time they interact: 'Did you end up having dinner with Alex?'\n\nThe confirmation queue should integrate with the mailbox module (butlers-2jx) or use a lightweight per-butler pending_actions table if mailbox isn't ready yet.","design":"New table in switchboard DB: extraction_queue (id UUID, source_message TEXT, extraction_type VARCHAR, extraction_data JSONB, confidence VARCHAR, status VARCHAR DEFAULT 'pending', created_at, resolved_at, resolved_by VARCHAR). Statuses: pending, confirmed, dismissed, expired.\n\nTools: extraction_queue_list(status?, limit?) — list pending extractions. extraction_queue_resolve(id, action: confirm|dismiss) — confirm dispatches to Relationship butler, dismiss discards. extraction_queue_stats() — counts by status.\n\nAuto-expiry: extractions older than 7 days auto-expire (configurable).\n\nThe Switchboard's tick handler (called by Heartbeat every 10min) should surface pending extractions count so the CC instance can proactively ask the user about them.","acceptance_criteria":"1. extraction_queue table created via migration\n2. Low/medium confidence extractions stored in queue\n3. Tools: extraction_queue_list, extraction_queue_resolve, extraction_queue_stats\n4. Confirming an extraction dispatches it to Relationship butler\n5. Dismissing discards without dispatch\n6. Auto-expiry after configurable TTL\n7. Tests cover queue lifecycle, confirm dispatch, dismiss, expiry","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:20:53.599554679+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:42:06.361171747+08:00","closed_at":"2026-02-10T01:42:06.361171747+08:00","close_reason":"Confirmation queue implemented: migration, 7 queue tools (add/list/resolve/stats/expire/get/pending_count), 30 tests, pushed to agent/butlers-r1v.3","labels":["database","feature","switchboard"],"dependencies":[{"issue_id":"butlers-r1v.3","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:20:53.601354321+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.3","depends_on_id":"butlers-r1v.2","type":"blocks","created_at":"2026-02-09T21:21:40.039995496+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.4","title":"Add contact name resolution for extracted mentions","description":"When the extraction pipeline identifies a contact mention (e.g., 'had coffee with Sarah'), it needs to resolve 'Sarah' to an existing contact ID in the Relationship butler, or flag it as a potential new contact.\n\nThis is critical for avoiding duplicate contacts and ensuring extracted data lands on the correct record. The resolver should:\n- Query existing contacts by name (fuzzy match)\n- Use context clues from the message to disambiguate (e.g., 'Sarah from work' vs 'my sister Sarah')\n- If no match: suggest creating a new contact (queue for confirmation)\n- If ambiguous: queue for user disambiguation\n- If confident match: use the contact_id in extraction dispatch\n\nThis tool lives on the Relationship butler side (it has the contact data) but is called by the Switchboard during extraction dispatch.","design":"New tool on Relationship butler: contact_resolve(name, context?) -\u003e {contact_id, confidence, candidates[]}.\n\nResolution strategy:\n1. Exact name match (case-insensitive) → HIGH confidence, return contact_id\n2. Partial/fuzzy match (first name only, nickname) → MEDIUM confidence, return candidates\n3. No match → return {contact_id: null, candidates: []}\n\nThe context param (optional freetext) is passed to a lightweight CC call that picks the best candidate from the list using relationship types, recent interactions, and facts as disambiguation signals.\n\nThe extraction pipeline uses this before dispatching: resolve contact → if HIGH, attach contact_id → if MEDIUM/none, queue for confirmation with candidates.","acceptance_criteria":"1. contact_resolve tool implemented on Relationship butler\n2. Exact match returns single result with HIGH confidence\n3. Partial match returns ranked candidates with MEDIUM confidence\n4. No match returns null contact_id\n5. Context parameter improves disambiguation accuracy\n6. Tests cover exact, partial, ambiguous, and no-match scenarios","status":"closed","priority":1,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:21:05.192427918+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:47:59.439830808+08:00","closed_at":"2026-02-09T21:47:59.439830808+08:00","close_reason":"Completed and pushed to agent branches","labels":["feature","relationship","switchboard"],"dependencies":[{"issue_id":"butlers-r1v.4","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:21:05.196140307+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.5","title":"Add idempotent ingestion guards to Relationship butler tools","description":"With autonomous extraction, the same data may be extracted multiple times (e.g., user mentions 'Sarah's birthday is March 15' in two separate messages). The Relationship butler's tools need idempotency guards to prevent duplicate records.\n\nCurrently tools blindly INSERT. They need to detect near-duplicates and either skip or merge.\n\nDedup logic per tool:\n- interaction_log: Skip if identical contact + type + date (within same day)\n- date_add: Skip if contact already has a date with same label + month + day\n- fact_set: Already idempotent (upsert on contact_id + key)\n- note_create: Skip if identical contact + content hash (within 1 hour window)\n- life_event_log: Skip if identical contact + type + date (within same day)\n- gift_add: No dedup (gifts are inherently unique)\n- loan_create: No dedup (loans are inherently unique)","acceptance_criteria":"1. interaction_log skips duplicate contact+type+date combinations\n2. date_add skips duplicate contact+label+month+day combinations\n3. note_create skips duplicate contact+content within 1 hour\n4. life_event_log skips duplicate contact+type+date combinations\n5. Dedup returns success with a 'skipped: duplicate' flag (not an error)\n6. Tests cover dedup for each tool with duplicate inputs","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:21:13.440810897+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:48:45.652283778+08:00","closed_at":"2026-02-10T00:48:45.652283778+08:00","close_reason":"Idempotent guards added to interaction_log, date_add, note_create, life_event_log with skip-duplicate responses","labels":["feature","relationship"],"dependencies":[{"issue_id":"butlers-r1v.5","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:21:13.443575074+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.6","title":"Add extraction audit log for transparency and correction","description":"Users need visibility into what data the extraction pipeline has autonomously created. Add an audit log tracking every extraction-originated write to the Relationship butler, with tools to review and undo.\n\nThis builds trust: users can see what was auto-extracted, verify accuracy, and correct mistakes. Without this, silent autonomous writes would feel opaque and untrustworthy.\n\nThe audit log should be queryable by time range, extraction type, contact, and source message.","design":"New table in switchboard DB: extraction_log (id UUID, source_message_preview TEXT(200), extraction_type VARCHAR, tool_name VARCHAR, tool_args JSONB, target_contact_id UUID, confidence VARCHAR, dispatched_at TIMESTAMPTZ, source_channel VARCHAR).\n\nTools: extraction_log_list(contact_id?, type?, since?, limit?) — review what was extracted. extraction_log_undo(id) — reverse an extraction by calling the appropriate delete/remove tool on the Relationship butler (best-effort).\n\nThe extraction pipeline (task .2) writes to this log on every successful dispatch.","acceptance_criteria":"1. extraction_log table created via migration\n2. Every auto-dispatched extraction logged with full context\n3. Tools: extraction_log_list, extraction_log_undo\n4. List supports filtering by contact, type, time range\n5. Undo reverses the original tool call on Relationship butler\n6. Tests cover logging, listing, filtering, and undo","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:21:21.331401083+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:41:40.585157146+08:00","closed_at":"2026-02-10T01:41:40.585157146+08:00","close_reason":"Extraction audit log implemented: migration, log_extraction/extraction_log_list/extraction_log_undo tools, 19 tests, pushed to agent/butlers-r1v.6","labels":["database","feature","switchboard"],"dependencies":[{"issue_id":"butlers-r1v.6","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:21:21.334876334+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.6","depends_on_id":"butlers-r1v.2","type":"blocks","created_at":"2026-02-09T21:21:40.120605205+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.7","title":"Add health signal extraction for cross-butler forwarding","description":"Extend the extraction pipeline pattern beyond relationships to also capture health signals. A message like 'feeling a headache coming on, took 200mg ibuprofen' should extract a symptom log and medication dose for the Health butler.\n\nThis uses the same extraction pipeline architecture but with a separate health-extractor skill for the Switchboard.\n\nLower priority than relationship extraction — start with relationship signals, generalize the pattern to health later.\n\nNon-goals: Full health-extractor skill creation (separate bead under butlers-bjr).","design":"Generalize extract_relationship_signals() into extract_signals(pool, message, extractors: list[str]) where each extractor is a skill name. The relationship-extractor and health-extractor skills both produce the same JSON schema (type, confidence, tool_name, tool_args, target_butler). The dispatch loop routes based on target_butler field.","acceptance_criteria":"1. Extraction pipeline generalized to support multiple extractor skills\n2. Health signals (symptoms, medications, measurements) extracted and routed\n3. Same confidence gating and confirmation queue applies\n4. Tests cover health extraction with mocked CC responses","status":"closed","priority":3,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:21:30.661284577+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:06:10.608293615+08:00","closed_at":"2026-02-10T00:06:10.608293615+08:00","close_reason":"Subsumed by redesigned butlers-r1v.2 — the extraction pipeline is now multi-butler from the start with ExtractorSchema registration, so health signals are just another registered schema rather than a separate generalization step.","labels":["feature","health","switchboard"],"dependencies":[{"issue_id":"butlers-r1v.7","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:21:30.662924588+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.7","depends_on_id":"butlers-r1v.2","type":"blocks","created_at":"2026-02-09T21:21:40.189755608+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-sle","title":"butlers-06j.10","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T22:15:53.180566517+08:00","updated_at":"2026-02-10T00:49:54.023568508+08:00","closed_at":"2026-02-10T00:49:54.023568508+08:00","close_reason":"Stale/duplicate issue — likely created in error by worker for butlers-06j.10 which is already closed"}
{"id":"butlers-tx5","title":"Replace Jaeger with LGTM stack for observability","description":"Replace the Jaeger all-in-one container with the homelab LGTM stack (Alloy as OTLP gateway, Tempo for traces, Loki for logs, Grafana for dashboards). Butlers already use OpenTelemetry SDK with OTLP export — the change is purely at the infrastructure and documentation level. The OTLP endpoint changes from jaeger:4317 to the Alloy gateway. Local dev can either run the LGTM stack via docker-compose or point at the Tailnet Alloy endpoint.","design":"Remove the jaeger service from docker-compose.yml. For local dev, the OTLP endpoint should point to the Alloy gateway (http://otel.parrot-hen.ts.net:4318 via Tailnet, or an in-cluster Alloy if running in k8s). The OTel SDK setup in Python code does not change — only the OTEL_EXPORTER_OTLP_ENDPOINT env var target changes. Trace visualization moves from Jaeger UI (:16686) to Grafana Tempo (via Grafana Explore). Structured JSON logs with traceId/spanId enable cross-signal correlation in Grafana.","acceptance_criteria":"1. No references to Jaeger remain in codebase\n2. docker-compose.yml uses LGTM-compatible OTLP endpoint\n3. All specs updated to reference Tempo/Grafana instead of Jaeger\n4. README quickstart and architecture diagram updated\n5. Existing OTel instrumentation code unchanged (only env var target changes)","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T04:58:53.927647463+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:59.439115143+08:00","closed_at":"2026-02-10T05:17:59.439115143+08:00","close_reason":"All 6 child tasks completed: Jaeger references replaced with LGTM stack in docker-compose.yml, all v1-mvp-spec OpenSpec files, README.md, and project plan docs. Discovered one remaining area (frontend-dashboard specs) tracked as butlers-mdw.","labels":["infra","telemetry"]}
{"id":"butlers-tx5.1","title":"Replace Jaeger service with LGTM endpoints in docker-compose.yml","description":"Remove the jaeger service definition and replace all OTEL_EXPORTER_OTLP_ENDPOINT=http://jaeger:4317 env vars across the 5 butler services. For local dev, point to the Alloy OTLP gateway at http://otel.parrot-hen.ts.net:4318 (Tailnet). Update header comments to reference Grafana instead of Jaeger UI. Remove port 16686 and 4317 from the compose file since Alloy is external.\n\nAffected lines: service definition (42-49), env vars on switchboard (67), general (88), relationship (109), health (130), heartbeat (151), header comments (6, 20, 22).","acceptance_criteria":"1. No jaeger service in docker-compose.yml\n2. All butler services use OTEL_EXPORTER_OTLP_ENDPOINT pointing to Alloy\n3. Header comments reference Grafana/Tempo, not Jaeger\n4. docker compose config validates without errors","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T04:59:02.895302353+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:36.363504254+08:00","closed_at":"2026-02-10T05:17:36.363504254+08:00","close_reason":"Jaeger references replaced with LGTM stack across all files","labels":["infra","telemetry"],"dependencies":[{"issue_id":"butlers-tx5.1","depends_on_id":"butlers-tx5","type":"parent-child","created_at":"2026-02-10T04:59:02.896713239+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-tx5.2","title":"Update telemetry spec to reference LGTM stack instead of Jaeger","description":"Update openspec/changes/v1-mvp-spec/specs/telemetry/spec.md to replace all Jaeger references with the LGTM stack. The 'Local dev Jaeger setup' requirement section (lines 376-391) should become 'LGTM stack integration' describing Alloy as the OTLP gateway and Tempo/Grafana for trace visualization. Update the infrastructure context at line 11 and 33-36.\n\nKey changes:\n- Replace 'Jaeger all-in-one for local dev visualization' with 'LGTM stack (Alloy gateway, Tempo for traces, Grafana for visualization)'\n- Replace jaegertracing/all-in-one:1.62 image reference with Alloy OTLP endpoint\n- Replace 'Jaeger UI on port 16686' with 'Grafana Explore with Tempo datasource'\n- Update scenarios: 'Jaeger container runs with correct configuration' → 'OTLP gateway accepts telemetry'\n- Update scenarios: 'Butler spans appear in Jaeger' → 'Butler spans appear in Grafana Tempo'","acceptance_criteria":"1. No Jaeger references remain in telemetry spec\n2. LGTM components (Alloy, Tempo, Grafana) correctly described\n3. Scenario GIVEN/WHEN/THEN structure preserved\n4. OTLP endpoint references use Alloy gateway address","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T04:59:10.739030771+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:36.373092244+08:00","closed_at":"2026-02-10T05:17:36.373092244+08:00","close_reason":"Jaeger references replaced with LGTM stack across all files","labels":["docs","telemetry"],"dependencies":[{"issue_id":"butlers-tx5.2","depends_on_id":"butlers-tx5","type":"parent-child","created_at":"2026-02-10T04:59:10.74048578+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-tx5.3","title":"Update cli-and-deployment spec to reference LGTM stack","description":"Update openspec/changes/v1-mvp-spec/specs/cli-and-deployment/spec.md to replace Jaeger references. Affected areas:\n- Line 282: docker-compose service list should remove Jaeger\n- Line 288: Remove jaegertracing/all-in-one:1.62 image requirement\n- Lines 303-304, 319: Dev mode command 'docker compose up -d postgres jaeger' → 'docker compose up -d postgres'\n- Line 327: Remove jaeger from 'all services' list\n- OTLP endpoint in service definitions should reference Alloy gateway","acceptance_criteria":"1. No Jaeger references in cli-and-deployment spec\n2. Dev quickstart command updated\n3. docker-compose service requirements reflect external LGTM stack","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T04:59:15.369410562+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:36.376665767+08:00","closed_at":"2026-02-10T05:17:36.376665767+08:00","close_reason":"Jaeger references replaced with LGTM stack across all files","labels":["docs","telemetry"],"dependencies":[{"issue_id":"butlers-tx5.3","depends_on_id":"butlers-tx5","type":"parent-child","created_at":"2026-02-10T04:59:15.371386416+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-tx5.4","title":"Update switchboard and design specs to reference Tempo instead of Jaeger","description":"Update remaining OpenSpec files that reference Jaeger:\n\n1. openspec/changes/v1-mvp-spec/specs/switchboard/spec.md:\n   - Line 352: Change 'traces in Jaeger' → 'traces in the telemetry backend (Grafana Tempo)'\n   - Line 362: Change 'trace in the telemetry backend (e.g., Jaeger)' → 'trace in the telemetry backend (Grafana Tempo)'\n\n2. openspec/changes/v1-mvp-spec/design.md:\n   - Line 90: Change 'D10: OpenTelemetry with Jaeger for local development' → 'D10: OpenTelemetry with LGTM stack'\n   - Lines 92-94: Update rationale to reference Alloy/Tempo/Grafana instead of Jaeger all-in-one\n\n3. openspec/changes/v1-mvp-spec/proposal.md:\n   - Line 15: Change 'Jaeger integration' → 'LGTM stack integration'\n   - Line 35: Remove Jaeger from docker-compose reference\n   - Line 36: Change 'Jaeger export' → 'OTLP export to LGTM stack'\n   - Line 48: Change 'Jaeger' → 'LGTM stack (Grafana, Tempo, Loki)'\n\n4. openspec/changes/v1-mvp-spec/tasks.md:\n   - Line 162: Remove jaeger from docker-compose service list\n   - Line 163: Update dev quickstart command","acceptance_criteria":"1. No Jaeger references remain in any OpenSpec files\n2. All references consistently use LGTM/Tempo/Grafana terminology","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T04:59:22.401925876+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:36.380385396+08:00","closed_at":"2026-02-10T05:17:36.380385396+08:00","close_reason":"Jaeger references replaced with LGTM stack across all files","labels":["docs","telemetry"],"dependencies":[{"issue_id":"butlers-tx5.4","depends_on_id":"butlers-tx5","type":"parent-child","created_at":"2026-02-10T04:59:22.408824181+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-tx5.5","title":"Update README.md to reference LGTM stack instead of Jaeger","description":"Update README.md to replace all Jaeger references:\n- Line 162: Mermaid diagram — change 'Jaeger :16686' → 'Grafana (Tempo/Loki)'\n- Line 165: Change 'OTLP gRPC :4317 → Jaeger' → 'OTLP HTTP :4318 → Alloy (LGTM)'\n- Lines 203-204: Dev quickstart — change 'docker compose up -d postgres jaeger' → 'docker compose up -d postgres'\n- Line 221: Change 'Jaeger tracing UI at http://localhost:16686' → reference to Grafana Tempo\n- Lines 254-255: Port table — remove Jaeger UI (16686) and Jaeger OTLP (4317) rows, add note about external Alloy OTLP endpoint\n- Line 294: Update OTEL_EXPORTER_OTLP_ENDPOINT documentation to reference Alloy","acceptance_criteria":"1. No Jaeger references in README\n2. Architecture diagram shows LGTM stack\n3. Quickstart commands work without jaeger service\n4. Port table accurate","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T04:59:27.760091944+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:36.384325763+08:00","closed_at":"2026-02-10T05:17:36.384325763+08:00","close_reason":"Jaeger references replaced with LGTM stack across all files","labels":["docs","telemetry"],"dependencies":[{"issue_id":"butlers-tx5.5","depends_on_id":"butlers-tx5","type":"parent-child","created_at":"2026-02-10T04:59:27.762132029+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-tx5.6","title":"Update PROJECT_PLAN.md and memory files to reference LGTM stack","description":"Update remaining project docs that reference Jaeger:\n\n1. PROJECT_PLAN.md (~16 mentions):\n   - Docker-compose examples: replace jaeger service definition and OTLP endpoint references\n   - Line 1202: Update companion services description\n   - Line 1347: Update dev mode command\n   - Lines 1365, 1395: Update milestone descriptions\n\n2. .genai/memory.md:\n   - Line 37: Change 'OTel + Jaeger for tracing' → 'OTel + LGTM stack (Alloy/Tempo/Grafana) for observability'\n\n3. FRONTEND_PROJECT_PLAN.md (2 mentions):\n   - Line 324, 1019: Update trace viewer references (these mention replacing Jaeger with inline viewer — update context to LGTM/Tempo)","acceptance_criteria":"1. No Jaeger references in PROJECT_PLAN.md\n2. No Jaeger references in .genai/memory.md\n3. FRONTEND_PROJECT_PLAN.md updated","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T04:59:33.573059024+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:36.388669823+08:00","closed_at":"2026-02-10T05:17:36.388669823+08:00","close_reason":"Jaeger references replaced with LGTM stack across all files","labels":["docs","telemetry"],"dependencies":[{"issue_id":"butlers-tx5.6","depends_on_id":"butlers-tx5","type":"parent-child","created_at":"2026-02-10T04:59:33.574652055+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-vyn","title":"Co-locate butler-specific artifacts under butlers/\u003cname\u003e/","description":"Butler-specific code, migrations, and tests are scattered across 5 separate directory trees (butlers/, src/butlers/tools/, alembic/versions/, tests/, openspec/). Moving all butler-specific artifacts under a single butlers/\u003cname\u003e/ folder makes adding new butlers a single-directory operation and improves modularity.\n\nCurrent layout (per butler):\n- butlers/\u003cname\u003e/ — config, manifesto, skills\n- src/butlers/tools/\u003cname\u003e.py — MCP tools\n- alembic/versions/\u003cname\u003e/ — DB migrations\n- tests/test_tools_\u003cname\u003e.py — tests\n\nTarget layout:\n  butlers/\u003cname\u003e/\n  ├── butler.toml, MANIFESTO.md, CLAUDE.md, AGENTS.md\n  ├── skills/\n  ├── tools.py          ← from src/butlers/tools/\u003cname\u003e.py\n  ├── migrations/       ← from alembic/versions/\u003cname\u003e/\n  └── tests/            ← from tests/test_tools_\u003cname\u003e.py\n\nShared code stays put: src/butlers/core/, src/butlers/modules/, alembic/versions/core/.","design":"Phase approach:\n1. Move tools: src/butlers/tools/\u003cname\u003e.py → butlers/\u003cname\u003e/tools.py; update imports in modules/registry\n2. Move migrations: alembic/versions/\u003cname\u003e/ → butlers/\u003cname\u003e/migrations/; update migrations.py to discover chains from butler dirs\n3. Move tests: tests/test_tools_\u003cname\u003e.py → butlers/\u003cname\u003e/tests/; update pytest discovery (conftest or pyproject.toml testpaths)\n4. Update framework wiring: config.py, migrations.py, daemon.py, cli.py to look for artifacts in butler dirs\n5. Keep shared tools (extraction.py, extraction_queue.py) in src/butlers/tools/ since they are cross-butler\n\nNote: openspec specs are change-scoped, not runtime artifacts — leave them where they are.","acceptance_criteria":"1. Each butler's tools, migrations, and tests live under butlers/\u003cname\u003e/\n2. Adding a new butler only requires creating one directory\n3. All existing tests pass\n4. Alembic migration discovery still works (versions detected from butler dirs)\n5. CLI butler discovery unchanged (still scans butlers/ dir)\n6. Import paths and tool registration updated\n7. Shared infrastructure (core/, modules/, core migrations) remains in src/butlers/","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T05:25:01.145939548+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:31:36.359355559+08:00","closed_at":"2026-02-10T11:31:36.359355559+08:00","close_reason":"All children merged: tools (vyn.1), migrations (vyn.2), tests (vyn.3), framework wiring (vyn.4). Butler artifacts fully co-located under butlers/\u003cname\u003e/.","labels":["architecture","refactoring"]}
{"id":"butlers-vyn.1","title":"Move butler-specific tools into butlers/\u003cname\u003e/tools.py","description":"Move each butler's tool file from src/butlers/tools/\u003cname\u003e.py to butlers/\u003cname\u003e/tools.py. Affected butlers: general, health, heartbeat, relationship, switchboard.\n\nShared/cross-butler tools (extraction.py, extraction_queue.py) stay in src/butlers/tools/.\n\nUpdate all import paths in:\n- src/butlers/modules/registry.py (or wherever tools are registered)\n- src/butlers/daemon.py (if it imports tools directly)\n- Any module that imports from butlers.tools.\u003cname\u003e\n\nThe butler config dirs need to be importable Python packages — either add them to sys.path at startup or use importlib to load tools.py dynamically from the config directory path.","design":"Option A (recommended): Dynamic import via importlib.import_module or importlib.util.spec_from_file_location — load tools.py from the butler config directory. No need to make butlers/ a Python package.\nOption B: Add butlers/ to sys.path and make each \u003cname\u003e/ an importable package. Risks namespace collisions.","acceptance_criteria":"1. src/butlers/tools/ only contains shared tools (extraction*.py, __init__.py)\n2. Each butler's tools.py lives in butlers/\u003cname\u003e/tools.py\n3. Tool registration still works at daemon startup\n4. No import errors","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T05:25:11.924166153+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:11:50.474343441+08:00","closed_at":"2026-02-10T11:11:50.474343441+08:00","close_reason":"Merged to main. Tools moved to butlers/\u003cname\u003e/tools.py with dynamic importlib loader.","labels":["refactoring"],"dependencies":[{"issue_id":"butlers-vyn.1","depends_on_id":"butlers-vyn","type":"parent-child","created_at":"2026-02-10T05:25:11.925723205+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-vyn.2","title":"Move butler-specific migrations into butlers/\u003cname\u003e/migrations/","description":"Move each butler's Alembic migration chain from alembic/versions/\u003cname\u003e/ to butlers/\u003cname\u003e/migrations/. Affected butlers: general, health, relationship, switchboard.\n\nCore migrations (alembic/versions/core/) and shared module migrations (alembic/versions/mailbox/) stay in alembic/versions/.\n\nUpdate migrations.py:\n- ALEMBIC_DIR constant and chain discovery logic\n- has_butler_chain() — look in butlers/\u003cname\u003e/migrations/ instead of alembic/versions/\u003cname\u003e/\n- _build_alembic_config() — version_locations should include butler-specific paths from butlers/ dir\n- VERSION_CHAINS — derive dynamically from butler dirs that have a migrations/ folder instead of hardcoding\n\nAlembic branch labels in existing migration files may reference the old chain names — verify these still resolve correctly.","acceptance_criteria":"1. alembic/versions/ only contains core/ and shared module chains (mailbox/)\n2. Each butler's migrations live in butlers/\u003cname\u003e/migrations/\n3. alembic upgrade heads still works\n4. has_butler_chain() discovers chains from butler dirs\n5. New butlers just add a migrations/ folder to their config dir","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T05:25:18.693120206+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T10:57:09.324708179+08:00","closed_at":"2026-02-10T10:57:09.324708179+08:00","close_reason":"Merged to main. Migrations moved to butlers/\u003cname\u003e/migrations/ with dynamic discovery.","labels":["database","refactoring"],"dependencies":[{"issue_id":"butlers-vyn.2","depends_on_id":"butlers-vyn","type":"parent-child","created_at":"2026-02-10T05:25:18.694805931+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-vyn.3","title":"Move butler-specific tests into butlers/\u003cname\u003e/tests/","description":"Move each butler's test file from tests/test_tools_\u003cname\u003e.py to butlers/\u003cname\u003e/tests/test_tools.py. Affected:\n- tests/test_tools_general.py → butlers/general/tests/test_tools.py\n- tests/test_tools_health.py → butlers/health/tests/test_tools.py\n- tests/test_tools_relationship.py → butlers/relationship/tests/test_tools.py\n- tests/test_tools_switchboard.py → butlers/switchboard/tests/test_tools.py\n- tests/test_tools_contact_info.py → butlers/relationship/tests/test_contact_info.py (relationship-specific)\n\nShared/cross-cutting tests stay in tests/.\n\nUpdate pyproject.toml testpaths to include butlers/ directories. Ensure conftest.py fixtures are accessible (may need a conftest.py in butlers/ or use pytest plugins).","acceptance_criteria":"1. pytest discovers and runs tests from both tests/ and butlers/*/tests/\n2. All existing tests still pass\n3. conftest.py fixtures accessible from butler test directories\n4. CI pipeline (if any) updated","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T05:25:23.572092611+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:24:21.59205289+08:00","closed_at":"2026-02-10T11:24:21.59205289+08:00","close_reason":"Merged to main. Tests moved to butlers/\u003cname\u003e/tests/ with root conftest.py and importlib discovery.","labels":["refactoring","testing"],"dependencies":[{"issue_id":"butlers-vyn.3","depends_on_id":"butlers-vyn","type":"parent-child","created_at":"2026-02-10T05:25:23.574012359+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-vyn.4","title":"Update framework wiring for butler-local artifact discovery","description":"Update the core framework code to discover tools, migrations, and tests from butler config directories instead of hardcoded paths.\n\nFiles to update:\n- src/butlers/migrations.py: Remove hardcoded VERSION_CHAINS list. Discover butler chains by scanning butlers/*/migrations/. Update has_butler_chain() and _build_alembic_config().\n- src/butlers/daemon.py: Load butler tools dynamically from butlers/\u003cname\u003e/tools.py instead of importing from butlers.tools.\u003cname\u003e.\n- src/butlers/cli.py: No changes expected (already discovers from butlers/ dir).\n- src/butlers/config.py: Optionally add config_dir path to ButlerConfig so daemon knows where to find tools.py and migrations/.\n\nThis task is the glue that makes the moved artifacts discoverable by the framework.","acceptance_criteria":"1. No hardcoded butler names in framework code (VERSION_CHAINS list removed)\n2. Framework dynamically discovers butler artifacts from butlers/\u003cname\u003e/\n3. Adding a new butler requires zero changes to framework code\n4. All tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T05:25:31.506029639+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:31:27.709455741+08:00","closed_at":"2026-02-10T11:31:27.709455741+08:00","close_reason":"Merged to main. Removed last hardcoded BUTLER_NAMES tuple, all discovery now filesystem-based.","labels":["architecture","refactoring"],"dependencies":[{"issue_id":"butlers-vyn.4","depends_on_id":"butlers-vyn","type":"parent-child","created_at":"2026-02-10T05:25:31.50754894+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-vyn.4","depends_on_id":"butlers-vyn.1","type":"blocks","created_at":"2026-02-10T05:25:35.119681194+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-vyn.4","depends_on_id":"butlers-vyn.2","type":"blocks","created_at":"2026-02-10T05:25:35.189762604+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-vyn.4","depends_on_id":"butlers-vyn.3","type":"blocks","created_at":"2026-02-10T05:25:35.255033924+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-vyn.5","title":"Move shared module migrations to module-local paths","description":"Mailbox migrations currently live in alembic/versions/mailbox/ as a '_SHARED_CHAIN', but mailbox is a regular opt-in Module subclass. This creates an inconsistent precedent — future modules with migrations wouldn't have a clear home. Move mailbox migrations to src/butlers/modules/mailbox/migrations/ (or similar module-local path) and update _SHARED_CHAINS, _resolve_chain_dir(), and alembic/env.py discovery to scan module dirs the same way butler chains are discovered. After this, alembic/versions/ should only contain core/.","notes":"Spawned from verifying butlers-vyn.2 — the asymmetry between butler-local and module-local migration paths was flagged as inconsistent.","status":"open","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:42:41.418977703+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:42:41.418977703+08:00","dependencies":[{"issue_id":"butlers-vyn.5","depends_on_id":"butlers-vyn","type":"parent-child","created_at":"2026-02-10T11:42:41.420525727+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue","title":"Reach Monica CRM basic parity for Relationship butler","description":"Gap analysis against Monica CRM (monicahq/monica) reveals the Relationship butler has strong core CRM coverage (contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, feed) but is missing several features needed for basic parity.\n\nHigh-priority gaps:\n- Structured contact info (email, phone, social handles) — currently stuffed into JSONB details\n- Addresses (structured, multi-per-contact) — completely missing\n- Relationship type taxonomy (love/family/friend/work groups) — currently freetext\n\nMedium-priority gaps:\n- Contact-scoped tasks/to-dos\n- Richer interactions (direction, duration, call reasons)\n- Life events (milestones, categorized)\n- Document/photo attachments per contact\n- vCard import/export for data portability\n- Stay-in-touch cadence per contact\n\nOut of scope for basic parity (future):\n- Pets, mood tracking, goals/streaks, journal, companies, occupation history\n\nExisting alignment work in butlers-06j.38 covers schema mismatches between implementation and spec. This epic covers net-new features not yet specified.","acceptance_criteria":"1. All high-priority gaps addressed (contact_info, addresses, relationship types)\n2. At least 3 of 6 medium-priority gaps addressed\n3. Each feature has migration, tools, and tests\n4. Activity feed integration for all new features","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T21:09:38.753299946+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:21:09.035088198+08:00","closed_at":"2026-02-10T01:21:09.035088198+08:00","close_reason":"All 8 children completed: contact_info, addresses, relationship taxonomy, contact tasks, enrich interactions, life events, stay-in-touch, vCard","labels":["feature","relationship"]}
{"id":"butlers-yue.1","title":"Add contact_info table for structured contact details","description":"Replace the freeform JSONB details blob with a dedicated contact_info table storing typed contact information (email, phone, telegram, linkedin, twitter, website, etc.).\n\nMonica stores each piece of contact information as a row with a type and value, allowing multiple emails, phones, etc. per contact. Our spec already defines this table but it was not implemented.\n\nUser problem: Contact details are buried in an unstructured JSONB blob, making it impossible to search by email or phone number across all contacts.\n\nNon-goals: Social media API integration, contact info verification.","design":"New table: contact_info (id, contact_id FK, type VARCHAR, value TEXT, label VARCHAR, is_primary BOOLEAN, created_at). Types: email, phone, telegram, linkedin, twitter, website, other. Tools: contact_info_add, contact_info_list, contact_info_remove, contact_search_by_info (cross-contact lookup). Index on (type, value) for reverse lookups.","acceptance_criteria":"1. contact_info table created via Alembic migration\n2. Tools: contact_info_add, contact_info_list, contact_info_remove, contact_search_by_info\n3. Multiple entries per contact supported (e.g., 2 emails, 1 phone)\n4. Reverse lookup: find contact by email/phone across all contacts\n5. Activity feed logged for add/remove operations\n6. Tests cover CRUD, multi-value, reverse lookup, and feed integration","status":"closed","priority":1,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:09:50.487030056+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:32:45.693106549+08:00","closed_at":"2026-02-09T21:32:45.693106549+08:00","close_reason":"Implementation complete, branch pushed","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.1","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:09:50.488799548+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.2","title":"Add addresses table for structured contact addresses","description":"Add a dedicated addresses table for structured multi-address support per contact. Monica stores addresses with street, city, province, postal code, country, and a type label (home, work, etc.).\n\nCurrently the Relationship butler has no address support at all. This is a core CRM feature needed for:\n- Knowing where contacts live/work\n- Planning visits or sending physical mail/gifts\n- Geographic organization of contacts\n\nNon-goals: Geocoding, map integration, weather lookup.","design":"New table: addresses (id, contact_id FK, label VARCHAR, line_1 TEXT, line_2 TEXT, city VARCHAR, province VARCHAR, postal_code VARCHAR, country VARCHAR(2) ISO 3166-1, is_current BOOLEAN, created_at, updated_at). Tools: address_add, address_list, address_update, address_remove. Default labels: Home, Work, Other.","acceptance_criteria":"1. addresses table created via Alembic migration\n2. Tools: address_add, address_list, address_update, address_remove\n3. Multiple addresses per contact with labels\n4. is_current flag for primary address\n5. Activity feed logged for add/update/remove\n6. Tests cover CRUD, multi-address, current flag toggle","status":"closed","priority":1,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:09:56.206785412+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:31:05.783456538+08:00","closed_at":"2026-02-09T21:31:05.783456538+08:00","close_reason":"Implemented addresses table, CRUD tools (address_add/list/update/remove), activity feed logging, and 20 tests. All 469 tests pass.","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.2","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:09:56.208750073+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.3","title":"Add relationship type taxonomy with group categories","description":"Replace freetext relationship types with a structured taxonomy organized into groups, matching Monica's approach. Monica defines 4 relationship groups (Love, Family, Friend, Work) each containing typed relationships with forward/reverse labels (e.g., parent/child, mentor/protege).\n\nCurrently our relationships table has a freetext type column with no validation or taxonomy. This makes it impossible to query 'show me all family relationships' or enforce bidirectional label consistency.\n\nNon-goals: User-customizable relationship types (future enhancement).","design":"New table: relationship_types (id, group VARCHAR, forward_label VARCHAR, reverse_label VARCHAR). Seed data: Love (spouse, partner, ex), Family (parent/child, sibling, grandparent/grandchild, uncle-aunt/nephew-niece, cousin), Friend (friend, best friend), Work (colleague, boss/subordinate, mentor/protege). Update relationships table: replace type VARCHAR with relationship_type_id FK. Tools: relationship_types_list (returns all types grouped). Update relationship_add to accept type_id and auto-set reverse label.","acceptance_criteria":"1. relationship_types table created and seeded via migration\n2. relationships.type replaced with relationship_type_id FK\n3. relationship_add auto-creates reverse with correct reverse_label\n4. relationship_types_list returns grouped taxonomy\n5. Backward-compatible: existing freetext types migrated to closest match or 'custom'\n6. Tests cover typed relationships, reverse labels, and listing by group","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:10:05.71679101+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:33:20.284506911+08:00","closed_at":"2026-02-10T00:33:20.284506911+08:00","close_reason":"Relationship type taxonomy added with 4 groups (Love, Family, Friend, Work), seeded types, FK migration, and auto-reverse labels","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.3","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:10:05.718369962+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.4","title":"Add contact-scoped tasks and to-dos","description":"Add a tasks/to-dos feature scoped to individual contacts. Monica allows creating tasks tied to contacts (e.g., 'Send thank-you note to Alice', 'Follow up on job referral with Bob').\n\nThis is distinct from reminders (which are time-triggered notifications) — tasks are action items that can be completed independently of time. They provide a lightweight way to track follow-ups without creating a full reminder.\n\nNon-goals: Task priorities, due dates (keep it simple — title + completed status).","design":"New table: tasks (id, contact_id FK, title VARCHAR, description TEXT, completed BOOLEAN DEFAULT false, completed_at TIMESTAMPTZ, created_at). Tools: task_create(contact_id, title, description?), task_list(contact_id?, include_completed?), task_complete(task_id), task_delete(task_id). Feed integration on create/complete.","acceptance_criteria":"1. tasks table created via Alembic migration\n2. Tools: task_create, task_list, task_complete, task_delete\n3. task_list supports filtering by contact and completion status\n4. Activity feed logged for create/complete\n5. Tests cover CRUD, completion, filtering, feed integration","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T21:10:11.768988435+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:30:28.333615709+08:00","closed_at":"2026-02-10T00:30:28.333615709+08:00","close_reason":"Contact-scoped tasks added with CRUD tools, feed integration, and tests","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.4","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:10:11.771209049+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.5","title":"Enrich interactions with direction, duration, and type","description":"Enhance the interactions table and tools to capture richer context matching Monica's call/activity model. Currently interactions only store type, summary, and occurred_at. Monica tracks who initiated the interaction, how long it lasted, and categorizes by reason.\n\nThis matters for the 'reconnect-planner' skill and relationship maintenance — knowing who reached out last and how substantial the interaction was helps prioritize outreach.\n\nNon-goals: Conversation message threads, multi-contact activities.","design":"Alter interactions table: add direction VARCHAR(10) (incoming/outgoing/mutual), duration_minutes INTEGER, metadata JSONB. Update interaction_log tool to accept optional direction, duration_minutes, metadata params. Update interaction_list to support filtering by direction and type. No breaking changes — new columns are nullable.","acceptance_criteria":"1. Migration adds direction, duration_minutes, metadata columns\n2. interaction_log accepts direction, duration_minutes, metadata\n3. interaction_list supports direction and type filters\n4. Existing interactions remain valid (new columns nullable)\n5. Activity feed entries include direction when present\n6. Tests cover new fields, filtering, backward compatibility","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T21:10:18.69167189+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:39:35.168032844+08:00","closed_at":"2026-02-10T00:39:35.168032844+08:00","close_reason":"Interactions enriched with direction, duration_minutes, metadata; filters and feed updated","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.5","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:10:18.693012823+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.6","title":"Add life events tracking with categories","description":"Add life event tracking to record significant milestones for contacts. Monica categorizes life events into groups (Work, Social, Transportation, Sport) with types within each. This provides a richer timeline than the activity feed alone.\n\nExamples: 'Alice got promoted', 'Bob moved to London', 'Charlie got married'. Life events differ from interactions (which are between you and the contact) — life events are things that happened to the contact.\n\nNon-goals: Cost tracking, distance/travel metrics, multi-participant events.","design":"New tables: life_event_categories (id, name), life_event_types (id, category_id FK, name), life_events (id, contact_id FK, life_event_type_id FK, summary TEXT, description TEXT, happened_at DATE, created_at). Seed categories: Career (new job, promotion, quit, retired, graduated), Personal (married, divorced, had a child, moved, passed away), Social (met for first time, reconnected). Tools: life_event_log(contact_id, type, summary, description?, happened_at?), life_event_list(contact_id?, type?, limit?), life_event_types_list(). Feed integration.","acceptance_criteria":"1. Tables created and seeded via migration\n2. Tools: life_event_log, life_event_list, life_event_types_list\n3. Events linked to contacts and categorized types\n4. Activity feed integration\n5. Tests cover logging, listing, type filtering, feed","status":"closed","priority":3,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:10:25.942982516+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:18:39.435375222+08:00","closed_at":"2026-02-10T01:18:39.435375222+08:00","close_reason":"Implemented life events tracking with categories, types, and activity feed integration. Created migration 002_life_events_table.py with 3 new tables (life_event_categories, life_event_types, life_events) and seeded data. Added 3 new tools (life_event_types_list, life_event_log, life_event_list) with flexible filtering. All 67 tests passing including 11 new life event tests.","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.6","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:10:25.945147656+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.7","title":"Add stay-in-touch cadence per contact","description":"Add a per-contact 'stay in touch' frequency setting that automatically flags contacts who haven't been interacted with within their cadence window. Monica's v4 had this as a core feature (stay_in_touch_frequency + trigger_date).\n\nThis is the data backbone for the planned reconnect-planner skill and the spec's relationship-maintenance scheduled task. Without it, there's no way to know which contacts are 'overdue' for interaction.\n\nNon-goals: Auto-sending messages, notification delivery (that's the scheduled task's job).","design":"Alter contacts table: add stay_in_touch_days INTEGER (null = no cadence). New tool: stay_in_touch_set(contact_id, frequency_days) — set or clear cadence. New tool: contacts_overdue() — returns contacts where last interaction is older than their cadence, ordered by staleness. Uses: SELECT c.*, MAX(i.occurred_at) as last_interaction FROM contacts c LEFT JOIN interactions i ON c.id = i.contact_id WHERE c.stay_in_touch_days IS NOT NULL GROUP BY c.id HAVING MAX(i.occurred_at) \u003c NOW() - (c.stay_in_touch_days || ' days')::interval OR MAX(i.occurred_at) IS NULL.","acceptance_criteria":"1. Migration adds stay_in_touch_days column to contacts\n2. Tools: stay_in_touch_set, contacts_overdue\n3. contacts_overdue correctly computes staleness from last interaction\n4. Contacts with no interactions but a cadence show as overdue\n5. Clearing cadence (null) removes contact from overdue list\n6. Tests cover set, clear, overdue calculation, no-interaction edge case","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T21:10:35.708082334+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:39:02.017848403+08:00","closed_at":"2026-02-10T00:39:02.017848403+08:00","close_reason":"Stay-in-touch cadence added with overdue detection and tests","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.7","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:10:35.709958428+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.8","title":"Add vCard import/export for contact portability","description":"Add vCard (.vcf) import and export to enable data portability with other CRM/contact tools. Monica supports vCard import/export and CardDAV sync. For basic parity, we need single-file import/export (not live sync).\n\nThis matters for onboarding (import existing contacts from phone/Google/Apple) and backup/migration scenarios.\n\nNon-goals: CardDAV live sync, CSV import, photo import.","design":"Tools: contact_export_vcard(contact_id?) — export one or all contacts as vCard 3.0. Returns VCF string. contact_import_vcard(vcf_content) — parse VCF and create contacts with name, contact_info, addresses, important_dates where available. Use python-vobject or vcard library. Map: FN→name, TEL→contact_info(phone), EMAIL→contact_info(email), ADR→addresses, BDAY→important_dates(birthday), ORG→quick_facts(company), TITLE→quick_facts(job_title).","acceptance_criteria":"1. Tools: contact_export_vcard, contact_import_vcard\n2. Export produces valid vCard 3.0 format\n3. Import parses standard vCard fields into appropriate tables\n4. Round-trip: export then import produces equivalent contact data\n5. Import handles missing/partial fields gracefully\n6. Tests cover export, import, round-trip, partial vCard","status":"closed","priority":3,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:10:43.11557128+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:17:29.919570796+08:00","closed_at":"2026-02-10T01:17:29.919570796+08:00","close_reason":"Implemented vCard import/export with 20 passing tests. Tools: contact_export_vcard (single/all contacts), contact_import_vcard (parses vCard 3.0). Maps FN→name, TEL→phones, EMAIL→emails, ADR→addresses, BDAY→important_dates, ORG→company, TITLE→job_title. Round-trip verified. All acceptance criteria met.","labels":["feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.8","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:10:43.120643622+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-yue.8","depends_on_id":"butlers-yue.1","type":"blocks","created_at":"2026-02-09T21:10:48.970605708+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-yue.8","depends_on_id":"butlers-yue.2","type":"blocks","created_at":"2026-02-09T21:10:49.044513329+08:00","created_by":"Tzeusy"}]}
