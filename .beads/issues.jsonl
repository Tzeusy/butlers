{"id":"butlers-06j","title":"Feature verification: align implementation with v1 MVP specs","description":"Systematic verification of all 15 OpenSpec v1-mvp-spec specifications against current implementation. Each child bead targets a specific gap (missing, divergent, or erroneous) found during spec-vs-code analysis. Gaps were identified by reading every ADDED requirement in each spec and checking whether the code satisfies it.","acceptance_criteria":"1. Every spec requirement has been reviewed\n2. All missing functionality is implemented or explicitly deferred\n3. All divergent implementations are aligned with spec or spec is updated\n4. All erroneous code is fixed\n5. Tests pass for each fixed area","notes":"Specs live in openspec/changes/v1-mvp-spec/specs/. Implementation is in src/butlers/. Gap analysis covered: butler-daemon, state-store, task-scheduler, cc-spawner, session-log, module-system, butler-skills, butler-credentials, telemetry, cli-and-deployment, butler-general, butler-relationship, butler-health, heartbeat, switchboard.","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T20:48:32.884306817+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:09:51.649830337+08:00","closed_at":"2026-02-10T01:09:51.649830337+08:00","close_reason":"All children completed"}
{"id":"butlers-06j.1","title":"Align MCP tool names with butler-daemon spec","description":"All core MCP tool names diverge from the spec. Spec names: state_get, state_set, state_delete, state_list, schedule_list, schedule_create, schedule_update, schedule_delete, sessions_list, sessions_get, tick. Implementation names: get_state, set_state, delete_state, list_state, list_schedules, create_schedule, update_schedule, delete_schedule, list_sessions, get_session, tick_now. Every tool needs renaming.","acceptance_criteria":"1. All core MCP tools use spec-defined names\n2. Tests updated to use new names\n3. Any callers (switchboard, heartbeat) updated","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:03.049431193+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:17:50.281080709+08:00","closed_at":"2026-02-09T21:17:50.281080709+08:00","close_reason":"Closed","labels":["core","daemon"],"dependencies":[{"issue_id":"butlers-06j.1","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:03.05146433+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.10","title":"Fix source value for runtime-created tasks","description":"The spec says runtime-created tasks SHALL have source='db'. The implementation uses source='runtime'. The TOML sync checks source='toml' which still works, but the value diverges from spec.","acceptance_criteria":"1. schedule_create uses source='db' instead of source='runtime'\n2. schedule_delete updated if it checks source value","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:49:23.996053078+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:15:48.624267303+08:00","closed_at":"2026-02-09T22:15:48.624267303+08:00","close_reason":"Fixed source value to 'db' per spec","labels":["core","scheduler"],"dependencies":[{"issue_id":"butlers-06j.10","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:23.99767741+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.11","title":"Fix trigger_source format for scheduled tasks","description":"The scheduler calls dispatch_fn with trigger_source='schedule'. The spec expects trigger_source='schedule:\u003ctask-name\u003e' (e.g., 'schedule:daily-review') to identify which task triggered the session.","acceptance_criteria":"1. tick() passes trigger_source='schedule:\u003ctask-name\u003e' to dispatch\n2. Session log records the full trigger source","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:49:25.439541673+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:29:44.254241369+08:00","closed_at":"2026-02-09T22:29:44.254241369+08:00","close_reason":"Already fixed in butlers-06j.15 — tick() now passes schedule:\u003ctask-name\u003e format","labels":["core","scheduler","sessions"],"dependencies":[{"issue_id":"butlers-06j.11","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:25.440988901+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.11","depends_on_id":"butlers-06j.15","type":"blocks","created_at":"2026-02-09T20:51:25.307218257+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.12","title":"Fix non-atomic schedule_update for cron change","description":"When cron is changed in schedule_update, the code does two separate UPDATE statements — one for fields and one for next_run_at. This is not atomic and could leave the row inconsistent. Should be a single UPDATE.","acceptance_criteria":"1. schedule_update uses a single UPDATE statement for all field changes including next_run_at","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:26.911472802+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:24:48.664048996+08:00","closed_at":"2026-02-09T22:24:48.664048996+08:00","close_reason":"Fixed non-atomic schedule_update - now uses single UPDATE statement for all field changes including next_run_at when cron changes. Added atomicity tests. All 461 tests pass.","labels":["core","scheduler"],"dependencies":[{"issue_id":"butlers-06j.12","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:26.913071887+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.13","title":"Add max_turns and cwd to CC spawner","description":"The spec requires max_turns defaulting to 20 (configurable per trigger call) and options.cwd set to the butler's config directory path. Neither exists in the implementation. ClaudeCodeOptions has no max_turns, and cwd is not set.","acceptance_criteria":"1. CCSpawner passes max_turns=20 as default\n2. max_turns is configurable per trigger call\n3. cwd is set to butler's config directory","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:38.041460551+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:24:19.697862142+08:00","closed_at":"2026-02-09T22:24:19.697862142+08:00","close_reason":"Added max_turns and cwd to CC spawner","labels":["core","spawner"],"dependencies":[{"issue_id":"butlers-06j.13","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:38.043508875+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.14","title":"Add success and error columns to sessions table","description":"The spec schema has success BOOLEAN and error TEXT columns on the sessions table. Neither exists. Error messages are conflated with the result field, making it impossible to distinguish failed from successful sessions. session_complete does not accept success/error params. SpawnerResult lacks success field (uses result vs spec's output).","acceptance_criteria":"1. Alembic migration adds success BOOLEAN and error TEXT columns\n2. session_complete accepts and stores success and error\n3. SpawnerResult has output (not result) and success fields matching spec\n4. Successful sessions have success=true, error=NULL\n5. Failed sessions have success=false, error=\u003cmessage\u003e, result=NULL","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:39.953679406+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:23:19.746591958+08:00","closed_at":"2026-02-09T21:23:19.746591958+08:00","close_reason":"Implementation complete, branch pushed","labels":["core","migrations","sessions"],"dependencies":[{"issue_id":"butlers-06j.14","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:39.955132655+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.15","title":"Fix trigger_source allowed values to match spec","description":"The spec defines trigger_source values: schedule:\u003ctask-name\u003e, tick, external, trigger. The implementation uses: schedule, trigger_tool, tick, heartbeat. Missing 'external', uses 'trigger_tool' instead of 'trigger', and 'heartbeat' is not in spec.","acceptance_criteria":"1. TRIGGER_SOURCES set matches spec values\n2. Callers use correct values (trigger not trigger_tool, external for MCP calls)","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:41.509000352+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:29:11.056982064+08:00","closed_at":"2026-02-09T22:29:11.056982064+08:00","close_reason":"Fixed trigger_source values to match spec","labels":["core","sessions"],"dependencies":[{"issue_id":"butlers-06j.15","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:41.510730895+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.16","title":"Remove dead temp dir code from CC spawner","description":"The spawner writes mcp.json to a temp dir via _write_mcp_config(), but the SDK invocation uses McpSSEServerConfig objects directly. The written mcp.json file is never referenced. This is dead code that creates and cleans up an unused file.","acceptance_criteria":"1. _write_mcp_config() removed or repurposed\n2. _cleanup_temp_dir() removed if no longer needed\n3. Tests still pass","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:49:43.068281205+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:55:06.358360651+08:00","closed_at":"2026-02-10T00:55:06.358360651+08:00","close_reason":"Dead temp dir code removed from spawner","labels":["core","spawner"],"dependencies":[{"issue_id":"butlers-06j.16","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:43.070004495+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.17","title":"Align default system prompt format with spec","description":"The spec says default prompt should be 'You are the \u003cname\u003e butler.' The implementation uses 'You are {butler_name}, a butler AI assistant.' Additionally, there are two duplicate implementations: skills.py::read_system_prompt() and spawner.py::_read_system_prompt(). The spawner should use skills.py.","acceptance_criteria":"1. Default prompt matches spec format: 'You are the \u003cname\u003e butler.'\n2. Single implementation in skills.py\n3. Spawner delegates to skills.py, no duplicate code","status":"closed","priority":3,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:49:44.771355118+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:54:12.055504182+08:00","closed_at":"2026-02-10T00:54:12.055504182+08:00","close_reason":"Default system prompt aligned with spec, duplicate implementation removed","labels":["core","skills","spawner"],"dependencies":[{"issue_id":"butlers-06j.17","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:44.772827733+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.18","title":"Add Pydantic config validation in module loading","description":"The spec requires each module's config to be validated against its config_schema (Pydantic BaseModel) during loading. Currently, raw dicts are passed to on_startup and register_tools without validation. Missing required fields, extra unknown fields, and type mismatches are not detected.","acceptance_criteria":"1. Module config validated against config_schema during loading\n2. Validated Pydantic instance passed to on_startup and register_tools\n3. Missing required fields raise clear error at startup\n4. Extra/unknown fields rejected\n5. Type mismatches detected","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:55.293290716+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:37:17.302098191+08:00","closed_at":"2026-02-09T22:37:17.302098191+08:00","close_reason":"Added Pydantic config validation in module loading","labels":["core","modules"],"dependencies":[{"issue_id":"butlers-06j.18","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:55.295193736+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.19","title":"Add env var resolution in module config values","description":"The spec says butler.toml module config values referencing env vars (e.g., password = '${EMAIL_PASSWORD}') SHALL be resolved before passing to the module. No env var resolution exists in the config loading pipeline.","acceptance_criteria":"1. Config values containing ${VAR_NAME} are resolved from environment\n2. Missing env vars produce clear error\n3. Resolution happens before Pydantic validation","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:56.715791414+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:46:16.037257329+08:00","closed_at":"2026-02-09T22:46:16.037257329+08:00","close_reason":"Added env var resolution in module config values","labels":["core","credentials","modules"],"dependencies":[{"issue_id":"butlers-06j.19","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:56.717817376+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.19","depends_on_id":"butlers-06j.18","type":"blocks","created_at":"2026-02-09T20:51:25.370829229+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.2","title":"Add context parameter to trigger MCP tool","description":"The spec defines trigger(prompt, context?) where context is optional text prepended to the prompt. The implementation has trigger(prompt) with no context parameter. The CCSpawner.trigger() also lacks context.","acceptance_criteria":"1. trigger MCP tool accepts optional context parameter\n2. When provided, context is prepended to prompt before CC invocation\n3. CCSpawner.trigger() signature updated","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:04.414913353+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:47:59.450942221+08:00","closed_at":"2026-02-09T21:47:59.450942221+08:00","close_reason":"Completed and pushed to agent branches","labels":["core","spawner"],"dependencies":[{"issue_id":"butlers-06j.2","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:04.416935168+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.20","title":"Add startup failure cleanup for initialized modules","description":"The spec requires that if module A's on_startup fails, already-initialized modules have on_shutdown() called and the butler halts. Current implementation has no try/except around the module startup loop. An exception would crash without cleaning up already-started modules.","acceptance_criteria":"1. If on_startup fails for a module, all previously-started modules get on_shutdown called\n2. Butler halts with clear error identifying the failing module","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:58.254659126+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:20:18.587320764+08:00","closed_at":"2026-02-09T22:20:18.587320764+08:00","close_reason":"Already implemented in butlers-06j.3 (graceful shutdown) - daemon.py now wraps module on_startup in try/except and calls on_shutdown on already-started modules","labels":["core","daemon","modules"],"dependencies":[{"issue_id":"butlers-06j.20","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:58.25714598+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.21","title":"Call detect_secrets during butler startup","description":"The detect_secrets() function exists in credentials.py but is never called during startup. The spec says at startup the butler SHALL scan all string values in butler.toml and log a warning if any value appears to be an inline secret. Also needs exemptions for credentials_env and [butler.env] lists.","acceptance_criteria":"1. detect_secrets() called during daemon startup after config load\n2. Warnings logged for detected secrets\n3. credentials_env fields and [butler.env] lists are exempt from scanning","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:50:01.086929705+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:41:30.872115149+08:00","closed_at":"2026-02-09T22:41:30.872115149+08:00","close_reason":"Added detect_secrets call during startup","labels":["core","credentials"],"dependencies":[{"issue_id":"butlers-06j.21","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:01.08829665+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.22","title":"Align credentials_env source with spec (TOML-based)","description":"The spec says credentials_env is declared in butler.toml under [modules.\u003cname\u003e]. The implementation reads it from the module class instance's credentials_env property. This is a fundamental architectural difference — config-driven vs code-driven credential declaration.","acceptance_criteria":"1. credentials_env read from butler.toml module config section\n2. Module class credentials_env used as fallback or removed\n3. Credential validation uses TOML-declared vars","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:01.515506614+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:47:16.984702986+08:00","closed_at":"2026-02-09T22:47:16.984702986+08:00","close_reason":"Aligned credentials_env source with TOML spec","labels":["core","credentials","modules"],"dependencies":[{"issue_id":"butlers-06j.22","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:01.517068078+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.23","title":"Add span instrumentation to all MCP tool handlers","description":"The spec requires every MCP tool handler to be wrapped with a butler.tool.\u003cname\u003e span. In daemon.py, none of the 13 registered tool handlers use tool_span. Module-provided tools also lack span wrapping.","acceptance_criteria":"1. All core MCP tools wrapped with tool_span\n2. Module tools wrapped with tool_span\n3. Spans include butler.name attribute","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:11.821127119+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:00:33.161157567+08:00","closed_at":"2026-02-09T23:00:33.161157567+08:00","close_reason":"Added span instrumentation to MCP tool handlers","labels":["core","telemetry"],"dependencies":[{"issue_id":"butlers-06j.23","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:11.822701527+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.23","depends_on_id":"butlers-06j.1","type":"blocks","created_at":"2026-02-09T20:51:25.007298381+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.24","title":"Add butler.cc_session span to CC spawner","description":"The spec requires a butler.cc_session span with session_id and prompt_length attributes when the CC spawner runs. spawner.py has no span creation. Also, session trace_id is never populated despite the column existing.","acceptance_criteria":"1. CC spawner creates butler.cc_session span\n2. Span has session_id and prompt_length attributes\n3. trace_id passed to session_create from active span","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:50:13.372434648+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:59:49.883856942+08:00","closed_at":"2026-02-09T22:59:49.883856942+08:00","close_reason":"Added butler.cc_session span to CC spawner with session_id and prompt_length attributes, trace_id extraction and propagation to session_create","labels":["core","spawner","telemetry"],"dependencies":[{"issue_id":"butlers-06j.24","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:13.374202632+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.24","depends_on_id":"butlers-06j.14","type":"blocks","created_at":"2026-02-09T20:51:25.069419135+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.25","title":"Add switchboard telemetry spans (receive, classify, route)","description":"The spec requires three spans for switchboard operations: switchboard.receive (with channel, source_id), switchboard.classify (with routed_to), and switchboard.route (with target, tool_name). tools/switchboard.py has zero telemetry instrumentation.","acceptance_criteria":"1. switchboard.receive span created on message arrival\n2. switchboard.classify span as child with routed_to\n3. switchboard.route span with target and tool_name\n4. Trace context injected into inter-butler MCP calls","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:15.12931305+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:08:58.290276893+08:00","closed_at":"2026-02-09T23:08:58.290276893+08:00","close_reason":"Added switchboard telemetry spans with receive, classify, and route spans; trace context injection into inter-butler MCP calls","labels":["switchboard","telemetry"],"dependencies":[{"issue_id":"butlers-06j.25","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:15.131241548+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.25","depends_on_id":"butlers-06j.35","type":"blocks","created_at":"2026-02-09T20:51:25.12747335+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.26","title":"Add scheduler tick and heartbeat cycle spans","description":"The spec requires: (a) butler.tick span with tasks_due and tasks_run attributes when tick() is called, (b) heartbeat.cycle span with butlers_ticked and failures attributes. Neither scheduler.py nor heartbeat.py has any telemetry instrumentation.","acceptance_criteria":"1. tick() creates butler.tick span with tasks_due and tasks_run\n2. Heartbeat creates heartbeat.cycle span with butlers_ticked and failures","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:50:16.832203193+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:06:24.930596136+08:00","closed_at":"2026-02-09T23:06:24.930596136+08:00","close_reason":"Added scheduler tick and heartbeat spans","labels":["core","telemetry"],"dependencies":[{"issue_id":"butlers-06j.26","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:16.834174982+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.27","title":"Wire up inter-butler trace context propagation","description":"inject_trace_context() and extract_trace_context() exist in telemetry.py but are never used for inter-butler calls. The spec requires: switchboard injects _trace_context into MCP tool call args when routing; target butlers extract _trace_context and create child spans.","acceptance_criteria":"1. switchboard.route() injects _trace_context into outgoing args\n2. daemon tool handlers extract _trace_context from incoming args\n3. End-to-end trace hierarchy visible in Jaeger","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:18.379690035+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:22:54.764356531+08:00","closed_at":"2026-02-09T23:22:54.764356531+08:00","close_reason":"Wired up inter-butler trace context propagation","labels":["switchboard","telemetry"],"dependencies":[{"issue_id":"butlers-06j.27","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:18.381122915+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.27","depends_on_id":"butlers-06j.35","type":"blocks","created_at":"2026-02-09T20:51:25.189177776+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.28","title":"Pin Jaeger image to v1.62 in docker-compose","description":"The spec requires jaegertracing/all-in-one:1.62. docker-compose.yml uses :latest which is unpinned and may break.","acceptance_criteria":"1. docker-compose.yml uses jaegertracing/all-in-one:1.62","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":5,"created_at":"2026-02-09T20:50:19.79184401+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:52:39.71599085+08:00","closed_at":"2026-02-10T00:52:39.71599085+08:00","close_reason":"Jaeger image pinned to v1.62","labels":["deployment"],"dependencies":[{"issue_id":"butlers-06j.28","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:19.793735788+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.29","title":"Switch to DATABASE_URL env var for DB connection","description":"The spec requires all CLI commands to use DATABASE_URL env var with default postgres://butlers:butlers@localhost/postgres. The implementation uses individual POSTGRES_HOST, POSTGRES_PORT, POSTGRES_USER, POSTGRES_PASSWORD vars. docker-compose.yml also uses individual vars. Defaults differ (postgres/postgres vs butlers/butlers).","acceptance_criteria":"1. Database.from_env() reads DATABASE_URL\n2. Falls back to individual POSTGRES_* vars for compat\n3. Default matches spec: postgres://butlers:butlers@localhost/postgres\n4. docker-compose.yml updated to use DATABASE_URL","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:28.729539069+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:17:35.888211168+08:00","closed_at":"2026-02-09T23:17:35.888211168+08:00","close_reason":"Switched to DATABASE_URL env var with spec-compliant defaults and backward compatibility","labels":["cli","core","deployment"],"dependencies":[{"issue_id":"butlers-06j.29","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:28.731130459+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.3","title":"Implement graceful shutdown with CC session draining","description":"The spec requires graceful shutdown to: (a) stop accepting new MCP connections, (b) wait for in-flight CC sessions to complete up to a configurable timeout, (c) clean up already-initialized modules on startup failure. Current shutdown() goes straight to module shutdown without draining CC sessions or stopping MCP acceptance.","acceptance_criteria":"1. Shutdown stops accepting new MCP connections\n2. In-flight CC sessions are awaited up to configurable timeout\n3. Configurable shutdown timeout in butler.toml\n4. On startup failure, already-initialized modules get on_shutdown() called","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:49:06.286394542+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:58:39.639583342+08:00","closed_at":"2026-02-09T21:58:39.639583342+08:00","close_reason":"Implemented graceful shutdown with CC session draining","labels":["core","daemon"],"dependencies":[{"issue_id":"butlers-06j.3","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:06.288025016+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.30","title":"Fix --only flag to use comma-separated syntax","description":"The spec says butlers up --only switchboard,health (comma-separated single value). Implementation uses Click multiple=True which means --only switchboard --only health (repeated flags).","acceptance_criteria":"1. --only accepts comma-separated butler names\n2. --only switchboard,health works as single argument","status":"closed","priority":3,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:50:30.032639555+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:01:29.942838921+08:00","closed_at":"2026-02-10T01:01:29.942838921+08:00","close_reason":"Fixed --only flag to accept comma-separated values","labels":["cli"],"dependencies":[{"issue_id":"butlers-06j.30","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:30.035116981+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.31","title":"Make --port optional in butlers init","description":"The spec says butlers init mybutler (without --port) should work with a reasonable default port. cli.py has --port required=True.","acceptance_criteria":"1. --port has a reasonable default (e.g., 8100 or auto-increment)\n2. butlers init mybutler works without --port","status":"closed","priority":3,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:50:31.352972043+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:59:57.281362882+08:00","closed_at":"2026-02-10T00:59:57.281362882+08:00","close_reason":"Made --port optional with default 8100","labels":["cli"],"dependencies":[{"issue_id":"butlers-06j.31","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:31.354795722+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.32","title":"Add port conflict detection to butlers up","description":"The spec requires butlers up to detect two butlers with the same configured port and report a conflict error, refusing to start any. No port conflict detection exists.","acceptance_criteria":"1. butlers up checks all discovered butlers for port conflicts\n2. Reports conflict with butler names and port number\n3. Exits non-zero without starting any butler","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:50:32.649639594+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:28:56.532980781+08:00","closed_at":"2026-02-09T23:28:56.532980781+08:00","close_reason":"Added port conflict detection","labels":["cli"],"dependencies":[{"issue_id":"butlers-06j.32","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:32.651231375+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.33","title":"Add running status detection to butlers list","description":"The spec requires butlers list to show which butlers are running vs stopped by probing configured ports. Currently it only shows static config info.","acceptance_criteria":"1. butlers list shows running/stopped status per butler\n2. Status detected by probing configured port","status":"closed","priority":3,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:50:33.841260293+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:01:42.631225108+08:00","closed_at":"2026-02-10T01:01:42.631225108+08:00","close_reason":"Running status detection added to butlers list via port probing","labels":["cli"],"dependencies":[{"issue_id":"butlers-06j.33","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:33.842805866+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.34","title":"Fix Dockerfile and docker-compose config mount paths","description":"Multiple issues: (a) Spec says config mounted at /etc/butler, Dockerfile uses /app/butler.toml, docker-compose uses /app/butler-config. (b) docker-compose --config commands pass file paths but CLI expects directories. (c) Dockerfile CMD references /app/butler.toml which doesn't exist in image.","acceptance_criteria":"1. Config mounted at /etc/butler as per spec\n2. butlers run --config receives a directory path\n3. Dockerfile CMD and docker-compose commands consistent\n4. docker-compose postgres user matches spec defaults","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:50:35.618578249+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:28:28.644982086+08:00","closed_at":"2026-02-09T23:28:28.644982086+08:00","close_reason":"Fixed Dockerfile and docker-compose config paths","labels":["deployment"],"dependencies":[{"issue_id":"butlers-06j.34","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:35.620072495+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.34","depends_on_id":"butlers-06j.29","type":"blocks","created_at":"2026-02-09T20:51:25.427473446+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.35","title":"Implement switchboard inter-butler routing","description":"The switchboard's _call_butler_tool() is literally raise NotImplementedError, blocking ALL inter-butler communication. The route() tool cannot forward requests to target butlers. This is the critical path for the switchboard's primary function.","acceptance_criteria":"1. _call_butler_tool connects to target butler's MCP endpoint\n2. Tool calls are forwarded and responses returned\n3. Trace context propagated to target butler","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:50:56.947359804+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:23:19.755869507+08:00","closed_at":"2026-02-09T21:23:19.755869507+08:00","close_reason":"Implementation complete, branch pushed","labels":["switchboard"],"dependencies":[{"issue_id":"butlers-06j.35","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:56.949507827+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.36","title":"Connect Telegram/Email modules to classification pipeline","description":"The Telegram and Email modules have tool stubs but are not connected to the switchboard's message classification and routing pipeline. Incoming messages from Telegram/Email should flow through classify_message() then route() to the appropriate butler.","acceptance_criteria":"1. Telegram module forwards incoming messages to classify_message\n2. Email module forwards incoming messages to classify_message\n3. Classification result routes to correct butler via route() tool","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:50:58.672999207+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:32:08.525347909+08:00","closed_at":"2026-02-09T21:32:08.525347909+08:00","close_reason":"Implemented: Telegram/Email modules connected to switchboard classification pipeline via MessagePipeline","labels":["modules","switchboard"],"dependencies":[{"issue_id":"butlers-06j.36","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:58.67478786+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-06j.36","depends_on_id":"butlers-06j.35","type":"blocks","created_at":"2026-02-09T20:51:25.248649701+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.37","title":"Align General butler DB schema with spec","description":"General butler spec requires a tags column on entities table for tag-based filtering and text search. The implementation collapses structure into simplified JSONB without proper tags support. The entity_search tool needs to support tag-based queries as per spec.","acceptance_criteria":"1. entities table has tags TEXT[] column\n2. entity_create/update accept tags\n3. entity_search supports tag filtering","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:59.774501704+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:40:27.444741309+08:00","closed_at":"2026-02-09T23:40:27.444741309+08:00","close_reason":"Added tags support to General butler entities","labels":["general","migrations"],"dependencies":[{"issue_id":"butlers-06j.37","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:50:59.776121498+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.38","title":"Align Relationship butler DB schema and tools with spec","description":"Relationship butler implementation simplifies the spec's rich schema. Tools use JSONB details blobs instead of proper columns (phone, email, birthday, etc.). Missing tables: contact_info, addresses. Tool implementations are stubs/skeletons rather than full implementations per spec.","acceptance_criteria":"1. Contact table has proper columns per spec (not just name+details JSONB)\n2. contact_info and addresses tables exist\n3. All tool functions fully implemented (not stubs)\n4. Relationship, gift, interaction, reminder tools complete","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":240,"created_at":"2026-02-09T20:51:01.482041985+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:45:10.124817355+08:00","closed_at":"2026-02-09T23:45:10.124817355+08:00","close_reason":"Aligned Relationship butler with spec","labels":["migrations","relationship"],"dependencies":[{"issue_id":"butlers-06j.38","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:51:01.484599803+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.39","title":"Align Health butler DB schema and tools with spec","description":"Health butler implementation diverges from spec in column naming (topic vs title, sources vs tags) and tool implementations are largely stubs. Measurement, medication, condition, symptom, and meal tools need full implementation per spec.","acceptance_criteria":"1. Column names match spec (title not topic, tags not sources, etc.)\n2. All measurement/medication/condition/symptom/meal tools fully implemented\n3. Summary and trend report tools working","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":240,"created_at":"2026-02-09T20:51:02.977909987+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:56:57.252464799+08:00","closed_at":"2026-02-09T23:56:57.252464799+08:00","close_reason":"Health butler schema aligned with spec, all tools fully implemented","labels":["health","migrations"],"dependencies":[{"issue_id":"butlers-06j.39","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:51:02.979489333+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.4","title":"Add dynamic health checking to status tool","description":"The status() MCP tool always returns health: ok unconditionally. The spec requires it to reflect actual component health — if the DB pool becomes unavailable, status should report degraded state.","acceptance_criteria":"1. status() checks DB pool health\n2. Returns degraded when DB pool is unavailable\n3. Returns ok only when all components healthy","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:08.196756022+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:54:09.945497879+08:00","closed_at":"2026-02-09T21:54:09.945497879+08:00","close_reason":"Added dynamic health checking to status tool","labels":["core","daemon"],"dependencies":[{"issue_id":"butlers-06j.4","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:08.198269214+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.40","title":"Implement heartbeat butler tick dispatch","description":"Heartbeat butler is supposed to call tick() on all registered butlers every 10 minutes. The tools/heartbeat.py is a skeleton. The scheduled task exists in butler.toml but the tick dispatch logic needs full implementation.","acceptance_criteria":"1. Heartbeat queries butler registry for all butlers\n2. Calls tick endpoint on each butler\n3. Logs successes and failures\n4. Returns summary of ticked/failed butlers","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:51:04.553437716+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:55:14.855279649+08:00","closed_at":"2026-02-09T23:55:14.855279649+08:00","close_reason":"Heartbeat tick dispatch fully implemented with registry query, per-butler tick calls, failure handling, session logging, and summary reporting. Fixed butler.toml schedule format. 22 tests passing.","labels":["heartbeat"],"dependencies":[{"issue_id":"butlers-06j.40","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:51:04.55502065+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.41","title":"Fix butler scheduled task definitions in butler.toml","description":"Scheduled task definitions across butler configs are either missing or incorrectly formatted per spec. The switchboard, relationship, and health butlers need their scheduled tasks properly defined in butler.toml matching the spec's cron expressions and prompt fields.","acceptance_criteria":"1. All butlers have correctly formatted [[butler.schedule]] entries\n2. Cron expressions match spec requirements\n3. Prompts are actionable for CC instances","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:51:06.152613516+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:53:03.730945423+08:00","closed_at":"2026-02-09T23:53:03.730945423+08:00","close_reason":"All butler.toml scheduled task definitions aligned with spec - correct cron expressions and actionable prompts","labels":["core","scheduler"],"dependencies":[{"issue_id":"butlers-06j.41","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:51:06.154202601+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.42","title":"Add skill directory name validation (kebab-case)","description":"The butler-skills spec requires skill directory names to use kebab-case (lowercase + hyphens, starting with letter, no consecutive hyphens). No validation logic exists. This should be enforced when reading the skills directory.","acceptance_criteria":"1. Skills directory names validated for kebab-case\n2. Invalid names logged as warnings\n3. Invalid skill directories skipped with warning","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:51:07.527729536+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:06:53.013732522+08:00","closed_at":"2026-02-10T01:06:53.013732522+08:00","close_reason":"Kebab-case validation added to skill directory names","labels":["core","skills"],"dependencies":[{"issue_id":"butlers-06j.42","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:51:07.530598201+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.43","title":"Add state_list keys-only mode per spec","description":"The spec says state_list SHALL return a list of keys. The implementation returns [{key, value}] dicts with both key and value. While this is a superset, it diverges from the spec's definition of returning just keys.","acceptance_criteria":"1. state_list returns a list of key strings by default\n2. Or: spec updated to document current behavior","status":"closed","priority":3,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T20:51:08.919379996+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:08:23.062784129+08:00","closed_at":"2026-02-10T01:08:23.062784129+08:00","close_reason":"state_list now returns key strings by default with keys_only parameter","labels":["core","state"],"dependencies":[{"issue_id":"butlers-06j.43","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:51:08.920969922+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.5","title":"Add butler-specific migration chain support","description":"The spec says after core migrations, the daemon SHALL apply butler-specific Alembic migrations if a version chain exists for the butler name. Currently the daemon only applies core chain and module chains. Butler-identity-level migrations (e.g., alembic/versions/relationship/ for the Relationship butler) are treated as module migrations, but there is no explicit lookup by butler name.","acceptance_criteria":"1. Daemon checks for butler-name-specific Alembic version chain\n2. Applies it after core migrations, before module migrations\n3. No-op if no such chain exists","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:09.220046296+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:04:21.167406688+08:00","closed_at":"2026-02-09T22:04:21.167406688+08:00","close_reason":"Added butler-specific migration chain support","labels":["core","daemon","migrations"],"dependencies":[{"issue_id":"butlers-06j.5","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:09.22156037+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.6","title":"Start FastMCP server on configured port in daemon.start()","description":"The spec says daemon startup step 9 starts the FastMCP server on the configured port. The daemon creates the FastMCP instance and registers tools but never calls mcp.run(). The SSE server startup is handled externally in cli.py. This makes ButlerDaemon not self-contained as the spec requires.","acceptance_criteria":"1. ButlerDaemon.start() starts the MCP server on the configured port\n2. Or: document that cli.py is responsible for starting the server and update spec","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:10.928692449+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:10:51.07486253+08:00","closed_at":"2026-02-09T22:10:51.07486253+08:00","close_reason":"Implemented FastMCP SSE server startup as background asyncio task in daemon.start() and corresponding shutdown in daemon.shutdown()","labels":["core","daemon"],"dependencies":[{"issue_id":"butlers-06j.6","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:10.930468268+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.7","title":"Add last_result column to scheduled_tasks table","description":"The spec schema includes last_result JSONB on scheduled_tasks to store CC session outcome after each dispatch. The column does not exist in the Alembic migration or the DB schema. tick() does not write results after dispatch. schedule_list does not select it.","acceptance_criteria":"1. Alembic migration adds last_result JSONB column\n2. tick() writes CC session result to last_result after dispatch\n3. schedule_list includes last_result in output","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:19.748644898+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:07:48.243192951+08:00","closed_at":"2026-02-09T22:07:48.243192951+08:00","close_reason":"Added last_result JSONB column to scheduled_tasks","labels":["core","migrations","scheduler"],"dependencies":[{"issue_id":"butlers-06j.7","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:19.750620485+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.8","title":"Add name UNIQUE constraint to scheduled_tasks","description":"The spec requires name TEXT UNIQUE NOT NULL on scheduled_tasks and schedule_create must reject duplicate names. The migration creates name TEXT NOT NULL without UNIQUE. Duplicate names silently insert.","acceptance_criteria":"1. Alembic migration adds UNIQUE constraint on name\n2. schedule_create rejects duplicate names with clear error message","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:21.037343404+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:19:33.825293546+08:00","closed_at":"2026-02-09T22:19:33.825293546+08:00","close_reason":"Added UNIQUE constraint on scheduled_tasks name","labels":["core","migrations","scheduler"],"dependencies":[{"issue_id":"butlers-06j.8","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:21.038950865+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-06j.9","title":"Handle next_run_at on enabled/disabled toggle","description":"The spec requires: when enabled set to true, recompute next_run_at; when enabled set to false, set next_run_at to NULL. The implementation only recomputes next_run_at when cron changes, ignoring enabled toggling.","acceptance_criteria":"1. schedule_update recomputes next_run_at when enabled changes to true\n2. schedule_update sets next_run_at to NULL when enabled changes to false","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:49:22.566991601+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:16:44.441541593+08:00","closed_at":"2026-02-09T22:16:44.441541593+08:00","close_reason":"Fixed next_run_at handling on enabled toggle","labels":["core","scheduler"],"dependencies":[{"issue_id":"butlers-06j.9","depends_on_id":"butlers-06j","type":"parent-child","created_at":"2026-02-09T20:49:22.568470879+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0dw","title":"Repo quality gates fail due existing lint/format debt outside butlers-v96 scope","description":"Running AGENTS.md gates on this branch reports unrelated baseline failures outside touched files: ruff check flags import/style issues in existing files (e.g., roster/memory/tools/__init__.py, src/butlers/daemon.py, src/butlers/modules/approvals/module.py), and ruff format --check reports many files needing formatting. Repro: uv run ruff check src/ tests/ roster/ conftest.py ; uv run ruff format --check src/ tests/ roster/ conftest.py.","status":"in_progress","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:36:45.277469981+08:00","created_by":"Tzeusy","updated_at":"2026-02-13T01:26:10.250373141+08:00","dependencies":[{"issue_id":"butlers-0dw","depends_on_id":"butlers-v96","type":"discovered-from","created_at":"2026-02-11T10:36:45.279837682+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0e0","title":"Discovered-from c7q: core sessions schema/test regressions","description":"During butlers-c7q verification, tests/core/test_core_sessions.py shows multiple failures around create/complete/list/get session behavior, consistent with sessions schema/query drift (e.g., token-related columns and CRUD expectations). This also impacts integration session assertions.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T23:15:07.077752166+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.471522458+08:00","closed_at":"2026-02-11T23:30:11.471522458+08:00","close_reason":"Duplicate of butlers-4xh (sessions schema/test mismatch).","dependencies":[{"issue_id":"butlers-0e0","depends_on_id":"butlers-c7q","type":"discovered-from","created_at":"2026-02-11T23:15:07.080187906+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp","title":"Butlers v1 MVP","description":"Complete implementation of the Butlers AI agent framework v1 MVP. Encompasses the core daemon framework, module system, 5 specialized butlers (Switchboard, Heartbeat, Relationship, Health, General), 2 communication modules (Telegram, Email), CLI, Docker deployment, and OpenTelemetry instrumentation. See openspec/changes/v1-mvp-spec for full specifications.","acceptance_criteria":"1. All 5 butlers start and serve MCP tools\n2. Switchboard routes messages to correct butler\n3. Heartbeat ticks all butlers on 10-min cycle\n4. CC spawner generates locked-down ephemeral configs\n5. All core tools (state, scheduler, sessions) work across butlers\n6. Docker Compose brings up full stack\n7. End-to-end tracing works from ingress to CC execution","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:05:36.754557265+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:41.354784456+08:00","closed_at":"2026-02-09T13:50:41.354784456+08:00","close_reason":"v1 MVP complete — all 22 milestone epics implemented. 449 tests passing. All 5 butlers (Switchboard, General, Relationship, Health, Heartbeat), 2 modules (Telegram, Email), CLI, Docker deployment, integration tests, and OpenTelemetry instrumentation."}
{"id":"butlers-0qp.1","title":"Set up project skeleton","description":"Initialize project structure: pyproject.toml with hatchling build backend, ruff config, pytest-asyncio, src/butlers layout, Makefile targets, GitHub Actions CI workflow with PostgreSQL service. Foundation for all subsequent work.","acceptance_criteria":"1. uv sync --dev installs all deps without error\n2. make check passes (lint + test)\n3. CI workflow runs on push and PR\n4. Project follows src layout convention","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:06:54.876948162+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:51.069385758+08:00","closed_at":"2026-02-09T12:28:51.069385758+08:00","close_reason":"All subtasks completed, skeleton merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:06:54.878359929+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.1","title":"Create pyproject.toml with hatchling build and dev dependencies","description":"Set up pyproject.toml with hatchling build backend, src/butlers layout. Dev dependencies: ruff, pytest, pytest-asyncio, testcontainers. Runtime dependencies: fastmcp, claude-code-sdk, asyncpg, croniter, opentelemetry-sdk, click.","acceptance_criteria":"1. pyproject.toml parses without error\n2. Build backend is hatchling with src layout\n3. All runtime and dev dependencies declared\n4. Ruff config included: target py312, line-length 100, rules E,F,I,UP","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:09:52.754473928+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.238295365+08:00","closed_at":"2026-02-09T12:28:23.238295365+08:00","close_reason":"Skeleton implemented and merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1.1","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:09:52.755954014+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.2","title":"Create src/butlers package and type marker","description":"Create src/butlers/__init__.py (can be empty or with version) and src/butlers/py.typed marker file for PEP 561 type checking support.","acceptance_criteria":"1. src/butlers/__init__.py exists\n2. src/butlers/py.typed exists\n3. Package importable after uv sync","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:09:54.454582037+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.253118145+08:00","closed_at":"2026-02-09T12:28:23.253118145+08:00","close_reason":"Skeleton implemented and merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1.2","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:09:54.456028609+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.3","title":"Create test infrastructure","description":"Create tests/__init__.py and tests/conftest.py with SpawnerResult dataclass (result, tool_calls, error, duration_ms) and MockSpawner pytest fixture that returns configurable SpawnerResult without invoking real CC.","acceptance_criteria":"1. tests/conftest.py contains SpawnerResult dataclass\n2. MockSpawner fixture available in all tests\n3. MockSpawner records invocations for assertion","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:09:58.053555877+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.261285042+08:00","closed_at":"2026-02-09T12:28:23.261285042+08:00","close_reason":"Skeleton implemented and merged to main","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.1.3","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:09:58.055445816+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.4","title":"Create .python-version file","description":"Create .python-version file specifying Python 3.12 for uv and other tooling.","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":5,"created_at":"2026-02-09T12:10:02.801563425+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.269551838+08:00","closed_at":"2026-02-09T12:28:23.269551838+08:00","close_reason":"Skeleton implemented and merged to main","dependencies":[{"issue_id":"butlers-0qp.1.4","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:10:02.803530601+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.5","title":"Create Makefile with dev targets","description":"Create Makefile with targets: lint (uv run ruff check src/ tests/), format (uv run ruff format src/ tests/), test (uv run pytest -v), check (lint + test).","acceptance_criteria":"1. make lint runs ruff check\n2. make format runs ruff format\n3. make test runs pytest -v\n4. make check runs lint then test","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:10:03.789282531+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.27783777+08:00","closed_at":"2026-02-09T12:28:23.27783777+08:00","close_reason":"Skeleton implemented and merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1.5","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:10:03.791042865+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.6","title":"Create GitHub Actions CI workflow","description":"Create .github/workflows/ci.yml that runs on push and PR. Steps: checkout, set up Python 3.12 with uv, PostgreSQL service container, uv sync --dev, make check.","acceptance_criteria":"1. Workflow triggers on push and PR\n2. PostgreSQL service container running\n3. make check executed and must pass\n4. uv used for dependency installation","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:05.229430117+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.286151534+08:00","closed_at":"2026-02-09T12:28:23.286151534+08:00","close_reason":"Skeleton implemented and merged to main","labels":["ci","infra"],"dependencies":[{"issue_id":"butlers-0qp.1.6","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:10:05.231397412+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.1.7","title":"Verify project skeleton builds clean","description":"Run uv sync --dev and verify make check passes with no errors. Smoke test that the full skeleton is wired correctly.","acceptance_criteria":"1. uv sync --dev completes without error\n2. make check passes (lint + test)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:10:07.628327377+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:28:23.294598801+08:00","closed_at":"2026-02-09T12:28:23.294598801+08:00","close_reason":"Skeleton implemented and merged to main","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.1.7","depends_on_id":"butlers-0qp.1","type":"parent-child","created_at":"2026-02-09T12:10:07.630086489+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.10","title":"Implement Telegram module","description":"Module implementation with send_message and get_updates MCP tools. Polling mode for dev (no public URL needed) and webhook mode for production, configurable via butler.toml [modules.telegram] section. Requires TELEGRAM_BOT_TOKEN credential.","acceptance_criteria":"1. Module registers send_message and get_updates tools\n2. Polling mode works for local development\n3. Webhook mode configurable for production\n4. Module declares TELEGRAM_BOT_TOKEN in credentials_env","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:44.707081615+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:45.013403808+08:00","closed_at":"2026-02-09T13:09:45.013403808+08:00","close_reason":"All children completed","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.10","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:44.708512478+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.10.1","title":"Implement Telegram module with send and receive tools","description":"Create src/butlers/modules/telegram.py implementing the Module ABC. Register MCP tools: send_message(chat_id, text) and get_updates(). Declare TELEGRAM_BOT_TOKEN in credentials_env. Config schema includes mode (polling/webhook) and webhook_url (for production).","acceptance_criteria":"1. Module implements all Module ABC members\n2. send_message tool registered and calls Telegram Bot API\n3. get_updates tool registered and returns messages\n4. TELEGRAM_BOT_TOKEN declared in credentials_env","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:06.775600425+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.706208083+08:00","closed_at":"2026-02-09T13:09:35.706208083+08:00","close_reason":"Implemented and merged to main","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.10.1","depends_on_id":"butlers-0qp.10","type":"parent-child","created_at":"2026-02-09T12:12:06.777029054+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.10.2","title":"Implement Telegram polling and webhook modes","description":"Support polling mode for dev (getUpdates long-polling, no public URL needed) and webhook mode for production (setWebhook, receive POSTs). Mode configured via [modules.telegram] in butler.toml. on_startup starts the appropriate mode, on_shutdown cleans up.","acceptance_criteria":"1. Polling mode works without public URL\n2. Webhook mode sets webhook URL on startup\n3. Mode selected from config\n4. Graceful cleanup on shutdown","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:12:08.003122958+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.714954266+08:00","closed_at":"2026-02-09T13:09:35.714954266+08:00","close_reason":"Implemented and merged to main","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.10.2","depends_on_id":"butlers-0qp.10","type":"parent-child","created_at":"2026-02-09T12:12:08.005131161+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.10.3","title":"Write Telegram module tests","description":"Write tests/test_module_telegram.py covering: tool registration, mocked API calls (send_message, get_updates), config validation, credential declaration.","acceptance_criteria":"1. Tool registration verified\n2. API calls mocked (no real Telegram calls)\n3. Config validation tested\n4. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:08.899573509+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.723203308+08:00","closed_at":"2026-02-09T13:09:35.723203308+08:00","close_reason":"Implemented and merged to main","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.10.3","depends_on_id":"butlers-0qp.10","type":"parent-child","created_at":"2026-02-09T12:12:08.900982981+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.11","title":"Implement task scheduler","description":"Cron-driven task dispatch. TOML-to-DB sync on startup (insert new, update changed, mark removed). tick() handler evaluates cron expressions via croniter, dispatches due task prompts to CC spawner serially. Runtime CRUD MCP tools: schedule_list, schedule_create (validate cron), schedule_update, schedule_delete (reject toml-source deletion).","acceptance_criteria":"1. TOML schedules synced to DB on startup\n2. tick() dispatches due tasks to CC spawner\n3. No-op tick when nothing due\n4. Disabled tasks skipped\n5. schedule_create validates cron syntax\n6. schedule_delete rejects toml-source tasks\n7. next_run_at computed correctly from cron expression","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:48.306483672+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:44.995841681+08:00","closed_at":"2026-02-09T13:09:44.995841681+08:00","close_reason":"All children completed","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.11","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:48.308047636+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.11","depends_on_id":"butlers-0qp.4","type":"blocks","created_at":"2026-02-09T12:15:48.731288429+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.11","depends_on_id":"butlers-0qp.8","type":"blocks","created_at":"2026-02-09T12:15:48.853046222+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.11.1","title":"Implement TOML-to-DB schedule sync and cron evaluation","description":"Create src/butlers/core/scheduler.py. On startup, sync [[butler.schedule]] entries from TOML to scheduled_tasks table: insert new tasks (source='toml'), update changed ones, mark removed ones. Use croniter to compute next_run_at for each task. tick() handler checks for due tasks and dispatches prompts to CC spawner serially.","design":"TOML sync: match by name. Source='toml' for config-sourced, source='runtime' for API-created. tick() flow: query tasks WHERE enabled=true AND next_run_at \u003c= now(), dispatch each to CC spawner, update next_run_at after dispatch.","acceptance_criteria":"1. TOML tasks synced on first startup\n2. Changed TOML tasks updated in DB\n3. Removed TOML tasks marked appropriately\n4. tick() dispatches due tasks to CC spawner\n5. next_run_at computed correctly via croniter\n6. Disabled tasks skipped by tick()","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T12:11:24.507483557+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.666783402+08:00","closed_at":"2026-02-09T13:09:35.666783402+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.11.1","depends_on_id":"butlers-0qp.11","type":"parent-child","created_at":"2026-02-09T12:11:24.509245155+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.11.2","title":"Implement schedule CRUD MCP tools","description":"Add MCP tools: schedule_list() returns all tasks, schedule_create(name, cron, prompt) creates runtime task (validates cron syntax via croniter), schedule_update(id, fields) modifies task, schedule_delete(id) removes task but rejects deletion of toml-source tasks.","acceptance_criteria":"1. schedule_list returns all tasks with their fields\n2. schedule_create validates cron syntax and creates with source='runtime'\n3. schedule_update modifies specified fields\n4. schedule_delete removes runtime tasks\n5. schedule_delete rejects toml-source tasks with clear error","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:31.676869967+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.684421471+08:00","closed_at":"2026-02-09T13:09:35.684421471+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.11.2","depends_on_id":"butlers-0qp.11","type":"parent-child","created_at":"2026-02-09T12:11:31.678601718+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.11.3","title":"Write task scheduler tests","description":"Write tests/test_core_scheduler.py covering: TOML sync (first run, update, removal), tick dispatch (due task dispatched), no-op tick (nothing due), disabled tasks skipped, error handling (dispatch failure doesn't stop tick), next_run_at computation, CRUD operations (list, create with valid/invalid cron, update, delete runtime, reject delete toml).","acceptance_criteria":"1. All scenarios tested\n2. MockSpawner used for dispatch verification\n3. Croniter used for next_run_at verification\n4. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:37.397770786+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.6942025+08:00","closed_at":"2026-02-09T13:09:35.6942025+08:00","close_reason":"Implemented and merged to main","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.11.3","depends_on_id":"butlers-0qp.11","type":"parent-child","created_at":"2026-02-09T12:11:37.399702054+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.12","title":"Implement Email module","description":"Module implementation with send_email, search_inbox, read_email MCP tools. IMAP for inbox access, SMTP for sending. Configurable via butler.toml [modules.email] section.","acceptance_criteria":"1. Module registers send_email, search_inbox, read_email tools\n2. IMAP connection for inbox operations\n3. SMTP connection for sending\n4. Module declares email credentials in credentials_env","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:48.490238233+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:45.028346022+08:00","closed_at":"2026-02-09T13:09:45.028346022+08:00","close_reason":"All children completed","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.12","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:48.491616346+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.12.1","title":"Implement Email module with send and inbox tools","description":"Create src/butlers/modules/email.py implementing the Module ABC. Register MCP tools: send_email(to, subject, body), search_inbox(query), read_email(id). IMAP for inbox access, SMTP for sending. Declare email credentials in credentials_env.","acceptance_criteria":"1. Module implements all Module ABC members\n2. send_email, search_inbox, read_email tools registered\n3. IMAP used for inbox operations\n4. SMTP used for sending\n5. Email credentials declared in credentials_env","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:10.317789812+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.731504469+08:00","closed_at":"2026-02-09T13:09:35.731504469+08:00","close_reason":"Implemented and merged to main","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-0qp.12.1","depends_on_id":"butlers-0qp.12","type":"parent-child","created_at":"2026-02-09T12:12:10.319852578+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.12.2","title":"Write Email module tests","description":"Write tests/test_module_email.py covering: tool registration, mocked IMAP/SMTP calls, config validation, credential declaration.","acceptance_criteria":"1. Tool registration verified\n2. IMAP/SMTP calls mocked\n3. Config validation tested\n4. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:11.725477278+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:09:35.741113272+08:00","closed_at":"2026-02-09T13:09:35.741113272+08:00","close_reason":"Implemented and merged to main","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.12.2","depends_on_id":"butlers-0qp.12","type":"parent-child","created_at":"2026-02-09T12:12:11.727457439+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13","title":"Implement Switchboard butler","description":"Public ingress butler on port 8100. Owns butler_registry and routing_log tables. MCP tools: route(butler_name, tool_name, args) for inter-butler forwarding via SSE MCP client, list_butlers() for registry query, discover() for config directory scanning. Routing flow: message intake -\u003e CC classification -\u003e route to target butler -\u003e return response. Default-to-general fallback. Telegram and Email modules for message intake.","acceptance_criteria":"1. butler_registry and routing_log tables provisioned\n2. route() forwards tool calls to target butler via MCP client\n3. list_butlers() returns full registry\n4. discover() scans config dirs and updates registry\n5. Trace context propagated through routing\n6. Unknown routes fall back to general butler","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:52.670290425+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:12.197811357+08:00","closed_at":"2026-02-09T13:28:12.197811357+08:00","close_reason":"Wave 8 epic complete — all children implemented and merged to main. 325 tests passing.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.13","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:52.671598907+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.13","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.242535254+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.13","depends_on_id":"butlers-0qp.10","type":"blocks","created_at":"2026-02-09T12:15:49.299449497+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.13","depends_on_id":"butlers-0qp.12","type":"blocks","created_at":"2026-02-09T12:15:49.354005806+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.1","title":"Create Switchboard Alembic revision","description":"Create Alembic revision in alembic/versions/switchboard/ with butler_registry table (name TEXT PK, endpoint_url TEXT NOT NULL, description TEXT, modules JSONB DEFAULT '[]', last_seen_at TIMESTAMPTZ, registered_at TIMESTAMPTZ DEFAULT now()) and routing_log table (id UUID PK, source_channel TEXT NOT NULL, source_id TEXT, routed_to TEXT NOT NULL, prompt_summary TEXT, trace_id TEXT, created_at TIMESTAMPTZ DEFAULT now()). Uses op.execute() with raw SQL.","acceptance_criteria":"1. butler_registry table created with correct schema\n2. routing_log table created with correct schema\n3. Migration idempotent via migration runner","notes":"NOTE: Acceptance criteria #3 is stale — should read 'Migration idempotent via Alembic' instead of 'via migration runner'.","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:12:13.296400213+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:05.310239406+08:00","closed_at":"2026-02-09T13:28:05.310239406+08:00","close_reason":"Wave 8: Switchboard butler implemented — register, list, discover, route, classify, routing log. 16 tests passing.","labels":["butler","database"],"dependencies":[{"issue_id":"butlers-0qp.13.1","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:13.297797453+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.2","title":"Implement Switchboard MCP tools","description":"Create src/butlers/tools/switchboard.py with three tools: route(butler_name, tool_name, args) forwards tool calls to target butler via MCP SSE client with trace context propagation; list_butlers() returns full registry; discover() scans butler config directories and updates registry (add new, update changed, mark stale).","design":"route() creates an MCP client connection to target butler's SSE endpoint, calls the specified tool, propagates _trace_context, logs to routing_log, returns result. discover() walks the butlers/ config directory, reads each butler.toml, upserts into butler_registry.","acceptance_criteria":"1. route() forwards to correct butler endpoint\n2. route() propagates trace context\n3. route() logs to routing_log\n4. list_butlers() returns all registered butlers\n5. discover() finds and registers new butlers","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T12:12:15.264861615+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:05.32616562+08:00","closed_at":"2026-02-09T13:28:05.32616562+08:00","close_reason":"Wave 8: Switchboard butler implemented — register, list, discover, route, classify, routing log. 16 tests passing.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.13.2","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:15.266406593+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.3","title":"Implement MCP client for inter-butler communication","description":"Implement SSE-based MCP client that connects to other butlers' MCP endpoints for the route() tool. Must handle connection lifecycle, trace context injection via _trace_context arg, and error handling for unreachable butlers.","acceptance_criteria":"1. MCP client connects via SSE transport\n2. Tool calls forwarded correctly\n3. _trace_context injected into tool args\n4. Unreachable butler returns clear error","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:17.019866984+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:05.331001214+08:00","closed_at":"2026-02-09T13:28:05.331001214+08:00","close_reason":"Wave 8: Switchboard butler implemented — register, list, discover, route, classify, routing log. 16 tests passing.","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.13.3","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:17.021240909+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.4","title":"Implement Switchboard routing flow","description":"Implement the full routing flow: message intake (from Telegram/Email modules or direct MCP) -\u003e CC classification (spawn CC to determine target butler) -\u003e route to target butler -\u003e return response. Default-to-general fallback when no specialist matches.","design":"CC is spawned with a classification prompt listing available butlers and their descriptions. CC returns the target butler name. Switchboard then calls route() to forward. If CC can't classify, defaults to 'general' butler.","acceptance_criteria":"1. Messages classified by CC to correct butler\n2. Route forwarded to target\n3. Response returned to caller\n4. Unknown classification defaults to general\n5. Routing logged","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:19.097920975+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:05.336649313+08:00","closed_at":"2026-02-09T13:28:05.336649313+08:00","close_reason":"Wave 8: Switchboard butler implemented — register, list, discover, route, classify, routing log. 16 tests passing.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.13.4","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:19.099817848+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.5","title":"Create Switchboard butler config","description":"Create butlers/switchboard/butler.toml (name=switchboard, port=8100, modules: telegram, email) and butlers/switchboard/CLAUDE.md (personality: message classifier and router, instructions for classifying incoming messages to the correct specialist butler).","acceptance_criteria":"1. butler.toml has correct name and port\n2. Telegram and email modules enabled\n3. CLAUDE.md contains classification instructions","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:12:21.70130235+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:05.341541704+08:00","closed_at":"2026-02-09T13:28:05.341541704+08:00","close_reason":"Wave 8: Switchboard butler implemented — register, list, discover, route, classify, routing log. 16 tests passing.","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.13.5","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:21.703406535+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.13.6","title":"Write Switchboard tests","description":"Write tests/test_tools_switchboard.py covering: registry CRUD (discover, list), routing (forward to target, return response), trace context propagation through route(), default-to-general fallback, discover() finding new butlers.","acceptance_criteria":"1. All scenarios tested\n2. MockSpawner used for CC classification\n3. MCP client mocked for inter-butler calls\n4. Trace propagation verified\n5. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:22.688350265+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:05.34615067+08:00","closed_at":"2026-02-09T13:28:05.34615067+08:00","close_reason":"Wave 8: Switchboard butler implemented — register, list, discover, route, classify, routing log. 16 tests passing.","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.13.6","depends_on_id":"butlers-0qp.13","type":"parent-child","created_at":"2026-02-09T12:12:22.690891115+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.14","title":"Implement Heartbeat butler","description":"Infrastructure butler on port 8199. Calls tick() on every registered butler on a 10-minute cycle. Enumerates butlers from Switchboard's list_butlers(), excludes self, logs results. Error-resilient: one butler's tick failure doesn't stop the cycle.","acceptance_criteria":"1. tick() cycle calls all registered butlers\n2. Self-exclusion from tick targets\n3. Single butler failure doesn't stop cycle\n4. Results logged as sessions\n5. 10-minute cron schedule configured in butler.toml","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:56.497043409+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:38.153204279+08:00","closed_at":"2026-02-09T13:40:38.153204279+08:00","close_reason":"Wave 9 epic complete — all children implemented and merged to main. 429 tests passing.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.14","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:56.49847899+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.14","depends_on_id":"butlers-0qp.13","type":"blocks","created_at":"2026-02-09T12:15:49.410036741+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.14.1","title":"Create Heartbeat butler config and implementation","description":"Create butlers/heartbeat/butler.toml (name=heartbeat, port=8199, schedule: tick every 10 min) and butlers/heartbeat/CLAUDE.md. Heartbeat's tick() enumerates butlers from Switchboard's list_butlers(), excludes itself, calls tick() on each butler via route(). Error-resilient: one failure doesn't stop the cycle.","design":"Heartbeat is a regular butler with a 10-min cron schedule. Its CC prompt: enumerate butlers via list_butlers(), call tick() on each. The CC handles the iteration, Switchboard's route() handles the forwarding.","acceptance_criteria":"1. butler.toml has correct name, port, 10-min schedule\n2. tick cycle enumerates all butlers\n3. Self (heartbeat) excluded from tick targets\n4. Single butler failure doesn't stop cycle\n5. Results logged as sessions","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:12:24.77430292+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:29.295918823+08:00","closed_at":"2026-02-09T13:40:29.295918823+08:00","close_reason":"Wave 9: Heartbeat butler implemented — tick_all tool with self-exclusion and error resilience. 9 tests.","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.14.1","depends_on_id":"butlers-0qp.14","type":"parent-child","created_at":"2026-02-09T12:12:24.77610824+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.14.2","title":"Write Heartbeat butler tests","description":"Write tests/test_heartbeat.py covering: tick cycle dispatches to all butlers, self-exclusion, error resilience (one butler failing doesn't stop others), session logging of tick results.","acceptance_criteria":"1. All scenarios tested\n2. MockSpawner used for CC\n3. Switchboard mocked for butler enumeration\n4. Error resilience verified\n5. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:26.86649374+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:29.309805302+08:00","closed_at":"2026-02-09T13:40:29.309805302+08:00","close_reason":"Wave 9: Heartbeat butler implemented — tick_all tool with self-exclusion and error resilience. 9 tests.","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.14.2","depends_on_id":"butlers-0qp.14","type":"parent-child","created_at":"2026-02-09T12:12:26.867916608+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15","title":"Implement OpenTelemetry instrumentation","description":"OpenTelemetry SDK integration with Jaeger export. init_telemetry(service_name) sets up tracer with OTLP exporter. Span wrappers for MCP tool handlers (butler.tool.\u003cname\u003e with butler.name attribute). Trace context propagation via _trace_context in MCP args and TRACEPARENT env var for CC instances. No-op when OTEL_EXPORTER_OTLP_ENDPOINT not set.","acceptance_criteria":"1. Spans created for each MCP tool invocation\n2. Parent-child span relationships preserved across butler calls\n3. Trace context propagates to CC instances via TRACEPARENT env var\n4. No-op mode when endpoint not configured (no errors, no overhead)\n5. Errors recorded on spans","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:56.788446322+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:29.021934272+08:00","closed_at":"2026-02-09T12:50:29.021934272+08:00","close_reason":"All children completed and merged","labels":["backend","infra"],"dependencies":[{"issue_id":"butlers-0qp.15","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:56.79012853+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15.1","title":"Implement telemetry initialization and tracer setup","description":"Create src/butlers/core/telemetry.py with init_telemetry(service_name) function. Sets up OpenTelemetry TracerProvider with OTLP exporter when OTEL_EXPORTER_OTLP_ENDPOINT env var is set. No-op mode when endpoint not configured (returns a no-op tracer, no errors, no overhead).","acceptance_criteria":"1. Tracer initialized when endpoint configured\n2. No-op mode when endpoint not set\n3. No errors in either mode\n4. Service name set correctly on spans","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:42.037804081+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:43:51.011712975+08:00","closed_at":"2026-02-09T12:43:51.011712975+08:00","close_reason":"Implemented and merged to main in Wave 3","labels":["backend","infra"],"dependencies":[{"issue_id":"butlers-0qp.15.1","depends_on_id":"butlers-0qp.15","type":"parent-child","created_at":"2026-02-09T12:11:42.03928614+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15.2","title":"Implement MCP tool span wrappers","description":"Add span creation wrappers for MCP tool handlers. Each tool invocation creates a span named butler.tool.\u003ctool_name\u003e with butler.name attribute. Errors recorded on spans. Designed as a decorator or context manager for easy application.","acceptance_criteria":"1. Each MCP tool call creates a span\n2. Span named butler.tool.\u003cname\u003e\n3. butler.name attribute set on span\n4. Errors recorded on spans with stack trace","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:48.663308199+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:19.895155634+08:00","closed_at":"2026-02-09T12:50:19.895155634+08:00","close_reason":"Implemented and merged to main in Wave 4","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.15.2","depends_on_id":"butlers-0qp.15","type":"parent-child","created_at":"2026-02-09T12:11:48.664768948+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15.3","title":"Implement trace context propagation","description":"Add trace context propagation helpers. Inter-butler MCP calls include _trace_context in args (W3C Trace Context format). CC spawner sets TRACEPARENT env var for spawned CC instances. Extract and inject helpers for both directions.","acceptance_criteria":"1. _trace_context injected into inter-butler MCP args\n2. TRACEPARENT env var set for CC instances\n3. Parent-child span relationships preserved across butler boundaries\n4. W3C Trace Context format used","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:52.894003238+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:19.905941463+08:00","closed_at":"2026-02-09T12:50:19.905941463+08:00","close_reason":"Implemented and merged to main in Wave 4","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.15.3","depends_on_id":"butlers-0qp.15","type":"parent-child","created_at":"2026-02-09T12:11:52.896318672+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.15.4","title":"Write telemetry tests","description":"Write tests/test_core_telemetry.py using InMemorySpanExporter. Test: span creation for tool calls, parent-child relationships, error recording on spans, no-op mode (no spans exported when endpoint not set).","acceptance_criteria":"1. InMemorySpanExporter captures test spans\n2. Parent-child relationships verified\n3. Error recording verified\n4. No-op mode verified (no spans)\n5. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:57.193345546+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:44:11.627523173+08:00","closed_at":"2026-02-09T12:44:11.627523173+08:00","close_reason":"Already implemented by Wave 3 workers — tests exist and pass","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.15.4","depends_on_id":"butlers-0qp.15","type":"parent-child","created_at":"2026-02-09T12:11:57.194943314+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16","title":"Implement Relationship butler","description":"Personal CRM butler on port 8102. 16 database tables covering contacts, relationships (bidirectional), important dates (partial date support), notes (with emotion), interactions, reminders (one-time/recurring), gifts (status pipeline), loans, groups, labels, quick facts, and activity feed. Full CRUD MCP tools for each domain.","acceptance_criteria":"1. All 16 tables created via migration\n2. Contact CRUD (create, update, get, search, archive) works\n3. Bidirectional relationships maintained\n4. Upcoming dates computed via month/day matching\n5. Activity feed auto-populated from mutating tools\n6. All tool categories have full CRUD coverage","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:00.617968247+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:38.163692446+08:00","closed_at":"2026-02-09T13:40:38.163692446+08:00","close_reason":"Wave 9 epic complete — all children implemented and merged to main. 429 tests passing.","labels":["backend","butler","database"],"dependencies":[{"issue_id":"butlers-0qp.16","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:00.619699307+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.16","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.464647222+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.1","title":"Create Relationship Alembic revision","description":"Create Alembic revision in alembic/versions/relationship/ with all 16 tables: contacts, relationships, important_dates, notes, interactions, reminders, gifts, loans, groups, group_members, labels, contact_labels, quick_facts, activity_feed, plus necessary indexes. Contacts have archive support (archived_at). Uses op.execute() with raw SQL.","acceptance_criteria":"1. All 16 tables created with correct schemas\n2. Appropriate indexes created (especially for search)\n3. Foreign keys reference contacts table\n4. Migration idempotent","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:13:06.550114248+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.686815939+08:00","closed_at":"2026-02-09T13:40:31.686815939+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["butler","database"],"dependencies":[{"issue_id":"butlers-0qp.16.1","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:06.551868301+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.10","title":"Write Relationship butler tests","description":"Write tests/test_tools_relationship.py with full CRUD coverage for all tool categories: contacts, relationships (bidirectional verified), dates (partial dates, upcoming), notes (with emotion, search), interactions, reminders (one_time and recurring), gifts (pipeline), loans, groups, labels, quick facts, and activity feed auto-population.","acceptance_criteria":"1. All tool categories have CRUD test coverage\n2. Bidirectional relationships verified\n3. Upcoming dates computation verified\n4. Feed auto-population verified\n5. Tests use testcontainers PostgreSQL\n6. All tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T12:14:05.555441422+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.772461005+08:00","closed_at":"2026-02-09T13:40:31.772461005+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.16.10","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:14:05.557047867+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.2","title":"Implement contact CRUD tools","description":"Create src/butlers/tools/relationship.py. Contact tools: contact_create(name, details JSONB), contact_update(id, fields), contact_get(id), contact_search(query), contact_archive(id). Archive is soft-delete (sets archived_at). Search supports name and details fields.","acceptance_criteria":"1. contact_create stores name and JSONB details\n2. contact_update modifies specified fields\n3. contact_get returns full contact\n4. contact_search finds by name and details content\n5. contact_archive sets archived_at (soft delete)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:12.276490714+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.696856179+08:00","closed_at":"2026-02-09T13:40:31.696856179+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.2","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:12.278160979+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.3","title":"Implement relationship tools","description":"Add relationship tools: relationship_add(contact_a, contact_b, type, notes) creates bidirectional relationship (two rows), relationship_list(contact_id) returns all relationships for a contact, relationship_remove(contact_a, contact_b) removes both directions.","acceptance_criteria":"1. relationship_add creates bidirectional entries\n2. relationship_list returns all for a contact\n3. relationship_remove deletes both directions\n4. Relationship types are freeform strings","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:13:17.277661356+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.708392277+08:00","closed_at":"2026-02-09T13:40:31.708392277+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.3","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:17.279507673+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.4","title":"Implement date and note tools","description":"Add date tools: date_add(contact_id, label, month, day, year?) supports partial dates, date_list(contact_id), upcoming_dates(days_ahead) uses month/day matching. Add note tools: note_create(contact_id, content, emotion?), note_list(contact_id), note_search(query) full-text search.","acceptance_criteria":"1. Partial dates supported (month/day without year)\n2. upcoming_dates computes correctly via month/day matching\n3. Notes support optional emotion tag\n4. note_search performs text search","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:24.598571352+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.71925393+08:00","closed_at":"2026-02-09T13:40:31.71925393+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.4","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:24.600378536+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.5","title":"Implement interaction and reminder tools","description":"Add interaction tools: interaction_log(contact_id, type, summary, occurred_at), interaction_list(contact_id, limit). Add reminder tools: reminder_create(contact_id, message, type: one_time|recurring, cron?), reminder_list(contact_id), reminder_dismiss(id).","acceptance_criteria":"1. Interactions logged with type and timestamp\n2. interaction_list supports limit\n3. Reminders support one_time and recurring types\n4. Recurring reminders use cron expressions\n5. reminder_dismiss marks as dismissed","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:31.148193949+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.729375094+08:00","closed_at":"2026-02-09T13:40:31.729375094+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.5","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:31.150154412+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.6","title":"Implement gift and loan tools","description":"Add gift tools: gift_add(contact_id, description, occasion?), gift_update_status(id, status) with pipeline (idea→purchased→wrapped→given→thanked), gift_list(contact_id, status?). Add loan tools: loan_create(contact_id, amount, direction: lent|borrowed, description), loan_settle(id), loan_list(contact_id).","acceptance_criteria":"1. Gift status pipeline enforced\n2. gift_list filterable by status\n3. Loans track direction (lent/borrowed)\n4. loan_settle marks as settled\n5. loan_list shows outstanding and settled","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:38.368683047+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.737373897+08:00","closed_at":"2026-02-09T13:40:31.737373897+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.6","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:38.370303819+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.7","title":"Implement group, label, and quick fact tools","description":"Add group tools: group_create(name), group_add_member(group_id, contact_id), group_list(). Add label tools: label_create(name, color?), label_assign(label_id, contact_id), contact_search_by_label(label_name). Add quick facts: fact_set(contact_id, key, value) upserts, fact_list(contact_id).","acceptance_criteria":"1. Groups support member management\n2. Labels assignable to contacts\n3. contact_search_by_label finds all contacts with label\n4. fact_set upserts (same key updates)\n5. fact_list returns all facts for contact","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:44.554935086+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.745567059+08:00","closed_at":"2026-02-09T13:40:31.745567059+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.7","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:44.556417015+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.8","title":"Implement activity feed","description":"Add feed_get(contact_id?, limit) tool. Activity feed auto-populated from all mutating tools (contact created, note added, interaction logged, gift status changed, etc.). Each feed entry has type, description, contact_id, and timestamp.","acceptance_criteria":"1. feed_get returns recent activity\n2. All mutating tools create feed entries\n3. Filterable by contact_id\n4. Supports limit parameter","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:13:50.656783955+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.754405749+08:00","closed_at":"2026-02-09T13:40:31.754405749+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.16.8","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:50.658852192+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.16.9","title":"Create Relationship butler config","description":"Create butlers/relationship/butler.toml (name=relationship, port=8102) and butlers/relationship/CLAUDE.md (personality: personal CRM assistant, instructions for managing contacts, relationships, and personal data).","acceptance_criteria":"1. butler.toml has correct name and port\n2. CLAUDE.md has appropriate personality and instructions","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:13:57.517006656+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:31.763760144+08:00","closed_at":"2026-02-09T13:40:31.763760144+08:00","close_reason":"Wave 9: Relationship butler implemented — full CRM with contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, activity feed. 56 tests.","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.16.9","depends_on_id":"butlers-0qp.16","type":"parent-child","created_at":"2026-02-09T12:13:57.518888911+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17","title":"Implement butler daemon core","description":"ButlerDaemon class orchestrating the full startup sequence: config load -\u003e credential validation -\u003e DB provision -\u003e core migrations -\u003e butler migrations -\u003e module init (topological order) -\u003e tool registration -\u003e FastMCP server start. Core MCP tool wiring: status(), tick(), trigger(), state_*, schedule_*, sessions_*. Graceful shutdown in reverse order.","acceptance_criteria":"1. Startup sequence executes in correct order\n2. All core MCP tools registered and callable\n3. Module tools registered in topological order\n4. status() returns butler identity, modules, health, uptime\n5. Graceful shutdown: stop connections, wait for in-flight CC, module shutdown (reverse order), close DB pool","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:01.740428366+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:29.353673229+08:00","closed_at":"2026-02-09T13:18:29.353673229+08:00","close_reason":"All children completed","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:01.742111877+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.2","type":"blocks","created_at":"2026-02-09T12:15:48.513249193+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.3","type":"blocks","created_at":"2026-02-09T12:15:48.568728916+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.4","type":"blocks","created_at":"2026-02-09T12:15:48.909758455+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.5","type":"blocks","created_at":"2026-02-09T12:15:48.964838122+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.6","type":"blocks","created_at":"2026-02-09T12:15:49.02041538+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.7","type":"blocks","created_at":"2026-02-09T12:15:49.076717888+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.8","type":"blocks","created_at":"2026-02-09T12:15:49.133485584+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.17","depends_on_id":"butlers-0qp.11","type":"blocks","created_at":"2026-02-09T12:15:49.187240499+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.1","title":"Implement ButlerDaemon class with startup sequence","description":"Create src/butlers/daemon.py with ButlerDaemon class. Orchestrates startup: config load -\u003e credential validation -\u003e DB provision -\u003e core Alembic migrations -\u003e butler-specific Alembic migrations -\u003e module init (topological order, including module Alembic revisions) -\u003e tool registration -\u003e FastMCP server start. The composition root that wires everything together.","design":"ButlerDaemon holds references to config, db pool, spawner, scheduler, modules. Startup is a sequential async flow. FastMCP server created with butler name, runs on configured port with SSE transport.","acceptance_criteria":"1. Startup executes in correct documented order\n2. Failure at any step prevents subsequent steps\n3. All components accessible on daemon instance\n4. FastMCP server starts on configured port","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T12:12:02.345988389+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:22.605575067+08:00","closed_at":"2026-02-09T13:18:22.605575067+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.1","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:02.347898496+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.2","title":"Implement core MCP tool registration","description":"Wire all core MCP tools on the FastMCP server instance: status(), tick(), trigger(prompt), state_get/set/delete/list, schedule_list/create/update/delete, sessions_list/get. Each tool delegates to the appropriate core component.","acceptance_criteria":"1. All core tools registered on FastMCP\n2. Tools callable via MCP protocol\n3. Tools delegate to correct core components\n4. Tool signatures match spec","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:12:10.333829246+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:22.619052694+08:00","closed_at":"2026-02-09T13:18:22.619052694+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.2","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:10.335774421+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.3","title":"Implement module tool registration","description":"Call register_tools(mcp, config, db) for each enabled module in topological order. Module configs validated against their config_schema. Module migrations applied before tool registration.","acceptance_criteria":"1. Modules loaded in topological dependency order\n2. Module configs validated against config_schema\n3. Module migrations applied before register_tools\n4. Module tools registered on shared FastMCP instance","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:14.909502577+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:22.626108711+08:00","closed_at":"2026-02-09T13:18:22.626108711+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.3","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:14.911256801+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.4","title":"Implement graceful shutdown sequence","description":"Graceful shutdown: stop accepting new connections, wait for in-flight CC instances to complete, call module on_shutdown() in reverse topological order, close DB pool. Triggered by SIGINT/SIGTERM or explicit shutdown call.","acceptance_criteria":"1. No new connections accepted during shutdown\n2. In-flight CC instances complete before shutdown\n3. Module on_shutdown called in reverse order\n4. DB pool closed last\n5. Clean exit with no resource leaks","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:12:20.729320572+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:22.635657964+08:00","closed_at":"2026-02-09T13:18:22.635657964+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.4","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:20.731030692+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.5","title":"Implement status() MCP tool","description":"Implement status() tool returning butler identity (name, description, port), loaded modules list, health status, and uptime (time since startup). Used by Heartbeat and for diagnostics.","acceptance_criteria":"1. Returns butler name, description, port\n2. Lists loaded modules\n3. Reports health status\n4. Reports uptime since startup","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:12:27.77168615+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:22.645127617+08:00","closed_at":"2026-02-09T13:18:22.645127617+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.17.5","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:27.773122944+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.17.6","title":"Write butler daemon tests","description":"Write tests/test_daemon.py covering: startup sequence order verification, core tool registration, module tool registration, shutdown order (reverse of startup), status() tool output.","acceptance_criteria":"1. Startup sequence order verified\n2. All core tools registered\n3. Module registration in topological order\n4. Shutdown in reverse order\n5. status() returns expected fields\n6. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:12:33.486972898+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:18:22.654998988+08:00","closed_at":"2026-02-09T13:18:22.654998988+08:00","close_reason":"Implemented and merged to main","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.17.6","depends_on_id":"butlers-0qp.17","type":"parent-child","created_at":"2026-02-09T12:12:33.488891312+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18","title":"Implement Health butler","description":"Health tracking butler on port 8103. Tables for measurements, medications, medication_doses, conditions, meals, symptoms, research. MCP tools for measurement logging/history, medication management with adherence rate, condition tracking, diet/nutrition with aggregation, symptom tracking, research notes, and health summary/trend reports.","acceptance_criteria":"1. All health tables created via migration\n2. Measurement log/history/latest tools work\n3. Medication adherence rate computed correctly\n4. Nutrition summary aggregates meal data\n5. Trend report generates meaningful summaries\n6. All tool categories have full coverage","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:04.479165077+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:38.173661782+08:00","closed_at":"2026-02-09T13:40:38.173661782+08:00","close_reason":"Wave 9 epic complete — all children implemented and merged to main. 429 tests passing.","labels":["backend","butler","database"],"dependencies":[{"issue_id":"butlers-0qp.18","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:04.480751704+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.18","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.520924002+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.1","title":"Create Health database migration","description":"Create migrations/health/001_health.sql with tables: measurements (id, type, value JSONB, unit, measured_at), medications (id, name, dosage, frequency, active), medication_doses (id, medication_id FK, taken_at, notes), conditions (id, name, status, diagnosed_at, notes), meals (id, description, calories, nutrients JSONB, eaten_at), symptoms (id, name, severity, notes, occurred_at), research (id, topic, content, sources JSONB, created_at). Plus appropriate indexes.","acceptance_criteria":"1. All 7 tables created with correct schemas\n2. Foreign key from medication_doses to medications\n3. Appropriate indexes for time-range queries\n4. Migration idempotent","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:13.969283232+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.291694528+08:00","closed_at":"2026-02-09T13:40:33.291694528+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["butler","database"],"dependencies":[{"issue_id":"butlers-0qp.18.1","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:13.970835654+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.2","title":"Implement measurement tools","description":"Create src/butlers/tools/health.py. Measurement tools: measurement_log(type, value, unit, measured_at?), measurement_history(type, since?, until?), measurement_latest(type). Types are freeform strings (weight, blood_pressure, heart_rate, etc.). Values stored as JSONB to support compound measurements.","acceptance_criteria":"1. measurement_log stores with timestamp\n2. measurement_history filters by type and date range\n3. measurement_latest returns most recent for type\n4. JSONB values support compound data (e.g., systolic/diastolic)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:21.715545229+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.302071595+08:00","closed_at":"2026-02-09T13:40:33.302071595+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.2","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:21.717811009+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.3","title":"Implement medication tools","description":"Add medication tools: medication_add(name, dosage, frequency), medication_list(active_only?), medication_log_dose(medication_id, taken_at?, notes?), medication_history(medication_id, since?, until?) with adherence rate computation (doses taken / expected doses based on frequency).","acceptance_criteria":"1. medication_add creates active medication\n2. medication_list filterable by active status\n3. medication_log_dose records dose taken\n4. medication_history includes adherence rate\n5. Adherence rate computed correctly","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:28.704068241+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.311389491+08:00","closed_at":"2026-02-09T13:40:33.311389491+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.3","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:28.705861979+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.4","title":"Implement condition and symptom tools","description":"Add condition tools: condition_add(name, status, diagnosed_at?, notes?), condition_list(status?), condition_update(id, fields). Add symptom tools: symptom_log(name, severity 1-10, notes?, occurred_at?), symptom_history(name?, since?, until?), symptom_search(query).","acceptance_criteria":"1. Conditions track status (active, resolved, managed)\n2. condition_list filterable by status\n3. symptom_log records with severity scale\n4. symptom_history supports filtering\n5. symptom_search finds by name and notes","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:34.046531237+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.320561502+08:00","closed_at":"2026-02-09T13:40:33.320561502+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.4","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:34.048107193+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.5","title":"Implement diet and nutrition tools","description":"Add diet tools: meal_log(description, calories?, nutrients JSONB?, eaten_at?), meal_history(since?, until?), nutrition_summary(since, until) aggregating calories and nutrient totals over a date range.","acceptance_criteria":"1. meal_log stores with optional nutrition data\n2. meal_history returns meals in date range\n3. nutrition_summary aggregates calories and nutrients\n4. Nutrients stored as JSONB for flexibility","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:39.942698291+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.329215233+08:00","closed_at":"2026-02-09T13:40:33.329215233+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.5","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:39.944401669+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.6","title":"Implement research and report tools","description":"Add research tools: research_save(topic, content, sources?), research_search(query), research_summarize(topic). Add report tools: health_summary() returns overview of recent measurements/medications/conditions, trend_report(type, since, until) generates trend analysis for a measurement type.","acceptance_criteria":"1. research_save stores with optional sources\n2. research_search finds by topic and content\n3. health_summary covers all health domains\n4. trend_report analyzes measurement trends","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:45.803917756+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.338220568+08:00","closed_at":"2026-02-09T13:40:33.338220568+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.18.6","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:45.805411358+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.7","title":"Create Health butler config","description":"Create butlers/health/butler.toml (name=health, port=8103) and butlers/health/CLAUDE.md (personality: health tracking assistant, instructions for logging and analyzing health data).","acceptance_criteria":"1. butler.toml has correct name and port\n2. CLAUDE.md has appropriate personality and instructions","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:14:50.993440482+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.347896752+08:00","closed_at":"2026-02-09T13:40:33.347896752+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.18.7","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:50.994989267+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.18.8","title":"Write Health butler tests","description":"Write tests/test_tools_health.py with full coverage: measurements (log, history, latest), medications (add, list, log dose, adherence rate), conditions (add, list, update), diet (meal log, history, nutrition summary), symptoms (log, history, search), research (save, search), reports (health summary, trend report).","acceptance_criteria":"1. All tool categories tested\n2. Adherence rate computation verified\n3. Nutrition aggregation verified\n4. Trend report generation verified\n5. Tests use testcontainers PostgreSQL\n6. All tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:14:56.713963614+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:40:33.357259743+08:00","closed_at":"2026-02-09T13:40:33.357259743+08:00","close_reason":"Wave 9: Health butler implemented — measurements, medications, conditions, symptoms, diet, research, reports. 39 tests.","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.18.8","depends_on_id":"butlers-0qp.18","type":"parent-child","created_at":"2026-02-09T12:14:56.715440694+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19","title":"Implement General butler","description":"Catch-all butler on port 8101. Schema-light freeform JSONB storage with collections and entities tables (GIN indexes). Entity CRUD with deep merge on update. Collection management. Export tools for future migration to specialist butlers. The default routing target when no specialist butler matches.","acceptance_criteria":"1. collections and entities tables with GIN indexes created\n2. Entity CRUD (create, get, update with deep merge, search, delete) works\n3. Collection management tools work\n4. GIN index enables efficient JSONB search\n5. Export tools produce usable output","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:09.581501378+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:12.218499746+08:00","closed_at":"2026-02-09T13:28:12.218499746+08:00","close_reason":"Wave 8 epic complete — all children implemented and merged to main. 325 tests passing.","labels":["backend","butler","database"],"dependencies":[{"issue_id":"butlers-0qp.19","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:09.583583942+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.19","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.578087044+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19.1","title":"Create General database migration","description":"Create migrations/general/001_general.sql with collections table (id UUID PK, name TEXT UNIQUE, description TEXT, created_at TIMESTAMPTZ) and entities table (id UUID PK, collection_id UUID FK, data JSONB NOT NULL, created_at TIMESTAMPTZ, updated_at TIMESTAMPTZ). Add GIN index on entities.data for efficient JSONB search.","acceptance_criteria":"1. collections and entities tables created\n2. GIN index on entities.data\n3. Foreign key from entities to collections\n4. Migration idempotent","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:15:03.112865592+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:08.167878414+08:00","closed_at":"2026-02-09T13:28:08.167878414+08:00","close_reason":"Wave 8: General butler implemented — collection/entity CRUD, deep merge, GIN search, export. 33 tests passing.","labels":["butler","database"],"dependencies":[{"issue_id":"butlers-0qp.19.1","depends_on_id":"butlers-0qp.19","type":"parent-child","created_at":"2026-02-09T12:15:03.114392125+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19.2","title":"Implement General butler entity and collection tools","description":"Create src/butlers/tools/general.py. Entity tools: entity_create(collection, data JSONB), entity_get(id), entity_update(id, data) with deep merge, entity_search(collection?, query JSONB), entity_delete(id). Collection tools: collection_create(name, description?), collection_list(), collection_delete(name). Export tools: export_collection(name) returns all entities as JSON.","design":"entity_update uses JSONB deep merge (jsonb_deep_merge or || operator with recursive merge). entity_search uses GIN index via @\u003e containment operator. Export produces a JSON array of all entities in a collection.","acceptance_criteria":"1. Entity CRUD with deep merge on update\n2. GIN-indexed JSONB search via containment\n3. Collection management works\n4. Export produces complete collection dump\n5. Freeform JSONB data accepted","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:15:12.418318081+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:08.176503587+08:00","closed_at":"2026-02-09T13:28:08.176503587+08:00","close_reason":"Wave 8: General butler implemented — collection/entity CRUD, deep merge, GIN search, export. 33 tests passing.","labels":["backend","butler"],"dependencies":[{"issue_id":"butlers-0qp.19.2","depends_on_id":"butlers-0qp.19","type":"parent-child","created_at":"2026-02-09T12:15:12.419722404+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19.3","title":"Create General butler config","description":"Create butlers/general/butler.toml (name=general, port=8101) and butlers/general/CLAUDE.md (personality: flexible catch-all assistant, instructions for storing and retrieving freeform data).","acceptance_criteria":"1. butler.toml has correct name and port\n2. CLAUDE.md has appropriate personality and instructions","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-09T12:15:17.077605865+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:08.184470736+08:00","closed_at":"2026-02-09T13:28:08.184470736+08:00","close_reason":"Wave 8: General butler implemented — collection/entity CRUD, deep merge, GIN search, export. 33 tests passing.","labels":["butler"],"dependencies":[{"issue_id":"butlers-0qp.19.3","depends_on_id":"butlers-0qp.19","type":"parent-child","created_at":"2026-02-09T12:15:17.07953562+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.19.4","title":"Write General butler tests","description":"Write tests/test_tools_general.py covering: entity CRUD, deep merge on update (nested objects merged correctly), GIN-indexed search (containment queries), collection management, export, freeform JSONB acceptance.","acceptance_criteria":"1. All tool operations tested\n2. Deep merge verified with nested objects\n3. GIN search verified with containment\n4. Export completeness verified\n5. Tests use testcontainers PostgreSQL\n6. All tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:15:22.437261116+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:08.193322667+08:00","closed_at":"2026-02-09T13:28:08.193322667+08:00","close_reason":"Wave 8: General butler implemented — collection/entity CRUD, deep merge, GIN search, export. 33 tests passing.","labels":["butler","testing"],"dependencies":[{"issue_id":"butlers-0qp.19.4","depends_on_id":"butlers-0qp.19","type":"parent-child","created_at":"2026-02-09T12:15:22.439045156+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2","title":"Implement config loading","description":"Parse butler.toml configuration files with support for [butler] identity (name, port, description), [butler.db] database config, [butler.env] credential declarations (required/optional), [[butler.schedule]] task definitions, and [modules.*] module configs. Validate required fields, apply defaults.","acceptance_criteria":"1. Valid full config loads all sections correctly\n2. Minimal config applies defaults (db name = butler_{name})\n3. Missing/invalid TOML raises clear error\n4. Missing required fields (name, port) prevent startup","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:06:58.946023801+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:30.606019845+08:00","closed_at":"2026-02-09T12:34:30.606019845+08:00","close_reason":"All config loading subtasks completed","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.2","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:06:58.947296466+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2.1","title":"Implement ButlerConfig dataclass and TOML parser","description":"Create src/butlers/config.py with ButlerConfig dataclass. Parse butler.toml sections: [butler] (name, port, description), [butler.db] (name with default butler_{name}), [[butler.schedule]] (name, cron, prompt), [modules.*] (module-specific config). Use tomllib (stdlib).","design":"ButlerConfig dataclass with fields: name (str), port (int), description (str|None), db_name (str), schedules (list[ScheduleConfig]), modules (dict[str, dict]). ScheduleConfig dataclass: name, cron, prompt. Validation at parse time.","acceptance_criteria":"1. Valid full config loads all sections\n2. Minimal config (name + port only) applies defaults\n3. Config object exposes all parsed fields","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:14.821442559+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:33:39.845850967+08:00","closed_at":"2026-02-09T12:33:39.845850967+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.2.1","depends_on_id":"butlers-0qp.2","type":"parent-child","created_at":"2026-02-09T12:10:14.823012765+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2.2","title":"Add butler.env credential declaration support","description":"Add [butler.env] section parsing to ButlerConfig. Supports required (list[str]) and optional (list[str]) env var declarations. These are used by credential validation at startup.","acceptance_criteria":"1. [butler.env].required parsed as list of env var names\n2. [butler.env].optional parsed as list of env var names\n3. Missing section defaults to empty lists","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:18.113979062+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:23.500636742+08:00","closed_at":"2026-02-09T12:34:23.500636742+08:00","close_reason":"Already implemented in butlers-0qp.2.1 worker (env section parsing included in config.py)","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.2.2","depends_on_id":"butlers-0qp.2","type":"parent-child","created_at":"2026-02-09T12:10:18.115508922+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2.3","title":"Add config validation for required fields","description":"Validate that butler.toml contains [butler] section with name (str) and port (int). Reject startup with clear error if file is missing, unparseable TOML, or lacks required fields.","acceptance_criteria":"1. Missing butler.toml raises ConfigError\n2. Invalid TOML syntax raises parse error with location info\n3. Missing name field raises validation error\n4. Missing port field raises validation error\n5. Daemon does not proceed past config loading on error","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:19.392429438+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:33:39.861524113+08:00","closed_at":"2026-02-09T12:33:39.861524113+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.2.3","depends_on_id":"butlers-0qp.2","type":"parent-child","created_at":"2026-02-09T12:10:19.394163243+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.2.4","title":"Write config loading tests","description":"Write tests/test_config.py covering: valid full config, minimal config with defaults, missing file, invalid TOML, missing required fields (name, port), env section parsing, schedule section parsing, module section parsing.","acceptance_criteria":"1. Test cases for every scenario listed\n2. All tests pass\n3. Edge cases covered (empty sections, extra fields)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:21.201546671+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:23.567298125+08:00","closed_at":"2026-02-09T12:34:23.567298125+08:00","close_reason":"Already implemented in butlers-0qp.2.1 worker (10 tests in test_config.py)","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.2.4","depends_on_id":"butlers-0qp.2","type":"parent-child","created_at":"2026-02-09T12:10:21.203415531+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20","title":"Implement CLI commands","description":"Click-based CLI with 4 commands: 'butlers up' (discover all butler.toml configs, start all in single asyncio event loop, --only filtering), 'butlers run --config' (single butler startup), 'butlers list' (discover and display names/ports/modules), 'butlers init \u003cname\u003e --port' (scaffold config dir with butler.toml, CLAUDE.md, AGENTS.md, skills/). Graceful shutdown on SIGINT/SIGTERM. Entry point in pyproject.toml.","acceptance_criteria":"1. butlers up discovers and starts all butlers\n2. butlers up --only filters to specific butlers\n3. butlers run starts a single butler from config path\n4. butlers list displays all discovered butlers\n5. butlers init scaffolds a complete config directory\n6. SIGINT/SIGTERM trigger graceful shutdown\n7. Entry point registered in pyproject.toml","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:17.695713261+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:12.208750451+08:00","closed_at":"2026-02-09T13:28:12.208750451+08:00","close_reason":"Wave 8 epic complete — all children implemented and merged to main. 325 tests passing.","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:17.697466273+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.20","depends_on_id":"butlers-0qp.17","type":"blocks","created_at":"2026-02-09T12:15:49.635262191+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.1","title":"Implement Click CLI with butlers up command","description":"Create src/butlers/cli.py with Click CLI group. Implement 'butlers up' command: discover all butler.toml configs in butlers/ directory, start all butler daemons in a single asyncio event loop, support --only flag to filter specific butlers.","design":"Click group 'butlers' with subcommands. 'up' discovers config dirs, creates ButlerDaemon per config, runs all in asyncio.gather. --only accepts comma-separated butler names.","acceptance_criteria":"1. butlers up discovers all butler configs\n2. All discovered butlers start in one event loop\n3. --only filters to specified butlers only\n4. Missing butlers/ directory gives clear error","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:13:46.75134368+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:06.974152775+08:00","closed_at":"2026-02-09T13:28:06.974152775+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.1","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:46.752872989+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.2","title":"Implement butlers run command","description":"Implement 'butlers run --config \u003cpath\u003e' command: start a single butler daemon from the specified config directory path.","acceptance_criteria":"1. Starts single butler from config path\n2. Missing config path gives clear error\n3. Invalid config gives clear error\n4. Runs until SIGINT/SIGTERM","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:13:49.59251006+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:06.983063076+08:00","closed_at":"2026-02-09T13:28:06.983063076+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.2","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:49.594832366+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.3","title":"Implement butlers list command","description":"Implement 'butlers list' command: discover all butler.toml configs and display butler names, ports, descriptions, and enabled modules in a formatted table.","acceptance_criteria":"1. Discovers all butler configs\n2. Displays name, port, description, modules\n3. Formatted for readability","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:13:51.559502+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:06.991808426+08:00","closed_at":"2026-02-09T13:28:06.991808426+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.3","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:51.561034836+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.4","title":"Implement butlers init command","description":"Implement 'butlers init \u003cname\u003e --port \u003cport\u003e' command: scaffold a new butler config directory with butler.toml (pre-filled name and port), CLAUDE.md (template), AGENTS.md (empty), and skills/ directory.","acceptance_criteria":"1. Creates butlers/\u003cname\u003e/ directory\n2. butler.toml has correct name and port\n3. CLAUDE.md created with template content\n4. AGENTS.md created (empty or with template)\n5. skills/ directory created\n6. Existing directory not overwritten","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:13:55.377542099+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:06.99986811+08:00","closed_at":"2026-02-09T13:28:06.99986811+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.4","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:55.409346322+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.5","title":"Implement graceful shutdown on signals","description":"Handle SIGINT and SIGTERM in CLI commands. Trigger graceful shutdown of all running butler daemons. Works for both 'butlers up' (multiple) and 'butlers run' (single).","acceptance_criteria":"1. SIGINT triggers graceful shutdown\n2. SIGTERM triggers graceful shutdown\n3. All butlers shut down cleanly\n4. Exit code 0 on clean shutdown","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:13:58.562950862+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:07.008382243+08:00","closed_at":"2026-02-09T13:28:07.008382243+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["backend","cli"],"dependencies":[{"issue_id":"butlers-0qp.20.5","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:13:58.566326098+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.6","title":"Add CLI entry point to pyproject.toml","description":"Add [project.scripts] entry point to pyproject.toml mapping 'butlers' to src/butlers/cli.py main function. Verify 'butlers --help' works after uv sync.","acceptance_criteria":"1. [project.scripts] entry defined\n2. butlers --help works after installation\n3. All subcommands listed","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":10,"created_at":"2026-02-09T12:14:01.354292834+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:07.017965435+08:00","closed_at":"2026-02-09T13:28:07.017965435+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["infra"],"dependencies":[{"issue_id":"butlers-0qp.20.6","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:14:01.356183365+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.20.7","title":"Write CLI tests","description":"Write tests/test_cli.py using Click's CliRunner. Test: command invocation (up, run, list, init), discovery of butler configs, init scaffolding (correct files created), signal handling.","acceptance_criteria":"1. All commands tested via CliRunner\n2. Discovery logic verified\n3. Init scaffolding verified (files exist with correct content)\n4. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:04.417757963+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:28:07.027214295+08:00","closed_at":"2026-02-09T13:28:07.027214295+08:00","close_reason":"Wave 8: CLI commands implemented — up, run, list, init, entry point. 16 tests passing.","labels":["cli","testing"],"dependencies":[{"issue_id":"butlers-0qp.20.7","depends_on_id":"butlers-0qp.20","type":"parent-child","created_at":"2026-02-09T12:14:04.419483632+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.21","title":"Implement Docker and deployment","description":"Dockerfile with python:3.12-slim base, Node.js 22, claude-code npm package, uv. docker-compose.yml defining postgres:17, jaeger, switchboard, general, relationship, health, heartbeat services. Dev quick start: docker compose up -d postgres jaeger \u0026\u0026 butlers up. Production: docker compose up -d.","acceptance_criteria":"1. Dockerfile builds successfully with all runtime deps\n2. docker-compose.yml defines all services with correct ports\n3. Dev mode: postgres + jaeger containers, butlers up locally\n4. Production mode: full stack via docker compose up -d\n5. Database auto-provisioning works in both modes","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:22.006375664+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:35.137509555+08:00","closed_at":"2026-02-09T13:50:35.137509555+08:00","close_reason":"Wave 10 epic complete — all children implemented and merged to main. 449 tests passing.","labels":["deployment","infra"],"dependencies":[{"issue_id":"butlers-0qp.21","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:22.00884053+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.21","depends_on_id":"butlers-0qp.20","type":"blocks","created_at":"2026-02-09T12:15:49.691993498+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.21.1","title":"Create Dockerfile","description":"Create Dockerfile based on python:3.12-slim. Install Node.js 22 (for claude-code npm package), install claude-code globally, install uv, copy project, run uv sync. Entrypoint: butlers run --config.","acceptance_criteria":"1. Builds successfully\n2. Python 3.12, Node.js 22, claude-code, uv all available\n3. Project dependencies installed\n4. Entrypoint works with --config flag","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:09.715751029+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:28.432203589+08:00","closed_at":"2026-02-09T13:50:28.432203589+08:00","close_reason":"Wave 10: Docker deployment — Dockerfile, docker-compose.yml, .env.example.","labels":["deployment","infra"],"dependencies":[{"issue_id":"butlers-0qp.21.1","depends_on_id":"butlers-0qp.21","type":"parent-child","created_at":"2026-02-09T12:14:09.718671745+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.21.2","title":"Create docker-compose.yml","description":"Create docker-compose.yml defining services: postgres:17 (with health check), jaeger (all-in-one with OTLP receiver), switchboard (port 8100), general (port 8101), relationship (port 8102), health (port 8103), heartbeat (port 8199). All butler services depend on postgres, share ANTHROPIC_API_KEY env var.","design":"postgres: postgres:17 with POSTGRES_PASSWORD, volume for data persistence, health check. jaeger: jaegertracing/all-in-one with ports 16686 (UI) and 4317 (OTLP). Butler services: built from Dockerfile, each with --config pointing to their butler dir, depends_on postgres healthy.","acceptance_criteria":"1. All services defined with correct ports\n2. postgres has health check\n3. Butler services depend on postgres\n4. ANTHROPIC_API_KEY passed to all butler services\n5. Jaeger configured for OTLP and UI","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:12.351420431+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:28.44238559+08:00","closed_at":"2026-02-09T13:50:28.44238559+08:00","close_reason":"Wave 10: Docker deployment — Dockerfile, docker-compose.yml, .env.example.","labels":["deployment","infra"],"dependencies":[{"issue_id":"butlers-0qp.21.2","depends_on_id":"butlers-0qp.21","type":"parent-child","created_at":"2026-02-09T12:14:12.352938389+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.21.3","title":"Verify dev and production quick starts","description":"Verify two deployment modes work: Dev mode (docker compose up -d postgres jaeger \u0026\u0026 butlers up), Production mode (docker compose up -d). Document any required .env setup.","acceptance_criteria":"1. Dev mode: postgres + jaeger in Docker, butlers locally\n2. Production mode: full stack via docker compose\n3. Database auto-provisioning works in both modes\n4. Butlers connect to postgres in both modes","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:14:14.068098688+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:28.446317479+08:00","closed_at":"2026-02-09T13:50:28.446317479+08:00","close_reason":"Wave 10: Docker deployment — Dockerfile, docker-compose.yml, .env.example.","labels":["deployment","infra"],"dependencies":[{"issue_id":"butlers-0qp.21.3","depends_on_id":"butlers-0qp.21","type":"parent-child","created_at":"2026-02-09T12:14:14.069519131+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22","title":"Write integration tests","description":"End-to-end integration tests using testcontainer PostgreSQL and MockSpawner. Four key test scenarios: full butler startup lifecycle, scheduler tick dispatch, switchboard routing, and trace context propagation across the full chain.","acceptance_criteria":"1. Full butler startup test: config -\u003e DB -\u003e migrations -\u003e tools -\u003e status()\n2. Scheduler tick dispatches to MockSpawner and logs session\n3. Switchboard route() forwards to target and returns result\n4. Trace context propagates from switchboard.route -\u003e butler.trigger -\u003e CC session","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:08:25.898819522+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:35.148508549+08:00","closed_at":"2026-02-09T13:50:35.148508549+08:00","close_reason":"Wave 10 epic complete — all children implemented and merged to main. 449 tests passing.","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:08:25.900446235+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.22","depends_on_id":"butlers-0qp.13","type":"blocks","created_at":"2026-02-09T12:15:49.750331942+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.22","depends_on_id":"butlers-0qp.14","type":"blocks","created_at":"2026-02-09T12:15:49.808386599+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.22","depends_on_id":"butlers-0qp.15","type":"blocks","created_at":"2026-02-09T12:15:49.867003609+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22.1","title":"Write full butler startup integration test","description":"Integration test: full butler startup with testcontainer PostgreSQL and MockSpawner. Verify: config load -\u003e DB provision -\u003e migrations -\u003e tool registration -\u003e status() returns correct data. Tests the entire ButlerDaemon lifecycle end-to-end.","acceptance_criteria":"1. Real PostgreSQL via testcontainers\n2. Full startup sequence completes\n3. Database provisioned with all tables\n4. MCP tools registered and callable\n5. status() returns correct identity and modules","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:14:18.621003233+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:30.069832382+08:00","closed_at":"2026-02-09T13:50:30.069832382+08:00","close_reason":"Wave 10: Integration tests — butler lifecycle, scheduler tick, switchboard routing, trace propagation. 20 tests.","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22.1","depends_on_id":"butlers-0qp.22","type":"parent-child","created_at":"2026-02-09T12:14:18.62251031+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22.2","title":"Write scheduler tick integration test","description":"Integration test: scheduler tick dispatches to MockSpawner and logs session. Set up a butler with a schedule, advance time past cron trigger, call tick(), verify MockSpawner received the prompt and session was logged.","acceptance_criteria":"1. Schedule task created in DB\n2. tick() dispatches due task to MockSpawner\n3. MockSpawner receives correct prompt\n4. Session logged with trigger_source='schedule'","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:22.531100628+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:30.082912849+08:00","closed_at":"2026-02-09T13:50:30.082912849+08:00","close_reason":"Wave 10: Integration tests — butler lifecycle, scheduler tick, switchboard routing, trace propagation. 20 tests.","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22.2","depends_on_id":"butlers-0qp.22","type":"parent-child","created_at":"2026-02-09T12:14:22.53281709+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22.3","title":"Write switchboard routing integration test","description":"Integration test: switchboard route() forwards to target butler and returns result. Set up switchboard and a target butler, register target in butler_registry, call route() with a tool name and args, verify target receives the call and response is returned.","acceptance_criteria":"1. Both butlers running (switchboard + target)\n2. Target registered in butler_registry\n3. route() forwards tool call to target\n4. Response returned to caller\n5. routing_log entry created","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:14:23.427141692+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:30.097702155+08:00","closed_at":"2026-02-09T13:50:30.097702155+08:00","close_reason":"Wave 10: Integration tests — butler lifecycle, scheduler tick, switchboard routing, trace propagation. 20 tests.","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22.3","depends_on_id":"butlers-0qp.22","type":"parent-child","created_at":"2026-02-09T12:14:23.428802088+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.22.4","title":"Write trace context propagation integration test","description":"Integration test: trace context propagates from switchboard.route -\u003e butler.trigger -\u003e CC session. Verify parent-child span relationships across the full chain using InMemorySpanExporter.","acceptance_criteria":"1. Trace context injected at switchboard\n2. Propagated through route() to target butler\n3. Propagated to CC session via TRACEPARENT\n4. Parent-child span relationships verified\n5. All spans share same trace ID","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:14:24.548055995+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:50:30.108971971+08:00","closed_at":"2026-02-09T13:50:30.108971971+08:00","close_reason":"Wave 10: Integration tests — butler lifecycle, scheduler tick, switchboard routing, trace propagation. 20 tests.","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.22.4","depends_on_id":"butlers-0qp.22","type":"parent-child","created_at":"2026-02-09T12:14:24.54955182+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3","title":"Implement module system","description":"Build the pluggable module system: Module ABC with name, config_schema, dependencies, register_tools, migrations, on_startup, on_shutdown. Module registry with topological dependency sort, circular dependency detection, and config-driven loading from butler.toml [modules.*] sections.","acceptance_criteria":"1. Module ABC enforces all required abstract members\n2. Registry resolves dependencies via topological sort\n3. Circular dependencies detected and rejected\n4. Missing dependencies fail fast with clear error\n5. Modules loaded in correct dependency order","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:02.879608473+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:30.665402419+08:00","closed_at":"2026-02-09T12:34:30.665402419+08:00","close_reason":"All module system subtasks completed","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.3","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:02.880944878+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3.1","title":"Implement Module abstract base class","description":"Create src/butlers/modules/base.py with Module ABC. Abstract members: name (str property), config_schema (type[BaseModel] property), dependencies (list[str] property), register_tools(mcp, config, db) async method, migration_revisions() method returning str | None (Alembic branch label for module's revisions, or None if no migrations needed), on_startup(config, db) async method, on_shutdown() async method.","design":"Use abc.ABC and abc.abstractmethod. config_schema returns a Pydantic BaseModel subclass so module configs are validated. Dependencies declared as module name strings. register_tools receives FastMCP instance, validated config, and asyncpg pool.","acceptance_criteria":"1. Cannot instantiate Module directly (ABC)\n2. Subclass missing any abstract member raises TypeError\n3. Minimal concrete implementation instantiates successfully\n4. All abstract members have correct signatures","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:31.971700635+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:33:39.870115873+08:00","closed_at":"2026-02-09T12:33:39.870115873+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.3.1","depends_on_id":"butlers-0qp.3","type":"parent-child","created_at":"2026-02-09T12:10:31.973741289+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3.2","title":"Implement module registry with topological sort","description":"Create src/butlers/modules/registry.py. Module registry maintains name-\u003eclass mapping. load_from_config(modules_config) instantiates enabled modules, resolves dependency order via topological sort (Kahn's algorithm), detects circular dependencies, and validates all declared dependencies exist in the registry.","design":"Registry is a dict[str, type[Module]]. Topological sort using in-degree counting (Kahn's algorithm). Circular deps detected when sorted result length != input length. Missing deps caught during validation before sort.","acceptance_criteria":"1. Modules registered by name\n2. load_from_config returns modules in topological order\n3. Circular dependencies raise clear error\n4. Missing dependencies raise clear error\n5. Independent modules have no ordering constraints","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:37.455060922+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:33:39.878407325+08:00","closed_at":"2026-02-09T12:33:39.878407325+08:00","close_reason":"Implemented and merged to main","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.3.2","depends_on_id":"butlers-0qp.3","type":"parent-child","created_at":"2026-02-09T12:10:37.456657337+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3.3","title":"Write Module ABC tests","description":"Write tests/test_module_base.py covering: minimal module implementation with all members, incomplete implementation raises TypeError, module with no dependencies returns empty list, module with no migrations returns empty list.","acceptance_criteria":"1. All scenarios tested\n2. Tests verify ABC enforcement\n3. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:40.287952205+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:23.622813102+08:00","closed_at":"2026-02-09T12:34:23.622813102+08:00","close_reason":"Already implemented in butlers-0qp.3.1 worker (9 tests in test_module_base.py)","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.3.3","depends_on_id":"butlers-0qp.3","type":"parent-child","created_at":"2026-02-09T12:10:40.289652526+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.3.4","title":"Write module registry tests","description":"Write tests/test_module_registry.py covering: registration, dependency ordering (A depends on B → B loads first), circular detection (A→B→A), missing dependencies, config-driven loading, modules not in config excluded.","acceptance_criteria":"1. Dependency ordering verified with 3+ modules\n2. Circular dependency raises error with cycle description\n3. Missing dependency raises error naming the missing module\n4. Only config-enabled modules loaded","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:43.277281263+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:23.68377011+08:00","closed_at":"2026-02-09T12:34:23.68377011+08:00","close_reason":"Already implemented in butlers-0qp.3.2 worker (12 tests in test_module_registry.py)","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.3.4","depends_on_id":"butlers-0qp.3","type":"parent-child","created_at":"2026-02-09T12:10:43.279165452+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4","title":"Implement database layer","description":"Alembic migration setup, asyncpg connection pool management, and database auto-provisioning (CREATE DATABASE IF NOT EXISTS via maintenance connection). Core Alembic revision creates state, scheduled_tasks, and sessions tables. Each butler gets its own dedicated PostgreSQL database. Alembic uses multiple version chains (core + per-butler) under alembic/versions/.","acceptance_criteria":"1. Database auto-created on first startup\n2. Migrations applied idempotently\n3. _migrations table tracks applied migrations\n4. Connection pool reusable across components","notes":"NOTE: Acceptance criteria #3 is stale — should read 'Alembic alembic_version table tracks applied revisions' instead of '_migrations table'. Updated in design.md D12.","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:06.6354237+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:44:22.066214891+08:00","closed_at":"2026-02-09T12:44:22.066214891+08:00","close_reason":"All children completed — DB layer, Alembic infrastructure, core revision, and tests merged","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.4","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:06.636861536+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4.1","title":"Implement asyncpg connection pool and DB provisioning","description":"Create src/butlers/db.py with Database class. Connect to PostgreSQL maintenance DB to CREATE DATABASE IF NOT EXISTS for the butler's dedicated database. Return asyncpg connection pool for the butler's DB. Support configurable host/port/user/password via environment variables (POSTGRES_HOST, POSTGRES_PORT, POSTGRES_USER, POSTGRES_PASSWORD).","design":"Database class with async init: connect to postgres DB, check if target DB exists, create if not, then create pool to target DB. Pool size configurable. Connection parameters from env vars with sensible defaults (localhost:5432, postgres/postgres).","acceptance_criteria":"1. Database created on first startup\n2. Existing database reused on subsequent startups\n3. Connection pool returned and usable\n4. Env var configuration works","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:52.085375999+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:33:39.887391927+08:00","closed_at":"2026-02-09T12:33:39.887391927+08:00","close_reason":"Implemented and merged to main","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.4.1","depends_on_id":"butlers-0qp.4","type":"parent-child","created_at":"2026-02-09T12:10:52.088879637+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4.2","title":"Set up Alembic migration infrastructure","description":"Set up Alembic for database migrations. Create alembic/ directory with alembic.ini, env.py (programmatic env that targets the correct butler DB via alembic.command.upgrade), and versions/ directory structure with subdirectories for each version chain (core/, switchboard/, relationship/, health/, general/). The env.py must support being called programmatically from the daemon at startup, targeting the butler's asyncpg database. Migrations use raw SQL via op.execute() — no SQLAlchemy models.","design":"Alembic env.py handles multi-chain setup. Each chain (core, switchboard, relationship, etc.) has its own versions directory. The daemon calls alembic.command.upgrade programmatically at startup, targeting the butler's DB. Alembic's alembic_version table tracks applied revisions. Each revision uses op.execute() with raw SQL. Idempotent: re-running skips already-applied revisions.","acceptance_criteria":"1. _migrations table created automatically\n2. Migrations applied in order\n3. Re-running is idempotent (no errors, no duplicates)\n4. Failed migration rolls back its transaction","notes":"NOTE: Acceptance criteria are stale — should reference Alembic alembic_version table instead of _migrations table. Updated in design.md D12 and spec files.","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:57.935179883+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:43:50.967234102+08:00","closed_at":"2026-02-09T12:43:50.967234102+08:00","close_reason":"Implemented and merged to main in Wave 3","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.4.2","depends_on_id":"butlers-0qp.4","type":"parent-child","created_at":"2026-02-09T12:10:57.936564578+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4.3","title":"Create core Alembic revision","description":"Create the initial Alembic revision in alembic/versions/core/ that defines the core tables shared by all butlers: state (key TEXT PK, value JSONB, updated_at TIMESTAMPTZ), scheduled_tasks (id UUID PK, name, cron, prompt, source, enabled, next_run_at, last_run_at, created_at, updated_at), sessions (id UUID PK, prompt, trigger_source, result, tool_calls JSONB, duration_ms, trace_id, cost JSONB, started_at, completed_at). Uses op.execute() with raw SQL.","acceptance_criteria":"1. All three tables created with correct columns and types\n2. Primary keys and defaults set correctly\n3. Migration is idempotent (uses IF NOT EXISTS or migration runner handles it)","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:00.820323137+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:43:50.982431537+08:00","closed_at":"2026-02-09T12:43:50.982431537+08:00","close_reason":"Implemented and merged to main in Wave 3","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.4.3","depends_on_id":"butlers-0qp.4","type":"parent-child","created_at":"2026-02-09T12:11:00.821973774+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.4.4","title":"Write database layer tests","description":"Write tests/test_db.py using testcontainers PostgreSQL. Test: database creation on first connect, Alembic migration application, idempotent re-run of migrations, alembic_version tracking, connection pool usability.","acceptance_criteria":"1. Tests use testcontainers PostgreSQL (real DB, not mocks)\n2. Database creation verified\n3. Migration application verified\n4. Idempotent re-run verified\n5. All tests pass","notes":"NOTE: Acceptance criteria reference _migrations — should read alembic_version. Updated in spec files.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:03.733051237+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:34:23.739313841+08:00","closed_at":"2026-02-09T12:34:23.739313841+08:00","close_reason":"Already implemented in butlers-0qp.4.1 worker (7 tests in test_db.py with testcontainers)","labels":["database","testing"],"dependencies":[{"issue_id":"butlers-0qp.4.4","depends_on_id":"butlers-0qp.4","type":"parent-child","created_at":"2026-02-09T12:11:03.734914867+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5","title":"Implement credential management","description":"Per-butler credential and environment variable management. Validate ANTHROPIC_API_KEY, [butler.env].required, [butler.env].optional, and module credentials_env at startup. Aggregated error reporting for missing vars. Advisory warning for suspected inline secrets in butler.toml.","acceptance_criteria":"1. All-present credentials pass validation\n2. Missing required vars fail startup with aggregated error listing all missing vars\n3. Missing optional vars log warning but don't block\n4. Secret-in-config detection warns on suspected inline secrets","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:12.554933796+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:00:23.893498693+08:00","closed_at":"2026-02-09T13:00:23.893498693+08:00","close_reason":"All children completed","labels":["backend","security"],"dependencies":[{"issue_id":"butlers-0qp.5","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:12.556293805+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5.1","title":"Implement credential validation at startup","description":"Add credential validation to butler startup. Check for: ANTHROPIC_API_KEY (always required), [butler.env].required env vars, [butler.env].optional env vars (warn if missing), module credentials_env vars. Aggregate all missing vars before failing.","acceptance_criteria":"1. ANTHROPIC_API_KEY checked on every butler\n2. All [butler.env].required vars checked\n3. Missing optional vars produce warnings, not errors\n4. Module credentials_env vars checked\n5. All missing vars reported in a single error message","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:35.006441351+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:43:50.991285552+08:00","closed_at":"2026-02-09T12:43:50.991285552+08:00","close_reason":"Implemented and merged to main in Wave 3","labels":["backend","security"],"dependencies":[{"issue_id":"butlers-0qp.5.1","depends_on_id":"butlers-0qp.5","type":"parent-child","created_at":"2026-02-09T12:10:35.007802271+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5.2","title":"Implement aggregated credential error reporting","description":"When multiple required env vars are missing, collect all of them before failing. Error message must list each missing var and which component needs it (core, butler.env, or module name).","acceptance_criteria":"1. Multiple missing vars reported in one error\n2. Each missing var identifies its source component\n3. Error message is actionable (tells user what to set)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:40.867803524+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:43:51.000224408+08:00","closed_at":"2026-02-09T12:43:51.000224408+08:00","close_reason":"Implemented and merged to main in Wave 3","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.5.2","depends_on_id":"butlers-0qp.5","type":"parent-child","created_at":"2026-02-09T12:10:40.869604846+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5.3","title":"Implement secret-in-config detection","description":"Scan butler.toml string values for patterns that look like inline secrets (API keys, passwords, tokens). Log advisory warnings during startup. Do not block startup — this is informational only.","design":"Heuristic detection: strings matching common secret patterns (sk-, ghp_, xoxb-, base64-like long strings). Advisory only — log.warning with suggestion to use env vars instead.","acceptance_criteria":"1. Suspected secrets in config values produce warnings\n2. Warnings suggest using env vars instead\n3. Does not block startup (advisory only)\n4. No false positives on short/normal config values","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:10:46.172956217+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.546355425+08:00","closed_at":"2026-02-09T12:58:43.546355425+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend","security"],"dependencies":[{"issue_id":"butlers-0qp.5.3","depends_on_id":"butlers-0qp.5","type":"parent-child","created_at":"2026-02-09T12:10:46.174760304+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.5.4","title":"Write credential management tests","description":"Write tests/test_credentials.py covering: all-present (passes), missing required (fails), missing optional (warning), missing module creds (fails), multiple missing (aggregated error), secret-in-config detection.","acceptance_criteria":"1. All 6 scenarios tested\n2. Aggregated error message verified\n3. Warning vs error distinction verified\n4. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:10:50.738360078+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:44:11.612084114+08:00","closed_at":"2026-02-09T12:44:11.612084114+08:00","close_reason":"Already implemented by Wave 3 workers — tests exist and pass","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.5.4","depends_on_id":"butlers-0qp.5","type":"parent-child","created_at":"2026-02-09T12:10:50.747797002+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.6","title":"Implement state store","description":"Key-value JSONB persistence in each butler's PostgreSQL database. MCP tools: state_get (returns null for missing keys), state_set (upsert), state_delete (no-op for missing), state_list (with optional prefix filter). All values stored as JSONB supporting any JSON type.","acceptance_criteria":"1. state_get returns value for existing key, null for missing\n2. state_set inserts new and updates existing (upsert)\n3. state_delete removes existing, no-op for missing\n4. state_list returns all entries, filters by prefix when provided\n5. JSONB values support strings, numbers, objects, arrays, booleans","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:18.879501505+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:28.993656636+08:00","closed_at":"2026-02-09T12:50:28.993656636+08:00","close_reason":"All children completed and merged","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.6","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:18.881541779+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.6","depends_on_id":"butlers-0qp.4","type":"blocks","created_at":"2026-02-09T12:15:48.621792957+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.6.1","title":"Implement state store MCP tools","description":"Create src/butlers/core/state.py with state store MCP tools: state_get(key) returns JSONB value or null, state_set(key, value) upserts, state_delete(key) removes (no-op if missing), state_list(prefix?) returns matching entries. All backed by the state table (key TEXT PK, value JSONB, updated_at TIMESTAMPTZ).","design":"state_set uses INSERT ON CONFLICT UPDATE (upsert). state_list uses key LIKE prefix% when prefix provided, otherwise returns all. Values stored as JSONB — any valid JSON type accepted.","acceptance_criteria":"1. state_get returns value for existing, null for missing\n2. state_set inserts new keys and updates existing\n3. state_delete removes existing, no-op for missing\n4. state_list returns all or prefix-filtered entries\n5. JSONB supports strings, numbers, objects, arrays, booleans, null","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:10:56.608975907+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:19.842323386+08:00","closed_at":"2026-02-09T12:50:19.842323386+08:00","close_reason":"Implemented and merged to main in Wave 4","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.6.1","depends_on_id":"butlers-0qp.6","type":"parent-child","created_at":"2026-02-09T12:10:56.610970394+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.6.2","title":"Write state store tests","description":"Write tests/test_core_state.py covering: get existing, get missing (null), set insert, set update, delete existing, delete missing (no-op), list all, list with prefix, JSONB value types (string, number, object, array, boolean, null).","acceptance_criteria":"1. All scenarios tested against real PostgreSQL (testcontainers)\n2. JSONB type round-tripping verified\n3. All tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:02.219263147+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:19.860709426+08:00","closed_at":"2026-02-09T12:50:19.860709426+08:00","close_reason":"Implemented and merged to main in Wave 4","labels":["database","testing"],"dependencies":[{"issue_id":"butlers-0qp.6.2","depends_on_id":"butlers-0qp.6","type":"parent-child","created_at":"2026-02-09T12:11:02.220849583+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.7","title":"Implement session log","description":"Append-only audit log of every CC invocation. Create session on CC spawn (recording prompt, trigger_source, trace_id), update on completion (result, tool_calls, duration_ms, cost). MCP tools: sessions_list (paginated), sessions_get (by id). No delete capability — append-only by design.","acceptance_criteria":"1. Session created on CC spawn with prompt and trigger_source\n2. Session updated on completion with result, tool_calls, duration_ms\n3. sessions_list supports pagination (limit/offset)\n4. sessions_get returns full session by ID\n5. No delete/update-after-close capability","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:25.643942646+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:29.00796533+08:00","closed_at":"2026-02-09T12:50:29.00796533+08:00","close_reason":"All children completed and merged","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.7","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:25.64534759+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.7","depends_on_id":"butlers-0qp.4","type":"blocks","created_at":"2026-02-09T12:15:48.67531344+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.7.1","title":"Implement session log with MCP tools","description":"Create src/butlers/core/sessions.py. Session creation on CC spawn (prompt, trigger_source, trace_id, started_at). Session update on completion (result, tool_calls JSONB, duration_ms, cost JSONB, completed_at). MCP tools: sessions_list(limit, offset) paginated, sessions_get(id). Append-only — no delete or update-after-close.","design":"Sessions table: id UUID PK, prompt TEXT, trigger_source TEXT, result TEXT, tool_calls JSONB, duration_ms INT, trace_id TEXT, cost JSONB, started_at TIMESTAMPTZ, completed_at TIMESTAMPTZ. trigger_source values: schedule, trigger_tool, tick, heartbeat.","acceptance_criteria":"1. Session created with prompt and trigger_source\n2. Session updated on completion with result, tool_calls, duration_ms\n3. sessions_list supports limit/offset pagination\n4. sessions_get returns full session by ID\n5. No delete capability exists","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:07.94358731+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:19.872403242+08:00","closed_at":"2026-02-09T12:50:19.872403242+08:00","close_reason":"Implemented and merged to main in Wave 4","labels":["backend","database"],"dependencies":[{"issue_id":"butlers-0qp.7.1","depends_on_id":"butlers-0qp.7","type":"parent-child","created_at":"2026-02-09T12:11:07.946172593+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.7.2","title":"Write session log tests","description":"Write tests/test_core_sessions.py covering: create session, complete success, complete failure, duration_ms computation, trigger_source values, list pagination, get by id, append-only verification (no delete/update-after-close).","acceptance_criteria":"1. All scenarios tested\n2. duration_ms correctly computed\n3. Pagination verified (limit/offset)\n4. Append-only constraint verified\n5. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:13.141296192+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:50:19.883940212+08:00","closed_at":"2026-02-09T12:50:19.883940212+08:00","close_reason":"Implemented and merged to main in Wave 4","labels":["database","testing"],"dependencies":[{"issue_id":"butlers-0qp.7.2","depends_on_id":"butlers-0qp.7","type":"parent-child","created_at":"2026-02-09T12:11:13.142716805+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8","title":"Implement CC spawner","description":"Ephemeral Claude Code instance management via the CC SDK. Generates locked-down MCP config files in temp directories (single butler endpoint only). Spawns CC with system prompt from CLAUDE.md, credential passthrough (only declared env vars), serial dispatch via asyncio lock, and session logging integration.","acceptance_criteria":"1. MCP config contains only the owning butler's endpoint\n2. Each invocation gets a unique temp directory, cleaned up after\n3. CLAUDE.md content passed as system_prompt\n4. Only declared env vars passed through to CC\n5. Serial dispatch prevents concurrent CC instances\n6. Session created/updated for each spawn","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:30.131696619+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:00:23.861384827+08:00","closed_at":"2026-02-09T13:00:23.861384827+08:00","close_reason":"All children completed","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:30.133021141+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-0qp.8","depends_on_id":"butlers-0qp.7","type":"blocks","created_at":"2026-02-09T12:15:48.786351896+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.1","title":"Implement ephemeral MCP config generation","description":"Create src/butlers/core/spawner.py with CCSpawner class. Generate locked-down MCP config in /tmp/butler_{name}_{uuid}/mcp.json containing only the owning butler's SSE endpoint. Each invocation gets a unique temp directory.","design":"Config JSON: {mcpServers: {butler_name: {url: 'http://localhost:PORT/sse'}}}. Temp dir: /tmp/butler_{name}_{uuid}/. Cleanup after CC session completes (success or failure).","acceptance_criteria":"1. Config contains exactly one MCP server entry\n2. Entry points to owning butler's SSE endpoint\n3. Each invocation creates unique temp dir\n4. Temp dir cleaned up after session","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T12:11:21.233806391+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.45886699+08:00","closed_at":"2026-02-09T12:58:43.45886699+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.1","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:21.235278181+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.2","title":"Implement CC SDK invocation and SpawnerResult","description":"Implement claude_code_sdk.query call with generated MCP config, system prompt, and working directory. Define SpawnerResult dataclass (result, tool_calls, error, duration_ms). Handle SDK errors gracefully.","acceptance_criteria":"1. CC SDK called with correct mcp_config path\n2. System prompt and cwd set correctly\n3. SpawnerResult captures success and failure cases\n4. SDK errors wrapped in SpawnerResult.error","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:26.08076857+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.472285833+08:00","closed_at":"2026-02-09T12:58:43.472285833+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.2","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:26.082136924+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.3","title":"Implement credential passthrough for CC instances","description":"Build explicit env dict for CC invocation containing only declared vars: ANTHROPIC_API_KEY + [butler.env] required/optional + module credentials_env. No other env vars leak to CC instance.","acceptance_criteria":"1. ANTHROPIC_API_KEY always included\n2. butler.env vars included\n3. Module credential vars included\n4. Undeclared env vars not passed through","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:30.941778301+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.480098114+08:00","closed_at":"2026-02-09T12:58:43.480098114+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend","security"],"dependencies":[{"issue_id":"butlers-0qp.8.3","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:30.943315224+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.4","title":"Implement CLAUDE.md system prompt reading","description":"Read CLAUDE.md from butler's config directory and pass contents as system_prompt to CC SDK query. If CLAUDE.md is missing or empty, use a default system prompt identifying the butler.","acceptance_criteria":"1. CLAUDE.md content passed as system_prompt\n2. Missing CLAUDE.md uses default prompt\n3. Empty CLAUDE.md uses default prompt\n4. Default prompt includes butler name","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:11:39.068096666+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.488577828+08:00","closed_at":"2026-02-09T12:58:43.488577828+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.4","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:39.071330855+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.5","title":"Implement serial CC dispatch with asyncio lock","description":"Add asyncio.Lock to CCSpawner ensuring only one CC instance runs at a time per butler. Subsequent trigger() calls wait for the lock. This is a v1 simplification — concurrent dispatch is a future enhancement.","acceptance_criteria":"1. Only one CC instance active per butler at a time\n2. Concurrent triggers queue and execute serially\n3. Lock released on both success and failure","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:46.784689414+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.496725433+08:00","closed_at":"2026-02-09T12:58:43.496725433+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.5","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:46.786273295+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.6","title":"Wire CC spawner session logging","description":"Create session record when CC spawn begins (prompt, trigger_source). Update session on completion with result, tool_calls, duration_ms, cost. Handle both success and failure paths.","acceptance_criteria":"1. Session created before CC invocation\n2. Session updated on success with result and tool_calls\n3. Session updated on failure with error\n4. duration_ms recorded accurately","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:11:52.137727183+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.50488951+08:00","closed_at":"2026-02-09T12:58:43.50488951+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.8.6","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:52.139374895+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.8.7","title":"Write CC spawner tests","description":"Write tests/test_core_spawner.py covering: MCP config generation (correct JSON, single endpoint), temp dir cleanup, serial dispatch (lock prevents concurrent), MockSpawner assertions, env passthrough (only declared vars), CLAUDE.md handling (present, missing, empty).","acceptance_criteria":"1. All scenarios tested\n2. MockSpawner used (no real CC invocation)\n3. Config JSON structure verified\n4. Serial dispatch verified via concurrent task simulation\n5. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T12:11:58.45663044+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.513181949+08:00","closed_at":"2026-02-09T12:58:43.513181949+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.8.7","depends_on_id":"butlers-0qp.8","type":"parent-child","created_at":"2026-02-09T12:11:58.458082864+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.9","title":"Implement butler skills infrastructure","description":"Skill directory structure and CC discovery. CLAUDE.md personality/instructions read by CC spawner as system_prompt. AGENTS.md runtime notes readable/writable by CC instances. skills/\u003cname\u003e/SKILL.md + optional scripts accessible via CC cwd set to butler config dir.","acceptance_criteria":"1. CLAUDE.md content passed as system_prompt to CC\n2. Missing CLAUDE.md falls back to default prompt\n3. AGENTS.md readable and writable by CC instances\n4. skills/ directory accessible when CC cwd set to butler config dir","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T12:07:37.321931865+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T13:00:23.875512708+08:00","closed_at":"2026-02-09T13:00:23.875512708+08:00","close_reason":"All children completed","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.9","depends_on_id":"butlers-0qp","type":"parent-child","created_at":"2026-02-09T12:07:37.323291724+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.9.1","title":"Implement CLAUDE.md and skills directory for CC spawner","description":"Ensure CC spawner reads CLAUDE.md from butler config dir as system_prompt. Set CC cwd to butler config dir so skills/ directory is accessible. CLAUDE.md defines butler personality and instructions. Missing CLAUDE.md uses default fallback.","acceptance_criteria":"1. CLAUDE.md read as system_prompt\n2. Missing CLAUDE.md uses default\n3. CC cwd set to butler config dir\n4. skills/ directory accessible from CC","notes":"This may overlap with the CC spawner CLAUDE.md reading task — coordinate to avoid duplication. The key addition here is the cwd setting for skills access.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:41.020113716+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.521484088+08:00","closed_at":"2026-02-09T12:58:43.521484088+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.9.1","depends_on_id":"butlers-0qp.9","type":"parent-child","created_at":"2026-02-09T12:12:41.021617887+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.9.2","title":"Implement AGENTS.md read/write access","description":"Ensure AGENTS.md in butler config dir is readable and writable by CC instances. CC can append runtime notes during sessions. File created if it doesn't exist on first write.","acceptance_criteria":"1. AGENTS.md readable by CC instances\n2. AGENTS.md writable by CC instances\n3. File created on first write if missing\n4. Content persists across sessions","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T12:12:46.914816969+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.529453286+08:00","closed_at":"2026-02-09T12:58:43.529453286+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["backend"],"dependencies":[{"issue_id":"butlers-0qp.9.2","depends_on_id":"butlers-0qp.9","type":"parent-child","created_at":"2026-02-09T12:12:46.91687713+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-0qp.9.3","title":"Write butler skills tests","description":"Write tests/test_skills.py covering: CLAUDE.md as system prompt, missing CLAUDE.md fallback, AGENTS.md read/write, skill directory structure validation (skills/\u003cname\u003e/SKILL.md exists and is accessible).","acceptance_criteria":"1. All scenarios tested\n2. File system interactions verified\n3. Tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T12:12:52.252884492+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T12:58:43.537772135+08:00","closed_at":"2026-02-09T12:58:43.537772135+08:00","close_reason":"Implemented and merged to main in Wave 5","labels":["testing"],"dependencies":[{"issue_id":"butlers-0qp.9.3","depends_on_id":"butlers-0qp.9","type":"parent-child","created_at":"2026-02-09T12:12:52.254444018+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-1x6","title":"Investigate integration/tooling test regressions in required gate","description":"The full pytest quality gate run for butlers-9du also fails in unrelated integration/tooling suites: tests/integration/test_idempotent_ingestion.py, tests/integration/test_integration.py, tests/integration/test_mailbox_integration.py, and tests/tools/test_decomposition.py. These represent nontrivial regressions outside the trailing-slash scope and should be addressed in follow-up work.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-12T00:07:00.982729414+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T11:45:38.468307416+08:00","closed_at":"2026-02-12T11:45:38.468307416+08:00","close_reason":"Already fixed in commits a71f7bf, dd21800, 9b09b38 — agent forgot to close","dependencies":[{"issue_id":"butlers-1x6","depends_on_id":"butlers-9du","type":"discovered-from","created_at":"2026-02-12T00:07:00.986098889+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h","title":"Build frontend dashboard and API","description":"Single pane of glass web dashboard over the deployed butler infrastructure — topology, health, sessions, schedules, state, traces, costs, errors, skills, memory, and butler-specific domain data. Full read/write admin control. Includes a FastAPI backend (src/butlers/api/) and a React SPA (frontend/) plus framework-level changes for token tracking and cross-butler notifications. See docs/FRONTEND_PROJECT_PLAN.md and openspec/changes/frontend-dashboard/.","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:01.15671057+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:12.916236212+08:00","closed_at":"2026-02-10T19:11:12.916236212+08:00","close_reason":"Closed","labels":["backend","dashboard","frontend"]}
{"id":"butlers-26h.1","title":"Framework changes: token tracking and core notify() tool","description":"Database schema additions and core tool changes required before dashboard features work. Add input_tokens/output_tokens/model/trace_id/parent_session_id columns to sessions table. Implement core notify() tool and Switchboard deliver() tool with notifications table. Tasks 1.1-1.10 in OpenSpec tasks.md.","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:42.255288801+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:20:14.984177745+08:00","closed_at":"2026-02-10T13:20:14.984177745+08:00","close_reason":"All 10 children complete: token tracking columns, spawner capture, session detection, notifications table, deliver tool, notify tool, switchboard client, error handling, token tests, notify/deliver tests","labels":["backend","core","database"],"dependencies":[{"issue_id":"butlers-26h.1","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:42.261914079+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.1.1","title":"Add token tracking columns to sessions table via Alembic","description":"Alembic migration: add input_tokens (INT nullable), output_tokens (INT nullable), model (TEXT nullable), trace_id (TEXT nullable), parent_session_id (UUID nullable) columns to sessions table in core migration chain.","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T11:59:14.463089623+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T12:15:35.677781421+08:00","closed_at":"2026-02-10T12:15:35.677781421+08:00","close_reason":"Merged to main. Added Alembic migration 003 with token tracking columns (input_tokens, output_tokens, parent_session_id) and fixed dual-002 revision conflict.","labels":["backend","core","database"],"dependencies":[{"issue_id":"butlers-26h.1.1","depends_on_id":"butlers-26h.1","type":"parent-child","created_at":"2026-02-10T11:59:14.464728709+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.1.10","title":"Write tests for notify() and deliver() tools","description":"Test notify() with mock Switchboard client. Test deliver() with mock telegram/email modules. Cover: successful delivery, Switchboard unreachable, invalid channel, module failure.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T11:59:58.516672871+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:20:09.434431168+08:00","closed_at":"2026-02-10T13:20:09.434431168+08:00","close_reason":"Closed","labels":["backend","core","testing"],"dependencies":[{"issue_id":"butlers-26h.1.10","depends_on_id":"butlers-26h.1","type":"parent-child","created_at":"2026-02-10T11:59:58.519672769+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.1.2","title":"Update CC spawner to capture token usage from SDK response","description":"Extract input_tokens, output_tokens, and model from Claude Code SDK response object and pass to sessions.log_session(). Token data should be nullable — sessions created before this change remain valid.","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T11:59:18.943566868+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T12:35:55.975045762+08:00","closed_at":"2026-02-10T12:35:55.975045762+08:00","close_reason":"Implemented, merged to main, tests passing","labels":["backend","core"],"dependencies":[{"issue_id":"butlers-26h.1.2","depends_on_id":"butlers-26h.1","type":"parent-child","created_at":"2026-02-10T11:59:18.945082091+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.1.3","title":"Add active session detection to CC spawner","description":"Write session record with completed_at = NULL before spawning CC. Update completed_at on completion. Dashboard can query for completed_at IS NULL to detect running sessions.","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T11:59:23.672841219+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T12:35:55.910108272+08:00","closed_at":"2026-02-10T12:35:55.910108272+08:00","close_reason":"Implemented, merged to main, tests passing","labels":["backend","core"],"dependencies":[{"issue_id":"butlers-26h.1.3","depends_on_id":"butlers-26h.1","type":"parent-child","created_at":"2026-02-10T11:59:23.674576207+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.1.4","title":"Add notifications table to Switchboard via Alembic","description":"Alembic migration for Switchboard DB: notifications table with columns (id UUID PK, source_butler TEXT, channel TEXT, recipient TEXT, message TEXT, metadata JSONB, status TEXT default 'sent', error TEXT, session_id UUID, trace_id TEXT, created_at TIMESTAMPTZ). Indexes on source_butler+created_at, channel+created_at, status.","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T11:59:28.256704063+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T12:10:01.910634784+08:00","closed_at":"2026-02-10T12:10:01.910634784+08:00","close_reason":"Merged to main. Alembic migration 003 adds notifications table to Switchboard DB with required columns and indexes.","labels":["backend","database","switchboard"],"dependencies":[{"issue_id":"butlers-26h.1.4","depends_on_id":"butlers-26h.1","type":"parent-child","created_at":"2026-02-10T11:59:28.258576781+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.1.5","title":"Implement Switchboard deliver() MCP tool","description":"New MCP tool on Switchboard: deliver(channel, message, recipient?, metadata?). Dispatches to the appropriate module (telegram/email), logs to notifications table, returns delivery result. Distinct from route() which forwards tool calls to other butlers.","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T11:59:36.479005269+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T12:54:13.88439691+08:00","closed_at":"2026-02-10T12:54:13.88439691+08:00","close_reason":"Implemented and merged to main","labels":["backend","switchboard"],"dependencies":[{"issue_id":"butlers-26h.1.5","depends_on_id":"butlers-26h.1","type":"parent-child","created_at":"2026-02-10T11:59:36.481946045+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.1.6","title":"Implement core notify() MCP tool on every butler daemon","description":"Register notify(channel, message, recipient?) as a core MCP tool on every butler daemon. Forwards to Switchboard's deliver() via MCP client connection. Synchronous from CC's perspective — blocks until delivered or fails. Returns error result (not exception) if Switchboard is unreachable or channel is invalid.","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T11:59:40.649678395+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T12:54:13.95280407+08:00","closed_at":"2026-02-10T12:54:13.95280407+08:00","close_reason":"Implemented and merged to main","labels":["backend","core"],"dependencies":[{"issue_id":"butlers-26h.1.6","depends_on_id":"butlers-26h.1","type":"parent-child","created_at":"2026-02-10T11:59:40.651671861+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.1.7","title":"Add Switchboard MCP client connection to butler daemon startup","description":"Each butler daemon opens an MCP client connection to the Switchboard at startup. Configured via switchboard_url in butler.toml or derived from Switchboard config. Required for notify() tool to work.","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T11:59:45.0727127+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T12:35:56.030319112+08:00","closed_at":"2026-02-10T12:35:56.030319112+08:00","close_reason":"Implemented, merged to main, tests passing","labels":["backend","core"],"dependencies":[{"issue_id":"butlers-26h.1.7","depends_on_id":"butlers-26h.1","type":"parent-child","created_at":"2026-02-10T11:59:45.074337129+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.1.8","title":"Handle notify() error cases","description":"Ensure notify() returns error result (not exception) for: Switchboard unreachable, invalid channel, delivery failure. CC can handle fallback logic (e.g., store in state).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T11:59:49.255678352+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:04:22.352973804+08:00","closed_at":"2026-02-10T13:04:22.352973804+08:00","close_reason":"Implemented and merged to main","labels":["backend","core"],"dependencies":[{"issue_id":"butlers-26h.1.8","depends_on_id":"butlers-26h.1","type":"parent-child","created_at":"2026-02-10T11:59:49.258046667+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.1.9","title":"Write tests for token capture in spawner","description":"Mock SDK response with usage data (input_tokens, output_tokens, model). Verify spawner extracts and stores token data in session record. Test with missing usage data (graceful degradation).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T11:59:53.876077693+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:12:47.390788802+08:00","closed_at":"2026-02-10T13:12:47.390788802+08:00","close_reason":"Closed","labels":["backend","core","testing"],"dependencies":[{"issue_id":"butlers-26h.1.9","depends_on_id":"butlers-26h.1","type":"parent-child","created_at":"2026-02-10T11:59:53.877802071+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.10","title":"M8: Relationship butler views","description":"CRM data visibility for the Relationship butler. API endpoints for contacts (list/search, detail with joins, sub-resources), groups, labels, upcoming dates. Frontend contacts table, contact detail page (info, dates, facts, relationships, notes/interactions/gifts/loans tabs, activity feed), groups page. Tasks 10.1-10.2, 21.1-21.6 in OpenSpec.","status":"closed","priority":3,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:42.950639751+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:09.803687469+08:00","closed_at":"2026-02-10T18:43:09.803687469+08:00","close_reason":"Closed","labels":["backend","dashboard","frontend","relationship"],"dependencies":[{"issue_id":"butlers-26h.10","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:42.952599363+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.10","depends_on_id":"butlers-26h.2","type":"blocks","created_at":"2026-02-10T12:05:52.148608806+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.10.1","title":"Create relationship API router and Pydantic models","description":"Create src/butlers/api/routers/relationship.py and src/butlers/api/models/relationship.py with Contact, Group, Label, Note, Interaction, Gift, Loan Pydantic models.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:02:28.420907973+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:25:08.926811343+08:00","closed_at":"2026-02-10T16:25:08.926811343+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard","relationship"],"dependencies":[{"issue_id":"butlers-26h.10.1","depends_on_id":"butlers-26h.10","type":"parent-child","created_at":"2026-02-10T12:02:28.422505083+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.10.2","title":"Implement relationship API endpoints","description":"Contacts list/search (?q, ?label), contact detail with joins (info, dates, facts, relationships). Sub-resources: notes, interactions, gifts, loans, activity feed. Groups list and detail with members. Labels list. Upcoming dates (next N days).","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":180,"created_at":"2026-02-10T12:02:32.850222077+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:37:24.485997629+08:00","closed_at":"2026-02-10T17:37:24.485997629+08:00","close_reason":"Closed","labels":["backend","dashboard","relationship"],"dependencies":[{"issue_id":"butlers-26h.10.2","depends_on_id":"butlers-26h.10","type":"parent-child","created_at":"2026-02-10T12:02:32.88075768+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.10.3","title":"Write tests for relationship API endpoints","description":"Test contacts search, detail with joins, sub-resources, groups, labels, upcoming dates.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:02:37.611057627+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:37:24.50880376+08:00","closed_at":"2026-02-10T17:37:24.50880376+08:00","close_reason":"Closed","labels":["backend","dashboard","relationship","testing"],"dependencies":[{"issue_id":"butlers-26h.10.3","depends_on_id":"butlers-26h.10","type":"parent-child","created_at":"2026-02-10T12:02:37.612826141+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.10.4","title":"Create useContacts TanStack Query hooks","description":"Create src/api/hooks/useContacts.ts — hooks for contacts list, contact detail, sub-resources (notes, interactions, gifts, loans, feed).","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:02:41.96681319+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:01.332264284+08:00","closed_at":"2026-02-10T18:43:01.332264284+08:00","close_reason":"Closed","labels":["dashboard","frontend","relationship"],"dependencies":[{"issue_id":"butlers-26h.10.4","depends_on_id":"butlers-26h.10","type":"parent-child","created_at":"2026-02-10T12:02:41.968701239+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.10.5","title":"Build contact table component","description":"Create src/components/relationship/ContactTable.tsx — searchable, label-filterable, sortable contact table: name, company, labels, last interaction.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:02:46.192317296+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:01.336265891+08:00","closed_at":"2026-02-10T18:43:01.336265891+08:00","close_reason":"Closed","labels":["dashboard","frontend","relationship"],"dependencies":[{"issue_id":"butlers-26h.10.5","depends_on_id":"butlers-26h.10","type":"parent-child","created_at":"2026-02-10T12:02:46.19398073+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.10.6","title":"Build contact detail component","description":"Create src/components/relationship/ContactDetail.tsx — header card (name, photo placeholder, title, company, pronouns), contact info, important dates with countdown badges, quick facts, relationships list, tabbed content (Notes | Interactions | Gifts | Loans), activity feed timeline.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":150,"created_at":"2026-02-10T12:02:50.333111303+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:01.340237351+08:00","closed_at":"2026-02-10T18:43:01.340237351+08:00","close_reason":"Closed","labels":["dashboard","frontend","relationship"],"dependencies":[{"issue_id":"butlers-26h.10.6","depends_on_id":"butlers-26h.10","type":"parent-child","created_at":"2026-02-10T12:02:50.334798332+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.10.7","title":"Create contacts and contact detail pages","description":"Create src/pages/relationship/ContactsPage.tsx and ContactDetailPage.tsx.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:02:54.314132596+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:01.344133208+08:00","closed_at":"2026-02-10T18:43:01.344133208+08:00","close_reason":"Closed","labels":["dashboard","frontend","relationship"],"dependencies":[{"issue_id":"butlers-26h.10.7","depends_on_id":"butlers-26h.10","type":"parent-child","created_at":"2026-02-10T12:02:54.316205716+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.10.8","title":"Create groups page","description":"Create src/pages/relationship/GroupsPage.tsx — groups list with member count, click → group detail with member list.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:02:58.451889816+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:01.347484447+08:00","closed_at":"2026-02-10T18:43:01.347484447+08:00","close_reason":"Closed","labels":["dashboard","frontend","relationship"],"dependencies":[{"issue_id":"butlers-26h.10.8","depends_on_id":"butlers-26h.10","type":"parent-child","created_at":"2026-02-10T12:02:58.453538613+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.10.9","title":"Add relationship sub-tabs to butler detail page","description":"Contacts and Groups sub-tabs on Relationship butler detail. Routing Log sub-tab on Switchboard butler detail.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T12:03:02.805902877+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:01.353643909+08:00","closed_at":"2026-02-10T18:43:01.353643909+08:00","close_reason":"Closed","labels":["dashboard","frontend","relationship"],"dependencies":[{"issue_id":"butlers-26h.10.9","depends_on_id":"butlers-26h.10","type":"parent-child","created_at":"2026-02-10T12:03:02.807509895+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.11","title":"M9: Health butler views","description":"Health tracking data visualization. API endpoints for measurements, medications (with dose log), conditions, symptoms, meals, research. Frontend measurement charts (Recharts), medication tracker with adherence, conditions/symptoms/meals/research pages. Note: write operations (e.g., logging new measurements) are intentionally deferred for v1 — health data entry is handled via chat interactions with the Health butler. Dashboard health views are read-only. Tasks 10.3-10.4, 22.1-22.5 in OpenSpec.","status":"closed","priority":3,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:43.013094738+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:09.754470375+08:00","closed_at":"2026-02-10T18:55:09.754470375+08:00","close_reason":"Closed","labels":["backend","dashboard","frontend","health"],"dependencies":[{"issue_id":"butlers-26h.11","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:43.014631661+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.11","depends_on_id":"butlers-26h.2","type":"blocks","created_at":"2026-02-10T12:05:52.275272219+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.11.1","title":"Create health API router and Pydantic models","description":"Create src/butlers/api/routers/health.py and src/butlers/api/models/health.py with Measurement, Medication, Dose, Condition, Symptom, Meal, Research Pydantic models.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:03:08.981953104+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.244026025+08:00","closed_at":"2026-02-10T18:55:06.244026025+08:00","close_reason":"Closed","labels":["backend","dashboard","health"],"dependencies":[{"issue_id":"butlers-26h.11.1","depends_on_id":"butlers-26h.11","type":"parent-child","created_at":"2026-02-10T12:03:08.984049257+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.11.2","title":"Implement health API endpoints","description":"Measurements (list with type filter, date range). Medications (list with active filter, dose log per medication). Conditions list. Symptoms (list with date range). Meals (list with date range). Research (list/search).","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T12:03:13.158866868+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.256875982+08:00","closed_at":"2026-02-10T18:55:06.256875982+08:00","close_reason":"Closed","labels":["backend","dashboard","health"],"dependencies":[{"issue_id":"butlers-26h.11.2","depends_on_id":"butlers-26h.11","type":"parent-child","created_at":"2026-02-10T12:03:13.160444741+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.11.3","title":"Write tests for health API endpoints","description":"Test measurements filtering, medications with dose log, conditions, symptoms, meals, research search.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:03:17.676737928+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.262484515+08:00","closed_at":"2026-02-10T18:55:06.262484515+08:00","close_reason":"Closed","labels":["backend","dashboard","health","testing"],"dependencies":[{"issue_id":"butlers-26h.11.3","depends_on_id":"butlers-26h.11","type":"parent-child","created_at":"2026-02-10T12:03:17.678599508+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.11.4","title":"Create useMeasurements TanStack Query hooks","description":"Create src/api/hooks/useMeasurements.ts — hooks for all health data endpoints.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":25,"created_at":"2026-02-10T12:03:21.888418203+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.268695752+08:00","closed_at":"2026-02-10T18:55:06.268695752+08:00","close_reason":"Closed","labels":["dashboard","frontend","health"],"dependencies":[{"issue_id":"butlers-26h.11.4","depends_on_id":"butlers-26h.11","type":"parent-child","created_at":"2026-02-10T12:03:21.890182509+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.11.5","title":"Build measurement chart component","description":"Create src/components/health/MeasurementChart.tsx — Recharts line charts by type (weight, BP dual-line, heart rate). Date range picker, type selector tabs, raw data table toggle.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:03:26.29187586+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.27512293+08:00","closed_at":"2026-02-10T18:55:06.27512293+08:00","close_reason":"Closed","labels":["dashboard","frontend","health"],"dependencies":[{"issue_id":"butlers-26h.11.5","depends_on_id":"butlers-26h.11","type":"parent-child","created_at":"2026-02-10T12:03:26.293560805+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.11.6","title":"Build medication tracker component","description":"Create src/components/health/MedicationTracker.tsx — medication cards (name, dosage, schedule), dose log table per medication, adherence percentage indicator.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":75,"created_at":"2026-02-10T12:03:30.550715746+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.282019127+08:00","closed_at":"2026-02-10T18:55:06.282019127+08:00","close_reason":"Closed","labels":["dashboard","frontend","health"],"dependencies":[{"issue_id":"butlers-26h.11.6","depends_on_id":"butlers-26h.11","type":"parent-child","created_at":"2026-02-10T12:03:30.552411362+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.11.7","title":"Create health sub-pages","description":"MeasurementsPage, MedicationsPage, ConditionsPage (status badges), SymptomsPage (severity bar, trend chart), MealsPage (daily timeline), ResearchPage (searchable with topic tags).","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:03:35.284712898+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.287190511+08:00","closed_at":"2026-02-10T18:55:06.287190511+08:00","close_reason":"Closed","labels":["dashboard","frontend","health"],"dependencies":[{"issue_id":"butlers-26h.11.7","depends_on_id":"butlers-26h.11","type":"parent-child","created_at":"2026-02-10T12:03:35.321459179+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.11.8","title":"Add health sub-tabs to butler detail page","description":"Measurements, Medications, Conditions, Symptoms, Meals, Research as conditional sub-tabs on Health butler detail.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T12:03:40.50324431+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.290844125+08:00","closed_at":"2026-02-10T18:55:06.290844125+08:00","close_reason":"Closed","labels":["dashboard","frontend","health"],"dependencies":[{"issue_id":"butlers-26h.11.8","depends_on_id":"butlers-26h.11","type":"parent-child","created_at":"2026-02-10T12:03:40.504847581+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.12","title":"M10: General butler and Switchboard views","description":"Freeform entity browsing and routing visibility. API for collections, entities (list/search/detail), routing log, registry. Frontend collections page, entity browser with JSON tree viewer, routing log and registry tabs. Tasks 10.5-10.8, 23.1-23.5 in OpenSpec.","status":"closed","priority":3,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:43.076417203+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:09.763145397+08:00","closed_at":"2026-02-10T18:55:09.763145397+08:00","close_reason":"Closed","labels":["backend","dashboard","frontend","general","switchboard"],"dependencies":[{"issue_id":"butlers-26h.12","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:43.077764699+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.12","depends_on_id":"butlers-26h.2","type":"blocks","created_at":"2026-02-10T12:05:52.437215001+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.12.1","title":"Create general API router and Pydantic models","description":"Create src/butlers/api/routers/general.py and src/butlers/api/models/general.py with Collection and Entity Pydantic models. Collections list with entity counts, entities list/search with collection/tag filter and full-text search, entity detail with full JSONB data.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:03:46.019208994+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.294056271+08:00","closed_at":"2026-02-10T18:55:06.294056271+08:00","close_reason":"Closed","labels":["backend","dashboard","general"],"dependencies":[{"issue_id":"butlers-26h.12.1","depends_on_id":"butlers-26h.12","type":"parent-child","created_at":"2026-02-10T12:03:46.020675336+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.12.2","title":"Create switchboard API router","description":"Create src/butlers/api/routers/switchboard.py. GET /api/butlers/switchboard/routing-log (paginated). GET /api/butlers/switchboard/registry (butler registry snapshot).","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:03:50.662281378+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.298865888+08:00","closed_at":"2026-02-10T18:55:06.298865888+08:00","close_reason":"Closed","labels":["backend","dashboard","switchboard"],"dependencies":[{"issue_id":"butlers-26h.12.2","depends_on_id":"butlers-26h.12","type":"parent-child","created_at":"2026-02-10T12:03:50.664554685+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.12.3","title":"Write tests for general and switchboard API endpoints","description":"Test collections, entities search/filter, entity detail, routing log pagination, registry.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:03:55.127588189+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.307577791+08:00","closed_at":"2026-02-10T18:55:06.307577791+08:00","close_reason":"Closed","labels":["backend","dashboard","testing"],"dependencies":[{"issue_id":"butlers-26h.12.3","depends_on_id":"butlers-26h.12","type":"parent-child","created_at":"2026-02-10T12:03:55.641281146+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.12.4","title":"Build entity browser component","description":"Create src/components/general/EntityBrowser.tsx — entity table with collection badge, tags, search, collection/tag filters. Click → JSON tree viewer.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:04:00.063328691+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.316338016+08:00","closed_at":"2026-02-10T18:55:06.316338016+08:00","close_reason":"Closed","labels":["dashboard","frontend","general"],"dependencies":[{"issue_id":"butlers-26h.12.4","depends_on_id":"butlers-26h.12","type":"parent-child","created_at":"2026-02-10T12:04:00.064927063+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.12.5","title":"Build JSON tree viewer component","description":"Create src/components/general/JsonViewer.tsx — syntax highlighted, collapsible tree, copy-to-clipboard. Reusable across state browser and entity detail.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:04:04.844531902+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.32088785+08:00","closed_at":"2026-02-10T18:55:06.32088785+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.12.5","depends_on_id":"butlers-26h.12","type":"parent-child","created_at":"2026-02-10T12:04:04.847185057+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.12.6","title":"Create general sub-pages","description":"CollectionsPage (cards with name, entity count, schema hint) and EntitiesPage.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:04:09.251208818+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.324711928+08:00","closed_at":"2026-02-10T18:55:06.324711928+08:00","close_reason":"Closed","labels":["dashboard","frontend","general"],"dependencies":[{"issue_id":"butlers-26h.12.6","depends_on_id":"butlers-26h.12","type":"parent-child","created_at":"2026-02-10T12:04:09.252906617+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.12.7","title":"Create switchboard sub-tabs","description":"Routing log table (timestamp, source channel, source ID, routed-to, prompt summary). Registry table (name, endpoint, modules, last seen).","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:04:13.881807627+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.328484467+08:00","closed_at":"2026-02-10T18:55:06.328484467+08:00","close_reason":"Closed","labels":["dashboard","frontend","switchboard"],"dependencies":[{"issue_id":"butlers-26h.12.7","depends_on_id":"butlers-26h.12","type":"parent-child","created_at":"2026-02-10T12:04:13.883821815+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.12.8","title":"Add general and switchboard sub-tabs to butler detail","description":"Collections and Entities as conditional sub-tabs on General butler. Routing Log and Registry on Switchboard butler.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T12:04:19.386827885+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:55:06.332587864+08:00","closed_at":"2026-02-10T18:55:06.332587864+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.12.8","depends_on_id":"butlers-26h.12","type":"parent-child","created_at":"2026-02-10T12:04:19.388528249+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.13","title":"M11: Memory system views (contingent)","description":"Memory system dashboard views. API for memory stats, facts (browse/search/edit/delete), rules (browse/search/promote/demote/delete), episodes (browse), activity feed (consolidation events). Frontend: butler-scoped memory tab (facts panel with confidence bars, playbook panel with effectiveness scores, episode stream), cross-butler /memory page (overview cards, knowledge browser, activity feed, health indicators), memory events in unified timeline, facts/rules in global search (Cmd+K). Reads butler_memory DB directly for queries, writes go through Memory MCP server.\n\nBlocked on Memory MCP tools (butlers-cfw.5). See openspec/changes/memory-system/specs/memory-dashboard/spec.md for full requirements.","notes":"Blocked on memory system implementation (memories table + MCP tools). Implement after MEMORY_PROJECT_PLAN.md is finalized.","status":"closed","priority":3,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:43.136560562+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:05.589053504+08:00","closed_at":"2026-02-10T19:11:05.589053504+08:00","close_reason":"Closed","labels":["backend","dashboard","frontend","memory"],"dependencies":[{"issue_id":"butlers-26h.13","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:43.138074021+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.13","depends_on_id":"butlers-cfw.5","type":"blocks","created_at":"2026-02-10T12:11:11.0609451+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.13.1","title":"Create memory API router and Pydantic models","description":"Create src/butlers/api/routers/memory.py and src/butlers/api/models/memory.py with MemoryStats and MemoryEntry models. Endpoints: stats, entries browse/search, single entry, activity (promotions/evictions).","notes":"Blocked on memory system implementation.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:04:25.037553646+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:00.849551954+08:00","closed_at":"2026-02-10T19:11:00.849551954+08:00","close_reason":"Closed","labels":["backend","dashboard","memory"],"dependencies":[{"issue_id":"butlers-26h.13.1","depends_on_id":"butlers-26h.13","type":"parent-child","created_at":"2026-02-10T12:04:25.066184782+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.13.2","title":"Write tests for memory API endpoints","description":"Test memory stats, entries search/filter, single entry, activity timeline.","notes":"Blocked on memory system implementation.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:04:29.922093168+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:00.860278919+08:00","closed_at":"2026-02-10T19:11:00.860278919+08:00","close_reason":"Closed","labels":["backend","dashboard","memory","testing"],"dependencies":[{"issue_id":"butlers-26h.13.2","depends_on_id":"butlers-26h.13","type":"parent-child","created_at":"2026-02-10T12:04:29.943752484+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.13.3","title":"Build memory tier cards component","description":"Create src/components/memory/MemoryTierCards.tsx — Eden/Mid-Term/Long-Term cards with entry count, capacity progress bar, oldest/newest entry.","notes":"Blocked on memory system implementation.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:04:37.91368346+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:00.865503148+08:00","closed_at":"2026-02-10T19:11:00.865503148+08:00","close_reason":"Closed","labels":["dashboard","frontend","memory"],"dependencies":[{"issue_id":"butlers-26h.13.3","depends_on_id":"butlers-26h.13","type":"parent-child","created_at":"2026-02-10T12:04:37.943032162+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.13.4","title":"Build memory browser component","description":"Create src/components/memory/MemoryBrowser.tsx — searchable/filterable table: tier badge, content (truncated), tags, reference count, last referenced. Click → full content + metadata.","notes":"Blocked on memory system implementation.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:04:43.649508479+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:00.870276805+08:00","closed_at":"2026-02-10T19:11:00.870276805+08:00","close_reason":"Closed","labels":["dashboard","frontend","memory"],"dependencies":[{"issue_id":"butlers-26h.13.4","depends_on_id":"butlers-26h.13","type":"parent-child","created_at":"2026-02-10T12:04:43.652856438+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.13.5","title":"Build memory activity timeline component","description":"Create src/components/memory/MemoryActivity.tsx — recent promotions (Eden→Mid, Mid→Long) and evictions timeline.","notes":"Blocked on memory system implementation.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:04:48.701019799+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:00.87402846+08:00","closed_at":"2026-02-10T19:11:00.87402846+08:00","close_reason":"Closed","labels":["dashboard","frontend","memory"],"dependencies":[{"issue_id":"butlers-26h.13.5","depends_on_id":"butlers-26h.13","type":"parent-child","created_at":"2026-02-10T12:04:48.7028929+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.13.6","title":"Add memory tab to butler detail with health indicators","description":"Memory tab on butler detail: tier cards, browser, activity timeline, health indicators (eviction rate, saturation, promotion rate).","notes":"Blocked on memory system implementation.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:04:54.094999108+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:00.877379026+08:00","closed_at":"2026-02-10T19:11:00.877379026+08:00","close_reason":"Closed","labels":["dashboard","frontend","memory"],"dependencies":[{"issue_id":"butlers-26h.13.6","depends_on_id":"butlers-26h.13","type":"parent-child","created_at":"2026-02-10T12:04:54.098066637+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.14","title":"M12: Polish and real-time foundation","description":"UX polish and groundwork for real-time updates. Loading/empty/error states, dark mode, responsive design, breadcrumbs, keyboard shortcuts, SSE endpoint for live status, auto-refresh, audit log. Tasks 25.1-25.6 in OpenSpec.","status":"closed","priority":3,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:43.197074812+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:05.598542097+08:00","closed_at":"2026-02-10T19:11:05.598542097+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.14","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:43.19865638+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.14.1","title":"Add loading states with skeleton loaders","description":"Skeleton loaders for all data tables and charts throughout the app.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:05:01.122243805+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:54:48.837307082+08:00","closed_at":"2026-02-10T14:54:48.837307082+08:00","close_reason":"Merged to main, 1232 unit tests pass, frontend builds","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.14.1","depends_on_id":"butlers-26h.14","type":"parent-child","created_at":"2026-02-10T12:05:01.123897421+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.14.2","title":"Add empty states for all pages and tabs","description":"Meaningful messages and illustrations when no data exists for each page and tab.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:05:06.092715142+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:00.881010523+08:00","closed_at":"2026-02-10T19:11:00.881010523+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.14.2","depends_on_id":"butlers-26h.14","type":"parent-child","created_at":"2026-02-10T12:05:06.094400548+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.14.3","title":"Add breadcrumb navigation","description":"Breadcrumb trail on all pages: Overview \u003e Butler Name \u003e Tab.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:05:11.465094382+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:00.88572027+08:00","closed_at":"2026-02-10T19:11:00.88572027+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.14.3","depends_on_id":"butlers-26h.14","type":"parent-child","created_at":"2026-02-10T12:05:11.467039099+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.14.4","title":"Add keyboard shortcuts","description":"/ or Cmd+K → search, g o → overview, g t → timeline. Show keyboard shortcut hints in UI.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:05:16.603932574+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:00.89018891+08:00","closed_at":"2026-02-10T19:11:00.89018891+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.14.4","depends_on_id":"butlers-26h.14","type":"parent-child","created_at":"2026-02-10T12:05:16.627926221+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.14.5","title":"Add SSE endpoint for live butler status updates","description":"Server-Sent Events endpoint streaming butler status changes and active session start/stop events. Foundation for real-time dashboard updates.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:05:23.54050317+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:00.89430283+08:00","closed_at":"2026-02-10T19:11:00.89430283+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.14.5","depends_on_id":"butlers-26h.14","type":"parent-child","created_at":"2026-02-10T12:05:23.554865641+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.14.6","title":"Add auto-refresh for timeline and session lists","description":"TanStack Query refetchInterval for timeline and session list pages. Configurable refresh rate (default 10s). Toggle on/off in UI.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:05:28.912127654+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T19:11:00.89827417+08:00","closed_at":"2026-02-10T19:11:00.89827417+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.14.6","depends_on_id":"butlers-26h.14","type":"parent-child","created_at":"2026-02-10T12:05:28.937330306+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.15","title":"M13: Audit log","description":"Audit log for all dashboard-initiated write operations. Every mutation (trigger, tick, schedule CRUD, state CRUD) is logged with timestamp, butler, operation type, user context (IP/user-agent for v1), request payload summary, and result (success/error). Includes Alembic migration for dashboard_audit_log table in Switchboard DB, GET /api/audit-log endpoint with pagination and filtering, audit logging decorator for write endpoints, and frontend audit log table page. See specs/dashboard-audit/spec.md. Tasks §27 in OpenSpec.","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:08:53.185330014+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:09.793546929+08:00","closed_at":"2026-02-10T18:43:09.793546929+08:00","close_reason":"Closed","labels":["backend","dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.15","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T12:08:53.188838796+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.15","depends_on_id":"butlers-26h.5","type":"blocks","created_at":"2026-02-10T12:08:53.242647948+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.15.1","title":"Alembic migration for dashboard_audit_log table","description":"Alembic migration in Switchboard chain: create dashboard_audit_log table with columns: id (UUID PK, gen_random_uuid()), timestamp (TIMESTAMPTZ NOT NULL, default now()), butler (TEXT NOT NULL), operation (TEXT NOT NULL), user_context (JSONB NOT NULL), request_summary (JSONB NOT NULL), result (TEXT NOT NULL), error_message (TEXT nullable). Indexes: idx_audit_butler_timestamp on (butler, timestamp DESC), idx_audit_operation_timestamp on (operation, timestamp DESC), idx_audit_timestamp on (timestamp DESC). See specs/dashboard-audit/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:09:17.226395763+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:01.302401659+08:00","closed_at":"2026-02-10T18:43:01.302401659+08:00","close_reason":"Closed","labels":["backend","dashboard","database"],"dependencies":[{"issue_id":"butlers-26h.15.1","depends_on_id":"butlers-26h.15","type":"parent-child","created_at":"2026-02-10T12:09:17.228260908+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.15.2","title":"Create audit log API router","description":"Create src/butlers/api/routers/audit.py — GET /api/audit-log endpoint. Paginated (limit/offset), filterable by butler, operation type, date range (from/to). Response: {items: AuditEntry[], total: int}. Ordered by timestamp descending. See specs/dashboard-audit/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:09:20.678929135+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:01.312067002+08:00","closed_at":"2026-02-10T18:43:01.312067002+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.15.2","depends_on_id":"butlers-26h.15","type":"parent-child","created_at":"2026-02-10T12:09:20.686160252+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.15.3","title":"Create AuditEntry Pydantic model","description":"Create src/butlers/api/models/audit.py — AuditEntry Pydantic model with fields: id (UUID), timestamp (datetime), butler (str), operation (str), user_context (dict with ip, user_agent), request_summary (dict), result (Literal['success', 'error']), error_message (Optional[str]). See specs/dashboard-audit/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:09:24.198525114+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:01.315713458+08:00","closed_at":"2026-02-10T18:43:01.315713458+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.15.3","depends_on_id":"butlers-26h.15","type":"parent-child","created_at":"2026-02-10T12:09:24.202620905+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.15.4","title":"Add audit logging decorator to write endpoints","description":"Implement audit logging decorator/middleware for all dashboard write endpoints. Applied to: POST trigger, POST tick, POST/PUT/DELETE/PATCH schedule CRUD, PUT/DELETE state CRUD. Extracts IP and User-Agent from request, logs operation result to dashboard_audit_log. Non-blocking: audit logging failures logged as warnings but do not cause API response to fail. See specs/dashboard-audit/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:09:29.207795316+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:01.319060529+08:00","closed_at":"2026-02-10T18:43:01.319060529+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.15.4","depends_on_id":"butlers-26h.15","type":"parent-child","created_at":"2026-02-10T12:09:29.210034679+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.15.5","title":"Create AuditLogTable.tsx component","description":"Create src/components/audit/AuditLogTable.tsx — paginated audit log table with columns: timestamp (formatted), butler (badge), operation (badge), IP (from user_context), request summary (truncated JSON), result (success/error badge), error message (expandable if present). Filter controls: butler selector, operation type selector, date range picker. Pagination controls. Error entries visually distinct with red badge. See specs/dashboard-audit/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:09:32.908065042+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:01.322330444+08:00","closed_at":"2026-02-10T18:43:01.322330444+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.15.5","depends_on_id":"butlers-26h.15","type":"parent-child","created_at":"2026-02-10T12:09:32.926270982+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.15.6","title":"Create useAuditLog TanStack Query hook","description":"Create src/api/hooks/useAuditLog.ts — TanStack Query hook for GET /api/audit-log endpoint. Supports butler, operation, from, to filter params and pagination (limit, offset). See specs/dashboard-audit/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:09:36.773107958+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:01.325566356+08:00","closed_at":"2026-02-10T18:43:01.325566356+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.15.6","depends_on_id":"butlers-26h.15","type":"parent-child","created_at":"2026-02-10T12:09:36.775437531+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.15.7","title":"Write tests for audit log endpoints","description":"Tests for audit log: (1) audit entry creation on trigger/schedule/state write operations, (2) GET /api/audit-log pagination and filtering (by butler, operation, date range), (3) user_context extraction (IP, User-Agent), (4) error result logging when write endpoint fails, (5) audit logging failure does not break API response. See specs/dashboard-audit/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:09:40.229420211+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:43:01.32886228+08:00","closed_at":"2026-02-10T18:43:01.32886228+08:00","close_reason":"Closed","labels":["backend","dashboard","testing"],"dependencies":[{"issue_id":"butlers-26h.15.7","depends_on_id":"butlers-26h.15","type":"parent-child","created_at":"2026-02-10T12:09:40.232278493+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.16","title":"Replace boilerplate frontend README with project-specific documentation","description":"The frontend/README.md is still the default Vite React+TypeScript template text (plugin recommendations, ESLint config expansion tips). It says nothing about the Butlers dashboard project itself.\n\nReplace it with project-relevant content:\n- What the frontend is (Butlers dashboard SPA)\n- Tech stack summary (React, TypeScript, Vite, TanStack Router/Query, shadcn/ui)\n- How to run locally (dev, build, lint, preview)\n- Project structure overview (pages/, components/, api/, hooks/, layouts/)\n- Connection to the FastAPI backend (proxy config, API client)\n- Any environment variables or prerequisites","acceptance_criteria":"1. README accurately describes the Butlers frontend dashboard\n2. Dev setup instructions work for a new contributor (npm install, dev server)\n3. No leftover Vite template boilerplate remains\n4. Project structure section matches actual directory layout","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-11T04:02:16.479835393+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T04:06:27.994523773+08:00","closed_at":"2026-02-11T04:06:27.994523773+08:00","close_reason":"Frontend README replaced with comprehensive project docs. Covers tech stack, setup instructions, project structure, backend connection, key features, and development notes.","labels":["docs","frontend"],"dependencies":[{"issue_id":"butlers-26h.16","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-11T04:02:16.481401442+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.17","title":"Fix frontend build: corrupted template literals, missing braces, and lint errors","description":"Running `npm run build` (or `tsc -b \u0026\u0026 vite build`) fails with 15+ TypeScript errors and 6 ESLint errors. The dev server starts but the app cannot be compiled or type-checked. Three root causes:\n\n1. **src/api/client.ts** — The Memory API section (lines 779–875) is a corrupted duplicate. Template literal backticks were replaced with bare backslashes, producing invalid syntax. Correct versions of the same functions already exist later in the file (lines 877–932). Fix: delete the corrupted block (lines 779–834) and the duplicate helper functions (lines 837–875).\n\n2. **src/api/types.ts:698** — `ResearchParams` interface is missing its closing brace `}`, causing `EntityParams` to be parsed as nested inside it. Fix: add the missing `}` before `EntityParams`.\n\n3. **src/pages/ButlerDetailPage.tsx:473** — The `{showHealthTab \u0026\u0026 (` JSX conditional is missing its closing `)}` before the `{isGeneral \u0026\u0026 (` block. Fix: add `)}` after the health `\u003c/TabsContent\u003e`.\n\nAdditionally, ESLint reports 6 errors / 5 warnings:\n- `CostWidget.tsx:58` — `Math.random()` in render (impure function)\n- `JsonViewer.tsx:31` — Unused `JsonValue` type\n- `MeasurementChart.tsx`, `EntitiesPage.tsx`, `MealsPage.tsx`, `TimelinePage.tsx` — react-hooks/exhaustive-deps warnings from conditional useMemo/useCallback deps","acceptance_criteria":"1. `npm run build` succeeds without errors\n2. `npm run lint` reports zero errors (warnings acceptable)\n3. No duplicate function definitions remain in client.ts\n4. Dev server starts and renders pages without runtime errors","notes":"Likely caused by a failed merge or agent edit that left corrupted duplicates. The correct code already exists in the file — the fix is mostly deletion, not rewriting.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-11T04:04:31.718096108+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T06:38:33.45475719+08:00","closed_at":"2026-02-11T06:38:33.45475719+08:00","close_reason":"All three syntax issues (corrupted template literals in client.ts, missing brace in types.ts, missing closing paren in ButlerDetailPage.tsx) and lint errors (Math.random impurity, unused JsonValue) were already fixed in the working tree. Build succeeds, lint reports 0 errors, dev server starts cleanly.","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.17","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-11T04:04:31.719879507+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2","title":"M0: Dashboard project scaffolding","description":"Set up both the frontend and API projects, verify they build and connect. Create FastAPI app with CORS, DB pool manager, MCP client manager, CLI command. Scaffold frontend with Vite+React+TS, Tailwind, shadcn/ui, TanStack Query. Docker services. Tasks 2.1-2.13, 11.1-11.11, 24.1-24.4 in OpenSpec.","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:42.336506897+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:55:27.814473862+08:00","closed_at":"2026-02-10T14:55:27.814473862+08:00","close_reason":"All 22 children completed: API scaffolding, frontend scaffolding, docker services, testing","labels":["dashboard","infra"],"dependencies":[{"issue_id":"butlers-26h.2","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:42.338311286+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.1","title":"Add FastAPI, uvicorn, httpx to pyproject.toml","description":"Add FastAPI, uvicorn, and httpx as dependencies in pyproject.toml.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T11:59:48.676600055+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:04:22.290521103+08:00","closed_at":"2026-02-10T13:04:22.290521103+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard","infra"],"dependencies":[{"issue_id":"butlers-26h.2.1","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T11:59:48.678363206+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.10","title":"Write tests for MCPClientManager and butler discovery","description":"Test lazy MCP client connection, unreachable butler handling, butler discovery from config directories.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:00:29.579750394+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:20:51.636443539+08:00","closed_at":"2026-02-10T13:20:51.636443539+08:00","close_reason":"Already complete — 26 tests in tests/api/test_deps.py created with butlers-26h.2.4","labels":["backend","dashboard","testing"],"dependencies":[{"issue_id":"butlers-26h.2.10","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:00:29.581393499+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.11","title":"Scaffold frontend with Vite, React 18, and TypeScript","description":"Run npm create vite@latest to scaffold frontend/ with React 18 + TypeScript template.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:00:33.728597708+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:45:22.843664244+08:00","closed_at":"2026-02-10T13:45:22.843664244+08:00","close_reason":"Closed","labels":["dashboard","frontend","infra"],"dependencies":[{"issue_id":"butlers-26h.2.11","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:00:33.730265378+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.12","title":"Install and configure Tailwind CSS for frontend","description":"Install Tailwind CSS in frontend/, configure tailwind.config.ts, create globals.css with Tailwind imports.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:00:38.645484948+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:50:03.209311943+08:00","closed_at":"2026-02-10T13:50:03.209311943+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.2.12","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:00:38.647485758+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.13","title":"Install and configure shadcn/ui components","description":"Init shadcn/ui in frontend/. Add core components: Button, Card, Table, Badge, Tabs, Dialog, DropdownMenu, Input, Textarea, Select, Toggle, Tooltip, Skeleton, Toast, Sheet.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:00:43.704438517+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:58:15.738582427+08:00","closed_at":"2026-02-10T13:58:15.738582427+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.2.13","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:00:43.711143264+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.14","title":"Set up React Router v7 with all page routes","description":"Install React Router v7. Configure routes for: /, /timeline, /sessions, /traces, /traces/:traceId, /costs, /notifications, /butlers/:name.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:00:48.189777892+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:50:03.267471109+08:00","closed_at":"2026-02-10T13:50:03.267471109+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.2.14","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:00:48.191368677+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.15","title":"Install and configure TanStack Query","description":"Install TanStack Query. Set up QueryClient with defaults, wrap app in QueryClientProvider.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:00:52.852498636+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:58:15.821698326+08:00","closed_at":"2026-02-10T13:58:15.821698326+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.2.15","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:00:52.85470785+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.16","title":"Create API client with typed fetch wrapper","description":"Create src/api/client.ts — base fetch wrapper with configurable VITE_API_URL, error handling, typed responses. Create src/api/types.ts with TypeScript types matching API Pydantic models.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:02.711326832+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:50:03.317673257+08:00","closed_at":"2026-02-10T13:50:03.317673257+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.2.16","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:01:02.719153239+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.17","title":"Install cmdk, React Flow, Recharts, date-fns","description":"Install cmdk (command palette), React Flow (topology graph), Recharts (charts), date-fns (date handling) in frontend/.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:01:06.905377776+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:58:15.872553706+08:00","closed_at":"2026-02-10T13:58:15.872553706+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.2.17","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:01:06.906878832+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.18","title":"Set up Vite dev proxy for API","description":"Configure vite.config.ts to proxy /api requests to the dashboard API server in development.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:01:11.127423151+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:02:16.127328473+08:00","closed_at":"2026-02-10T14:02:16.127328473+08:00","close_reason":"Closed","labels":["dashboard","frontend","infra"],"dependencies":[{"issue_id":"butlers-26h.2.18","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:01:11.150693747+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.19","title":"Verify frontend-to-API connectivity","description":"Verify frontend dev server renders, proxies to API health endpoint, returns OK. End-to-end smoke test.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:01:15.38206905+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:09:19.074259761+08:00","closed_at":"2026-02-10T14:09:19.074259761+08:00","close_reason":"Closed","labels":["dashboard","frontend","testing"],"dependencies":[{"issue_id":"butlers-26h.2.19","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:01:15.383676356+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.2","title":"Create dashboard API app factory with CORS and health endpoint","description":"Create src/butlers/api/app.py — FastAPI app factory with CORS middleware, router registration, lifespan handler for startup/shutdown of DB pools and MCP clients. Include GET /api/health endpoint.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T11:59:53.430291565+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:12:47.276701109+08:00","closed_at":"2026-02-10T13:12:47.276701109+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.2.2","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T11:59:53.43213075+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.20","title":"Add dashboard-api service to docker-compose.yml","description":"Add dashboard-api service: port 8200, depends on postgres healthy, mounts butlers/ config read-only, runs 'butlers dashboard' command.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:20.643292961+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:02:16.18527743+08:00","closed_at":"2026-02-10T14:02:16.18527743+08:00","close_reason":"Closed","labels":["dashboard","infra"],"dependencies":[{"issue_id":"butlers-26h.2.20","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:01:20.645212086+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.21","title":"Add frontend dev service to docker-compose.yml","description":"Add frontend dev service behind compose profile (not started by default): node:22-slim, port 5173, VITE_API_URL env var.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:01:25.521763973+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:54:48.787636405+08:00","closed_at":"2026-02-10T14:54:48.787636405+08:00","close_reason":"Merged to main, 1232 unit tests pass, frontend builds","labels":["dashboard","infra"],"dependencies":[{"issue_id":"butlers-26h.2.21","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:01:25.523306567+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.22","title":"Configure FastAPI static file serving for production","description":"Mount frontend/dist/ at / with html=True fallback in FastAPI app. API routes take precedence. Single container deployment.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:30.265715346+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:02:16.236284267+08:00","closed_at":"2026-02-10T14:02:16.236284267+08:00","close_reason":"Closed","labels":["backend","dashboard","infra"],"dependencies":[{"issue_id":"butlers-26h.2.22","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:01:30.267584368+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.3","title":"Create multi-DB connection manager","description":"Create src/butlers/api/db.py — DatabaseManager class: one asyncpg pool per butler DB, pool(butler_name) accessor, fan_out(query, butler_names?) for concurrent cross-butler queries, startup/shutdown lifecycle.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T11:59:57.793729357+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:12:47.336969104+08:00","closed_at":"2026-02-10T13:12:47.336969104+08:00","close_reason":"Closed","labels":["backend","dashboard","database"],"dependencies":[{"issue_id":"butlers-26h.2.3","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T11:59:57.795676005+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.4","title":"Create MCP client manager and butler discovery deps","description":"Create src/butlers/api/deps.py — MCPClientManager (lazy FastMCP client per butler, graceful unreachable handling), discover_butlers() using existing config loader, FastAPI dependency functions.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:00:02.081642942+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:20:09.494248223+08:00","closed_at":"2026-02-10T13:20:09.494248223+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.2.4","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:00:02.083453022+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.5","title":"Create shared Pydantic response/request models base","description":"Create src/butlers/api/models/__init__.py — shared base models, error response format, pagination metadata.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:00:06.909940641+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:20:09.547432131+08:00","closed_at":"2026-02-10T13:20:09.547432131+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.2.5","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:00:06.911792038+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.6","title":"Add butlers dashboard CLI command","description":"Add 'butlers dashboard' command to cli.py — starts uvicorn with --host (default 0.0.0.0) and --port (default 8200) options.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:00:11.290201991+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:25:05.571740308+08:00","closed_at":"2026-02-10T13:25:05.571740308+08:00","close_reason":"Closed","labels":["backend","cli","dashboard"],"dependencies":[{"issue_id":"butlers-26h.2.6","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:00:11.29169947+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.7","title":"Add API error handling middleware","description":"Consistent error format: {error: {code, message, butler?}}. Return 502 for unreachable butlers, 404 for unknown butlers, proper error codes throughout.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:00:15.654597016+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:25:05.627311692+08:00","closed_at":"2026-02-10T13:25:05.627311692+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.2.7","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:00:15.669749063+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.8","title":"Create pricing.toml config for per-model token pricing","description":"Create pricing.toml mapping model IDs to input/output per-token prices. Loaded at API startup. Used by cost estimation logic.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:00:20.017082445+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:25:05.685563947+08:00","closed_at":"2026-02-10T13:25:05.685563947+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.2.8","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:00:20.020914334+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.2.9","title":"Write tests for DatabaseManager","description":"Test pool creation, fan_out concurrent queries, shutdown cleanup. Mock asyncpg pools.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:00:24.989376752+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:20:51.527477867+08:00","closed_at":"2026-02-10T13:20:51.527477867+08:00","close_reason":"Already complete — 10 tests in tests/api/test_db.py created with butlers-26h.2.3","labels":["backend","dashboard","testing"],"dependencies":[{"issue_id":"butlers-26h.2.9","depends_on_id":"butlers-26h.2","type":"parent-child","created_at":"2026-02-10T12:00:24.990866196+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3","title":"M1: Butler discovery and overview page","description":"Landing page with topology graph, stats, and issues panel. API endpoints for butler discovery, live status, and issues aggregation. Frontend app shell with sidebar, overview page with React Flow topology, aggregate stats, issues panel, cost widget, and activity feed. Tasks 3.1-3.11, 12.1-12.8, 13.1-13.7 in OpenSpec.","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:42.403354673+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:37:31.075225072+08:00","closed_at":"2026-02-10T17:37:31.075225072+08:00","close_reason":"All 22 children completed — butler discovery, overview page, sidebar, topology graph, issues panel, and all API endpoints done","labels":["backend","dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.3","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:42.405037292+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.3","depends_on_id":"butlers-26h.2","type":"blocks","created_at":"2026-02-10T12:05:51.105136118+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.1","title":"Create butler discovery and status API router","description":"Create src/butlers/api/routers/butlers.py with ButlerSummary, ButlerDetail, ModuleStatus Pydantic models in src/butlers/api/models/butler.py.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:00:22.038629995+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:03:56.451361837+08:00","closed_at":"2026-02-10T15:03:56.451361837+08:00","close_reason":"Merged to main, 1274 unit tests pass","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.3.1","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:00:22.043630252+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.10","title":"Write tests for butler discovery and status endpoints","description":"Test butler list, single butler detail, unreachable handling, issues aggregation.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:02.020704611+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:20:04.809400121+08:00","closed_at":"2026-02-10T15:20:04.809400121+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard","testing"],"dependencies":[{"issue_id":"butlers-26h.3.10","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:01:02.022880552+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.11","title":"Create app shell layout component","description":"Create src/components/layout/Shell.tsx — three-region layout: sidebar, header, main content area.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:05.963632665+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:24:42.050087377+08:00","closed_at":"2026-02-10T15:24:42.050087377+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.3.11","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:01:05.965195678+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.12","title":"Create sidebar navigation component","description":"Create src/components/layout/Sidebar.tsx — collapsible sidebar with nav items (Overview, Timeline, Butlers section with status dots, Sessions, Traces, Notifications, Costs). Issues badge count on Overview. Today's spend in sidebar footer.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:01:10.902532242+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:24:42.093908944+08:00","closed_at":"2026-02-10T15:24:42.093908944+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.3.12","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:01:10.904096848+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.13","title":"Create page header with breadcrumbs and dark mode toggle","description":"Create src/components/layout/PageHeader.tsx — page title, breadcrumbs, dark mode toggle. Implement dark mode with Tailwind dark class, persisted to localStorage, system preference fallback.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:01:15.031773061+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:24:42.142562847+08:00","closed_at":"2026-02-10T15:24:42.142562847+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.3.13","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:01:15.033331174+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.14","title":"Implement responsive sidebar collapse","description":"Collapse sidebar to off-screen drawer below 768px, icon-only mode on desktop toggle.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:01:19.612628082+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:37:24.460613435+08:00","closed_at":"2026-02-10T17:37:24.460613435+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.3.14","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:01:19.614634152+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.15","title":"Create error boundary and toast notification system","description":"Error boundary wrapping routed content. Toast notifications for API errors and write operation confirmations.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:23.745949242+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:30:35.083484164+08:00","closed_at":"2026-02-10T15:30:35.083484164+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.3.15","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:01:23.747461259+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.16","title":"Create useButlers TanStack Query hook","description":"Create src/api/hooks/useButlers.ts — TanStack Query hook for butler list endpoint. Used to populate sidebar and overview page.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T12:01:27.876710005+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:30:35.139297765+08:00","closed_at":"2026-02-10T15:30:35.139297765+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.3.16","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:01:27.879833546+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.17","title":"Create overview page with aggregate stats bar","description":"Create src/pages/Overview.tsx with aggregate stats bar: total butlers, healthy count (status() call succeeded), sessions today, failed sessions today, estimated cost today. Stats bar is the top section of the overview page. See specs/dashboard-overview/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:01:32.379543532+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:34:53.755374839+08:00","closed_at":"2026-02-10T15:34:53.755374839+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.3.17","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:01:32.381516209+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.18","title":"Build topology graph with React Flow","description":"Create src/components/topology/TopologyGraph.tsx — React Flow graph: Switchboard as center node (visually distinct, larger), butler nodes with status badges (green=healthy, red=unreachable, yellow=degraded), module health dots per D13 (green=connected, yellow=degraded, red=error, gray=unknown), Heartbeat with dashed edges to non-Switchboard butlers, active session pulse/glow when completed_at IS NULL, edge labels for routing channels, click node → navigate to /butlers/:name. See specs/dashboard-overview/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":180,"created_at":"2026-02-10T12:01:39.55182726+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:01:40.078427168+08:00","closed_at":"2026-02-10T16:01:40.078427168+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.3.18","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:01:39.553594499+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.19","title":"Build issues panel component","description":"Create src/components/issues/IssuesPanel.tsx — prominent alert section: unreachable butlers, failing tasks, cost anomalies, failed notifications. Each issue: severity badge (critical/warning), butler name, description, link to detail. Dismissable per-issue (localStorage).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:44.587097861+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:34:53.826550416+08:00","closed_at":"2026-02-10T15:34:53.826550416+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.3.19","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:01:44.589030612+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.2","title":"Implement GET /api/butlers — butler list with live status","description":"Discover butlers from config dirs, call status() via MCP client on each, return aggregated list with live health. Handle unreachable butlers gracefully (timeout/connection refused → status: down).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:00:26.125448524+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:03:56.49554394+08:00","closed_at":"2026-02-10T15:03:56.49554394+08:00","close_reason":"Merged to main, 1274 unit tests pass","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.3.2","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:00:26.127245169+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.20","title":"Build cost summary widget for overview","description":"Today's spend, 7-day trend sparkline (Recharts), top spender butler. Links to full cost view.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:01:49.346054027+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:45:04.010001565+08:00","closed_at":"2026-02-10T15:45:04.010001565+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.3.20","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:01:49.34760105+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.21","title":"Build recent activity feed for overview","description":"Last 10 cross-butler events sourced from GET /api/timeline?limit=10. Each entry: relative timestamp, butler badge, event type icon, one-line summary. Heartbeat tick collapsing: consecutive heartbeat tick events (type=schedule, task_name matches heartbeat pattern) within the same 10-minute cycle SHALL be collapsed into a single entry: 'Heartbeat: N butlers ticked, M failures'. Collapsed entries are expandable. Collapsing is frontend-only — API returns individual events. See specs/dashboard-overview/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:55.10195073+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:39:38.848732462+08:00","closed_at":"2026-02-10T15:39:38.848732462+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.3.21","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:01:55.10414224+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.22","title":"Create useIssues TanStack Query hook","description":"Create src/api/hooks/useIssues.ts — TanStack Query hook for issues endpoint.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:01:59.426700916+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:34:53.794072393+08:00","closed_at":"2026-02-10T15:34:53.794072393+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.3.22","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:01:59.428543307+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.23","title":"Create Issue Pydantic model","description":"Create src/butlers/api/models/issue.py — Issue Pydantic model with fields: severity (Literal['critical', 'warning']), type (Literal['unreachable', 'failing_task', 'module_error', 'cost_anomaly', 'notification_failure']), butler (str), description (str), link (Optional[str]). Used by GET /api/issues endpoint. See specs/dashboard-overview/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:08:45.558995509+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:30:58.601884887+08:00","closed_at":"2026-02-10T15:30:58.601884887+08:00","close_reason":"Issue model already implemented in butlers-26h.3.9","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.3.23","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:08:45.5664557+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.3","title":"Implement GET /api/butlers/:name — single butler detail","description":"Single butler detail with live status, module health, config summary.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:00:30.283885124+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:03:56.528077411+08:00","closed_at":"2026-02-10T15:03:56.528077411+08:00","close_reason":"Merged to main, 1274 unit tests pass","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.3.3","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:00:30.286400627+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.4","title":"Implement GET /api/butlers/:name/config — read config files","description":"Read butler.toml, CLAUDE.md, AGENTS.md from disk and return as structured response.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:00:34.293773771+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:12:20.940701524+08:00","closed_at":"2026-02-10T15:12:20.940701524+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.3.4","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:00:34.295622073+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.5","title":"Implement GET /api/butlers/:name/skills — list skills","description":"List skills/ directory for a butler, read SKILL.md files, return skill name and content.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:00:38.637139651+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:12:20.988103965+08:00","closed_at":"2026-02-10T15:12:20.988103965+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.3.5","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:00:38.639342122+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.6","title":"Implement GET /api/butlers/:name/modules — module health","description":"Implement GET /api/butlers/:name/modules — module list with health status. Per D13, module health is determined from the MCP status() tool response. The status() response includes a modules field with per-module health indicators: connected (healthy), degraded, error, or unknown. Dashboard polls status() which already runs for the topology view. See design.md D13.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:00:43.492693625+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:12:21.021107552+08:00","closed_at":"2026-02-10T15:12:21.021107552+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.3.6","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:00:43.494398045+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.7","title":"Implement POST /api/butlers/:name/trigger — trigger CC","description":"Trigger CC session via MCP client with user-provided prompt. Return session result.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:00:48.565911425+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:20:04.733740391+08:00","closed_at":"2026-02-10T15:20:04.733740391+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.3.7","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:00:48.567422119+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.8","title":"Implement POST /api/butlers/:name/tick — force tick","description":"Force scheduler tick via MCP client on the specified butler.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:00:53.72395005+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:20:04.775024653+08:00","closed_at":"2026-02-10T15:20:04.775024653+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.3.8","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:00:53.725582063+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.3.9","title":"Implement GET /api/issues — active issues aggregation","description":"Create src/butlers/api/routers/issues.py — issues aggregation endpoint (GET /api/issues). Aggregate active issues from multiple sources: (1) unreachable butlers — MCP status() call fails/times out, severity=critical, type=unreachable; (2) failing scheduled tasks — consecutive_failures \u003e= 3, severity=warning, type=failing_task; (3) module dependency failures — per D13, check per-module health from status() response, severity=warning, type=module_error; (4) butler-level cost anomalies — daily spend \u003e2x 7-day daily average per D14, severity=warning, type=cost_anomaly; (5) failed notification deliveries — status='failed' in last 24h from Switchboard notifications table, severity=warning, type=notification_failure. Response: JSON array of Issue objects with severity (critical/warning), type, butler, description, link. Sorted by severity (critical first), then butler name. See specs/dashboard-overview/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:00:57.705685281+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:30:35.171072138+08:00","closed_at":"2026-02-10T15:30:35.171072138+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.3.9","depends_on_id":"butlers-26h.3","type":"parent-child","created_at":"2026-02-10T12:00:57.707531048+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4","title":"M2: Butler detail — sessions, config, skills","description":"Core visibility into what a butler is and what it has been doing. Sessions API (paginated, cross-butler), config/skills/modules read endpoints. Frontend butler detail page with tabs: Overview, Sessions, Config, Skills. Cross-butler sessions page. Tasks 4.1-4.6, 14.1-14.5, 15.1-15.6 in OpenSpec.","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:42.476713841+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:56:39.553792987+08:00","closed_at":"2026-02-10T17:56:39.553792987+08:00","close_reason":"All 16 children completed — sessions API, butler detail page, tabs (overview, sessions, config, skills, trigger), session table, detail drawer, cost column","labels":["backend","dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.4","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:42.478333731+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.4","depends_on_id":"butlers-26h.3","type":"blocks","created_at":"2026-02-10T12:05:51.213844411+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.1","title":"Create sessions API router and Pydantic models","description":"Create src/butlers/api/routers/sessions.py and src/butlers/api/models/session.py with SessionSummary and SessionDetail Pydantic models.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:00:46.479868499+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:46:48.421109969+08:00","closed_at":"2026-02-10T17:46:48.421109969+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.4.1","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:00:46.481396446+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.10","title":"Build butler trigger tab","description":"Prompt textarea, submit button, result display with token usage and cost. History of manual triggers.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:01:28.769185301+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:56:34.032203723+08:00","closed_at":"2026-02-10T17:56:34.032203723+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.4.10","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:01:28.770955947+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.11","title":"Create useSessions TanStack Query hooks","description":"Create src/api/hooks/useSessions.ts — hooks for session list (paginated) and session detail.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T12:01:33.901161347+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:56:34.049204999+08:00","closed_at":"2026-02-10T17:56:34.049204999+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.4.11","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:01:33.903147078+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.12","title":"Build session table component","description":"Create src/components/sessions/SessionTable.tsx — paginated table: timestamp, butler badge, trigger source, prompt (truncated), duration, tokens, cost, success/fail badge.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:37.919072153+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:56:34.06744442+08:00","closed_at":"2026-02-10T17:56:34.06744442+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.4.12","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:01:37.921463591+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.13","title":"Build session detail drawer component","description":"Create src/components/sessions/SessionDetail.tsx — drawer/panel: full prompt, tool calls timeline (ordered, with args and results), result, error details, token breakdown, cost, trace_id link to /traces/:traceId.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:01:43.174891859+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:56:34.082681198+08:00","closed_at":"2026-02-10T17:56:34.082681198+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.4.13","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:01:43.176442669+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.14","title":"Create cross-butler sessions page","description":"Create src/pages/Sessions.tsx — cross-butler sessions with filters (butler, date range, trigger source, success/fail).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:01:48.439961673+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:56:34.097448202+08:00","closed_at":"2026-02-10T17:56:34.097448202+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.4.14","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:01:48.441797251+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.15","title":"Add sessions tab to butler detail page","description":"Scoped session table on butler detail page, using same SessionTable component filtered to single butler.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T12:01:53.119985823+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:56:34.112630979+08:00","closed_at":"2026-02-10T17:56:34.112630979+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.4.15","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:01:53.121555158+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.16","title":"Implement cost column and anomaly badges in session tables","description":"Derive cost from tokens × pricing config. Show anomaly badge on individual sessions costing \u003e3x the butler's 7-day average session cost (per D14 session-level threshold). This is distinct from the butler-level 2x daily threshold used in the Issues panel. See design.md D14.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:57.373416134+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:56:34.127922702+08:00","closed_at":"2026-02-10T17:56:34.127922702+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.4.16","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:01:57.374970691+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.2","title":"Implement GET /api/sessions — cross-butler paginated sessions","description":"Cross-butler paginated sessions via fan-out query. Query params: limit, offset, butler, trigger_source, success, from, to.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:00:51.266382778+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:46:48.441859708+08:00","closed_at":"2026-02-10T17:46:48.441859708+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.4.2","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:00:51.268153673+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.3","title":"Implement GET /api/butlers/:name/sessions — single-butler sessions","description":"Paginated session list for a single butler via direct DB read. Same filter params as cross-butler endpoint.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:00:58.406143676+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:46:48.456688916+08:00","closed_at":"2026-02-10T17:46:48.456688916+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.4.3","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:00:58.410182667+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.4","title":"Implement GET /api/butlers/:name/sessions/:id — session detail","description":"Full session detail: prompt, result, tool_calls, tokens (input/output), cost estimate, trace_id, error details.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:01:02.477470064+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:46:48.472109175+08:00","closed_at":"2026-02-10T17:46:48.472109175+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.4.4","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:01:02.479231121+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.5","title":"Write tests for session API endpoints","description":"Test pagination, filtering, cross-butler aggregation, session detail.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:06.318484491+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:47:20.141825774+08:00","closed_at":"2026-02-10T17:47:20.141825774+08:00","close_reason":"Already implemented by session API worker — 12 tests in tests/api/test_sessions.py","labels":["backend","dashboard","testing"],"dependencies":[{"issue_id":"butlers-26h.4.5","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:01:06.320494889+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.6","title":"Create butler detail page with tab navigation","description":"Create src/pages/ButlerDetail.tsx — tabbed detail view with tab navigation via URL query params.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:01:10.798791714+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:46:48.487273704+08:00","closed_at":"2026-02-10T17:46:48.487273704+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.4.6","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:01:10.800227807+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.7","title":"Build butler overview tab","description":"Butler detail overview tab — the default view at /butlers/:name. Components: (1) Identity card — butler name, description (MANIFESTO.md first line), port, uptime from status() started_at (or 'Unreachable' with red badge); (2) Module health badges — colored dot per module per D13 (green=connected, yellow=degraded, red=error, gray=unknown), module name labels; (3) Active session indicator — 'Currently running CC session' with elapsed time when completed_at IS NULL exists, otherwise 'Idle — last session N ago'; (4) Error summary — count of failed sessions (success=false) in last 24h, clickable link to sessions tab filtered to failures; (5) Cost card — sessions/tokens/cost today with sparkline; (6) Recent notifications — last 5. See specs/dashboard-butler-detail/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:01:14.808579388+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:46:48.502831172+08:00","closed_at":"2026-02-10T17:46:48.502831172+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.4.7","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:01:14.810154063+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.8","title":"Build butler config tab","description":"Structured butler.toml view with raw toggle (syntax highlighted), CLAUDE.md rendered as markdown, AGENTS.md rendered as markdown, module credential status (required env vars — set/missing, never actual values).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:19.166492071+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:46:48.517550573+08:00","closed_at":"2026-02-10T17:46:48.517550573+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.4.8","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:01:19.168003206+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.4.9","title":"Build butler skills tab","description":"Skill cards (name, description from first line of SKILL.md). Click → full SKILL.md rendered as markdown + file list. 'Trigger with skill' button pre-fills trigger prompt.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:24.169492939+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:56:34.008491864+08:00","closed_at":"2026-02-10T17:56:34.008491864+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.4.9","depends_on_id":"butlers-26h.4","type":"parent-child","created_at":"2026-02-10T12:01:24.171006228+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5","title":"M3: Write operations — schedules, state, trigger","description":"Interactive admin capabilities. Schedule CRUD, state CRUD, trigger/tick endpoints via MCP client proxying. Frontend trigger tab, schedule management (create/edit/toggle/delete/run-now), state store browser with set/delete. Tasks 5.1-5.10, 16.1-16.7 in OpenSpec.","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:42.548049796+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:16:29.839136515+08:00","closed_at":"2026-02-10T18:16:29.839136515+08:00","close_reason":"All 14 children complete — schedules + state backend + frontend","labels":["backend","dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.5","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:42.549702889+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.5","depends_on_id":"butlers-26h.4","type":"blocks","created_at":"2026-02-10T12:05:51.306503886+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.1","title":"Create schedules API router and Pydantic models","description":"Create src/butlers/api/routers/schedules.py and src/butlers/api/models/schedule.py with Schedule Pydantic model.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:06.490690562+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:06:31.182913741+08:00","closed_at":"2026-02-10T18:06:31.182913741+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.5.1","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:01:06.494143236+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.10","title":"Build schedule create/edit form","description":"Create src/components/schedules/ScheduleForm.tsx — form: name input, cron expression input with live next-run preview, prompt textarea, validation.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:49.338175582+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:16:18.232100085+08:00","closed_at":"2026-02-10T18:16:18.232100085+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.5.10","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:01:49.339962659+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.11","title":"Add schedules tab to butler detail with full CRUD","description":"Table + create button → form modal, edit button → edit modal, toggle enable/disable, delete with confirmation dialog, 'Run now' per task.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:01:54.512079737+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:16:18.240305065+08:00","closed_at":"2026-02-10T18:16:18.240305065+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.5.11","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:01:54.514198731+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.12","title":"Create useState TanStack Query hooks with mutations","description":"Create src/api/hooks/useState.ts — hooks for list, get, set, delete state entries.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:59.728882453+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:16:18.248397642+08:00","closed_at":"2026-02-10T18:16:18.248397642+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.5.12","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:01:59.730581743+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.13","title":"Build state browser component","description":"Create src/components/state/StateBrowser.tsx — key-value table with expandable JSON rows, prefix search, syntax highlighting for values.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:02:03.725544578+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:16:18.256578476+08:00","closed_at":"2026-02-10T18:16:18.256578476+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.5.13","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:02:03.727711653+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.14","title":"Add state tab to butler detail with set/delete","description":"State browser + set key modal (key input + JSON editor with validation) + delete key with confirmation dialog.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:02:07.924360427+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:16:18.262902264+08:00","closed_at":"2026-02-10T18:16:18.262902264+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.5.14","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:02:07.926479861+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.2","title":"Implement GET /api/butlers/:name/schedules — list schedules","description":"List schedules for a butler via direct DB read.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:10.477523858+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:06:31.192960823+08:00","closed_at":"2026-02-10T18:06:31.192960823+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.5.2","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:01:10.479022519+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.3","title":"Implement schedule write endpoints via MCP proxying","description":"POST create, PUT update, DELETE, PATCH toggle for schedules. All writes proxied through MCP tool calls to the butler daemon.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:01:15.500920036+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:06:31.201714624+08:00","closed_at":"2026-02-10T18:06:31.201714624+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.5.3","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:01:15.503971361+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.4","title":"Create state API router and Pydantic models","description":"Create src/butlers/api/routers/state.py and src/butlers/api/models/state.py with StateEntry Pydantic model.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:19.675091434+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:06:31.211340872+08:00","closed_at":"2026-02-10T18:06:31.211340872+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.5.4","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:01:19.676628398+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.5","title":"Implement state read endpoints","description":"GET /api/butlers/:name/state (list with prefix filter) and GET /api/butlers/:name/state/:key (single entry) via direct DB read.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:23.630128329+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:06:31.218432735+08:00","closed_at":"2026-02-10T18:06:31.218432735+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.5.5","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:01:23.632170057+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.6","title":"Implement state write endpoints via MCP proxying","description":"PUT /api/butlers/:name/state/:key (set value) and DELETE /api/butlers/:name/state/:key via MCP tool calls.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:01:28.478094108+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:06:31.226041906+08:00","closed_at":"2026-02-10T18:06:31.226041906+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.5.6","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:01:28.482518598+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.7","title":"Write tests for schedule and state endpoints","description":"Test schedule CRUD, state CRUD, MCP proxying, error handling for unreachable butlers.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:33.058149041+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:06:41.250588064+08:00","closed_at":"2026-02-10T18:06:41.250588064+08:00","close_reason":"Already fulfilled: 12 schedule tests in test_schedules.py + 12 state tests in test_state.py created by workers for 5.1-5.3 and 5.4-5.6","labels":["backend","dashboard","testing"],"dependencies":[{"issue_id":"butlers-26h.5.7","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:01:33.060099546+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.8","title":"Create useSchedules TanStack Query hooks with mutations","description":"Create src/api/hooks/useSchedules.ts — hooks for list, create, update, toggle, delete with optimistic updates.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:40.159352025+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:16:18.210911705+08:00","closed_at":"2026-02-10T18:16:18.210911705+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.5.8","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:01:40.161033763+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.5.9","title":"Build schedule table component","description":"Create src/components/schedules/ScheduleTable.tsx — table: name, cron + human-readable description, next run, source badge (toml/db), enabled toggle, last result, 'Run now' button.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:44.748381165+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:16:18.224563748+08:00","closed_at":"2026-02-10T18:16:18.224563748+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.5.9","depends_on_id":"butlers-26h.5","type":"parent-child","created_at":"2026-02-10T12:01:44.75032077+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.6","title":"M4: Cost and usage tracking","description":"Token usage and cost tracking across the system. Cost estimation logic (tokens × configurable pricing), summary/daily/top-sessions/by-schedule API endpoints. Frontend cost page with area charts, butler breakdown, top sessions, per-schedule analysis. Cost widgets on overview and butler detail. Tasks 6.1-6.7, 17.1-17.5 in OpenSpec.","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:42.617046682+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:02:13.073277936+08:00","closed_at":"2026-02-10T16:02:13.073277936+08:00","close_reason":"All M4 tasks completed — cost tracking fully implemented","labels":["backend","dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.6","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:42.618872491+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.6","depends_on_id":"butlers-26h.1","type":"blocks","created_at":"2026-02-10T12:05:51.414169627+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.6","depends_on_id":"butlers-26h.2","type":"blocks","created_at":"2026-02-10T12:05:51.517389986+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.6.1","title":"Create costs API router","description":"Create src/butlers/api/routers/costs.py.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T12:01:21.824940674+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:39:38.757931242+08:00","closed_at":"2026-02-10T15:39:38.757931242+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.6.1","depends_on_id":"butlers-26h.6","type":"parent-child","created_at":"2026-02-10T12:01:21.826805677+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.6.10","title":"Build cost breakdown table component","description":"Create src/components/costs/CostSummary.tsx — butler breakdown table: name, sessions count, tokens (in/out), cost, % of total, trend arrow.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:02:01.181078499+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:56:35.472795589+08:00","closed_at":"2026-02-10T15:56:35.472795589+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.6.10","depends_on_id":"butlers-26h.6","type":"parent-child","created_at":"2026-02-10T12:02:01.182669896+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.6.11","title":"Build top expensive sessions component","description":"Create src/components/costs/TopSessions.tsx — table of most expensive sessions with butler badge, prompt snippet, cost.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:02:07.127183899+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:01:39.990169774+08:00","closed_at":"2026-02-10T16:01:39.990169774+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.6.11","depends_on_id":"butlers-26h.6","type":"parent-child","created_at":"2026-02-10T12:02:07.128681027+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.6.12","title":"Create costs page combining all cost views","description":"Create src/pages/Costs.tsx — full cost page: area chart, butler breakdown table, top sessions, per-schedule analysis.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:02:10.971364851+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:01:40.046286884+08:00","closed_at":"2026-02-10T16:01:40.046286884+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.6.12","depends_on_id":"butlers-26h.6","type":"parent-child","created_at":"2026-02-10T12:02:10.973274078+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.6.2","title":"Implement cost estimation logic","description":"Load pricing.toml at startup. Compute cost = input_tokens * input_price + output_tokens * output_price per model. Reusable function for all cost endpoints.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:25.963424408+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:39:38.806708978+08:00","closed_at":"2026-02-10T15:39:38.806708978+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.6.2","depends_on_id":"butlers-26h.6","type":"parent-child","created_at":"2026-02-10T12:01:25.964950441+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.6.3","title":"Implement GET /api/costs/summary — aggregate cost data","description":"Aggregate cost data: today, 7d, 30d totals. Per-butler breakdown. Uses fan-out query across all butler DBs.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:29.993354241+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:45:03.93377079+08:00","closed_at":"2026-02-10T15:45:03.93377079+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.6.3","depends_on_id":"butlers-26h.6","type":"parent-child","created_at":"2026-02-10T12:01:29.995224815+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.6.4","title":"Implement GET /api/costs/daily — daily cost time series","description":"Daily cost breakdown between from and to date params. Returns time series data for charting, stacked by butler.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:01:34.920474109+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:51:40.791113652+08:00","closed_at":"2026-02-10T15:51:40.791113652+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.6.4","depends_on_id":"butlers-26h.6","type":"parent-child","created_at":"2026-02-10T12:01:34.92240625+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.6.5","title":"Implement GET /api/costs/top-sessions — most expensive sessions","description":"Most expensive individual sessions by token count. Limit param. Includes butler name, prompt snippet, cost.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:38.932136971+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:51:40.826708352+08:00","closed_at":"2026-02-10T15:51:40.826708352+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.6.5","depends_on_id":"butlers-26h.6","type":"parent-child","created_at":"2026-02-10T12:01:38.933716875+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.6.6","title":"Implement GET /api/costs/by-schedule — per-schedule cost analysis","description":"Each scheduled task's average cost per run, runs per day, projected monthly spend.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:42.749057965+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:56:35.386301572+08:00","closed_at":"2026-02-10T15:56:35.386301572+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.6.6","depends_on_id":"butlers-26h.6","type":"parent-child","created_at":"2026-02-10T12:01:42.75058533+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.6.7","title":"Write tests for cost endpoints and estimation logic","description":"Test cost computation, summary aggregation, daily time series, top sessions, by-schedule analysis.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:47.617293253+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:45:03.976954247+08:00","closed_at":"2026-02-10T15:45:03.976954247+08:00","close_reason":"Implemented and merged to main","labels":["backend","dashboard","testing"],"dependencies":[{"issue_id":"butlers-26h.6.7","depends_on_id":"butlers-26h.6","type":"parent-child","created_at":"2026-02-10T12:01:47.619214633+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.6.8","title":"Create useCosts TanStack Query hooks","description":"Create src/api/hooks/useCosts.ts — hooks for summary, daily, top-sessions, by-schedule endpoints.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T12:01:51.468616376+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:51:40.858146653+08:00","closed_at":"2026-02-10T15:51:40.858146653+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.6.8","depends_on_id":"butlers-26h.6","type":"parent-child","created_at":"2026-02-10T12:01:51.470167557+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.6.9","title":"Build cost area chart component","description":"Create src/components/costs/CostChart.tsx — Recharts area chart: daily/weekly/monthly spend stacked by butler, period selector.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:56.601454174+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T15:56:35.440547865+08:00","closed_at":"2026-02-10T15:56:35.440547865+08:00","close_reason":"Implemented and merged to main","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.6.9","depends_on_id":"butlers-26h.6","type":"parent-child","created_at":"2026-02-10T12:01:56.603272279+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.7","title":"M5: Simplified trace viewer","description":"Inline trace visualization for common cross-butler request flows. Trace list and detail API endpoints with span tree assembly from session records and routing log. Frontend trace list page and waterfall timeline view. Tasks 7.1-7.6, 18.1-18.6 in OpenSpec.","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:42.697063418+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:38.347009924+08:00","closed_at":"2026-02-10T18:25:38.347009924+08:00","close_reason":"Closed","labels":["backend","dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.7","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:42.699020556+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.7","depends_on_id":"butlers-26h.1","type":"blocks","created_at":"2026-02-10T12:05:51.65602027+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.7","depends_on_id":"butlers-26h.4","type":"blocks","created_at":"2026-02-10T12:05:51.770362623+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.7.1","title":"Create traces API router and Pydantic models","description":"Create src/butlers/api/routers/traces.py and src/butlers/api/models/trace.py with TraceSummary, TraceDetail, SpanNode Pydantic models.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:01:38.502043759+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:06:31.233521743+08:00","closed_at":"2026-02-10T18:06:31.233521743+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.7.1","depends_on_id":"butlers-26h.7","type":"parent-child","created_at":"2026-02-10T12:01:38.503798715+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.7.10","title":"Create trace detail page","description":"Create src/pages/TraceDetail.tsx — waterfall view with span attributes panel.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:02:19.459645783+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:16:18.29421092+08:00","closed_at":"2026-02-10T18:16:18.29421092+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.7.10","depends_on_id":"butlers-26h.7","type":"parent-child","created_at":"2026-02-10T12:02:19.462798925+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.7.11","title":"Add trace_id link in session detail to trace view","description":"In SessionDetail drawer, make trace_id clickable, navigating to /traces/:traceId.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:02:24.392267454+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:30.101549903+08:00","closed_at":"2026-02-10T18:25:30.101549903+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.7.11","depends_on_id":"butlers-26h.7","type":"parent-child","created_at":"2026-02-10T12:02:24.394317791+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.7.2","title":"Implement GET /api/traces — list traces","description":"List traces aggregated from sessions across butler DBs, grouped by trace_id. Paginated and filterable by date range and butler.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:01:42.309818523+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:06:31.241045993+08:00","closed_at":"2026-02-10T18:06:31.241045993+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.7.2","depends_on_id":"butlers-26h.7","type":"parent-child","created_at":"2026-02-10T12:01:42.311903422+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.7.3","title":"Implement GET /api/traces/:trace_id — trace detail with span tree","description":"Fan-out query sessions + routing_log across butler DBs for matching trace_id. Assemble tree via parent_session_id.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:01:46.707663967+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:06:31.248496856+08:00","closed_at":"2026-02-10T18:06:31.248496856+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.7.3","depends_on_id":"butlers-26h.7","type":"parent-child","created_at":"2026-02-10T12:01:46.710063481+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.7.4","title":"Implement trace tree assembly algorithm","description":"Index sessions by ID, link by parent_session_id, NULL parents are roots, sort children by started_at. Merge routing_log entries from Switchboard DB as intermediate spans.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:51.148923956+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:06:31.255396096+08:00","closed_at":"2026-02-10T18:06:31.255396096+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.7.4","depends_on_id":"butlers-26h.7","type":"parent-child","created_at":"2026-02-10T12:01:51.150708047+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.7.5","title":"Write tests for trace endpoints and tree assembly","description":"Test trace list, trace detail, tree assembly with various topologies (linear, branching, multi-butler).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:01:56.3897086+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:06:49.819622873+08:00","closed_at":"2026-02-10T18:06:49.819622873+08:00","close_reason":"Already fulfilled: 25 tests in test_traces.py created by worker for 7.1-7.4 (7 span tree, 7 status, 6 list, 5 detail)","labels":["backend","dashboard","testing"],"dependencies":[{"issue_id":"butlers-26h.7.5","depends_on_id":"butlers-26h.7","type":"parent-child","created_at":"2026-02-10T12:01:56.39147081+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.7.6","title":"Create useTraces TanStack Query hooks","description":"Create src/api/hooks/useTraces.ts — hooks for trace list and trace detail.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T12:02:01.133838137+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:16:18.270022816+08:00","closed_at":"2026-02-10T18:16:18.270022816+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.7.6","depends_on_id":"butlers-26h.7","type":"parent-child","created_at":"2026-02-10T12:02:01.173438284+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.7.7","title":"Build trace list component","description":"Create src/components/traces/TraceList.tsx — table: truncated trace ID, start time, duration, entry point (channel + butler), span count.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:02:05.172491017+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:16:18.277037078+08:00","closed_at":"2026-02-10T18:16:18.277037078+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.7.7","depends_on_id":"butlers-26h.7","type":"parent-child","created_at":"2026-02-10T12:02:05.173968569+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.7.8","title":"Build trace waterfall timeline component","description":"Create src/components/traces/TraceTimeline.tsx — waterfall/timeline view: span bars colored by butler, proportional positioning relative to trace start, click span → attributes panel showing butler name, tool args, result summary, tokens.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T12:02:11.516279557+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:16:18.282799176+08:00","closed_at":"2026-02-10T18:16:18.282799176+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.7.8","depends_on_id":"butlers-26h.7","type":"parent-child","created_at":"2026-02-10T12:02:11.521894846+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.7.9","title":"Create traces list page","description":"Create src/pages/Traces.tsx — trace list with date range and butler filters.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:02:15.584194133+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:16:18.288276957+08:00","closed_at":"2026-02-10T18:16:18.288276957+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.7.9","depends_on_id":"butlers-26h.7","type":"parent-child","created_at":"2026-02-10T12:02:15.585913362+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.8","title":"M6: Unified timeline and global search","description":"Cross-cutting visibility features. Timeline API aggregating sessions, routing, heartbeat, state changes, errors with cursor-based pagination. Search API with fan-out across all butler DBs. Frontend timeline page with infinite scroll and filters. Cmd+K command palette with grouped results. Tasks 8.1-8.6, 19.1-19.5 in OpenSpec.","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:42.773022308+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:38.363158439+08:00","closed_at":"2026-02-10T18:25:38.363158439+08:00","close_reason":"Closed","labels":["backend","dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.8","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:42.774721999+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.8","depends_on_id":"butlers-26h.4","type":"blocks","created_at":"2026-02-10T12:05:51.975134906+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.8.1","title":"Create timeline API router","description":"Create src/butlers/api/routers/timeline.py.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T12:01:59.892778203+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:30.114668926+08:00","closed_at":"2026-02-10T18:25:30.114668926+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.8.1","depends_on_id":"butlers-26h.8","type":"parent-child","created_at":"2026-02-10T12:01:59.894417631+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.8.10","title":"Create useSearch TanStack Query hook with debounce","description":"Create src/api/hooks/useSearch.ts — debounced (300ms) search hook.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T12:02:40.804176647+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:30.149719228+08:00","closed_at":"2026-02-10T18:25:30.149719228+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.8.10","depends_on_id":"butlers-26h.8","type":"parent-child","created_at":"2026-02-10T12:02:40.806891219+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.8.11","title":"Build command palette with global search","description":"Create src/components/layout/CommandPalette.tsx — cmdk overlay: Cmd+K or / shortcut to open. Debounced search input. Results grouped by category (sessions, contacts, entities, state, skills, research) with icons. Each result: title, butler badge, snippet with match highlight. Enter → navigate to detail view. Recent searches in localStorage when empty.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T12:02:45.269541752+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:30.154226582+08:00","closed_at":"2026-02-10T18:25:30.154226582+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.8.11","depends_on_id":"butlers-26h.8","type":"parent-child","created_at":"2026-02-10T12:02:45.271744146+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.8.2","title":"Implement GET /api/timeline — cross-butler event stream","description":"Fan-out query sessions, routing_log, notifications across butler DBs. Merge and sort by timestamp. Cursor-based pagination. Filter by butler (multi) and event type (multi).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T12:02:05.014120034+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:30.118349599+08:00","closed_at":"2026-02-10T18:25:30.118349599+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.8.2","depends_on_id":"butlers-26h.8","type":"parent-child","created_at":"2026-02-10T12:02:05.016255789+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.8.3","title":"Implement event type mapping for timeline","description":"Map source records to unified event envelope: sessions → session/error events, routing_log → routing events, notifications → notification events. Common format: {type, butler, timestamp, data}.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:02:08.963597704+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:30.121591714+08:00","closed_at":"2026-02-10T18:25:30.121591714+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.8.3","depends_on_id":"butlers-26h.8","type":"parent-child","created_at":"2026-02-10T12:02:08.965560793+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.8.4","title":"Create search API router","description":"Create src/butlers/api/routers/search.py.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T12:02:13.266847843+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:30.12497231+08:00","closed_at":"2026-02-10T18:25:30.12497231+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.8.4","depends_on_id":"butlers-26h.8","type":"parent-child","created_at":"2026-02-10T12:02:13.26882569+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.8.5","title":"Implement GET /api/search — cross-butler fan-out search","description":"Fan-out ILIKE search across butler DBs: sessions (prompt, result), state (keys, values), contacts (name, notes), entities (title, tags, data), research (topic, title, content). Scan skills/ on filesystem. Return grouped results with snippets.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T12:02:18.185147767+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:30.128742332+08:00","closed_at":"2026-02-10T18:25:30.128742332+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.8.5","depends_on_id":"butlers-26h.8","type":"parent-child","created_at":"2026-02-10T12:02:18.186781634+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.8.6","title":"Write tests for timeline and search endpoints","description":"Test timeline pagination, filtering, event merging across sources. Test search fan-out, result grouping, empty results.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:02:22.377815968+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:30.133944469+08:00","closed_at":"2026-02-10T18:25:30.133944469+08:00","close_reason":"Closed","labels":["backend","dashboard","testing"],"dependencies":[{"issue_id":"butlers-26h.8.6","depends_on_id":"butlers-26h.8","type":"parent-child","created_at":"2026-02-10T12:02:22.380006079+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.8.7","title":"Create useTimeline TanStack Query hook with cursor pagination","description":"Create src/api/hooks/useTimeline.ts — hook with cursor-based pagination for infinite scroll.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:02:27.523203714+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:30.137917484+08:00","closed_at":"2026-02-10T18:25:30.137917484+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.8.7","depends_on_id":"butlers-26h.8","type":"parent-child","created_at":"2026-02-10T12:02:27.525429572+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.8.8","title":"Build unified timeline component","description":"Create src/components/timeline/UnifiedTimeline.tsx — vertical event stream: timestamp, butler badge, event type icon (session/routing/notification/error/schedule), one-line summary, expandable detail per event. Heartbeat tick collapsing: consecutive heartbeat tick events (type=schedule, task_name matches heartbeat pattern) within the same 10-minute cycle SHALL be collapsed into 'Heartbeat: N butlers ticked, M failures'. Collapsed entry is expandable to show individual ticks. Non-consecutive ticks (\u003e10 min apart) are separate groups. Other events between heartbeat ticks break the grouping. Collapsing is frontend rendering only — API returns individual events. See specs/dashboard-timeline/spec.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:02:31.71209524+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:30.142305513+08:00","closed_at":"2026-02-10T18:25:30.142305513+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.8.8","depends_on_id":"butlers-26h.8","type":"parent-child","created_at":"2026-02-10T12:02:31.719290644+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.8.9","title":"Create timeline page with filters and infinite scroll","description":"Create src/pages/Timeline.tsx — butler multi-select filter, event type multi-select filter, date range picker, auto-refresh toggle (10s polling), infinite scroll loading older events.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:02:36.187270698+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T18:25:30.145807529+08:00","closed_at":"2026-02-10T18:25:30.145807529+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.8.9","depends_on_id":"butlers-26h.8","type":"parent-child","created_at":"2026-02-10T12:02:36.373003101+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.9","title":"M7: Notifications view","description":"Visibility into outbound messages sent by butlers. Notification history API reading from Switchboard notifications table. Stats endpoint. Frontend notification feed with channel icons, status badges, filters. Integration with butler detail, overview, and timeline. Tasks 9.1-9.6, 20.1-20.4 in OpenSpec. Depends on Framework Changes epic (notify tool).","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:58:42.839573723+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:55:27.902254137+08:00","closed_at":"2026-02-10T14:55:27.902254137+08:00","close_reason":"All notification children completed: models, endpoints, stats, butler-scoped, hooks, feed, stats bar, page, integration","labels":["backend","dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.9","depends_on_id":"butlers-26h","type":"parent-child","created_at":"2026-02-10T11:58:42.841100869+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-26h.9","depends_on_id":"butlers-26h.1","type":"blocks","created_at":"2026-02-10T12:05:50.987238696+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.9.1","title":"Create notifications API router and Pydantic models","description":"Create src/butlers/api/routers/notifications.py and src/butlers/api/models/notification.py with Notification and NotificationStats Pydantic models.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:02:12.471815907+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:09:19.132682412+08:00","closed_at":"2026-02-10T14:09:19.132682412+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.9.1","depends_on_id":"butlers-26h.9","type":"parent-child","created_at":"2026-02-10T12:02:12.473700357+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.9.10","title":"Integrate notifications into butler detail and overview","description":"Butler detail overview tab: 'Recent notifications' section (last 5 from this butler). Overview page: failed notification deliveries surfaced in Issues panel. Timeline: notification events in unified event stream.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:02:52.548419188+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:24:37.971595048+08:00","closed_at":"2026-02-10T14:24:37.971595048+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.9.10","depends_on_id":"butlers-26h.9","type":"parent-child","created_at":"2026-02-10T12:02:52.550109534+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.9.2","title":"Implement GET /api/notifications — paginated notification history","description":"Paginated notification history from Switchboard DB. Filterable by butler, channel, status (sent/failed/pending), date range.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:02:18.779317+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:09:19.184102048+08:00","closed_at":"2026-02-10T14:09:19.184102048+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.9.2","depends_on_id":"butlers-26h.9","type":"parent-child","created_at":"2026-02-10T12:02:18.780975805+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.9.3","title":"Implement GET /api/notifications/stats — summary statistics","description":"Total sent today, failure rate, breakdown by butler, breakdown by channel.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:02:23.288093069+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:15:10.047631282+08:00","closed_at":"2026-02-10T14:15:10.047631282+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.9.3","depends_on_id":"butlers-26h.9","type":"parent-child","created_at":"2026-02-10T12:02:23.289648139+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.9.4","title":"Implement GET /api/butlers/:name/notifications — butler-scoped","description":"Notifications filtered by source butler. Same pagination and filters as cross-butler endpoint.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:02:27.275119288+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:15:10.111633378+08:00","closed_at":"2026-02-10T14:15:10.111633378+08:00","close_reason":"Closed","labels":["backend","dashboard"],"dependencies":[{"issue_id":"butlers-26h.9.4","depends_on_id":"butlers-26h.9","type":"parent-child","created_at":"2026-02-10T12:02:27.279025203+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.9.5","title":"Write tests for notification endpoints","description":"Test notification list, stats, butler-scoped, filtering, pagination.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:02:31.479682176+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:15:10.164346198+08:00","closed_at":"2026-02-10T14:15:10.164346198+08:00","close_reason":"Closed","labels":["backend","dashboard","testing"],"dependencies":[{"issue_id":"butlers-26h.9.5","depends_on_id":"butlers-26h.9","type":"parent-child","created_at":"2026-02-10T12:02:31.481423829+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.9.6","title":"Create useNotifications TanStack Query hooks","description":"Create src/api/hooks/useNotifications.ts — hooks for notification list and stats endpoints.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T12:02:35.604377357+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:19:39.455436023+08:00","closed_at":"2026-02-10T14:19:39.455436023+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.9.6","depends_on_id":"butlers-26h.9","type":"parent-child","created_at":"2026-02-10T12:02:35.606187279+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.9.7","title":"Build notification feed component","description":"Create src/components/notifications/NotificationFeed.tsx — reverse-chronological feed: timestamp, source butler badge, channel icon (telegram/email), message text, delivery status badge (sent/failed/pending). Failed notifications highlighted in red with error details. Click → expanded view: full message, metadata, linked session.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":75,"created_at":"2026-02-10T12:02:39.630500399+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:19:39.514407567+08:00","closed_at":"2026-02-10T14:19:39.514407567+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.9.7","depends_on_id":"butlers-26h.9","type":"parent-child","created_at":"2026-02-10T12:02:39.632110382+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.9.8","title":"Build notification stats bar component","description":"Create src/components/notifications/NotificationStats.tsx — total sent today, failure rate, most active butler, most used channel.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:02:44.170128593+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:19:39.564790608+08:00","closed_at":"2026-02-10T14:19:39.564790608+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.9.8","depends_on_id":"butlers-26h.9","type":"parent-child","created_at":"2026-02-10T12:02:44.171724601+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-26h.9.9","title":"Create notifications page","description":"Create src/pages/Notifications.tsx — notification feed with filters (butler, channel, status, date range) and stats bar.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:02:48.148772569+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:24:37.913780841+08:00","closed_at":"2026-02-10T14:24:37.913780841+08:00","close_reason":"Closed","labels":["dashboard","frontend"],"dependencies":[{"issue_id":"butlers-26h.9.9","depends_on_id":"butlers-26h.9","type":"parent-child","created_at":"2026-02-10T12:02:48.150994459+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-2ea","title":"Fix SessionDetailDrawer ref warning in Sheet overlay","description":"## Summary\nReact logs `Function components cannot be given refs` when opening a session detail drawer.\n\n## Why This Matters\nThe warning indicates an invalid ref path in UI composition and obscures real client errors during development.\n\n## Context\n- Observed while loading a specific session detail view.\n- Stack includes `SessionDetailDrawer` (`src/components/sessions/SessionDetailDrawer.tsx`) and `SheetOverlay` (`src/components/ui/sheet.tsx`).\n- Warning includes `Primitive.div.SlotClone` in Radix primitives.\n\n## Steps to Reproduce\n1. Run the frontend app and navigate to sessions.\n2. Open a specific session to render `SessionDetailDrawer`.\n3. Observe browser console output.\n\n## Expected Behavior\nOpening session details does not emit React ref warnings.\n\n## Actual Behavior\nConsole logs: `Warning: Function components cannot be given refs...` with stack including `Primitive.div.SlotClone` and `SheetOverlay`.\n\n## Acceptance Criteria\n1. Opening `SessionDetailDrawer` no longer logs `Function components cannot be given refs` warnings in development.\n2. `SheetOverlay` continues to render/animate correctly (overlay appears and dismisses as before).\n3. A regression test (or equivalent component test) covers the drawer open path to ensure the warning does not return.","acceptance_criteria":"1. Opening `SessionDetailDrawer` no longer logs `Function components cannot be given refs` warnings in development.\n2. `SheetOverlay` continues to render/animate correctly (overlay appears and dismisses as before).\n3. A regression test (or equivalent component test) covers the drawer open path to ensure the warning does not return.","status":"in_progress","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-12T11:37:41.710999382+08:00","created_by":"Tzeusy","updated_at":"2026-02-13T01:26:02.43506333+08:00"}
{"id":"butlers-2jx","title":"Add per-butler mailbox module for async message delivery","description":"Each butler gets a mailbox table for async messages from other butlers, users, or external channels. Messages are fire-and-forget: sender posts mail, recipient butler reads/actions at its own pace. Decouples inter-butler and user-to-butler communication from real-time wakeups.\n\nMailbox lives in each butlers own DB (per strict DB isolation constraint). Switchboard exposes a post_mail tool routing mail to the target butler via MCP. Each message records sender identity and the posting mechanism (e.g. alice/telegram, relationship-butler/mcp, system/scheduler).\n\nNon-goals: real-time push notifications (use Telegram/Email), message threading (v2), attachments (v2).","design":"Table: mailbox — id UUID PK, sender TEXT NOT NULL (identity), sender_channel TEXT NOT NULL (posting mechanism: mcp/telegram/email/api/scheduler), subject TEXT, body JSONB NOT NULL, priority INTEGER DEFAULT 2, status TEXT DEFAULT unread (unread/read/actioned/archived), metadata JSONB DEFAULT {}, created_at TIMESTAMPTZ, read_at TIMESTAMPTZ, actioned_at TIMESTAMPTZ. Indexes on (status, created_at) and (sender).\n\nMCP Tools (MailboxModule): mailbox_list, mailbox_read, mailbox_update_status, mailbox_post, mailbox_stats. Switchboard Tool: post_mail routes to target butlers mailbox_post.","acceptance_criteria":"1. Every butler with mailbox module has an isolated mailbox table\n2. Messages postable by other butlers via Switchboard, users via channel modules, and butler itself\n3. Sender identity includes both who (name) and how (channel)\n4. Butler can list, read, triage, and archive messages via MCP tools\n5. Alembic migration in dedicated mailbox chain\n6. Module follows Module ABC pattern","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T20:53:38.224376938+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:09:51.666598122+08:00","closed_at":"2026-02-10T01:09:51.666598122+08:00","close_reason":"All children completed","labels":["backend","core","module"]}
{"id":"butlers-2jx.1","title":"Create mailbox Alembic migration chain and table schema","description":"Create a new Alembic migration chain 'mailbox' under alembic/versions/mailbox/ with the mailbox table DDL. Follow the pattern established by core/001_create_core_tables.py and switchboard/001_switchboard_tables.py.\n\nTable: mailbox\n- id UUID PK DEFAULT gen_random_uuid()\n- sender TEXT NOT NULL — who sent it (butler name, user handle, or system identifier)\n- sender_channel TEXT NOT NULL — how it was sent (mcp, telegram, email, api, scheduler)\n- subject TEXT — optional subject/topic line\n- body JSONB NOT NULL — message payload\n- priority INTEGER NOT NULL DEFAULT 2 — 0=critical to 4=backlog\n- status TEXT NOT NULL DEFAULT 'unread' — unread | read | actioned | archived\n- metadata JSONB NOT NULL DEFAULT '{}'::jsonb — extensible envelope (trace_id, correlation_id, reply_to, etc.)\n- created_at TIMESTAMPTZ NOT NULL DEFAULT now()\n- read_at TIMESTAMPTZ — timestamp when first read\n- actioned_at TIMESTAMPTZ — timestamp when actioned\n\nIndexes:\n- CREATE INDEX idx_mailbox_status_created ON mailbox (status, created_at DESC) — inbox queries\n- CREATE INDEX idx_mailbox_sender ON mailbox (sender) — sender filtering","acceptance_criteria":"1. Migration file exists at alembic/versions/mailbox/001_create_mailbox_table.py\n2. Branch label is 'mailbox'\n3. Table and indexes created on upgrade, dropped on downgrade\n4. Migration runs cleanly against a fresh database","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:53:48.325997915+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:01:40.584401543+08:00","closed_at":"2026-02-10T00:01:40.584401543+08:00","close_reason":"Mailbox migration chain created with table schema matching spec","labels":["backend","migrations","module"],"dependencies":[{"issue_id":"butlers-2jx.1","depends_on_id":"butlers-2jx","type":"parent-child","created_at":"2026-02-09T20:53:48.327672311+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-2jx.2","title":"Implement MailboxModule with MCP tools","description":"Create src/butlers/modules/mailbox.py implementing the Module ABC. This module adds five MCP tools for managing a butlers local mailbox.\n\nTools to implement:\n1. mailbox_post(sender, sender_channel, subject?, body, priority?, metadata?) — insert a new message into the mailbox table. Returns the new message ID. This is the write entry point used by both the butler itself and the Switchboard routing.\n\n2. mailbox_list(status?, sender?, limit=50, offset=0) — query the mailbox with optional filters. Returns list of messages ordered by created_at DESC. Include id, sender, sender_channel, subject, status, priority, created_at in the list view (omit full body for efficiency).\n\n3. mailbox_read(message_id) — fetch a single message by ID including full body and metadata. Auto-updates status from 'unread' to 'read' and sets read_at if not already read.\n\n4. mailbox_update_status(message_id, status) — change message status to read/actioned/archived. Sets the corresponding timestamp (read_at or actioned_at). Validates status is one of the allowed values.\n\n5. mailbox_stats() — return counts grouped by status: {unread: N, read: N, actioned: N, archived: N, total: N}.\n\nModule properties:\n- name: 'mailbox'\n- config_schema: MailboxConfig (Pydantic BaseModel, initially empty or with optional max_retention_days)\n- dependencies: [] (no module dependencies)\n- migration_revisions: 'mailbox'\n- on_startup/on_shutdown: no-op for now","design":"Follow the pattern from email.py and telegram.py. All tools use asyncpg pool directly. Use parameterized queries throughout. The mailbox_post tool should validate sender_channel against a known set (mcp, telegram, email, api, scheduler, system) but accept unknown channels with a warning log rather than rejecting — extensibility over strictness.","acceptance_criteria":"1. Module class MailboxModule passes isinstance check against Module ABC\n2. All five tools registered and callable via FastMCP\n3. mailbox_post inserts and returns UUID\n4. mailbox_read auto-marks unread messages as read\n5. mailbox_list supports filtering by status and sender\n6. mailbox_stats returns accurate counts\n7. All queries use parameterized SQL (no f-string injection)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:54:03.391590609+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:11:34.620937684+08:00","closed_at":"2026-02-10T00:11:34.620937684+08:00","close_reason":"MailboxModule implemented with all 5 MCP tools, parameterized queries, and comprehensive tests","labels":["backend","module"],"dependencies":[{"issue_id":"butlers-2jx.2","depends_on_id":"butlers-2jx","type":"parent-child","created_at":"2026-02-09T20:54:03.393152352+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-2jx.2","depends_on_id":"butlers-2jx.1","type":"blocks","created_at":"2026-02-09T20:54:32.061622825+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-2jx.3","title":"Add post_mail tool to Switchboard for cross-butler mail delivery","description":"Add a post_mail tool to the Switchboard butler that enables any butler (or external caller) to deliver a message to another butlers mailbox. This tool composes the sender identity with the delivery channel and routes through the existing Switchboard route() mechanism.\n\nTool signature:\n  post_mail(target_butler, sender, sender_channel, subject?, body, priority?, metadata?)\n\nBehavior:\n1. Validate target_butler exists in butler_registry\n2. Validate target butler has the mailbox module (check modules JSONB in registry)\n3. Route to the target butlers mailbox_post tool via the existing route() function\n4. Return success with message_id or error with reason\n5. Log the routing in routing_log (already handled by route())\n\nThe sender and sender_channel fields allow documenting the original source. For example:\n- Butler-to-butler: sender='relationship', sender_channel='mcp'\n- User via Telegram: sender='alice', sender_channel='telegram'\n- System scheduled: sender='system', sender_channel='scheduler'\n- External API: sender='webhook/stripe', sender_channel='api'\n\nRegister this tool in the Switchboard butlers tool registration (alongside register_butler, list_butlers, discover_butlers, route, classify_message).","design":"Add post_mail as an async function in src/butlers/tools/switchboard.py. It wraps route() with target tool_name='mailbox_post'. Before routing, check the target butlers modules list in butler_registry to confirm mailbox is enabled — return a clear error if not. Include the original sender identity in the routed args unchanged.","acceptance_criteria":"1. post_mail tool callable via Switchboard MCP\n2. Validates target butler exists and has mailbox module\n3. Returns message_id on success\n4. Returns descriptive error if butler not found or mailbox not enabled\n5. Routing logged in routing_log table\n6. Sender identity preserved end-to-end","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:54:16.971272963+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:17:29.928471074+08:00","closed_at":"2026-02-10T00:17:29.928471074+08:00","close_reason":"post_mail tool added to Switchboard with registry validation, mailbox module check, and routing","labels":["backend","switchboard"],"dependencies":[{"issue_id":"butlers-2jx.3","depends_on_id":"butlers-2jx","type":"parent-child","created_at":"2026-02-09T20:54:16.972752129+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-2jx.3","depends_on_id":"butlers-2jx.2","type":"blocks","created_at":"2026-02-09T20:54:32.127876828+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-2jx.4","title":"Write mailbox module and post_mail integration tests","description":"Comprehensive test coverage for the mailbox module and Switchboard post_mail tool. Follow existing test patterns (testcontainers for PostgreSQL, MockSpawner, direct SQL for setup).\n\nTest cases for MailboxModule:\n1. mailbox_post — insert message, verify all fields stored correctly\n2. mailbox_post — default values (priority=2, status=unread, metadata={})\n3. mailbox_list — returns messages ordered by created_at DESC\n4. mailbox_list — filter by status\n5. mailbox_list — filter by sender\n6. mailbox_list — pagination (limit/offset)\n7. mailbox_list — empty mailbox returns []\n8. mailbox_read — returns full message body and metadata\n9. mailbox_read — auto-marks unread as read, sets read_at\n10. mailbox_read — already-read message stays read (idempotent)\n11. mailbox_read — nonexistent message_id returns error\n12. mailbox_update_status — transitions unread-\u003eread, read-\u003eactioned, actioned-\u003earchived\n13. mailbox_update_status — sets read_at and actioned_at timestamps appropriately\n14. mailbox_update_status — rejects invalid status values\n15. mailbox_stats — accurate counts across all statuses\n\nTest cases for Switchboard post_mail:\n16. post_mail — routes to target butler and returns message_id\n17. post_mail — error when target butler not in registry\n18. post_mail — error when target butler lacks mailbox module\n19. post_mail — sender identity preserved in delivered message","acceptance_criteria":"1. All 19 test cases pass\n2. Tests use real PostgreSQL via testcontainers\n3. No mocking of database layer\n4. Tests run in \u003c10s total","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:54:27.919744817+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:32:31.646883394+08:00","closed_at":"2026-02-10T00:32:31.646883394+08:00","close_reason":"19 integration tests passing for mailbox module and post_mail tool","labels":["backend","module","testing"],"dependencies":[{"issue_id":"butlers-2jx.4","depends_on_id":"butlers-2jx","type":"parent-child","created_at":"2026-02-09T20:54:27.922681198+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-2jx.4","depends_on_id":"butlers-2jx.2","type":"blocks","created_at":"2026-02-09T20:54:32.209746791+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-2jx.4","depends_on_id":"butlers-2jx.3","type":"blocks","created_at":"2026-02-09T20:54:32.287964871+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-2zt","title":"Quality gates fail from unrelated notifications/mailbox regressions","description":"Running required quality gate 'uv run pytest tests/ -v --ignore=tests/test_db.py --ignore=tests/test_migrations.py' currently fails with 66 failing tests in notifications endpoints and mailbox/idempotent integration suites on this branch, unrelated to switchboard decomposition API compatibility work. Track and resolve baseline test regressions so worker branches can satisfy full gate pass.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-12T00:02:03.686437465+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T11:45:38.487673368+08:00","closed_at":"2026-02-12T11:45:38.487673368+08:00","close_reason":"Already fixed in commits a71f7bf, dd21800, 9b09b38 — agent forgot to close","dependencies":[{"issue_id":"butlers-2zt","depends_on_id":"butlers-cjj","type":"discovered-from","created_at":"2026-02-12T00:02:03.688653592+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-30g","title":"Refactor butler tools.py into tools/{category}/{tool}.py with unified imports","description":"Refactor each butler's monolithic tools.py into a structured tools/ directory:\n\n**Current:** butlers/{butler}/tools.py (single file, grows to 1000+ lines)\n\n**Target:**\n```\nbutlers/{butler}/tools/\n├── __init__.py          # Re-exports all tools for unified import\n├── {category}/\n│   ├── __init__.py      # Re-exports category tools\n│   └── {tool_name}.py   # Individual tool implementation\n└── ...\n```\n\n**Requirements:**\n- Each tool function moves to its own file under a logical category subdirectory\n- Category __init__.py re-exports its tools\n- Top-level tools/__init__.py collects all categories so existing imports (from butler.tools import ...) continue to work unchanged\n- No behavioral changes — pure structural refactor\n- Update any imports in tests or other modules that reference the old tools.py path","notes":"The _loader.py in src/butlers/tools/ dynamically imports butler tools at runtime. It currently expects a single tools.py — needs updating to load the tools/ package (__init__.py) instead. The butler config dirs intentionally live at repo root, separate from the src/butlers/ Python package.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:11:52.169111792+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:45:22.903142516+08:00","closed_at":"2026-02-10T13:45:22.903142516+08:00","close_reason":"Closed","dependencies":[{"issue_id":"butlers-30g","depends_on_id":"butlers-4or","type":"blocks","created_at":"2026-02-10T11:25:12.867898218+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-337","title":"Fix Ruff import ordering in roster/memory/tools/__init__.py","description":"Running repository quality gates for butlers-kie hit a pre-existing Ruff I001 failure in roster/memory/tools/__init__.py (import order in helper re-exports). This exists at HEAD and is unrelated to API lifespan wiring; track separately so full-gate runs can pass cleanly.","status":"closed","priority":3,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:01:56.827394746+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T11:21:51.631552965+08:00","closed_at":"2026-02-12T11:21:51.631552965+08:00","close_reason":"Fixed Ruff I001: reordered _search before _storage alphabetically in roster/memory/tools/__init__.py","dependencies":[{"issue_id":"butlers-337","depends_on_id":"butlers-kie","type":"discovered-from","created_at":"2026-02-11T10:01:56.830059965+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-3lg","title":"Investigate pre-existing failing quality gates (95 pytest failures + lint/format drift)","description":"While implementing butlers-t8m.2 and running required repository quality gates, the baseline worktree showed unrelated failures:\n\n- Ruff check failures in unrelated files (e.g., roster/memory/tools/__init__.py import order, src/butlers/modules/approvals/module.py line length)\n- Ruff format --check reports many unrelated files requiring formatting\n- pytest tests/ -v --ignore=tests/test_db.py --ignore=tests/test_migrations.py finished with 95 failures across unrelated suites, including notifications endpoints (307 redirects), sessions/migrations integration, mailbox integration, and switchboard decomposition API mismatch/import errors.\n\nThis issue tracks restoring green baseline quality gates independent of butlers-t8m.2.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:57:56.984101984+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T11:45:38.497464558+08:00","closed_at":"2026-02-12T11:45:38.497464558+08:00","close_reason":"Already fixed in commits a71f7bf, dd21800, 9b09b38 — agent forgot to close","dependencies":[{"issue_id":"butlers-3lg","depends_on_id":"butlers-t8m.2","type":"discovered-from","created_at":"2026-02-11T10:57:56.98666008+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-47n","title":"Update project documentation with architecture diagram and README improvements","description":"The README is minimal and missing key operational information. Three improvements needed:\n\n1. Add a visual architecture diagram showing the full system topology (butlers, DB isolation, MCP routing, CC spawner lifecycle, modules)\n2. Document production and development entrypoints (CLI commands, Docker Compose modes, Dockerfile entrypoint)\n3. Document all environment variables — global (PostgreSQL, OTEL, Anthropic) vs butler-specific (module credentials declared in butler.toml)\n\nThese make the project approachable for new contributors and operationally self-documenting.","acceptance_criteria":"1. README contains a detailed ASCII or Mermaid architecture diagram covering: daemon lifecycle, module system, MCP routing, DB isolation, CC spawner flow\n2. README has clearly separated Development and Production quickstart sections with exact commands\n3. README has an Environment Variables section with a table distinguishing global vs per-butler/per-module variables\n4. All information is accurate to the current codebase","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T20:38:17.276607568+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T20:44:41.323636302+08:00","closed_at":"2026-02-09T20:44:41.323636302+08:00","close_reason":"Closed","labels":["docs"]}
{"id":"butlers-47n.1","title":"Add architecture diagram to README","description":"The current README has a basic 6-line ASCII sketch of the switchboard routing. Replace it with a comprehensive architecture diagram that covers:\n\n- Full system topology: Switchboard routing to domain butlers (general, relationship, health, heartbeat)\n- Butler internals: daemon lifecycle (12-step startup), core components (state store, scheduler, session log, CC spawner)\n- Module system: how modules plug in, register tools, run migrations, topological dependency sort\n- Database isolation: each butler owns a dedicated PostgreSQL database\n- CC spawner flow: trigger → lock → session create → MCP config gen → SDK invoke → session complete\n- Telemetry: OpenTelemetry spans propagated via traceparent to CC instances\n- Trigger sources: external MCP, scheduler, heartbeat tick\n\nUse Mermaid for renderability on GitHub. Keep the existing ASCII sketch as a simplified overview above the detailed diagram.","design":"Two diagrams:\n1. Keep existing ASCII as 'System Overview' (simplified topology)\n2. Add Mermaid diagram as 'Detailed Architecture' covering internals\n\nUse ```mermaid code blocks which GitHub renders natively.","acceptance_criteria":"1. Diagram renders correctly on GitHub\n2. Covers all 7 areas listed in description\n3. Accurate to current codebase (not aspirational)\n4. Readable at default GitHub width without horizontal scrolling","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:38:48.751511999+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T20:44:41.293791101+08:00","closed_at":"2026-02-09T20:44:41.293791101+08:00","close_reason":"Closed","labels":["docs"],"dependencies":[{"issue_id":"butlers-47n.1","depends_on_id":"butlers-47n","type":"parent-child","created_at":"2026-02-09T20:38:48.753288622+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-47n.2","title":"Add production and development entrypoint docs to README","description":"The README has a Development section with only lint/test commands. Missing:\n\n- How to actually start butlers in dev mode (docker compose up postgres jaeger + butlers up)\n- How to start in production mode (docker compose up -d with all services)\n- CLI entrypoint: `butlers` command with subcommands (up, run, list, init)\n- Docker entrypoint: `uv run butlers run --config /app/butler.toml`\n- Port assignments: switchboard 8100, general 8101, relationship 8102, health 8103, heartbeat 8199, Jaeger UI 16686\n- Dockerfile build context: Python 3.12-slim + Node.js 22 + claude-code CLI + uv\n\nSource of truth:\n- CLI: src/butlers/cli.py (Click commands: up, run, list, init)\n- Docker: Dockerfile + docker-compose.yml\n- pyproject.toml: `[project.scripts] butlers = 'butlers.cli:cli'`","acceptance_criteria":"1. README has a 'Getting Started' section with Development and Production subsections\n2. Development section shows: install deps, start infra, start butlers, access Jaeger\n3. Production section shows: env setup, docker compose, service ports\n4. CLI commands documented: butlers up, butlers run, butlers list, butlers init\n5. All commands are copy-pasteable and accurate","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T20:38:48.80404266+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T20:44:41.303276815+08:00","closed_at":"2026-02-09T20:44:41.303276815+08:00","close_reason":"Closed","labels":["docs"],"dependencies":[{"issue_id":"butlers-47n.2","depends_on_id":"butlers-47n","type":"parent-child","created_at":"2026-02-09T20:38:48.805468812+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-47n.3","title":"Add environment variables reference to README","description":"Developers need to know which env vars to set. The codebase has three tiers:\n\n**Global (all butlers):**\n- ANTHROPIC_API_KEY — required, checked by credentials.py for every butler\n- POSTGRES_HOST — default 'localhost', read by Database.from_env()\n- POSTGRES_PORT — default 5432, read by Database.from_env()\n- POSTGRES_USER — default 'postgres', read by Database.from_env()\n- POSTGRES_PASSWORD — default 'postgres', read by Database.from_env()\n- OTEL_EXPORTER_OTLP_ENDPOINT — optional, enables real tracing (otherwise no-op tracer)\n\n**Per-butler (declared in butler.toml):**\n- [butler.env].required — custom required vars per butler\n- [butler.env].optional — custom optional vars per butler (warns if missing)\n\n**Per-module (declared in module code):**\n- Email module: EMAIL_ADDRESS, EMAIL_PASSWORD (credentials_env in email.py)\n- Telegram module: TELEGRAM_BOT_TOKEN (credentials_env in telegram.py)\n- Future modules declare their own via the credentials_env property on Module ABC\n\nSource of truth: src/butlers/credentials.py, src/butlers/db.py, src/butlers/core/telemetry.py, module files","design":"Add an 'Environment Variables' section to README with a table per tier:\n1. Global Variables (always apply)\n2. Butler-Specific Variables (configured in butler.toml)\n3. Module Variables (per enabled module)\n\nInclude: variable name, required/optional, default value, description.","acceptance_criteria":"1. All 6 global env vars documented with defaults and descriptions\n2. Butler-specific env var mechanism explained with butler.toml example\n3. All current module env vars listed (email: 2, telegram: 1)\n4. Clear distinction between tiers\n5. Table format for scanability","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-09T20:38:48.854993+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T20:44:41.312659334+08:00","closed_at":"2026-02-09T20:44:41.312659334+08:00","close_reason":"Closed","labels":["docs"],"dependencies":[{"issue_id":"butlers-47n.3","depends_on_id":"butlers-47n","type":"parent-child","created_at":"2026-02-09T20:38:48.856449749+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-4dd","title":"Idempotent ingestion integration fails for interaction/life_event dedupe","description":"Full pytest gate (2026-02-11) shows failures in tests/integration/test_idempotent_ingestion.py for interaction_log and life_event_log scenarios (first insert, duplicate skip, type/date differentiation). Date and note dedupe tests pass. Investigate idempotent keying/uniqueness logic for interaction and life event ingestion paths.","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T23:13:12.767846874+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.83796261+08:00","closed_at":"2026-02-11T23:30:11.83796261+08:00","close_reason":"Duplicate of butlers-xb5 (idempotent ingestion interaction/life-event regressions).","dependencies":[{"issue_id":"butlers-4dd","depends_on_id":"butlers-4xh","type":"discovered-from","created_at":"2026-02-11T23:13:12.771478321+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-4or","title":"Rename butlers/ config directory to roster/","description":"Rename the top-level butlers/ directory (butler config dirs) to roster/ to avoid confusion with the repo name and src/butlers/ Python package.\n\n**Current:** butlers/{name}/ (MANIFESTO.md, CLAUDE.md, butler.toml, skills/, tools.py)\n**Target:** roster/{name}/\n\n**Update all references:**\n- src/butlers/tools/_loader.py (auto-detect path, BUTLER_NAMES)\n- CLAUDE.md code layout section\n- AGENTS.md if referenced\n- Any tests that reference the butlers/ config path\n- .gitignore or CI configs if applicable\n\nThis must land before butlers-30g (tools.py refactor) since that changes the tools path inside config dirs.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:25:09.789999965+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T12:07:08.211328468+08:00","closed_at":"2026-02-10T12:07:08.211328468+08:00","close_reason":"Renamed butlers/ config dir to roster/. Updated all references in source, tests, docs. Fixed pre-existing REPO_ROOT bug in test_tools_loader.py."}
{"id":"butlers-4qb","title":"Discovered-from c7q: notifications endpoint 307 redirect regression","description":"During butlers-c7q verification, tests in tests/api/test_notification_endpoints.py and tests/api/test_notifications_router.py fail because GET /api/notifications/ returns HTTP 307 redirects instead of direct JSON responses. This causes status assertion failures, JSON decode failures, and query-mock call assertions to fail.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T23:15:00.944648951+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.271385353+08:00","closed_at":"2026-02-11T23:30:11.271385353+08:00","close_reason":"Duplicate of butlers-9du (canonical 307 redirect bug across API list endpoints).","dependencies":[{"issue_id":"butlers-4qb","depends_on_id":"butlers-c7q","type":"discovered-from","created_at":"2026-02-11T23:15:00.947067277+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-4xh","title":"Core sessions schema mismatch causes session CRUD test failures","description":"Full pytest gate fails in tests/core/test_core_sessions.py and related integration tests with asyncpg UndefinedColumnError for sessions.input_tokens/output_tokens. This indicates schema drift between session code and migrated DB schema. Align migrations and session queries so session_create/session_complete/sessions_get work with current schema.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:56:00.252048068+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:17:57.237705194+08:00","closed_at":"2026-02-11T23:17:57.237705194+08:00","close_reason":"Implemented and pushed in agent/butlers-4xh (commit 33961a3).","dependencies":[{"issue_id":"butlers-4xh","depends_on_id":"butlers-uu0","type":"discovered-from","created_at":"2026-02-11T10:56:00.254534419+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-571","title":"Surface CC SDK error reason in spawner failure logs","description":"## What\n\nWhen CC SDK invocations fail, the spawner logs only the generic exception message (e.g., \"Command failed with exit code 1\") while the actual error reason from the SDK's ResultMessage (e.g., \"Credit balance is too low\") is discarded.\n\n## Why\n\nMakes CC invocation failures extremely hard to diagnose. The spawner's _run() method at line 96 does receive a ResultMessage with is_error=True and a meaningful result string, but the exception handler at line 498 only logs the exception message and ignores the already-captured result_text.\n\nCurrent log output:\n```\nERROR: butlers.core.spawner: Runtime invocation failed: Exception: Command failed with exit code 1 (exit code: 1)\nError output: Check stderr output for details\n```\n\nShould instead show:\n```\nERROR: butlers.core.spawner: Runtime invocation failed: Credit balance is too low (exit code 1)\n```\n\n## Repro\n\n1. Start butlers with an API key that has low/no credits\n2. Trigger any CC session (e.g., send a Telegram message)\n3. Observe opaque \"Command failed with exit code 1\" in logs with no indication of the actual error","design":"In spawner._run() exception handler (line 498-527):\n\n1. Check if result_text was set before the exception\n2. If result_text is non-empty and the exception is a CC SDK error, prefer result_text as the error message\n3. Log both the result_text (user-facing reason) and the exception (technical detail) at different levels\n\n```python\nexcept Exception as exc:\n    # Prefer result_text from CC SDK if available (contains actual error reason)\n    reason = result_text if result_text else str(exc)\n    error_msg = f\"{type(exc).__name__}: {reason}\"\n    logger.error(\"Runtime invocation failed: %s\", error_msg, exc_info=True)\n```\n\n### Files to modify\n- src/butlers/core/spawner.py — _run() exception handler","acceptance_criteria":"1. When CC SDK raises after yielding a ResultMessage with is_error=True, the spawner includes result_text in the error log\n2. The session_complete record in DB includes the actual error reason, not just the exception message\n3. Common failure modes (credit balance, auth, rate limit) are surfaced clearly in logs\n4. Existing success path is not affected","notes":"- The CC SDK emits ResultMessage(is_error=True, result='Credit balance is too low') BEFORE raising the exception\n- The async for loop at spawner.py:96 captures this in result_text, which is in scope in the except block\n- The SDK exception itself just says \"Command failed with exit code 1\" — completely unhelpful\n- Current instance: API key credits exhausted, but this affects ALL CC failure modes (auth, rate limits, model access, etc.)","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-12T00:24:25.111998812+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T11:45:38.507070187+08:00","closed_at":"2026-02-12T11:45:38.507070187+08:00","close_reason":"Already fixed in commits a71f7bf, dd21800, 9b09b38 — agent forgot to close"}
{"id":"butlers-67h","title":"Pre-existing quality gate failures in notifications/sessions/mailbox/decomposition suites","description":"Running required AGENTS.md gates in agent/butlers-t8m.3 shows repository-level pre-existing failures unrelated to butlers-t8m.3 logging changes. Evidence: uv run pytest tests/ -v --ignore=tests/test_db.py --ignore=tests/test_migrations.py failed with 95 failures (1960 passed, 1 skipped). Major clusters: notifications endpoint redirect/assertions, core sessions persistence tests, mailbox integration tests, decomposition import/API mismatch tests, and migration chain assertions. Also required lint/format gates fail on unrelated files in this branch baseline. This issue tracks restoring green baseline quality gates separately from observability logging changes.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T23:12:30.551089956+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:10.967556794+08:00","closed_at":"2026-02-11T23:30:10.967556794+08:00","close_reason":"Duplicate of butlers-3lg (same pre-existing quality gate failure cluster).","dependencies":[{"issue_id":"butlers-67h","depends_on_id":"butlers-t8m.3","type":"discovered-from","created_at":"2026-02-11T23:12:30.553343631+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-6au","title":"Migration path/revision expectations inconsistent in config migration tests","description":"Full pytest gate reports failures in tests/config/test_migrations.py and tests/config/test_switchboard_notifications_migration_unit.py: expected revision '003' vs actual 'core_003', and missing file lookup under butlers/switchboard/migrations/003_add_notifications_table.py. Reconcile migration revision naming and test path assumptions.","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:56:00.415260899+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.574670724+08:00","closed_at":"2026-02-11T23:30:11.574670724+08:00","close_reason":"Duplicate of butlers-c7q (migration path/revision expectation drift).","dependencies":[{"issue_id":"butlers-6au","depends_on_id":"butlers-uu0","type":"discovered-from","created_at":"2026-02-11T10:56:00.417821831+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-6kb","title":"Switchboard notifications migration unit tests reference non-existent legacy file path","description":"tests/config/test_switchboard_notifications_migration_unit.py fails because it loads butlers/switchboard/migrations/003_add_notifications_table.py, which does not exist in current repo layout. Repro: uv run pytest tests/config/test_switchboard_notifications_migration_unit.py -q. Update tests to current migration location and metadata conventions.","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:36:38.859573291+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.673209394+08:00","closed_at":"2026-02-11T23:30:11.673209394+08:00","close_reason":"Duplicate of butlers-c7q (switchboard migration path test drift).","dependencies":[{"issue_id":"butlers-6kb","depends_on_id":"butlers-v96","type":"discovered-from","created_at":"2026-02-11T10:36:38.861737528+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-9du","title":"Fix trailing-slash 307 redirects breaking CORS preflight","description":"## What\n\nAPI list endpoints return 307 Temporary Redirect when called without a trailing slash (e.g. `GET /api/traces?offset=0\u0026limit=20` → 307 → `/api/traces/?offset=0\u0026limit=20`). The browser's CORS preflight OPTIONS request to the redirected URL then fails with 400 Bad Request, breaking the frontend.\n\n## Why\n\nThe dashboard frontend cannot load data for any list endpoint that uses `@router.get(\"/\")`. This affects traces, sessions, notifications, memory, timeline, search, audit, and most other paginated views. The API is functionally broken from the browser.\n\n## Context\n\n- FastAPI defaults `redirect_slashes=True` in Starlette's Router\n- Most routers define list endpoints as `@router.get(\"/\")`, making the canonical path e.g. `/api/traces/` (with trailing slash)\n- The frontend requests without trailing slash (`/api/traces?...`), triggering a 307 redirect\n- The 307 redirect preserves the HTTP method but the browser must send a CORS preflight (OPTIONS) to the new URL first — this preflight hits Starlette's redirect logic again and returns 400\n- One router (`butlers.py`) already uses `@router.get(\"\")` — no trailing slash, no redirect. This is inconsistent with the rest.\n\n## Steps to reproduce\n\n1. Start the dashboard API and frontend\n2. Open the Traces page in the browser\n3. Observe in Network tab: `GET /api/traces?offset=0\u0026limit=20` → 307\n4. Preflight `OPTIONS /api/traces/?offset=0\u0026limit=20` → 400\n5. Frontend receives no data\n\n## Expected behavior\n\n`GET /api/traces?offset=0\u0026limit=20` returns 200 with JSON data directly, no redirect.","design":"Two changes, both needed:\n\n1. **Normalize route paths** — Change all `@router.get(\"/\")` list endpoints to `@router.get(\"\")` across all routers. This makes the canonical path match what the frontend requests (no trailing slash). The `butlers.py` router already does this correctly.\n\n2. **Disable `redirect_slashes`** — Set `redirect_slashes=False` in the FastAPI constructor in `app.py` as a safety net. This prevents Starlette from ever issuing 307 redirects for slash mismatches.\n\nAffected routers (use `@router.get(\"/\")`): traces, sessions, notifications, memory, timeline, search, audit, health, general, switchboard_views, schedules, state, relationship, costs, issues. The butlers router already uses `\"\"`.","acceptance_criteria":"1. GET /api/traces?offset=0\u0026limit=20 returns 200 (no 307 redirect)\n2. All other list endpoints return 200 without redirect\n3. CORS preflight (OPTIONS) succeeds on all endpoints\n4. Existing tests continue to pass\n5. Consistent route path convention across all routers","notes":"- The 307 + CORS issue is a well-known FastAPI footgun. Setting redirect_slashes=False is the standard fix.\n- Some routers may also have POST/PUT endpoints with \"/\" — check those too.\n- The butlers router's use of \"\" is the correct pattern to follow.\nCoordinator: PR #1 opened from agent/butlers-9du for review.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:12:51.824286738+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T00:12:56.892112751+08:00","closed_at":"2026-02-12T00:12:56.892112751+08:00","close_reason":"PR #1 merged","external_ref":"gh-pr:1","labels":["pr-review"]}
{"id":"butlers-a6j","title":"Fix empty /butlers overview page rendering","description":"## Summary\nThe main dashboard route at `/butlers` appears effectively empty in the UX, while direct butler detail routes like `/butlers/general` render correctly.\n\nCurrent state in code: `frontend/src/pages/ButlersPage.tsx` returns only a bare `\u003ch1\u003eButlers\u003c/h1\u003e`, so users do not get the expected butler index experience from the sidebar/keyboard navigation path.\n\n## Steps to Reproduce\n1. Start the frontend dashboard.\n2. Navigate to `/butlers` (or use sidebar \"Butlers\").\n3. Observe that the page appears empty/minimal and does not present the butler list/index UX.\n4. Navigate to `/butlers/general` and observe that detail content renders normally.\n\n## Expected Behavior\n`/butlers` should provide a usable butler index page (list/summary of butlers with navigation into detail pages), with clear loading/empty/error states rather than a near-empty placeholder.\n\n## Acceptance Criteria\n1. Navigating to `/butlers` renders a functional butler index UI populated from the existing butler data source (no placeholder-only page).\n2. Each listed butler has a working navigation path to `/butlers/:name` and links open the existing detail page.\n3. `/butlers` includes explicit loading and empty/error states so users never see an ambiguous blank/empty screen.\n4. Frontend tests are added or updated to cover `/butlers` route rendering and navigation behavior.","status":"in_progress","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-12T11:34:38.972985847+08:00","created_by":"Tzeusy","updated_at":"2026-02-13T01:25:05.1374934+08:00"}
{"id":"butlers-atv","title":"Notification API tests failing in baseline quality gate","description":"Running the AGENTS.md pytest gate (uv run pytest tests/ -v --ignore=tests/test_db.py --ignore=tests/test_migrations.py) on agent/butlers-kq5 shows a large out-of-scope failure cluster in notification-related tests (e.g., tests/api/test_notification_endpoints.py and tests/api/test_notifications_router.py). This appears unrelated to session schema work in butlers-kq5 and should be triaged/fixed separately to restore full test gate health.","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:55:10.657970108+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.420557026+08:00","closed_at":"2026-02-11T23:30:11.420557026+08:00","close_reason":"Duplicate of butlers-9du (notification endpoint redirect cluster).","dependencies":[{"issue_id":"butlers-atv","depends_on_id":"butlers-kq5","type":"discovered-from","created_at":"2026-02-11T10:55:10.660447082+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-bjr","title":"Scope and create initial skills for each butler","description":"Each butler under butlers/ should have at least one skill in its skills/ directory following the SKILL.md spec. Skills provide specialized workflows, scripts, and reference material that Claude Code instances use when spawned for that butler.\n\nCurrent state: Skills infrastructure is implemented (butlers-0qp.9 closed) but no butler-specific skills exist yet.\n\nButlers to cover:\n- Switchboard (message routing)\n- General (freeform data)\n- Relationship (personal CRM)\n- Health (wellness tracking)\n- Heartbeat (system monitor)\n\nEach skill must follow the SKILL.md format with YAML frontmatter, progressive disclosure, and optional bundled resources.","acceptance_criteria":"1. Every butler under butlers/ has at least one skill in butlers/{identity}/skills/\n2. Each skill has a valid SKILL.md with YAML frontmatter\n3. Skills are domain-appropriate and actionable\n4. Skills follow progressive disclosure pattern","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T20:57:39.849305586+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:21:08.189053937+08:00","closed_at":"2026-02-10T01:21:08.189053937+08:00","close_reason":"All 7 children completed: triage, data-organizer, reconnect, gift-brainstorm, health-check-in, trend-interpreter, tick-diagnostics","labels":["skills"]}
{"id":"butlers-bjr.1","title":"Create message-triage skill for Switchboard butler","description":"Create a skill at butlers/switchboard/skills/message-triage/ that helps the Switchboard butler classify and route incoming messages with structured confidence scoring.\n\nThe Switchboard's core job is classifying messages and routing them to the correct specialist butler. This skill should provide:\n- Classification rubric with routing rules\n- Confidence scoring framework (high/medium/low → route, ask for clarification, or default)\n- Handling for ambiguous messages that span multiple domains\n- Reference table mapping message topics to target butlers","acceptance_criteria":"1. butlers/switchboard/skills/message-triage/SKILL.md exists with valid YAML frontmatter\n2. Skill covers routing logic for all known butlers (general, relationship, health)\n3. Includes confidence scoring guidance\n4. Handles ambiguous/multi-domain messages","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:57:48.101579007+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:03:03.691599495+08:00","closed_at":"2026-02-10T00:03:03.691599495+08:00","close_reason":"Message-triage skill created with classification rubric, confidence scoring, and multi-domain handling","labels":["skills","switchboard"],"dependencies":[{"issue_id":"butlers-bjr.1","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:57:48.103171567+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-bjr.2","title":"Create data-organizer skill for General butler","description":"Create a skill at butlers/general/skills/data-organizer/ that provides structured patterns for organizing collections and entities in the General butler's freeform data store.\n\nThe General butler stores arbitrary JSONB entities in named collections. This skill should provide:\n- Collection naming conventions and taxonomy suggestions\n- Entity schema templates for common use cases (projects, bookmarks, notes, lists)\n- JSONB query patterns for effective searching\n- Data hygiene workflows (dedup, merge, archive stale entities)","acceptance_criteria":"1. butlers/general/skills/data-organizer/SKILL.md exists with valid YAML frontmatter\n2. Includes at least 3 entity schema templates\n3. Covers collection naming conventions\n4. Provides search query patterns","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:57:52.11050004+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:03:55.56128591+08:00","closed_at":"2026-02-10T00:03:55.56128591+08:00","close_reason":"Data-organizer skill created with naming conventions, 6 entity templates (project, bookmark, note, list, recipe, contact), JSONB query patterns, and 5 hygiene workflows (dedup, archive, tag normalization, schema validation, bulk tagging)","labels":["general","skills"],"dependencies":[{"issue_id":"butlers-bjr.2","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:57:52.112390733+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-bjr.3","title":"Create reconnect-planner skill for Relationship butler","description":"Create a skill at butlers/relationship/skills/reconnect-planner/ that helps the Relationship butler proactively identify contacts who haven't been reached out to in a while and plan reconnection outreach.\n\nThe Relationship butler tracks contacts, interactions, and reminders. This skill should provide:\n- Staleness detection logic (configurable thresholds per relationship tier)\n- Outreach suggestion templates based on contact context (shared interests, last interaction topic, upcoming dates)\n- Prioritization framework (close friends vs acquaintances vs professional contacts)\n- Workflow for creating reminders from reconnect recommendations","acceptance_criteria":"1. butlers/relationship/skills/reconnect-planner/SKILL.md exists with valid YAML frontmatter\n2. Defines staleness thresholds per relationship tier\n3. Includes outreach suggestion patterns\n4. Integrates with existing reminder and interaction tools","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:57:57.021493906+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:09:24.690940579+08:00","closed_at":"2026-02-10T00:09:24.690940579+08:00","close_reason":"Reconnect-planner skill created with staleness thresholds, outreach templates, and reminder integration","labels":["relationship","skills"],"dependencies":[{"issue_id":"butlers-bjr.3","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:57:57.023093789+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-bjr.4","title":"Create gift-brainstorm skill for Relationship butler","description":"Create a skill at butlers/relationship/skills/gift-brainstorm/ that helps the Relationship butler generate thoughtful gift ideas based on contact facts, preferences, and upcoming dates.\n\nThe Relationship butler tracks facts, notes, and gift pipelines (idea → purchased → wrapped → given → thanked). This skill should provide:\n- Gift ideation framework using contact facts and past interactions\n- Budget-aware suggestion tiers\n- Occasion-appropriate filtering (birthday, holiday, thank-you, just-because)\n- Integration with the gift pipeline tools to track chosen gifts","acceptance_criteria":"1. butlers/relationship/skills/gift-brainstorm/SKILL.md exists with valid YAML frontmatter\n2. Uses contact facts and notes as input signals\n3. Covers multiple occasion types\n4. Integrates with gift pipeline (idea → purchased → given)","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T20:58:00.865387212+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:07:33.481717209+08:00","closed_at":"2026-02-10T01:07:33.481717209+08:00","close_reason":"Gift-brainstorm skill created with ideation framework, budget tiers, and pipeline integration","labels":["relationship","skills"],"dependencies":[{"issue_id":"butlers-bjr.4","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:58:00.86719596+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-bjr.5","title":"Create health-check-in skill for Health butler","description":"Create a skill at butlers/health/skills/health-check-in/ that provides a guided daily or weekly health check-in workflow for the Health butler.\n\nThe Health butler tracks measurements, medications, symptoms, meals, and conditions. This skill should provide:\n- Structured check-in flow (what to ask, in what order)\n- Adaptive questioning based on active conditions and medications\n- Medication adherence prompts (did you take X today?)\n- Symptom screening based on active conditions\n- Summary generation after check-in completion","acceptance_criteria":"1. butlers/health/skills/health-check-in/SKILL.md exists with valid YAML frontmatter\n2. Defines a structured check-in flow\n3. Adapts to active conditions and medications\n4. Produces a summary at the end of each check-in","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:58:04.995728878+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:09:07.961003687+08:00","closed_at":"2026-02-10T00:09:07.961003687+08:00","close_reason":"Health-check-in skill created with structured flow, adaptive questioning, and summary generation","labels":["health","skills"],"dependencies":[{"issue_id":"butlers-bjr.5","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:58:04.997816343+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-bjr.6","title":"Create trend-interpreter skill for Health butler","description":"Create a skill at butlers/health/skills/trend-interpreter/ that helps the Health butler interpret measurement trends and flag potential anomalies.\n\nThe Health butler has trend_report and measurement_history tools. This skill should provide:\n- Statistical interpretation guidelines for common measurements (BP, weight, blood glucose, heart rate)\n- Anomaly detection heuristics (sudden changes, out-of-range values)\n- Trend narrative templates (improving, stable, concerning, needs attention)\n- Reference ranges for common measurements\n- Clear disclaimers about not providing medical advice","acceptance_criteria":"1. butlers/health/skills/trend-interpreter/SKILL.md exists with valid YAML frontmatter\n2. Covers interpretation for at least 4 common measurements\n3. Includes anomaly detection heuristics\n4. Contains medical disclaimer","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T20:58:09.642520884+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:16:17.417150852+08:00","closed_at":"2026-02-10T01:16:17.417150852+08:00","close_reason":"Created comprehensive trend-interpreter skill at butlers/health/skills/trend-interpreter/SKILL.md with valid YAML frontmatter. Covers interpretation for 4 common measurements (BP, weight, glucose, heart rate) with reference ranges, anomaly detection heuristics, trend narratives, and medical disclaimers. Includes workflow, examples, and priority-based recommendations.","labels":["health","skills"],"dependencies":[{"issue_id":"butlers-bjr.6","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:58:09.644230265+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-bjr.7","title":"Create tick-diagnostics skill for Heartbeat butler","description":"Create a skill at butlers/heartbeat/skills/tick-diagnostics/ that helps the Heartbeat butler diagnose and report on butler health from tick cycle results.\n\nThe Heartbeat butler runs tick_all_butlers every 10 minutes. This skill should provide:\n- Health assessment framework based on tick responses (success, timeout, error, unreachable)\n- Pattern detection for recurring failures (same butler failing multiple ticks)\n- Escalation rules (when to alert vs when to just log)\n- Diagnostic checklist for common failure modes (DB down, port blocked, OOM)\n- Summary report template for tick cycle results","acceptance_criteria":"1. butlers/heartbeat/skills/tick-diagnostics/SKILL.md exists with valid YAML frontmatter\n2. Defines health assessment criteria from tick responses\n3. Includes failure pattern detection guidance\n4. Provides escalation rules","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-09T20:58:13.92194523+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:17:06.730500141+08:00","closed_at":"2026-02-10T00:17:06.730500141+08:00","close_reason":"Tick-diagnostics skill created with health assessment, failure patterns, escalation rules, and report template","labels":["heartbeat","skills"],"dependencies":[{"issue_id":"butlers-bjr.7","depends_on_id":"butlers-bjr","type":"parent-child","created_at":"2026-02-09T20:58:13.923777814+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-c7l","title":"Switchboard decomposition API drift causes import/signature failures","description":"Full pytest gate (2026-02-11) fails tests/tools/test_decomposition.py due to missing exports (classify_message_multi, dispatch_to_targets) from butlers.tools.switchboard and changed aggregate_responses signature requiring dispatch_fn. Reconcile decomposition tests and switchboard public API (exports + call signatures).","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T23:13:13.166884224+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.222926+08:00","closed_at":"2026-02-11T23:30:11.222926+08:00","close_reason":"Duplicate of butlers-cjj (switchboard decomposition API mismatch).","dependencies":[{"issue_id":"butlers-c7l","depends_on_id":"butlers-4xh","type":"discovered-from","created_at":"2026-02-11T23:13:13.169172014+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-c7q","title":"Migration chain consistency regressions in memory and switchboard notification chains","description":"Full pytest gate reports failures in tests/config/test_switchboard_notifications_migration_unit.py, tests/daemon/test_memory_chain_registration.py, and tests/config/test_migrations.py::test_alembic_version_tracking. These indicate migration artifact/chain metadata drift unrelated to switchboard classify/route import fix. Needs separate migration chain audit and repair.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:42:57.864020375+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:17:57.221787528+08:00","closed_at":"2026-02-11T23:17:57.221787528+08:00","close_reason":"Implemented and pushed in agent/butlers-c7q (commit e795f25).","dependencies":[{"issue_id":"butlers-c7q","depends_on_id":"butlers-t8m.1","type":"discovered-from","created_at":"2026-02-11T10:42:57.866472596+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cav","title":"Idempotent ingestion integration regressions for interaction/life_event tools","description":"Full pytest gate reports failures in tests/integration/test_idempotent_ingestion.py for interaction_log and life_event_log idempotency cases. This is out-of-scope for butlers-t8m.1 (switchboard classify/route module) and should be addressed separately to restore ingestion guarantees.","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:43:02.400610078+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.888714538+08:00","closed_at":"2026-02-11T23:30:11.888714538+08:00","close_reason":"Duplicate of butlers-xb5 (idempotent ingestion interaction/life-event regressions).","dependencies":[{"issue_id":"butlers-cav","depends_on_id":"butlers-t8m.1","type":"discovered-from","created_at":"2026-02-11T10:43:02.402867121+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw","title":"Implement Memory Butler","description":"Shared institutional memory for the butler ecosystem. A dedicated Memory Butler owns a PostgreSQL database (butler_memory) with pgvector, hosts an MCP server that all butlers connect to, and runs background consolidation to transform raw session episodes into durable facts and learned rules.\n\nThree memory types: episodes (raw observations, 7-day TTL), facts (subject-predicate knowledge with confidence decay), rules (behavioral patterns with maturity progression). Local-first embedding (MiniLM-L6), hybrid search (semantic + keyword via RRF), exponential confidence decay with permanence categories, anti-pattern inversion for harmful rules.\n\nSee MEMORY_PROJECT_PLAN.md and openspec/changes/memory-system/.","design":"Memory Butler is a standard butler (roster/memory/), not a framework-level service. Tools in tools.py following existing butler pattern. sentence-transformers MiniLM-L6-v2 (384-dim) loaded in-process. pgvector with IVFFlat (20 lists). Hybrid search via Reciprocal Rank Fusion (k=60). Consolidation as scheduled batch CC sessions (every 6h). Memory context injection via spawner hook. Dashboard reads DB directly, writes go through MCP. See openspec/changes/memory-system/design.md.","notes":"Dashboard integration already tracked under butlers-26h.13 (M11: Memory system views). This epic covers the backend memory system that butlers-26h.13 depends on.","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:10:13.416709891+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:23:40.701503137+08:00","closed_at":"2026-02-10T17:23:40.701503137+08:00","close_reason":"All 7 sub-epics complete: schema (11 tasks), storage (8 tasks), search (9 tasks), decay/maturity (6 tasks), MCP tools (8 tasks), consolidation (7 tasks), CC spawner integration (8 tasks). Total: 57 tasks implemented with 2061 tests passing.","labels":["backend","database","memory"]}
{"id":"butlers-cfw.1","title":"Scaffold Memory Butler and create database schema","description":"Stand up the Memory Butler config directory and database foundation. Create roster/memory/ with butler.toml, MANIFESTO.md, CLAUDE.md, AGENTS.md. Add sentence-transformers and pgvector dependencies. Create Alembic migration chain (branch label 'memory') for episodes, facts, rules, and memory_links tables with pgvector extensions and IVFFlat indexes. Implement embedding engine (MiniLM-L6-v2, 384-dim) and tsvector search vector generation.","acceptance_criteria":"1. roster/memory/ directory exists with valid butler.toml (name=memory, port=8150, db=butler_memory)\n2. Alembic migrations run cleanly against empty database, creating all 4 tables\n3. pgvector and uuid-ossp extensions enabled\n4. EmbeddingEngine produces 384-dim vectors\n5. Search vector generation handles edge cases","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:10:59.900267342+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:55:23.147285976+08:00","closed_at":"2026-02-10T14:55:23.147285976+08:00","close_reason":"All 11 children completed: config, deps, 5 migrations, chain registration, embedding engine, search vector, tests","labels":["backend","database","memory"],"dependencies":[{"issue_id":"butlers-cfw.1","depends_on_id":"butlers-cfw","type":"parent-child","created_at":"2026-02-10T12:10:59.902457852+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.1.1","title":"Create Memory Butler config directory","description":"Create roster/memory/ with butler.toml (name=memory, port=8150, db=butler_memory, scheduled tasks for consolidate/decay_sweep/episode_cleanup), MANIFESTO.md, CLAUDE.md, AGENTS.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:11:46.433862632+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:24:38.023599305+08:00","closed_at":"2026-02-10T14:24:38.023599305+08:00","close_reason":"Closed","labels":["backend","database","memory"],"dependencies":[{"issue_id":"butlers-cfw.1.1","depends_on_id":"butlers-cfw.1","type":"parent-child","created_at":"2026-02-10T12:11:46.43553878+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.1.10","title":"Implement search vector generation helper","description":"Create roster/memory/search_vector.py. Helper to generate tsvector content from text for populating search_vector columns at write time. Handle edge cases: empty text, special characters, very long text.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:12:20.038339091+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:48:18.140499769+08:00","closed_at":"2026-02-10T14:48:18.140499769+08:00","close_reason":"Merged to main, 1145 unit tests pass","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.1.10","depends_on_id":"butlers-cfw.1","type":"parent-child","created_at":"2026-02-10T12:12:20.040263909+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.1.11","title":"Write tests for schema and embedding","description":"Test migration chain runs cleanly against empty database. All 4 tables and indexes created. EmbeddingEngine produces 384-dim vectors. Batch embedding matches individual results. Search vector generation handles edge cases.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:12:23.264647821+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:54:48.731501166+08:00","closed_at":"2026-02-10T14:54:48.731501166+08:00","close_reason":"Merged to main, 1232 unit tests pass, frontend builds","labels":["backend","memory","testing"],"dependencies":[{"issue_id":"butlers-cfw.1.11","depends_on_id":"butlers-cfw.1","type":"parent-child","created_at":"2026-02-10T12:12:23.26640404+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.1.2","title":"Add sentence-transformers and pgvector dependencies","description":"Add sentence-transformers and asyncpg pgvector support to pyproject.toml under [project.dependencies].","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:11:51.396217538+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:34:11.997260385+08:00","closed_at":"2026-02-10T14:34:11.997260385+08:00","close_reason":"Closed","labels":["backend","database","memory"],"dependencies":[{"issue_id":"butlers-cfw.1.2","depends_on_id":"butlers-cfw.1","type":"parent-child","created_at":"2026-02-10T12:11:51.398477258+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.1.3","title":"Create Alembic migration 001_create_episodes","description":"Episodes table: id (UUID PK), butler (TEXT), session_id (UUID nullable), content (TEXT), embedding (vector(384)), search_vector (tsvector), importance (FLOAT default 5.0), reference_count (INT default 0), consolidated (BOOLEAN default false), created_at, last_referenced_at, expires_at (default now+7d), metadata (JSONB). Indexes: butler+created_at, expires_at partial, unconsolidated, GIN search_vector. Branch label 'memory'.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:11:55.311974563+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:34:12.053360159+08:00","closed_at":"2026-02-10T14:34:12.053360159+08:00","close_reason":"Closed","labels":["backend","database","memory"],"dependencies":[{"issue_id":"butlers-cfw.1.3","depends_on_id":"butlers-cfw.1","type":"parent-child","created_at":"2026-02-10T12:11:55.313757874+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.1.4","title":"Create Alembic migration 002_create_facts","description":"Facts table: id (UUID PK), subject, predicate, content (TEXT), embedding (vector(384)), search_vector (tsvector), importance, confidence (default 1.0), decay_rate (default 0.008), permanence (default 'standard'), source_butler, source_episode_id (FK episodes), supersedes_id (FK facts), validity (default 'active'), scope (default 'global'), reference_count, created_at, last_referenced_at, last_confirmed_at, tags (JSONB), metadata (JSONB). Indexes: scope+validity partial, subject+predicate, GIN search_vector, GIN tags.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:11:59.256747804+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:34:12.103215013+08:00","closed_at":"2026-02-10T14:34:12.103215013+08:00","close_reason":"Closed","labels":["backend","database","memory"],"dependencies":[{"issue_id":"butlers-cfw.1.4","depends_on_id":"butlers-cfw.1","type":"parent-child","created_at":"2026-02-10T12:11:59.259470099+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.1.5","title":"Create Alembic migration 003_create_rules","description":"Rules table: id (UUID PK), content, embedding (vector(384)), search_vector (tsvector), scope (default 'global'), maturity (default 'candidate'), confidence (default 0.5), decay_rate, permanence, effectiveness_score, applied_count, success_count, harmful_count, source_episode_id (FK episodes), source_butler, created_at, last_applied_at, last_evaluated_at, tags (JSONB), metadata (JSONB). Indexes: scope+maturity, GIN search_vector.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:12:03.118894328+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:43:26.793238508+08:00","closed_at":"2026-02-10T14:43:26.793238508+08:00","close_reason":"Migrations merged to main, 1109 unit tests pass","labels":["backend","database","memory"],"dependencies":[{"issue_id":"butlers-cfw.1.5","depends_on_id":"butlers-cfw.1","type":"parent-child","created_at":"2026-02-10T12:12:03.120623857+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.1.6","title":"Create Alembic migration 004_create_memory_links","description":"Memory links table: composite PK (source_type, source_id, target_type, target_id), relation (TEXT), created_at. Index on (target_type, target_id). Valid relations: derived_from, supports, contradicts, supersedes, related_to.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:12:06.532146581+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:43:26.872254909+08:00","closed_at":"2026-02-10T14:43:26.872254909+08:00","close_reason":"Migrations merged to main, 1109 unit tests pass","labels":["backend","database","memory"],"dependencies":[{"issue_id":"butlers-cfw.1.6","depends_on_id":"butlers-cfw.1","type":"parent-child","created_at":"2026-02-10T12:12:06.534443062+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.1.7","title":"Create Alembic migration 005_add_vector_indexes","description":"Enable pgvector and uuid-ossp extensions. Add IVFFlat indexes (20 lists, cosine ops) on episodes.embedding, facts.embedding, rules.embedding.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:12:09.966203865+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:43:26.925123484+08:00","closed_at":"2026-02-10T14:43:26.925123484+08:00","close_reason":"Migrations merged to main, 1109 unit tests pass","labels":["backend","database","memory"],"dependencies":[{"issue_id":"butlers-cfw.1.7","depends_on_id":"butlers-cfw.1","type":"parent-child","created_at":"2026-02-10T12:12:09.968994519+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.1.8","title":"Register memory migration chain","description":"Add 'memory' to shared migration chains in src/butlers/migrations.py so Memory Butler runs these at startup.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:12:13.113930999+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:48:18.024878427+08:00","closed_at":"2026-02-10T14:48:18.024878427+08:00","close_reason":"Merged to main, 1145 unit tests pass","labels":["backend","database","memory"],"dependencies":[{"issue_id":"butlers-cfw.1.8","depends_on_id":"butlers-cfw.1","type":"parent-child","created_at":"2026-02-10T12:12:13.115806373+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.1.9","title":"Implement EmbeddingEngine class","description":"Create roster/memory/embedding.py with EmbeddingEngine class. Loads all-MiniLM-L6-v2 at init. Exposes embed(text) -\u003e list[float] (384-dim) and embed_batch(texts) -\u003e list[list[float]]. Model held in memory for process lifetime.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:12:16.733465024+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T14:48:18.088162762+08:00","closed_at":"2026-02-10T14:48:18.088162762+08:00","close_reason":"Merged to main, 1145 unit tests pass","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.1.9","depends_on_id":"butlers-cfw.1","type":"parent-child","created_at":"2026-02-10T12:12:16.735262581+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.2","title":"Implement core memory storage operations","description":"CRUD operations for episodes, facts, rules, and memory_links. Episode storage with embedding and search vector generation. Fact storage with permanence-to-decay_rate mapping, subject-predicate conflict detection, and automatic supersession. Rule storage as candidate with confidence=0.5. Memory retrieval with reference count bumping. Soft-delete (forget) support.","acceptance_criteria":"1. store/get/forget works for all three memory types\n2. Fact supersession triggers on subject-predicate conflict\n3. Supersession creates memory_links with relation='supersedes'\n4. Invalid permanence values rejected with validation error\n5. Reference count and last_referenced_at updated on retrieval","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:11:00.023331816+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:25:23.262676056+08:00","closed_at":"2026-02-10T16:25:23.262676056+08:00","close_reason":"All 8 storage tasks complete — episodes, facts, rules, links, get, forget, permanence validation, integration tests","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.2","depends_on_id":"butlers-cfw","type":"parent-child","created_at":"2026-02-10T12:11:00.025086302+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-cfw.2","depends_on_id":"butlers-cfw.1","type":"blocks","created_at":"2026-02-10T12:11:10.313026975+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.2.1","title":"Implement episode storage","description":"Create roster/memory/storage.py. store_episode(pool, content, butler, embedding_engine, session_id?, importance?) generates embedding + search_vector, inserts row, returns UUID. Default importance=5.0, expires_at=now+7d.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:11:58.984924998+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:10:02.661099869+08:00","closed_at":"2026-02-10T16:10:02.661099869+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.2.1","depends_on_id":"butlers-cfw.2","type":"parent-child","created_at":"2026-02-10T12:11:58.986911091+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.2.2","title":"Implement fact storage with supersession","description":"Add store_fact(pool, subject, predicate, content, embedding_engine, importance?, permanence?, scope?, tags?) to storage.py. Maps permanence to decay_rate. Checks for existing active fact with same subject+predicate — if found, sets old fact validity='superseded', new fact supersedes_id=old.id, creates memory_link with relation='supersedes'.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T12:12:02.679543904+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:10:02.700127183+08:00","closed_at":"2026-02-10T16:10:02.700127183+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.2.2","depends_on_id":"butlers-cfw.2","type":"parent-child","created_at":"2026-02-10T12:12:02.681308779+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.2.3","title":"Implement rule storage","description":"Add store_rule(pool, content, embedding_engine, scope?, tags?) to storage.py. Creates rule as candidate with confidence=0.5, effectiveness_score=0.0.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:12:05.523975682+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:10:02.74813901+08:00","closed_at":"2026-02-10T16:10:02.74813901+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.2.3","depends_on_id":"butlers-cfw.2","type":"parent-child","created_at":"2026-02-10T12:12:05.525626852+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.2.4","title":"Implement memory links CRUD","description":"Add create_link(pool, source_type, source_id, target_type, target_id, relation) to storage.py. Validates relation is one of: derived_from, supports, contradicts, supersedes, related_to.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:12:08.954036085+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:17:31.98826664+08:00","closed_at":"2026-02-10T16:17:31.98826664+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.2.4","depends_on_id":"butlers-cfw.2","type":"parent-child","created_at":"2026-02-10T12:12:08.956013903+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.2.5","title":"Implement get_memory with reference bumping","description":"Add get_memory(pool, type, id) to storage.py. Retrieves single memory by type ('episode', 'fact', 'rule') and UUID. Bumps reference_count by 1 and updates last_referenced_at to now. Returns full record.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:12:12.426818979+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:17:32.024519399+08:00","closed_at":"2026-02-10T16:17:32.024519399+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.2.5","depends_on_id":"butlers-cfw.2","type":"parent-child","created_at":"2026-02-10T12:12:12.428529351+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.2.6","title":"Implement forget_memory soft-delete","description":"Add forget_memory(pool, type, id) to storage.py. Sets validity to 'forgotten'. Memory remains in DB but excluded from retrieval.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:12:15.676164304+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:17:32.058769524+08:00","closed_at":"2026-02-10T16:17:32.058769524+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.2.6","depends_on_id":"butlers-cfw.2","type":"parent-child","created_at":"2026-02-10T12:12:15.677693193+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.2.7","title":"Implement permanence validation","description":"Add permanence validation and mapping. Valid values: permanent (lambda=0.0), stable (0.002), standard (0.008), volatile (0.03), ephemeral (0.1). Reject invalid permanence with ValueError.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:12:19.47253991+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:25:08.826573728+08:00","closed_at":"2026-02-10T16:25:08.826573728+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.2.7","depends_on_id":"butlers-cfw.2","type":"parent-child","created_at":"2026-02-10T12:12:19.474493772+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.2.8","title":"Write tests for storage operations","description":"Test store/get/forget for each type. Test supersession creates correct links and updates validity. Test permanence-to-decay_rate mapping. Test invalid permanence rejected. Test reference count bumping on get.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:12:22.947422315+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:25:08.880242619+08:00","closed_at":"2026-02-10T16:25:08.880242619+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory","testing"],"dependencies":[{"issue_id":"butlers-cfw.2.8","depends_on_id":"butlers-cfw.2","type":"parent-child","created_at":"2026-02-10T12:12:22.950885289+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.3","title":"Implement hybrid search and retrieval","description":"Search and retrieval system combining semantic similarity (pgvector cosine), keyword matching (tsvector/tsquery), and hybrid fusion via Reciprocal Rank Fusion (k=60). Composite scoring with four signals: relevance (0.4), importance (0.3), recency (0.2), confidence (0.1). Effective confidence computation via exponential decay. Scope filtering (global + butler-specific). Min confidence threshold filtering.","acceptance_criteria":"1. Semantic search returns conceptually similar results\n2. Keyword search handles stemming and exact matches\n3. Hybrid RRF produces sensible merged rankings\n4. Composite scoring ranks high-importance recent facts above low-importance old ones\n5. Scope filtering includes global + specified scope, excludes others\n6. Fading memories (eff_confidence \u003c 0.2) excluded by default","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:11:00.127170755+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:54:49.346463034+08:00","closed_at":"2026-02-10T16:54:49.346463034+08:00","close_reason":"All 9 children complete","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.3","depends_on_id":"butlers-cfw","type":"parent-child","created_at":"2026-02-10T12:11:00.128659679+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-cfw.3","depends_on_id":"butlers-cfw.2","type":"blocks","created_at":"2026-02-10T12:11:10.411533957+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.3.1","title":"Implement semantic search via pgvector","description":"Create roster/memory/search.py. semantic_search(pool, query_embedding, table, limit, scope?) using pgvector cosine similarity operator (\u003c=\u003e). Returns results ranked by similarity.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:12:14.393727753+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:32:05.474157665+08:00","closed_at":"2026-02-10T16:32:05.474157665+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.3.1","depends_on_id":"butlers-cfw.3","type":"parent-child","created_at":"2026-02-10T12:12:14.398084015+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.3.2","title":"Implement keyword search via tsvector","description":"Add keyword_search(pool, query_text, table, limit, scope?) to search.py. Uses PostgreSQL tsvector/tsquery full-text search against search_vector column. Handles stemming.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:12:17.779913945+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:32:05.508676332+08:00","closed_at":"2026-02-10T16:32:05.508676332+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.3.2","depends_on_id":"butlers-cfw.3","type":"parent-child","created_at":"2026-02-10T12:12:17.781510272+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.3.3","title":"Implement hybrid search via RRF","description":"Add hybrid_search(pool, query_text, query_embedding, table, limit, scope?) to search.py. Runs both semantic and keyword searches, fuses via Reciprocal Rank Fusion: rrf_score = 1/(k+semantic_rank) + 1/(k+keyword_rank) where k=60. Results appearing in only one list use default rank of limit+1.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:12:20.762995551+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:32:05.536895755+08:00","closed_at":"2026-02-10T16:32:05.536895755+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.3.3","depends_on_id":"butlers-cfw.3","type":"parent-child","created_at":"2026-02-10T12:12:20.764724519+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.3.4","title":"Implement composite scoring function","description":"Add compute_composite_score(relevance, importance, recency, effective_confidence, weights) to search.py. Default weights: relevance=0.4, importance=0.3, recency=0.2, confidence=0.1. Recency computed as exponential decay from last_referenced_at.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:12:24.855672696+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:38:24.767518348+08:00","closed_at":"2026-02-10T16:38:24.767518348+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.3.4","depends_on_id":"butlers-cfw.3","type":"parent-child","created_at":"2026-02-10T12:12:24.857437521+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.3.5","title":"Implement memory recall","description":"Add recall(pool, topic, embedding_engine, scope?, limit?, min_confidence?, weights?) to search.py. Embeds topic, runs hybrid search on facts+rules, computes composite scores, filters by effective confidence threshold (default 0.2), bumps reference counts on returned results, returns sorted.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:12:28.5240731+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:43:54.494208274+08:00","closed_at":"2026-02-10T16:43:54.494208274+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.3.5","depends_on_id":"butlers-cfw.3","type":"parent-child","created_at":"2026-02-10T12:12:28.532615184+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.3.6","title":"Implement general memory search","description":"Add search(pool, query, embedding_engine, types?, scope?, mode?, limit?, min_confidence?) to search.py. Supports mode='semantic', 'keyword', or 'hybrid' (default). Searches across specified types (default: all three).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:12:31.779151952+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:49:00.100060884+08:00","closed_at":"2026-02-10T16:49:00.100060884+08:00","close_reason":"Merged to main, 1868 tests passing","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.3.6","depends_on_id":"butlers-cfw.3","type":"parent-child","created_at":"2026-02-10T12:12:31.782124109+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.3.7","title":"Implement effective confidence computation","description":"Add effective_confidence(confidence, decay_rate, last_confirmed_at) function. Formula: confidence * exp(-decay_rate * days_since_last_confirmed). Used by search filtering and decay sweep.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:12:35.070650954+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:49:00.133226329+08:00","closed_at":"2026-02-10T16:49:00.133226329+08:00","close_reason":"Merged to main, 1868 tests passing","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.3.7","depends_on_id":"butlers-cfw.3","type":"parent-child","created_at":"2026-02-10T12:12:35.072436709+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.3.8","title":"Implement scope filtering","description":"Add scope filtering to all search functions. Facts/rules: scope IN ('global', \u003cspecified_scope\u003e). Episodes: butler = \u003cspecified_scope\u003e. No scope parameter = search all.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:12:38.533027324+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:54:49.241136781+08:00","closed_at":"2026-02-10T16:54:49.241136781+08:00","close_reason":"Merged to main, 1893 tests passing","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.3.8","depends_on_id":"butlers-cfw.3","type":"parent-child","created_at":"2026-02-10T12:12:38.537826504+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.3.9","title":"Write tests for search and retrieval","description":"Test semantic search ranking. Test keyword search with stemming. Test hybrid RRF fusion produces merged rankings. Test composite scoring math. Test effective confidence decay formula. Test scope filtering includes/excludes correctly. Test reference count bumping. Test min_confidence filtering.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T12:12:42.003104529+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:50:15.25993855+08:00","closed_at":"2026-02-10T16:50:15.25993855+08:00","close_reason":"Already implemented — individual task workers created comprehensive tests alongside their implementations (518 total memory tests)","labels":["backend","memory","testing"],"dependencies":[{"issue_id":"butlers-cfw.3.9","depends_on_id":"butlers-cfw.3","type":"parent-child","created_at":"2026-02-10T12:12:42.005779384+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.4","title":"Implement confidence decay and rule maturity","description":"Dynamic lifecycle behaviors for facts and rules. Confirmation resets decay clock. Rule maturity progression: candidate (new) -\u003e established (success\u003e=5, effectiveness\u003e=0.6) -\u003e proven (success\u003e=15, effectiveness\u003e=0.8, age\u003e=30d). Effectiveness scoring with 4x harmful weight. Maturity demotion on harmful marks. Anti-pattern inversion for repeatedly harmful rules (harmful\u003e=3, effectiveness\u003c0.3). Daily decay sweep that marks fading/expired memories.","acceptance_criteria":"1. memory_confirm resets last_confirmed_at, restoring effective confidence\n2. Rules promote through candidate -\u003e established -\u003e proven at correct thresholds\n3. Effectiveness formula applies 4x harmful weight\n4. Rules with harmful_count\u003e=3 and effectiveness\u003c0.3 get inverted to anti-patterns\n5. Decay sweep transitions: active -\u003e fading (0.05\u003c=eff\u003c0.2) -\u003e expired (eff\u003c0.05)\n6. Permanent facts (decay_rate=0.0) never decay","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:11:00.228114824+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:50:24.939153494+08:00","closed_at":"2026-02-10T16:50:24.939153494+08:00","close_reason":"All 6 children complete","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.4","depends_on_id":"butlers-cfw","type":"parent-child","created_at":"2026-02-10T12:11:00.230609839+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-cfw.4","depends_on_id":"butlers-cfw.2","type":"blocks","created_at":"2026-02-10T12:11:10.536518319+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.4.1","title":"Implement memory_confirm","description":"Add confirm_memory(pool, type, id) to storage.py. Resets last_confirmed_at to now for facts and rules, restoring effective confidence to original level. Rejects episodes with error (episodes don't have confidence decay).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:12:28.001847101+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:38:24.80265924+08:00","closed_at":"2026-02-10T16:38:24.80265924+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.4.1","depends_on_id":"butlers-cfw.4","type":"parent-child","created_at":"2026-02-10T12:12:28.003953502+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.4.2","title":"Implement mark_helpful with maturity promotion","description":"Add mark_helpful(pool, rule_id) to storage.py. Increments success_count and applied_count. Recalculates effectiveness_score. Updates last_applied_at. Evaluates promotion: candidate-\u003eestablished (success\u003e=5, effectiveness\u003e=0.6), established-\u003eproven (success\u003e=15, effectiveness\u003e=0.8, age\u003e=30d).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:12:29.446878772+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:38:24.831987486+08:00","closed_at":"2026-02-10T16:38:24.831987486+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.4.2","depends_on_id":"butlers-cfw.4","type":"parent-child","created_at":"2026-02-10T12:12:29.448945528+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.4.3","title":"Implement mark_harmful with demotion","description":"Add mark_harmful(pool, rule_id, reason?) to storage.py. Increments harmful_count and applied_count. Recalculates effectiveness_score with 4x weight: success/(success + 4*harmful + 0.01). Evaluates demotion: established-\u003ecandidate if effectiveness\u003c0.6, proven-\u003eestablished if effectiveness\u003c0.8. Evaluates anti-pattern inversion trigger.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:12:30.890500448+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:43:54.527296397+08:00","closed_at":"2026-02-10T16:43:54.527296397+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.4.3","depends_on_id":"butlers-cfw.4","type":"parent-child","created_at":"2026-02-10T12:12:30.892010141+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.4.4","title":"Implement anti-pattern inversion","description":"When harmful_count\u003e=3 and effectiveness_score\u003c0.3, rewrite rule content as 'ANTI-PATTERN: Do NOT {original rule}. This caused problems because: {accumulated harmful reasons}'. Set maturity to anti-pattern state. Anti-patterns remain in system as warnings and appear in retrieval results.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:12:32.282559455+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:43:54.568769063+08:00","closed_at":"2026-02-10T16:43:54.568769063+08:00","close_reason":"Implemented and merged to main","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.4.4","depends_on_id":"butlers-cfw.4","type":"parent-child","created_at":"2026-02-10T12:12:32.290355328+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.4.5","title":"Implement decay sweep","description":"Add run_decay_sweep(pool) function. Computes effective_confidence for all active facts and rules. Marks fading (0.05\u003c=eff\u003c0.2, set metadata.status='fading'). Expires (eff\u003c0.05, set validity='expired'). Permanent facts (decay_rate=0.0) are skipped.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:12:33.673245646+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:49:00.160281014+08:00","closed_at":"2026-02-10T16:49:00.160281014+08:00","close_reason":"Merged to main, 1868 tests passing","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.4.5","depends_on_id":"butlers-cfw.4","type":"parent-child","created_at":"2026-02-10T12:12:33.674977149+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.4.6","title":"Write tests for decay and maturity","description":"Test confirm resets decay clock. Test mark_helpful promotion thresholds (candidate-\u003eestablished, established-\u003eproven, age gate). Test mark_harmful demotion + 4x weight formula. Test effectiveness_score formula. Test anti-pattern inversion trigger and content rewrite. Test decay sweep transitions (active-\u003efading-\u003eexpired). Test permanent facts never decay.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T12:12:34.963679183+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T16:50:15.230314882+08:00","closed_at":"2026-02-10T16:50:15.230314882+08:00","close_reason":"Already implemented — individual task workers created comprehensive tests alongside their implementations (518 total memory tests)","labels":["backend","memory","testing"],"dependencies":[{"issue_id":"butlers-cfw.4.6","depends_on_id":"butlers-cfw.4","type":"parent-child","created_at":"2026-02-10T12:12:34.965420774+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.5","title":"Implement Memory MCP tools","description":"MCP tool surface for the Memory Butler. Writing tools: memory_store_episode, memory_store_fact, memory_store_rule. Reading tools: memory_search, memory_recall, memory_get. Feedback tools: memory_confirm, memory_mark_helpful, memory_mark_harmful. Management tools: memory_forget, memory_stats. Context building: memory_context (token-budgeted context block for CC system prompt injection). All tools registered via @mcp.tool() on the Memory Butler's FastMCP server.","acceptance_criteria":"1. All 13 MCP tools callable with valid arguments\n2. Error cases handled (nonexistent ID, invalid type, confirm on episode)\n3. memory_context produces formatted text block within token budget\n4. memory_context orders memories by composite score (highest first)\n5. EmbeddingEngine loads MiniLM-L6 model once at startup","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:11:00.38169973+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:01:38.510793885+08:00","closed_at":"2026-02-10T17:01:38.510793885+08:00","close_reason":"All 8 children complete, 1962 tests passing","labels":["backend","mcp","memory"],"dependencies":[{"issue_id":"butlers-cfw.5","depends_on_id":"butlers-cfw","type":"parent-child","created_at":"2026-02-10T12:11:00.383227307+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-cfw.5","depends_on_id":"butlers-cfw.3","type":"blocks","created_at":"2026-02-10T12:11:10.647755089+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-cfw.5","depends_on_id":"butlers-cfw.4","type":"blocks","created_at":"2026-02-10T12:11:10.752212577+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.5.1","title":"Create Memory Butler tools.py scaffold","description":"Create roster/memory/tools.py. Register all memory tools on the Memory Butler's FastMCP server following the @mcp.tool() pattern from existing butlers (e.g., roster/general/tools.py).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:12:41.757317716+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:01:27.165930159+08:00","closed_at":"2026-02-10T17:01:27.165930159+08:00","close_reason":"Merged to main, 1962 tests passing","labels":["backend","mcp","memory"],"dependencies":[{"issue_id":"butlers-cfw.5.1","depends_on_id":"butlers-cfw.5","type":"parent-child","created_at":"2026-02-10T12:12:41.759226453+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.5.2","title":"Implement writing MCP tools","description":"Implement memory_store_episode, memory_store_fact, memory_store_rule as MCP tools. Each delegates to storage.py functions and returns the created ID.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:12:42.862784784+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:01:27.197633258+08:00","closed_at":"2026-02-10T17:01:27.197633258+08:00","close_reason":"Merged to main, 1962 tests passing","labels":["backend","mcp","memory"],"dependencies":[{"issue_id":"butlers-cfw.5.2","depends_on_id":"butlers-cfw.5","type":"parent-child","created_at":"2026-02-10T12:12:42.86429559+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.5.3","title":"Implement reading MCP tools","description":"Implement memory_search, memory_recall, memory_get as MCP tools. Each delegates to search.py/storage.py. memory_search supports types, scope, mode, limit, min_confidence params. memory_recall supports topic, scope, limit params.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:12:44.100957686+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:01:27.22415795+08:00","closed_at":"2026-02-10T17:01:27.22415795+08:00","close_reason":"Merged to main, 1962 tests passing","labels":["backend","mcp","memory"],"dependencies":[{"issue_id":"butlers-cfw.5.3","depends_on_id":"butlers-cfw.5","type":"parent-child","created_at":"2026-02-10T12:12:44.10437229+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.5.4","title":"Implement feedback MCP tools","description":"Implement memory_confirm, memory_mark_helpful, memory_mark_harmful as MCP tools. Each delegates to the corresponding function. memory_confirm accepts type and id. memory_mark_harmful accepts optional reason.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:12:45.238033428+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:01:27.257663888+08:00","closed_at":"2026-02-10T17:01:27.257663888+08:00","close_reason":"Merged to main, 1962 tests passing","labels":["backend","mcp","memory"],"dependencies":[{"issue_id":"butlers-cfw.5.4","depends_on_id":"butlers-cfw.5","type":"parent-child","created_at":"2026-02-10T12:12:45.239886791+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.5.5","title":"Implement management MCP tools","description":"Implement memory_forget (soft-delete via type+id) and memory_stats (counts by type, scope, status: active/fading/expired facts, candidate/established/proven rules, total/unconsolidated episodes, backlog age).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:12:46.515258371+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:01:27.283223797+08:00","closed_at":"2026-02-10T17:01:27.283223797+08:00","close_reason":"Merged to main, 1962 tests passing","labels":["backend","mcp","memory"],"dependencies":[{"issue_id":"butlers-cfw.5.5","depends_on_id":"butlers-cfw.5","type":"parent-child","created_at":"2026-02-10T12:12:46.518018827+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.5.6","title":"Implement memory_context tool","description":"Implement memory_context(trigger_prompt, butler, token_budget?) MCP tool. Embeds trigger prompt, queries top-scored facts and rules for butler scope, formats as structured text block within token budget (default 3000 tokens). Sections: Facts, Rules, Recent Episodes. Ordered by composite score (highest first). Used by CC spawner for system prompt injection.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:12:47.924137981+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:01:27.309206344+08:00","closed_at":"2026-02-10T17:01:27.309206344+08:00","close_reason":"Merged to main, 1962 tests passing","labels":["backend","mcp","memory"],"dependencies":[{"issue_id":"butlers-cfw.5.6","depends_on_id":"butlers-cfw.5","type":"parent-child","created_at":"2026-02-10T12:12:47.928514602+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.5.7","title":"Initialize EmbeddingEngine at Memory Butler startup","description":"Load MiniLM-L6 model once at Memory Butler startup and hold in memory. Pass EmbeddingEngine instance to all tool functions that need embedding generation. Ensure model is shared across all tool invocations.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:12:49.143649401+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:01:27.335142454+08:00","closed_at":"2026-02-10T17:01:27.335142454+08:00","close_reason":"Merged to main, 1962 tests passing","labels":["backend","mcp","memory"],"dependencies":[{"issue_id":"butlers-cfw.5.7","depends_on_id":"butlers-cfw.5","type":"parent-child","created_at":"2026-02-10T12:12:49.146424796+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.5.8","title":"Write tests for MCP tools","description":"Test each MCP tool callable with valid args. Test error cases: nonexistent ID returns error, invalid type rejected, confirm on episode returns error. Test memory_context respects token budget. Test memory_context orders by composite score (highest first). Test memory_stats returns correct counts.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:12:50.419147497+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:01:38.428563928+08:00","closed_at":"2026-02-10T17:01:38.428563928+08:00","close_reason":"Already covered — 69 tool tests across test_tools_writing/reading/management files","labels":["backend","memory","testing"],"dependencies":[{"issue_id":"butlers-cfw.5.8","depends_on_id":"butlers-cfw.5","type":"parent-child","created_at":"2026-02-10T12:12:50.422791503+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.6","title":"Implement consolidation engine","description":"The Memory Butler's core intelligence. Scheduled consolidation (every 6h) fetches unconsolidated episodes, groups by source butler, spawns CC instances with extraction prompts that include existing facts/rules for dedup. CC output parsed into new facts (with permanence), updated facts (supersession), new rules, and confirmations. Provenance links (derived_from, supports, contradicts) created. Episode cleanup task (daily) deletes expired episodes and enforces capacity cap while protecting unconsolidated episodes.","acceptance_criteria":"1. Consolidation fetches and groups unconsolidated episodes by butler\n2. Consolidation prompt includes existing facts/rules for dedup context\n3. Output parser handles valid and malformed CC output gracefully\n4. Facts created with correct permanence from LLM classification\n5. Provenance links (derived_from) connect facts/rules to source episodes\n6. Episode cleanup respects unconsolidated + unexpired protection\n7. Scheduled tasks wired in butler.toml (consolidate, decay_sweep, episode_cleanup)","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:11:00.505429973+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:15:14.730958014+08:00","closed_at":"2026-02-10T17:15:14.730958014+08:00","close_reason":"All 7 children complete: consolidation runner, prompt template, output parser, executor, episode cleanup, butler.toml wiring, tests","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.6","depends_on_id":"butlers-cfw","type":"parent-child","created_at":"2026-02-10T12:11:00.50783584+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-cfw.6","depends_on_id":"butlers-cfw.5","type":"blocks","created_at":"2026-02-10T12:11:10.86122924+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.6.1","title":"Implement consolidation runner","description":"Create roster/memory/consolidation.py. run_consolidation(pool, spawner, embedding_engine) fetches all episodes WHERE consolidated=false, groups by source butler, processes each group.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:12:55.803008769+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:08:48.761233306+08:00","closed_at":"2026-02-10T17:08:48.761233306+08:00","close_reason":"Merged to main, 2001 tests passing","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.6.1","depends_on_id":"butlers-cfw.6","type":"parent-child","created_at":"2026-02-10T12:12:55.804700646+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.6.2","title":"Build consolidation prompt template","description":"Design the consolidation prompt that instructs CC to extract: new facts (with permanence classification), updated facts (supersession targets), new rules (behavioral patterns), and confirmations of existing facts. Prompt includes current active facts and rules (scoped) for dedup context. Create roster/memory/skills/consolidate/SKILL.md.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:12:57.138499426+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:08:48.824496642+08:00","closed_at":"2026-02-10T17:08:48.824496642+08:00","close_reason":"Merged to main, 2001 tests passing","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.6.2","depends_on_id":"butlers-cfw.6","type":"parent-child","created_at":"2026-02-10T12:12:57.142077418+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.6.3","title":"Implement consolidation output parser","description":"Parse CC response into structured actions: new facts (subject, predicate, content, permanence), superseded facts (target fact ID, new content), new rules (content, scope), confirmations (fact IDs), provenance links. Handle malformed output gracefully (log warning, skip unparseable sections).","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T12:12:58.513800898+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:08:48.843828628+08:00","closed_at":"2026-02-10T17:08:48.843828628+08:00","close_reason":"Merged to main, 2001 tests passing","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.6.3","depends_on_id":"butlers-cfw.6","type":"parent-child","created_at":"2026-02-10T12:12:58.523988621+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.6.4","title":"Implement consolidation executor","description":"For each parsed action from CC output: store facts/rules via storage.py, create derived_from links to source episodes, create supports/contradicts links between facts and rules, call confirm on referenced fact IDs, mark processed episodes as consolidated=true.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:12:59.564329747+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:15:05.187780203+08:00","closed_at":"2026-02-10T17:15:05.187780203+08:00","close_reason":"Merged to main, 2027 tests passing","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.6.4","depends_on_id":"butlers-cfw.6","type":"parent-child","created_at":"2026-02-10T12:12:59.566434475+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.6.5","title":"Implement episode cleanup","description":"Add run_episode_cleanup(pool, max_entries=10000). Delete episodes WHERE expires_at \u003c now(). If count \u003e max_entries, delete oldest first. Never delete unconsolidated episodes that haven't expired.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:13:00.689937384+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:08:48.863342639+08:00","closed_at":"2026-02-10T17:08:48.863342639+08:00","close_reason":"Merged to main, 2001 tests passing","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.6.5","depends_on_id":"butlers-cfw.6","type":"parent-child","created_at":"2026-02-10T12:13:00.691966318+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.6.6","title":"Wire scheduled tasks in butler.toml","description":"Add scheduled tasks to roster/memory/butler.toml: consolidate (cron='0 */6 * * *'), decay_sweep (cron='0 3 * * *'), episode_cleanup (cron='0 4 * * *'). Each with appropriate prompt text.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:13:02.003263198+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:11:54.403512686+08:00","closed_at":"2026-02-10T17:11:54.403512686+08:00","close_reason":"Scheduled tasks already wired in butler.toml; adjusted consolidation cron from */30 to 0 */6","labels":["backend","memory"],"dependencies":[{"issue_id":"butlers-cfw.6.6","depends_on_id":"butlers-cfw.6","type":"parent-child","created_at":"2026-02-10T12:13:02.007259911+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.6.7","title":"Write tests for consolidation","description":"Test consolidation groups episodes by butler. Test prompt includes existing facts/rules for context. Test output parser handles valid CC output. Test output parser handles malformed/incomplete output. Test episode cleanup respects unconsolidated protection. Test episode cleanup enforces capacity cap. Integration test: episodes -\u003e consolidation -\u003e facts + rules + links created.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T12:13:03.352256978+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:09:52.635256302+08:00","closed_at":"2026-02-10T17:09:52.635256302+08:00","close_reason":"All 7 test scenarios already covered by 39 tests from 6.1/6.2/6.3 workers; integration test will accompany executor (6.4)","labels":["backend","memory","testing"],"dependencies":[{"issue_id":"butlers-cfw.6.7","depends_on_id":"butlers-cfw.6","type":"parent-child","created_at":"2026-02-10T12:13:03.35483506+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.7","title":"Integrate Memory Butler with CC spawner","description":"Wire the Memory MCP server into all butlers' CC instances. Update CC spawner to call memory_context() before spawning (injects memory block into system prompt after CLAUDE.md). Update spawner to call memory_store_episode() after session completion. Add Memory MCP server to all ephemeral MCP configs. Add [butler.memory] config section support. Register Memory Butler with Switchboard. Graceful fallbacks when Memory Butler is unreachable.","acceptance_criteria":"1. CC instances receive memory context in system prompt\n2. Spawner handles Memory Butler unavailability (log warning, spawn without memory)\n3. Episode stored after every CC session completion\n4. Episode storage failure doesn't block session completion\n5. Ephemeral MCP configs include Memory MCP server at port 8150\n6. butler.toml supports [butler.memory.retrieval] custom weights\n7. Memory Butler registered with Switchboard","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T12:11:00.624133335+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:23:34.613780887+08:00","closed_at":"2026-02-10T17:23:34.613780887+08:00","close_reason":"All 8 children complete: memory context injection, fallbacks, episode storage, MCP config, butler.memory config, Switchboard registration, tests","labels":["backend","core","memory"],"dependencies":[{"issue_id":"butlers-cfw.7","depends_on_id":"butlers-cfw","type":"parent-child","created_at":"2026-02-10T12:11:00.625936132+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-cfw.7","depends_on_id":"butlers-cfw.5","type":"blocks","created_at":"2026-02-10T12:11:10.958778041+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.7.1","title":"Add memory context injection to CC spawner","description":"Update src/butlers/core/spawner.py. Before spawning CC, call memory_context(trigger_prompt, butler_name) on Memory MCP server. Inject returned memory block into system prompt after butler's CLAUDE.md content.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:13:09.436249839+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:15:05.247255136+08:00","closed_at":"2026-02-10T17:15:05.247255136+08:00","close_reason":"Merged to main, 2027 tests passing","labels":["backend","core","memory"],"dependencies":[{"issue_id":"butlers-cfw.7.1","depends_on_id":"butlers-cfw.7","type":"parent-child","created_at":"2026-02-10T12:13:09.438697876+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.7.2","title":"Add graceful fallback for memory context","description":"If memory_context call fails (Memory Butler unreachable, timeout, error), log warning and spawn CC without memory context. Butlers work fine without memory — degraded but functional.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:13:10.534118125+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:15:05.267773425+08:00","closed_at":"2026-02-10T17:15:05.267773425+08:00","close_reason":"Merged to main, 2027 tests passing","labels":["backend","core","memory"],"dependencies":[{"issue_id":"butlers-cfw.7.2","depends_on_id":"butlers-cfw.7","type":"parent-child","created_at":"2026-02-10T12:13:10.536058913+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.7.3","title":"Add episode storage after CC session","description":"Update spawner post-session flow. After CC session completes, call memory_store_episode(content, butler, session_id) on Memory MCP server with extracted session observations and LLM-rated importance.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T12:13:11.695444085+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:23:23.047002869+08:00","closed_at":"2026-02-10T17:23:23.047002869+08:00","close_reason":"Merged to main, 2061 tests passing","labels":["backend","core","memory"],"dependencies":[{"issue_id":"butlers-cfw.7.3","depends_on_id":"butlers-cfw.7","type":"parent-child","created_at":"2026-02-10T12:13:11.697540707+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.7.4","title":"Add graceful fallback for episode storage","description":"If memory_store_episode fails after session completion, log warning but do not block session completion. Session should be marked complete regardless of episode storage success.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:13:12.771036482+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:23:23.10387896+08:00","closed_at":"2026-02-10T17:23:23.10387896+08:00","close_reason":"Merged to main, 2061 tests passing","labels":["backend","core","memory"],"dependencies":[{"issue_id":"butlers-cfw.7.4","depends_on_id":"butlers-cfw.7","type":"parent-child","created_at":"2026-02-10T12:13:12.77375552+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.7.5","title":"Add Memory MCP server to ephemeral CC configs","description":"Update ephemeral MCP config generation in spawner. Include Memory MCP server (port 8150) in all butlers' CC instance configs alongside butler-specific tools. CC instances can call memory_recall, memory_store_fact, memory_confirm, etc. during sessions.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T12:13:14.118879456+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:23:23.124644055+08:00","closed_at":"2026-02-10T17:23:23.124644055+08:00","close_reason":"Merged to main, 2061 tests passing","labels":["backend","core","memory"],"dependencies":[{"issue_id":"butlers-cfw.7.5","depends_on_id":"butlers-cfw.7","type":"parent-child","created_at":"2026-02-10T12:13:14.12351111+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.7.6","title":"Add butler.memory config section support","description":"Update src/butlers/config.py to parse [butler.memory] and [butler.memory.retrieval] from butler.toml. Support score_weights, confidence thresholds, token_budget. Pass to memory_context calls.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":45,"created_at":"2026-02-10T12:13:15.319845888+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:23:23.14420324+08:00","closed_at":"2026-02-10T17:23:23.14420324+08:00","close_reason":"Merged to main, 2061 tests passing","labels":["backend","core","memory"],"dependencies":[{"issue_id":"butlers-cfw.7.6","depends_on_id":"butlers-cfw.7","type":"parent-child","created_at":"2026-02-10T12:13:15.324294615+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.7.7","title":"Register Memory Butler with Switchboard","description":"Register the Memory Butler as a routable butler with the Switchboard. Follow existing butler registration pattern.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":15,"created_at":"2026-02-10T12:13:16.357010831+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:16:21.830723634+08:00","closed_at":"2026-02-10T17:16:21.830723634+08:00","close_reason":"Auto-registered by discover_butlers() which scans roster/ for butler.toml files; Memory Butler already has roster/memory/butler.toml","labels":["backend","core","memory"],"dependencies":[{"issue_id":"butlers-cfw.7.7","depends_on_id":"butlers-cfw.7","type":"parent-child","created_at":"2026-02-10T12:13:16.362537074+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cfw.7.8","title":"Write tests for butler integration","description":"Test spawner injects memory context into system prompt. Test spawner handles Memory Butler unavailability gracefully. Test episode stored after session completion. Test episode failure doesn't block session. Test MCP config includes memory server. End-to-end test: trigger -\u003e session -\u003e episode -\u003e consolidation -\u003e fact retrieval.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T12:13:17.625435535+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T17:23:28.676279493+08:00","closed_at":"2026-02-10T17:23:28.676279493+08:00","close_reason":"All 6 test scenarios covered by 47 tests across test_spawner_memory_context.py (13), test_spawner_episode_storage.py (10), test_spawner_mcp_config.py (10), test_config_memory.py (14)","labels":["backend","memory","testing"],"dependencies":[{"issue_id":"butlers-cfw.7.8","depends_on_id":"butlers-cfw.7","type":"parent-child","created_at":"2026-02-10T12:13:17.62753361+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cjj","title":"Switchboard decomposition APIs missing or incompatible with tests","description":"tests/tools/test_decomposition.py fails because classify_message_multi and dispatch_to_targets are not importable from butlers.tools.switchboard, and aggregate_responses now requires dispatch_fn unexpectedly. Restore/define expected decomposition interfaces or update callers/tests coherently.","notes":"Coordinator: PR #2 opened from agent/butlers-cjj for review.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:56:00.712896382+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T00:12:56.91110432+08:00","closed_at":"2026-02-12T00:12:56.91110432+08:00","close_reason":"PR #2 merged","external_ref":"gh-pr:2","labels":["pr-review"],"dependencies":[{"issue_id":"butlers-cjj","depends_on_id":"butlers-uu0","type":"discovered-from","created_at":"2026-02-11T10:56:00.716033113+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cjp","title":"Write MANIFESTO.md for each butler","description":"Create a public-facing MANIFESTO.md file in each butler's config directory (butlers/\u003cname\u003e/MANIFESTO.md). Each manifesto explains what the butler does, what it represents, and how it improves the user's life. Written for a general audience — not developers, but people who want to understand why this butler exists and what it can do for them. Tone should be warm, clear, and aspirational without being salesy. Each manifesto should reflect the butler's unique personality and domain.\n\nThese manifestos also serve as the UX north star for each butler: new features, tools, and design decisions should be deeply aligned with the manifesto. CLAUDE.md and AGENTS.md have been updated to codify this convention.","acceptance_criteria":"1. butlers/switchboard/MANIFESTO.md exists\n2. butlers/general/MANIFESTO.md exists\n3. butlers/health/MANIFESTO.md exists\n4. butlers/relationship/MANIFESTO.md exists\n5. butlers/heartbeat/MANIFESTO.md exists\n6. Each manifesto explains what the butler does, why it matters, and what it can do for you\n7. Tone is warm, clear, and public-audience appropriate\n8. No internal implementation details (no SQL schemas, no port numbers, no MCP internals)","status":"closed","priority":3,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T21:20:05.176052182+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:49:10.336668104+08:00","closed_at":"2026-02-10T01:49:10.336668104+08:00","close_reason":"All 5 children completed: switchboard, general, health, relationship, heartbeat MANIFESTOs written"}
{"id":"butlers-cjp.1","title":"Write MANIFESTO.md for the Switchboard butler","description":"Write butlers/switchboard/MANIFESTO.md. The Switchboard is the front door — it receives every message and makes sure it reaches the right specialist. Frame it as the intelligent receptionist: you never need to know which butler handles what, you just talk, and the Switchboard figures it out. Emphasize simplicity for the user (one entry point), reliability (nothing gets lost), and intelligence (it understands context, not just keywords).","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T21:20:27.100987991+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:28:05.11865032+08:00","closed_at":"2026-02-10T01:28:05.11865032+08:00","close_reason":"MANIFESTO.md created for Switchboard butler, all tests pass, pushed to agent/butlers-cjp.1","dependencies":[{"issue_id":"butlers-cjp.1","depends_on_id":"butlers-cjp","type":"parent-child","created_at":"2026-02-09T21:20:27.102937968+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cjp.2","title":"Write MANIFESTO.md for the General butler","description":"Write butlers/general/MANIFESTO.md. The General butler is the flexible catch-all — a personal notebook that remembers anything. Frame it as the swiss-army-knife assistant: lists, notes, random data, ideas, anything that doesn't fit elsewhere. Emphasize its flexibility (any kind of data), organization (collections keep things tidy), and reliability (it never forgets what you told it).","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T21:20:27.167410662+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:29:41.509611953+08:00","closed_at":"2026-02-10T01:29:41.509611953+08:00","close_reason":"MANIFESTO.md created for General butler, lint passed, pushed to agent/butlers-cjp.2","dependencies":[{"issue_id":"butlers-cjp.2","depends_on_id":"butlers-cjp","type":"parent-child","created_at":"2026-02-09T21:20:27.168895881+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cjp.3","title":"Write MANIFESTO.md for the Health butler","description":"Write butlers/health/MANIFESTO.md. The Health butler tracks your physical wellbeing over time. Frame it as a patient, non-judgmental health companion: it remembers your medications, tracks your measurements, logs symptoms, watches your nutrition, and spots trends you'd miss. Emphasize continuity (it builds a picture over weeks and months), agency (your data, your terms), and insight (trend reports, adherence tracking, nutrition summaries).","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T21:20:27.236979052+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:39:20.528942056+08:00","closed_at":"2026-02-10T01:39:20.528942056+08:00","close_reason":"MANIFESTO.md created for Health butler, all tests pass, pushed to agent/butlers-cjp.3","dependencies":[{"issue_id":"butlers-cjp.3","depends_on_id":"butlers-cjp","type":"parent-child","created_at":"2026-02-09T21:20:27.238640794+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cjp.4","title":"Write MANIFESTO.md for the Relationship butler","description":"Write butlers/relationship/MANIFESTO.md. The Relationship butler is a personal CRM for the people in your life. Frame it as the friend who remembers everything: birthdays, gift ideas, who you talked to last week, the loan you made, the note you took after a meaningful conversation. Emphasize thoughtfulness (never miss an important date), richness (notes with emotion tags, interaction history), and connection (it helps you be more present in your relationships).","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T21:20:27.311569338+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:45:35.832966209+08:00","closed_at":"2026-02-10T01:45:35.832966209+08:00","close_reason":"MANIFESTO.md created for Relationship butler, all tests pass, pushed to agent/butlers-cjp.4","dependencies":[{"issue_id":"butlers-cjp.4","depends_on_id":"butlers-cjp","type":"parent-child","created_at":"2026-02-09T21:20:27.313773476+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-cjp.5","title":"Write MANIFESTO.md for the Heartbeat butler","description":"Write butlers/heartbeat/MANIFESTO.md. The Heartbeat butler is the system's pulse — it makes sure every other butler stays alive and responsive. Frame it for a public audience as the reliability layer: you never need to think about it, but it's always working to make sure the system is healthy. Brief and understated, matching the butler's behind-the-scenes nature. Emphasize reliability (runs every 10 minutes, never stops), resilience (one failure doesn't cascade), and peace of mind (the system watches itself so you don't have to).","status":"closed","priority":3,"issue_type":"chore","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-09T21:20:27.390734083+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:49:09.00245906+08:00","closed_at":"2026-02-10T01:49:09.00245906+08:00","close_reason":"MANIFESTO.md created for Heartbeat butler, all tests pass, pushed to agent/butlers-cjp.5","dependencies":[{"issue_id":"butlers-cjp.5","depends_on_id":"butlers-cjp","type":"parent-child","created_at":"2026-02-09T21:20:27.392412326+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc","title":"Add action approval mechanism with standing approval rules","description":"Butlers performing high-stakes actions (sending emails, making purchases, creating calendar events) need human review before execution. This epic adds a generalized approval framework:\n\n1. **MCP-level interception** — gated tools are wrapped at the daemon level; when called, the action is serialized and parked instead of executed\n2. **Approval queue** — pending actions persisted in the butler's DB with full context (tool, args, agent summary, session ID)\n3. **Standing approval rules** — users can pre-approve recurring action patterns (e.g. 'weekly health email to bob@co.com') so they only approve once\n4. **Rule matching** — tool name + per-argument constraints (exact/pattern/any), with module-declared sensitivity hints and heuristic fallback for arg classification\n5. **Post-approval execution** — approved actions invoke the target tool directly (no CC respawn), with result logging\n6. **Notification** — users are notified of pending actions via existing channels\n\nKey data model:\n- PendingAction: id, butler, tool, args, agent_summary, session_id, status (pending/approved/rejected/expired/executed), timestamps, decision metadata, execution result\n- ApprovalRule: id, butler, tool, arg_constraints, description, expiry, max_uses, use_count, active, created_from (the PendingAction that spawned it)\n- Constraint types: exact, pattern, any — safety-critical args (recipients, amounts, URLs) default to pinned\n\nDesign decisions:\n- Hybrid core+module: interception lives in daemon (wraps MCP dispatch), approval tools live in an opt-in module\n- Sensitivity metadata: modules declare sensitive args via tool_metadata(); heuristic fallback for args named to/recipient/amount/url/etc.\n- When approving, user can choose: reject / approve once / approve \u0026 create standing rule (system suggests constraints)\n- Auto-expiry for pending actions (configurable TTL)\n- Even auto-approved actions are logged for audit trail\n\nPrior art: butlers-r1v.3 (extraction confirmation queue) — similar pattern but Switchboard-specific. This generalizes it.","design":"Architecture:\n- Core daemon change: tool dispatch wrapper checks approval config before invoking tool function. If gated, serialize PendingAction to DB, return {status: 'pending_approval', action_id} to CC.\n- Approval module: registers MCP tools (list_pending, approve_action, reject_action, create_rule, list_rules, revoke_rule). Owns the approval_actions and approval_rules tables.\n- Module.tool_metadata() method returns dict of {tool_name: {arg_name: {sensitive: bool}}}. Convention-based heuristic as fallback.\n- butler.toml config: [modules.approvals] require_approval = ['email_send', 'purchase_create'] with optional per-tool overrides.\n- Standing rule matching: ordered most-specific-first (more pinned args = higher priority). On match: auto-approve, log, increment use_count.\n- Suggested constraints on 'approve \u0026 create rule': sensitive args default to exact (pinned), content args default to any (open). User can adjust before confirming.\n\nTables (in butler's own DB):\n- pending_actions (id UUID PK, tool_name TEXT, tool_args JSONB, agent_summary TEXT, session_id UUID FK, status VARCHAR, requested_at TIMESTAMPTZ, expires_at TIMESTAMPTZ, decided_by TEXT, decided_at TIMESTAMPTZ, execution_result JSONB, approval_rule_id UUID nullable FK)\n- approval_rules (id UUID PK, tool_name TEXT, arg_constraints JSONB, description TEXT, created_from UUID nullable FK, created_at TIMESTAMPTZ, expires_at TIMESTAMPTZ, max_uses INT, use_count INT DEFAULT 0, active BOOL DEFAULT true)","acceptance_criteria":"1. Any butler can opt into approval gating via butler.toml configuration\n2. Gated tool calls are intercepted at MCP dispatch, serialized, and parked in DB\n3. Pending actions include agent-generated human-readable summary\n4. Users can approve, reject, or create standing rules from pending actions\n5. Standing rules auto-approve matching future actions without human intervention\n6. Rule matching supports exact, pattern, and any constraints per argument\n7. Modules can declare which tool args are safety-critical; heuristic fallback exists\n8. Approved actions execute directly (no CC respawn) with result logged\n9. Expired actions are auto-rejected after configurable TTL\n10. Full audit trail: all actions (manual and auto-approved) logged with decision metadata","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:27:30.535583906+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:13:27.644695474+08:00","closed_at":"2026-02-10T13:13:27.644695474+08:00","close_reason":"All 7 children complete: data models, gate interception, approval queue tools, standing rules engine, sensitivity metadata, gating config, and post-approval executor"}
{"id":"butlers-clc.1","title":"Define PendingAction and ApprovalRule data models with Alembic migration","description":"Create the two core tables for the approval mechanism in a new Alembic migration branch.\n\nTables:\n- pending_actions: id (UUID PK), tool_name (TEXT NOT NULL), tool_args (JSONB NOT NULL), agent_summary (TEXT), session_id (UUID, FK to sessions), status (VARCHAR NOT NULL DEFAULT 'pending', CHECK IN pending/approved/rejected/expired/executed), requested_at (TIMESTAMPTZ NOT NULL DEFAULT now()), expires_at (TIMESTAMPTZ), decided_by (TEXT), decided_at (TIMESTAMPTZ), execution_result (JSONB), approval_rule_id (UUID, FK to approval_rules, nullable — set when auto-approved by a rule)\n- approval_rules: id (UUID PK), tool_name (TEXT NOT NULL), arg_constraints (JSONB NOT NULL), description (TEXT NOT NULL), created_from (UUID, FK to pending_actions, nullable), created_at (TIMESTAMPTZ NOT NULL DEFAULT now()), expires_at (TIMESTAMPTZ), max_uses (INT), use_count (INT NOT NULL DEFAULT 0), active (BOOL NOT NULL DEFAULT true)\n\nIndexes: pending_actions(status, requested_at), pending_actions(session_id), approval_rules(tool_name, active).\n\nAlso define corresponding Python dataclasses/Pydantic models in src/butlers/modules/approvals/models.py for serialization/deserialization.","acceptance_criteria":"1. Alembic migration creates both tables with correct schema, constraints, and indexes\n2. Python dataclasses match DB schema with JSON serialization support\n3. Migration uses branch label 'approvals'\n4. Tests verify migration applies cleanly and models round-trip through DB","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T11:27:41.593209805+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:45:18.755143357+08:00","closed_at":"2026-02-10T11:45:18.755143357+08:00","close_reason":"Merged to main. PendingAction + ApprovalRule tables, models, migration, and 16 tests.","dependencies":[{"issue_id":"butlers-clc.1","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:27:41.595227428+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc.2","title":"Add tool sensitivity metadata to Module interface with heuristic fallback","description":"Extend the Module abstract base class to allow modules to declare which tool arguments are safety-critical (sensitive). This metadata drives the default constraint suggestions when creating standing approval rules.\n\nChanges to Module ABC:\n- Add optional method tool_metadata() -\u003e dict[str, ToolMeta] where ToolMeta has {arg_sensitivities: dict[str, bool]}. Default implementation returns empty dict (backward compatible).\n\nHeuristic fallback (for tools without explicit metadata):\n- Args named: to, recipient, recipients, email, address, url, uri, amount, price, cost, account → sensitive=True\n- All other args → sensitive=False\n\nResolution order: module declaration \u003e heuristic \u003e default (not sensitive).\n\nPlace heuristic logic in src/butlers/modules/approvals/sensitivity.py so it's co-located with the approval module.","acceptance_criteria":"1. Module ABC has optional tool_metadata() method with sensible default\n2. Existing modules are unaffected (backward compatible)\n3. Heuristic correctly classifies common sensitive arg names\n4. Resolution order: explicit \u003e heuristic \u003e default\n5. Tests cover explicit declaration, heuristic matching, and fallback","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T11:27:49.194712401+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:52:54.857208903+08:00","closed_at":"2026-02-10T11:52:54.857208903+08:00","close_reason":"Merged to main. Module ABC extended with tool_metadata(), sensitivity heuristic, 46 tests.","dependencies":[{"issue_id":"butlers-clc.2","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:27:49.197535916+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc.3","title":"Add approval gating configuration to butler.toml and ButlerConfig","description":"Extend butler.toml schema and ButlerConfig to support approval gating configuration.\n\nConfig shape in butler.toml:\n[modules.approvals]\nenabled = true\ndefault_expiry_hours = 48\n\n[modules.approvals.gated_tools]\nemail_send = {}                          # gate with defaults\npurchase_create = {expiry_hours = 24}    # custom expiry\ncalendar_invite = {}\n\nParsed into ApprovalConfig dataclass with:\n- enabled: bool\n- default_expiry_hours: int = 48\n- gated_tools: dict[str, GatedToolConfig]\n\nGatedToolConfig:\n- expiry_hours: int | None (override default)\n\nValidation: gated tool names must match tools actually registered by the butler's modules (validated at startup after module registration).","acceptance_criteria":"1. butler.toml supports [modules.approvals] section\n2. ButlerConfig parses approval config correctly\n3. Unknown/unregistered gated tool names raise validation error at startup\n4. Default expiry is configurable\n5. Tests cover config parsing, validation, and defaults","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T11:27:55.619784775+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:55:08.816376557+08:00","closed_at":"2026-02-10T11:55:08.816376557+08:00","close_reason":"Merged to main. ApprovalConfig + GatedToolConfig dataclasses, TOML parsing, validation, 26 tests.","dependencies":[{"issue_id":"butlers-clc.3","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:27:55.621552896+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc.4","title":"Implement MCP tool dispatch interception for approval-gated tools","description":"Modify the daemon's MCP tool registration to wrap approval-gated tools. When a gated tool is called by CC:\n\n1. Serialize the call into a PendingAction (tool_name, tool_args, session context)\n2. Check standing approval rules — if a rule matches, auto-approve and execute immediately\n3. If no rule matches, persist PendingAction with status='pending' and return a structured response to CC: {status: 'pending_approval', action_id: '\u003cuuid\u003e', message: 'Action queued for approval: \u003cagent_summary\u003e'}\n\nImplementation in daemon.py's tool registration loop:\n- After module.register_tools(), wrap any tool whose name appears in gated_tools config\n- The wrapper function replaces the original tool handler\n- Original tool function reference is preserved for post-approval direct invocation\n\nThe CC agent will receive the pending_approval response and can inform the user that the action is awaiting approval.\n\nKey: the wrapping happens at the FastMCP level, not inside individual tool functions. Tools remain unaware of the approval layer.","acceptance_criteria":"1. Gated tools are transparently wrapped at MCP registration time\n2. Non-gated tools are completely unaffected\n3. Wrapped tools serialize call into PendingAction and persist to DB\n4. Standing rule check happens before parking (auto-approve path works)\n5. CC receives structured pending_approval response with action ID\n6. Original tool function is preserved for later direct invocation\n7. Tests cover: gated tool interception, non-gated passthrough, auto-approve via rule, serialization correctness","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":180,"created_at":"2026-02-10T11:28:08.069721047+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T12:12:38.549442947+08:00","closed_at":"2026-02-10T12:12:38.549442947+08:00","close_reason":"Merged to main. Implemented MCP dispatch interception with standing rule matching, daemon integration, and 27 tests.","dependencies":[{"issue_id":"butlers-clc.4","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:28:08.071429235+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.4","depends_on_id":"butlers-clc.1","type":"blocks","created_at":"2026-02-10T11:28:43.677091058+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.4","depends_on_id":"butlers-clc.3","type":"blocks","created_at":"2026-02-10T11:28:43.788504927+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc.5","title":"Implement approval queue MCP tools (list, approve, reject)","description":"Create the approval module's core MCP tools for managing the pending action queue.\n\nTools:\n- list_pending_actions(status?: str, limit?: int) → list of pending actions with id, tool_name, agent_summary, requested_at, expires_at\n- show_pending_action(action_id: str) → full PendingAction details including tool_args\n- approve_action(action_id: str, create_rule?: bool) → approves and executes the action. If create_rule=true, returns suggested constraints for rule creation (see standing rules task)\n- reject_action(action_id: str, reason?: str) → rejects with optional reason\n- pending_action_count() → count of pending actions (for tick handler surfacing)\n- expire_stale_actions() → mark expired actions past their expires_at (called by tick handler)\n\nAll tools operate on the butler's own DB. Register via the approvals Module.register_tools() method.\n\nStatus transitions: pending → approved → executed, pending → rejected, pending → expired. No backward transitions.","acceptance_criteria":"1. All 6 tools registered and callable via MCP\n2. approve_action triggers direct execution of the original tool and stores result\n3. reject_action records reason and timestamps\n4. expire_stale_actions correctly identifies and expires overdue actions\n5. Status transitions are enforced (no invalid transitions)\n6. Tests cover full lifecycle: create → list → approve → execute, create → reject, create → expire","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T11:28:16.738273107+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:54:36.418750911+08:00","closed_at":"2026-02-10T11:54:36.418750911+08:00","close_reason":"Merged to main. ApprovalsModule with 6 MCP tools, status transitions, 63 tests.","dependencies":[{"issue_id":"butlers-clc.5","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:28:16.740742921+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.5","depends_on_id":"butlers-clc.1","type":"blocks","created_at":"2026-02-10T11:28:43.859989751+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc.6","title":"Implement standing approval rules engine with CRUD tools","description":"Build the rule matching engine and MCP tools for managing standing approval rules.\n\nRule matching engine (src/butlers/modules/approvals/rules.py):\n- match_rules(pool, tool_name, tool_args) → ApprovalRule | None\n- Fetches active, non-expired rules for the tool_name\n- Filters out rules that exceeded max_uses\n- Evaluates arg_constraints against tool_args:\n  - exact: arg value == constraint value\n  - pattern: fnmatch-style glob matching (e.g. '*@mycompany.com')\n  - any: always matches\n- Returns most-specific match (most pinned/exact constraints wins)\n- Returns None if no match\n\nConstraint suggestion (src/butlers/modules/approvals/sensitivity.py):\n- suggest_constraints(tool_name, tool_args, tool_metadata) → dict[str, Constraint]\n- Sensitive args → exact constraint (pinned to current value)\n- Non-sensitive args → any constraint\n- Uses module metadata + heuristic fallback\n\nMCP tools:\n- create_approval_rule(tool_name, arg_constraints, description, expires_at?, max_uses?) → rule_id\n- create_rule_from_action(action_id, constraint_overrides?) → creates rule from a PendingAction, using suggested constraints with optional user overrides\n- list_approval_rules(tool_name?, active_only?: bool) → list of rules\n- show_approval_rule(rule_id) → full rule details with use_count\n- revoke_approval_rule(rule_id) → sets active=false\n- suggest_rule_constraints(action_id) → returns suggested constraints for a pending action (preview before creating)","acceptance_criteria":"1. Rule matching correctly evaluates exact, pattern, and any constraints\n2. Most-specific rule wins when multiple rules match\n3. Expired and max-uses-exceeded rules are skipped\n4. Constraint suggestion correctly classifies sensitive vs non-sensitive args\n5. create_rule_from_action generates rule from pending action with smart defaults\n6. All 6 CRUD tools work end-to-end\n7. Tests cover: matching priority, constraint types, expiry, max_uses, suggestion logic","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":180,"created_at":"2026-02-10T11:28:27.515042441+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T12:54:14.006996202+08:00","closed_at":"2026-02-10T12:54:14.006996202+08:00","close_reason":"Implemented and merged to main","dependencies":[{"issue_id":"butlers-clc.6","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:28:27.516858951+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.6","depends_on_id":"butlers-clc.1","type":"blocks","created_at":"2026-02-10T11:28:43.949523687+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.6","depends_on_id":"butlers-clc.2","type":"blocks","created_at":"2026-02-10T11:28:44.032851374+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-clc.7","title":"Implement post-approval direct tool executor with audit logging","description":"When an action is approved (manually or via standing rule), execute the original tool function directly without spawning a CC session.\n\nExecutor (src/butlers/modules/approvals/executor.py):\n- execute_approved_action(pool, pending_action, original_tool_fn) → ExecutionResult\n- Calls the original tool function with the deserialized args\n- Captures return value or exception\n- Updates PendingAction: status='executed', execution_result={success, result/error, executed_at}\n- If the rule that auto-approved it exists, increment use_count\n\nError handling:\n- Tool function raises → status='executed', execution_result={success: false, error: str(exception)}\n- Action is still marked executed (not retried). User can see the failure and decide what to do.\n\nAudit:\n- All executions (manual-approve and auto-approve) logged to pending_actions table\n- Auto-approved actions include approval_rule_id FK for traceability\n- Support querying: list_executed_actions(tool_name?, rule_id?, since?) for audit review","acceptance_criteria":"1. Approved actions execute the original tool function with correct args\n2. Execution result (success or failure) is persisted\n3. Auto-approved actions link back to the rule that matched\n4. Rule use_count incremented on auto-approve execution\n5. list_executed_actions supports filtering by tool, rule, and date\n6. Tests cover: successful execution, failed execution, auto-approve audit trail","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T11:28:36.120925667+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:04:22.410588246+08:00","closed_at":"2026-02-10T13:04:22.410588246+08:00","close_reason":"Implemented and merged to main","dependencies":[{"issue_id":"butlers-clc.7","depends_on_id":"butlers-clc","type":"parent-child","created_at":"2026-02-10T11:28:36.122749711+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.7","depends_on_id":"butlers-clc.4","type":"blocks","created_at":"2026-02-10T11:28:44.142348012+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.7","depends_on_id":"butlers-clc.5","type":"blocks","created_at":"2026-02-10T11:28:44.225283339+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-clc.7","depends_on_id":"butlers-clc.6","type":"blocks","created_at":"2026-02-10T11:28:44.297455522+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-dbq","title":"Refactor general butler tools.py into tools/ directory","description":"Split roster/general/tools.py (217 lines) into a tools/ directory following the pattern established in butlers-30g. Create tools/__init__.py that re-exports all tools for backward compatibility. Group tool functions into logical category files. The dynamic tools loader already supports both tools.py and tools/__init__.py.","notes":"Follow the same structure as roster/health/tools/ and roster/relationship/tools/ from butlers-30g.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-11T03:48:28.463710899+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T03:52:49.189380928+08:00","closed_at":"2026-02-11T03:52:49.189380928+08:00","close_reason":"Refactored and pushed to agent branches"}
{"id":"butlers-dk0","title":"Mailbox integration contract mismatch breaks mailbox integration tests","description":"Full pytest gate (2026-02-11) shows broad failures in tests/integration/test_mailbox_integration.py. Symptoms include unexpected post_mail return shape, metadata serialization type mismatch, and mailbox CRUD/list/read/status/stat assertions failing. Module-level mailbox tests pass, indicating integration-level contract drift between switchboard post_mail expectations and mailbox tool behavior.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T23:13:12.949140351+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.023582485+08:00","closed_at":"2026-02-11T23:30:11.023582485+08:00","close_reason":"Duplicate of butlers-yvr (mailbox integration contract drift).","dependencies":[{"issue_id":"butlers-dk0","depends_on_id":"butlers-4xh","type":"discovered-from","created_at":"2026-02-11T23:13:12.952234433+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-dnk","title":"Fix pipeline.process() passing list to route() instead of using dispatch_decomposed()","description":"## What\n\nMessagePipeline.process() in src/butlers/modules/pipeline.py passes the raw list[dict] return value from classify_message() directly to route() as the target_butler argument. route() expects a str for the SQL query parameter, causing asyncpg.exceptions.DataError on every incoming message.\n\n## Why\n\nThis breaks ALL message routing through the Switchboard pipeline. Every Telegram/Email message that reaches the pipeline fails with:\n\n```\nERROR: butlers.modules.pipeline: Routing failed for message to butler [{'butler': 'general', 'prompt': 'Hello world'}]\nasyncpg.exceptions.DataError: invalid input for query argument $1: [{'butler': 'general', 'prompt': 'Hello ... (expected str, got list)\n```\n\nThe root cause is a type mismatch introduced when classify_message() was updated to return list[dict[str, str]] for multi-butler decomposition, but pipeline.process() was not updated to iterate over the list. dispatch_decomposed() already exists and correctly handles this iteration.\n\n## Repro\n\n1. Start butlers with `butlers up`\n2. Send any message via Telegram\n3. Observe ERROR in switchboard logs: \"Routing failed for message to butler [{'butler': ...}]\"","design":"### Approach: Wire dispatch_decomposed into pipeline\n\n1. In pipeline.process(), replace the direct route() call with dispatch_decomposed():\n   - Import dispatch_decomposed from butlers.tools.switchboard\n   - Pass classify result (list[dict]) directly to dispatch_decomposed()\n   - dispatch_decomposed already iterates, calls route() per target, handles errors independently\n\n2. Update RoutingResult:\n   - Change target_butler from str to str (keep as primary/first target for backwards compat)\n   - Add targets: list[dict] field for full decomposition results\n   - Add per_butler_results: list[dict] from dispatch_decomposed return\n\n3. Update logging to iterate targets for structured fields.\n\n4. Update tests: mock classify functions should return list[dict] format, not bare str.\n\n### Files to modify\n- src/butlers/modules/pipeline.py — process() routing step + RoutingResult\n- tests/modules/test_module_pipeline.py — update mock classify return types","acceptance_criteria":"1. pipeline.process() uses dispatch_decomposed() to route each classified sub-message individually\n2. RoutingResult dataclass updated to represent multiple targets (list of per-butler results)\n3. Single-target messages (most common case) still work correctly\n4. Multi-target decomposed messages route to each butler independently\n5. Errors in one sub-route do not prevent other sub-routes from executing\n6. Existing structured logging preserved with per-target detail\n7. All test_module_pipeline.py tests updated for list[dict] classify return type and pass","notes":"- dispatch_decomposed() at roster/switchboard/tools/routing/dispatch.py already exists and is tested\n- aggregate_responses() exists for combining multi-butler responses but is not needed for this fix\n- The classify→dispatch→route chain was designed together in butlers-hzx epic but the pipeline wasn't wired to use dispatch_decomposed\n- Related closed epics: butlers-hzx (decomposition), butlers-t8m (pipeline wiring)","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-12T00:21:50.888416187+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T11:45:38.440847251+08:00","closed_at":"2026-02-12T11:45:38.440847251+08:00","close_reason":"Already fixed in commits a71f7bf, dd21800, 9b09b38 — agent forgot to close"}
{"id":"butlers-duz","title":"Dashboard notifications list endpoint redirects /api/notifications/ to canonical path","description":"Running notification API tests fails with HTTP 307 redirects when requesting /api/notifications/ (trailing slash). Tests expect 200/422 directly and mock DB calls are not reached. Repro: uv run pytest tests/api/test_notifications_router.py tests/api/test_notification_endpoints.py -q. Likely route path canonicalization mismatch in notifications router vs test/client expectations; evaluate whether endpoint should mount at '/' or tests should use canonical non-redirect path.","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:36:29.523317159+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.371660867+08:00","closed_at":"2026-02-11T23:30:11.371660867+08:00","close_reason":"Duplicate of butlers-9du (same notifications/list redirect root cause).","dependencies":[{"issue_id":"butlers-duz","depends_on_id":"butlers-v96","type":"discovered-from","created_at":"2026-02-11T10:36:29.525714256+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-e1l","title":"Memory migration chain linearity checks failing","description":"tests/daemon/test_memory_chain_registration.py reports failures in revision chain link and linearity assertions. Validate memory migration revision graph and fix incorrect down_revision/ordering so chain integrity checks pass.","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:56:01.200831702+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.729900994+08:00","closed_at":"2026-02-11T23:30:11.729900994+08:00","close_reason":"Duplicate of butlers-c7q (memory migration chain linearity failure).","dependencies":[{"issue_id":"butlers-e1l","depends_on_id":"butlers-uu0","type":"discovered-from","created_at":"2026-02-11T10:56:01.203779586+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f1u","title":"Stabilize failing notification API test suites","description":"The required pytest quality gate currently fails across notification endpoint suites unrelated to butlers-9du. Failing files include tests/api/test_notification_endpoints.py and tests/api/test_notifications_router.py (validation, query construction, pagination, and filter behavior). These failures should be triaged and fixed in a dedicated issue so worker branches can pass full required gates.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-12T00:06:56.78171603+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T11:45:38.478109106+08:00","closed_at":"2026-02-12T11:45:38.478109106+08:00","close_reason":"Already fixed in commits a71f7bf, dd21800, 9b09b38 — agent forgot to close","dependencies":[{"issue_id":"butlers-f1u","depends_on_id":"butlers-9du","type":"discovered-from","created_at":"2026-02-12T00:06:56.784169495+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t","title":"Abstract LLM runtime to support multiple CLI agents","description":"The CC spawner (butlers-0qp.8) is hardcoded to the Claude Code SDK — imports, option types, result parsing, and config generation all assume Claude Code. Refactor the spawner into a runtime-agnostic orchestrator backed by pluggable runtime adapters.\n\nMinimum supported runtimes:\n- Claude Code (existing, via claude-code-sdk)\n- Codex CLI (OpenAI)\n- Gemini CLI (Google)\n\nThese are all CLI tools that accept MCP server configs and a system prompt, so the fundamental model is the same — the differences are:\n1. SDK/CLI invocation interface (different query functions, option types, result types)\n2. Config file format and location (.claude/ vs .codex/ vs .gemini/ and their respective MCP config schemas)\n3. How system prompts are passed (CLAUDE.md vs AGENTS.md vs equivalent)\n4. Result parsing (different message type enums and tool-call shapes)\n\nWhat stays the same (must NOT change):\n- MCP config isolation (each instance sees only its butler's tools)\n- Serial dispatch (asyncio.Lock per butler)\n- Credential isolation (only declared env vars)\n- Session logging (every invocation logged)\n- Temp directory cleanup\n- Trace context propagation","design":"Adapter pattern with a RuntimeAdapter ABC in src/butlers/core/runtimes/base.py:\n\n```python\nclass RuntimeAdapter(ABC):\n    @abstractmethod\n    async def invoke(\n        self,\n        prompt: str,\n        system_prompt: str,\n        mcp_servers: dict[str, dict],\n        env: dict[str, str],\n        cwd: Path,\n        timeout: int = 300,\n    ) -\u003e tuple[str | None, list[dict]]:\n        \"\"\"Return (result_text, tool_calls).\"\"\"\n```\n\nConcrete adapters: ClaudeCodeAdapter, CodexAdapter, GeminiAdapter in sibling modules.\n\nCCSpawner becomes the runtime-agnostic orchestrator — keeps lock, session logging, temp dirs, credential passthrough. Delegates invocation to self._adapter.invoke().\n\nRuntime selection via butler.toml:\n```toml\n[runtime]\ntype = \"claude-code\"  # or \"codex\", \"gemini\"\n```\n\nNew module layout:\n```\nsrc/butlers/core/runtimes/\n├── __init__.py\n├── base.py              # RuntimeAdapter ABC\n├── claude_code.py       # ClaudeCodeAdapter\n├── codex.py             # CodexAdapter\n└── gemini.py            # GeminiAdapter\n```","acceptance_criteria":"1. CCSpawner delegates all SDK-specific logic to a RuntimeAdapter\n2. butler.toml `[runtime]` section selects which adapter is used\n3. ClaudeCodeAdapter preserves all existing behavior (no regression)\n4. CodexAdapter can invoke Codex CLI with MCP config and system prompt\n5. GeminiAdapter can invoke Gemini CLI with MCP config and system prompt\n6. All architectural invariants preserved (serial dispatch, credential isolation, session logging, temp cleanup, trace propagation)\n7. Tests parameterized across all three runtimes","notes":"Discovered from: butlers-0qp.8 (original CC spawner epic, now closed). This is post-v1 work — the v1 MVP shipped with Claude Code only. Key files: src/butlers/core/spawner.py, tests/test_core_spawner.py, src/butlers/core/config.py (ButlerConfig).","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T20:49:31.571765013+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:09:51.661945934+08:00","closed_at":"2026-02-10T01:09:51.661945934+08:00","close_reason":"All children completed","labels":["backend","core","refactor"],"dependencies":[{"issue_id":"butlers-f3t","depends_on_id":"butlers-0qp.8","type":"discovered-from","created_at":"2026-02-09T20:50:44.20701239+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.1","title":"Define RuntimeAdapter ABC and adapter registry","description":"Create the abstract base class that all runtime adapters implement, plus a registry/factory function that maps runtime type strings to adapter classes.\n\nCreate src/butlers/core/runtimes/__init__.py and src/butlers/core/runtimes/base.py.\n\nThe ABC defines:\n- invoke(prompt, system_prompt, mcp_servers, env, cwd, timeout) -\u003e (result_text, tool_calls)\n- build_config_file(mcp_servers, tmp_dir) -\u003e Path (runtimes may need different config file formats)\n- parse_system_prompt_file(config_dir) -\u003e str (CLAUDE.md vs equivalent)\n\nThe registry maps 'claude-code' | 'codex' | 'gemini' -\u003e adapter class. Raise ValueError for unknown types.","acceptance_criteria":"1. RuntimeAdapter ABC importable from butlers.core.runtimes\n2. get_adapter(type_str) returns correct class or raises ValueError\n3. ABC enforces invoke(), build_config_file(), parse_system_prompt_file()","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:49:41.51950919+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:33:45.590904213+08:00","closed_at":"2026-02-09T22:33:45.590904213+08:00","close_reason":"Defined RuntimeAdapter ABC and adapter registry","labels":["backend","core"],"dependencies":[{"issue_id":"butlers-f3t.1","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:49:41.525110856+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.2","title":"Extract ClaudeCodeAdapter from CCSpawner","description":"Refactor the SDK-specific code out of src/butlers/core/spawner.py into src/butlers/core/runtimes/claude_code.py as a ClaudeCodeAdapter implementing RuntimeAdapter.\n\nMove to the adapter:\n- claude_code_sdk imports (ClaudeCodeOptions, ResultMessage, ToolUseBlock, McpSSEServerConfig, query)\n- MCP config file writing (JSON format with mcpServers key)\n- SDK invocation (building ClaudeCodeOptions, calling query(), parsing ResultMessage/ToolUseBlock)\n- CLAUDE.md reading logic\n\nKeep in CCSpawner (the orchestrator):\n- asyncio.Lock and serial dispatch\n- Session logging (create/complete)\n- Credential passthrough (_build_env)\n- Temp directory lifecycle\n- Trace context propagation\n- SpawnerResult dataclass\n\nCCSpawner receives a RuntimeAdapter instance at __init__ instead of sdk_query callable.","acceptance_criteria":"1. All existing spawner tests pass without modification to assertions (only setup changes)\n2. ClaudeCodeAdapter is a standalone module with no imports from spawner.py\n3. CCSpawner has zero imports from claude_code_sdk\n4. Behavior identical to pre-refactor (no regression)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:49:53.92584154+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T22:51:40.88083812+08:00","closed_at":"2026-02-09T22:51:40.88083812+08:00","close_reason":"Extracted ClaudeCodeAdapter from CCSpawner","labels":["backend","core","refactor"],"dependencies":[{"issue_id":"butlers-f3t.2","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:49:53.934925662+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.2","depends_on_id":"butlers-f3t.1","type":"blocks","created_at":"2026-02-09T20:49:57.257634225+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.3","title":"Add runtime config to butler.toml and ButlerConfig","description":"Extend butler.toml schema and ButlerConfig dataclass to support runtime selection.\n\nAdd a [runtime] section to butler.toml:\n```toml\n[runtime]\ntype = \"claude-code\"   # \"claude-code\" | \"codex\" | \"gemini\"\n# Future: runtime-specific overrides could go here\n```\n\nAdd RuntimeConfig to ButlerConfig:\n```python\n@dataclass\nclass RuntimeConfig:\n    type: str = \"claude-code\"  # default preserves backward compat\n\n@dataclass  \nclass ButlerConfig:\n    runtime: RuntimeConfig = field(default_factory=RuntimeConfig)\n```\n\nButlerDaemon startup uses get_adapter(config.runtime.type) to instantiate the correct adapter and passes it to CCSpawner (or rename to just Spawner).","acceptance_criteria":"1. Existing butler.toml files without [runtime] default to claude-code (backward compat)\n2. Invalid runtime type raises clear error at startup, not at first invocation\n3. ButlerConfig.runtime.type accessible throughout the codebase\n4. Config parsing tested with all three runtime types + missing section + invalid type","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T20:50:06.134135358+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:01:08.991832307+08:00","closed_at":"2026-02-09T23:01:08.991832307+08:00","close_reason":"Added runtime config to butler.toml and ButlerConfig","labels":["backend","config","core"],"dependencies":[{"issue_id":"butlers-f3t.3","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:50:06.135889887+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.3","depends_on_id":"butlers-f3t.1","type":"blocks","created_at":"2026-02-09T20:50:06.200121617+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.4","title":"Implement CodexAdapter for Codex CLI","description":"Implement CodexAdapter in src/butlers/core/runtimes/codex.py.\n\nResearch required:\n- Codex CLI invocation interface (likely subprocess-based or SDK)\n- MCP config format for Codex (.codex/ conventions)\n- How Codex ingests system prompts (equivalent of CLAUDE.md — likely AGENTS.md or instructions file)\n- Result format (how to extract text response and tool calls)\n\nThe adapter must:\n- Build Codex-compatible MCP config pointing to the butler's SSE endpoint\n- Pass the system prompt in Codex's expected format\n- Invoke Codex with filtered env vars\n- Parse Codex output into (result_text, tool_calls) matching the RuntimeAdapter contract\n\nIf Codex doesn't have a Python SDK, use subprocess invocation of the CLI binary.","acceptance_criteria":"1. CodexAdapter implements all RuntimeAdapter methods\n2. MCP config generated in Codex-compatible format\n3. System prompt sourced from appropriate file (AGENTS.md or equivalent)\n4. Result parsing extracts text and tool calls correctly\n5. Adapter works with Codex CLI binary installed on PATH","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":180,"created_at":"2026-02-09T20:50:15.601088013+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:11:50.420589571+08:00","closed_at":"2026-02-09T23:11:50.420589571+08:00","close_reason":"Implemented CodexAdapter for Codex CLI","labels":["backend","core"],"dependencies":[{"issue_id":"butlers-f3t.4","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:50:15.603215778+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.4","depends_on_id":"butlers-f3t.1","type":"blocks","created_at":"2026-02-09T20:50:15.666185839+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.5","title":"Implement GeminiAdapter for Gemini CLI","description":"Implement GeminiAdapter in src/butlers/core/runtimes/gemini.py.\n\nResearch required:\n- Gemini CLI invocation interface (subprocess or google-generativeai SDK)\n- MCP config format for Gemini (.gemini/ conventions — note: .gemini/ already has TOML command definitions in this repo)\n- How Gemini ingests system prompts (equivalent of CLAUDE.md)\n- Result format (how to extract text response and tool calls)\n\nThe adapter must:\n- Build Gemini-compatible MCP config pointing to the butler's SSE endpoint\n- Pass the system prompt in Gemini's expected format\n- Invoke Gemini with filtered env vars (GOOGLE_API_KEY instead of ANTHROPIC_API_KEY)\n- Parse Gemini output into (result_text, tool_calls) matching the RuntimeAdapter contract\n\nIf Gemini CLI doesn't have a Python SDK for agentic invocation, use subprocess.","acceptance_criteria":"1. GeminiAdapter implements all RuntimeAdapter methods\n2. MCP config generated in Gemini-compatible format\n3. System prompt passed correctly\n4. Result parsing extracts text and tool calls\n5. Adapter works with Gemini CLI binary installed on PATH\n6. Env passthrough includes GOOGLE_API_KEY (not ANTHROPIC_API_KEY)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":180,"created_at":"2026-02-09T20:50:22.431473906+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:23:48.001730525+08:00","closed_at":"2026-02-09T23:23:48.001730525+08:00","close_reason":"Implemented GeminiAdapter for Gemini CLI","labels":["backend","core"],"dependencies":[{"issue_id":"butlers-f3t.5","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:50:22.432887279+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.5","depends_on_id":"butlers-f3t.1","type":"blocks","created_at":"2026-02-09T20:50:22.491757995+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.6","title":"Wire runtime adapter into ButlerDaemon startup","description":"Update ButlerDaemon (src/butlers/core/daemon.py) to:\n1. Read runtime.type from ButlerConfig\n2. Instantiate the correct RuntimeAdapter via get_adapter()\n3. Pass the adapter to the Spawner (formerly CCSpawner)\n4. Handle missing runtime binaries gracefully (check PATH at startup, warn or fail-fast)\n\nAlso rename CCSpawner -\u003e Spawner (or AgentSpawner) since it's no longer Claude Code-specific. Update all imports across the codebase.","acceptance_criteria":"1. ButlerDaemon correctly wires the adapter based on butler.toml config\n2. Missing runtime binary detected at startup with clear error message\n3. All imports updated — no references to CCSpawner remain\n4. Existing butler configs (no [runtime] section) default to claude-code and work unchanged","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T20:50:30.087481629+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:34:05.280738025+08:00","closed_at":"2026-02-09T23:34:05.280738025+08:00","close_reason":"Wired runtime adapter into daemon startup","labels":["backend","core"],"dependencies":[{"issue_id":"butlers-f3t.6","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:50:30.09425505+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.6","depends_on_id":"butlers-f3t.2","type":"blocks","created_at":"2026-02-09T20:50:30.173585359+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.6","depends_on_id":"butlers-f3t.3","type":"blocks","created_at":"2026-02-09T20:50:30.23863598+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.7","title":"Parameterize spawner tests across all runtimes","description":"Refactor tests/test_core_spawner.py to:\n1. Run the existing orchestration tests (lock, session logging, credential passthrough, cleanup) against a mock adapter — these are runtime-agnostic\n2. Add per-adapter unit tests for each RuntimeAdapter implementation:\n   - ClaudeCodeAdapter: config generation, SDK invocation, result parsing\n   - CodexAdapter: config generation, CLI invocation, result parsing\n   - GeminiAdapter: config generation, CLI invocation, result parsing\n3. Use pytest.mark.parametrize where tests should run identically across adapters\n4. Mock the actual SDK/CLI calls in adapter tests (don't require binaries installed)\n\nThe existing 757-line test file has 10 test classes — preserve all assertions, just restructure.","acceptance_criteria":"1. All existing test assertions preserved (no regression)\n2. Orchestration tests run against mock adapter (not Claude Code-specific)\n3. Each adapter has dedicated unit tests for its specific logic\n4. Tests don't require any CLI binary to be installed (fully mocked)\n5. pytest --co shows parameterized test matrix","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T20:50:39.742258253+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T23:44:27.037706773+08:00","closed_at":"2026-02-09T23:44:27.037706773+08:00","close_reason":"Parameterized spawner tests across all runtimes","labels":["backend","core","testing"],"dependencies":[{"issue_id":"butlers-f3t.7","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T20:50:39.743782085+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.7","depends_on_id":"butlers-f3t.2","type":"blocks","created_at":"2026-02-09T20:50:39.800757992+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.7","depends_on_id":"butlers-f3t.4","type":"blocks","created_at":"2026-02-09T20:50:39.858383978+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.7","depends_on_id":"butlers-f3t.5","type":"blocks","created_at":"2026-02-09T20:50:39.914884918+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.7","depends_on_id":"butlers-f3t.6","type":"blocks","created_at":"2026-02-09T20:50:39.974783071+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-f3t.8","title":"Add per-butler model selection to runtime config","description":"Each butler should be able to specify which LLM model it uses, independent of the runtime adapter. The runtime type (claude-code, codex, gemini) determines the CLI tool, but the model parameter selects which specific model within that runtime the butler invokes.\n\nThis matters because different butlers have different cost/capability tradeoffs:\n- Switchboard (classification, routing): fast cheap model (Haiku, GPT-4o-mini)\n- Relationship (nuanced reasoning, empathy): capable model (Opus 4.6, GPT-5.2)\n- Heartbeat (simple ticks): cheapest available\n- General (varied tasks): mid-tier default (Sonnet 4.5)\n\nWithout per-butler model config, all butlers share whatever the runtime default is, wasting money on simple tasks or under-powering complex ones.\n\nThe model field should be optional — when omitted, the runtime adapter uses its own default (e.g. Claude Code SDK default, Codex CLI default). This preserves backward compatibility for existing butler.toml files.","design":"Extend RuntimeConfig with an optional model field:\n\nbutler.toml:\n```toml\n[runtime]\ntype = \"claude-code\"\nmodel = \"claude-opus-4-6\"    # optional, runtime-specific model ID\n```\n\nRuntimeConfig dataclass:\n```python\n@dataclass\nclass RuntimeConfig:\n    type: str = \"claude-code\"\n    model: str | None = None   # None = use runtime default\n```\n\nRuntimeAdapter.invoke() gains a model parameter:\n```python\nasync def invoke(self, prompt, system_prompt, mcp_servers, env, cwd, timeout=300, model=None):\n    ...\n```\n\nEach adapter maps the model string to its SDK/CLI equivalent:\n- ClaudeCodeAdapter: passes model to ClaudeCodeOptions (claude-code-sdk already supports this)\n- CodexAdapter: passes --model flag to codex CLI\n- GeminiAdapter: passes --model flag to gemini CLI\n\nThe Spawner reads config.runtime.model and passes it through to adapter.invoke(). If None, the adapter omits the flag entirely (runtime default).\n\nModel string is opaque to the framework — no validation beyond non-empty. Each runtime defines its own valid model IDs. Invalid models fail at invocation time with a clear error from the underlying CLI/SDK.\n\nSession logging should record the model used (add model TEXT column to sessions table or include in the existing cost JSONB).","acceptance_criteria":"1. butler.toml [runtime] section accepts optional model field\n2. Omitting model preserves backward compat (runtime default used)\n3. Model string passed through to RuntimeAdapter.invoke()\n4. ClaudeCodeAdapter passes model to ClaudeCodeOptions when set\n5. Session log records which model was used for each invocation\n6. Config parsing tested: model present, model absent, model empty string","notes":"Model IDs are runtime-specific and not validated by the framework. Examples: claude-opus-4-6, claude-sonnet-4-5-20250929, claude-haiku-4-5-20251001, gpt-5.2, gpt-4o-mini, gemini-2.0-flash. The framework treats them as opaque strings.","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T21:05:27.945753955+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:24:16.532274429+08:00","closed_at":"2026-02-10T00:24:16.532274429+08:00","close_reason":"Per-butler model selection added to RuntimeConfig, all adapters, and session logging","labels":["backend","config","core"],"dependencies":[{"issue_id":"butlers-f3t.8","depends_on_id":"butlers-f3t","type":"parent-child","created_at":"2026-02-09T21:05:27.947689973+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.8","depends_on_id":"butlers-f3t.3","type":"blocks","created_at":"2026-02-09T21:05:32.430965332+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-f3t.8","depends_on_id":"butlers-f3t.1","type":"blocks","created_at":"2026-02-09T21:05:32.541901451+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-fh0","title":"Migration test expects stale alembic revision id '003' instead of current 'core_003'","description":"tests/config/test_migrations.py::test_alembic_version_tracking fails because alembic_version contains 'core_003' while assertion expects '003'. Repro: uv run pytest tests/config/test_migrations.py::test_alembic_version_tracking -q. This appears to be a stale expectation after namespaced core migration revisions were introduced.","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:36:34.559750629+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.623252599+08:00","closed_at":"2026-02-11T23:30:11.623252599+08:00","close_reason":"Duplicate of butlers-c7q (core revision expectation drift).","dependencies":[{"issue_id":"butlers-fh0","depends_on_id":"butlers-v96","type":"discovered-from","created_at":"2026-02-11T10:36:34.562631119+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-go1","title":"Fix broken alembic migration history in relationship butler","description":"The migration history for the relationship butler is broken. There are multiple migrations with the same sequence number, and rel_003 references a non-existent rel_002. This prevents any migrations from running.","status":"in_progress","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-12T13:06:03.41941283+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T13:24:15.797727631+08:00","dependencies":[{"issue_id":"butlers-go1","depends_on_id":"butlers-pis","type":"discovered-from","created_at":"2026-02-12T13:06:03.42221396+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx","title":"Enable multi-butler message decomposition in Switchboard","description":"When a user sends a single message that spans multiple butler domains (e.g., 'Remind me to call Mom on Tuesday and log my weight at 75kg'), the Switchboard should decompose it into sub-messages and route each to the appropriate specialist butler. Currently the entire pipeline is 1:1: classify_message() returns a single butler name, route() forwards to one target, and the CLAUDE.md prompt does not instruct CC to split messages. This epic covers the spec changes, code changes, and prompt engineering needed to enable fan-out routing.","acceptance_criteria":"1. A single multi-domain message produces route() calls to each relevant butler\n2. Each sub-route is independently logged in routing_log\n3. Responses from all targeted butlers are aggregated into a single user-facing reply\n4. Single-domain messages continue to work exactly as before (no regression)\n5. Switchboard CLAUDE.md and triage skill instruct CC on decomposition behavior","notes":"Related existing work: butlers-bjr.1 (message-triage skill) partially covers multi-domain handling but needs decomposition guidance. butlers-06j.35 (inter-butler routing) must land first since route() does not work yet. butlers-06j.36 (module-to-classification pipeline) must land for end-to-end flow. This epic can be designed in parallel but implementation depends on those blockers.","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T21:15:54.507634584+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:09:51.67108062+08:00","closed_at":"2026-02-10T01:09:51.67108062+08:00","close_reason":"All children completed","dependencies":[{"issue_id":"butlers-hzx","depends_on_id":"butlers-06j.35","type":"blocks","created_at":"2026-02-09T21:15:57.639786378+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.1","title":"Update classify_message to return multi-butler decomposition","description":"Refactor classify_message() in src/butlers/tools/switchboard.py to return a list of (butler_name, sub_prompt) tuples instead of a single butler name string. The CC spawner prompt must instruct CC to analyze whether the message spans multiple domains and, if so, decompose it into distinct sub-messages each tagged with the target butler. For single-domain messages, the result is a list with one entry (backward-compatible). The return type changes from str to list[dict] with keys 'butler' and 'prompt'.","design":"Current classify_message asks CC to respond with ONLY the butler name. New prompt should ask CC to respond with JSON: [{\"butler\": \"health\", \"prompt\": \"Log weight at 75kg\"}, {\"butler\": \"relationship\", \"prompt\": \"Remind me to call Mom on Tuesday\"}]. Parse the JSON response; on parse failure, fall back to general.","acceptance_criteria":"1. classify_message returns list[dict] with keys 'butler' and 'prompt'\n2. Single-domain messages return a list with exactly one entry\n3. Multi-domain messages return one entry per target butler with a scoped sub-prompt\n4. The CC prompt instructs decomposition and specifies the expected JSON output format\n5. Fallback to [{'butler': 'general', 'prompt': original_message}] on classification failure","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:16:08.829702388+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:39:11.128999086+08:00","closed_at":"2026-02-09T21:39:11.128999086+08:00","close_reason":"Closed","dependencies":[{"issue_id":"butlers-hzx.1","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:16:08.833557743+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.2","title":"Add multi-route dispatch loop to Switchboard routing flow","description":"After classify_message returns a list of (butler, prompt) pairs, the Switchboard needs a dispatch loop that calls route() for each entry sequentially (respecting v1 serial constraint), collects results, and aggregates responses. Currently the flow is: classify -\u003e route(single_butler). New flow: classify -\u003e for each target: route(butler, trigger, {prompt: sub_prompt}) -\u003e collect results -\u003e aggregate. Each route() call is independently logged in routing_log. Errors in one sub-route must not prevent others from executing.","design":"New async function dispatch_decomposed(pool, targets: list[dict], source_channel, source_id) -\u003e list[dict]. Iterates over targets, calls route() for each, captures result or error. Returns list of {butler, result, error} dicts.","acceptance_criteria":"1. All decomposed sub-messages are dispatched via route() sequentially\n2. Each route() call is independently logged in routing_log\n3. A failure in one sub-route does not prevent subsequent sub-routes\n4. Results from all sub-routes are collected into a list\n5. Single-target messages dispatch exactly one route() call (no regression)","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:16:19.14513489+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:46:09.539656415+08:00","closed_at":"2026-02-09T21:46:09.539656415+08:00","close_reason":"Implemented dispatch_decomposed() with 7 tests, all 456 tests passing","dependencies":[{"issue_id":"butlers-hzx.2","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:16:19.146809308+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-hzx.2","depends_on_id":"butlers-hzx.1","type":"blocks","created_at":"2026-02-09T21:17:06.669033563+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.3","title":"Add response aggregation for multi-butler replies","description":"When a message is decomposed and dispatched to multiple butlers, the individual responses need to be combined into a single coherent reply sent back to the user via the originating channel (Telegram/Email). This task implements the aggregation logic that takes a list of per-butler results and produces one user-facing message. The aggregation should be done by spawning a CC instance that synthesizes the individual responses into a natural-sounding combined reply.","design":"Option A (CC-based): Spawn a CC instance with prompt 'Combine these responses into one natural reply: [results]'. Option B (template-based): Simple concatenation with headers per butler. Recommend Option A for quality since CC is already available and the output needs to feel conversational.","acceptance_criteria":"1. Multiple butler responses are aggregated into a single reply\n2. The aggregated reply reads naturally (not just concatenated text)\n3. If only one butler responded, that response is returned as-is (no aggregation overhead)\n4. If a sub-route failed, the aggregated reply includes a graceful mention or omission\n5. The originating channel receives exactly one response message","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:16:28.648900636+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:55:25.500521143+08:00","closed_at":"2026-02-09T21:55:25.500521143+08:00","close_reason":"Implemented response aggregation for multi-butler replies with CC-based synthesis, fallback concatenation, and 11 tests","dependencies":[{"issue_id":"butlers-hzx.3","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:16:28.650370647+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-hzx.3","depends_on_id":"butlers-hzx.2","type":"blocks","created_at":"2026-02-09T21:17:06.736057158+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.4","title":"Update Switchboard CLAUDE.md with decomposition instructions","description":"The Switchboard butler's CLAUDE.md (butlers/switchboard/CLAUDE.md) currently contains simple 1:1 classification rules. It needs to be updated with explicit instructions for message decomposition so that when CC is spawned for classification, it knows to split multi-domain messages. The prompt must explain: when to decompose (message contains distinct requests for different domains), the expected output format (JSON array), and when NOT to decompose (single-domain messages, ambiguous messages that should go to general).","acceptance_criteria":"1. CLAUDE.md includes decomposition instructions and examples\n2. Output format (JSON array of {butler, prompt} objects) is clearly specified\n3. Examples cover: single-domain, multi-domain, and ambiguous cases\n4. Instructions explain that each sub-prompt should be self-contained (not reference the other parts)\n5. Fallback behavior (default to general) is preserved","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T21:16:36.92503249+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:37:22.383954701+08:00","closed_at":"2026-02-10T00:37:22.383954701+08:00","close_reason":"Switchboard CLAUDE.md updated with decomposition instructions, output format, and examples","dependencies":[{"issue_id":"butlers-hzx.4","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:16:36.926748096+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.5","title":"Update message-triage skill with decomposition rubric","description":"The existing message-triage skill bead (butlers-bjr.1) mentions handling ambiguous/multi-domain messages but does not address decomposition. This task updates the skill spec to include: a decomposition decision tree (decompose vs. route-whole vs. default-to-general), examples of multi-domain messages with expected decompositions, and guidance on crafting self-contained sub-prompts that don't lose context from the original message. This task complements butlers-hzx.4 (CLAUDE.md update) — CLAUDE.md provides the high-level instructions while the triage skill provides the detailed rubric and examples.","acceptance_criteria":"1. Triage skill includes decomposition decision tree\n2. At least 3 examples of multi-domain message decompositions\n3. Guidance on preserving context in sub-prompts (e.g., 'Mom' context shouldn't be lost)\n4. Clear criteria for when NOT to decompose (ambiguous, single-domain, unclear)","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T21:16:45.860222502+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:44:14.18135905+08:00","closed_at":"2026-02-10T00:44:14.18135905+08:00","close_reason":"Message-triage skill updated with decomposition decision tree, 3+ examples, and context preservation guidance","dependencies":[{"issue_id":"butlers-hzx.5","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:16:45.862999907+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-hzx.5","depends_on_id":"butlers-bjr.1","type":"blocks","created_at":"2026-02-09T21:17:07.054874051+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.6","title":"Update switchboard spec with message decomposition requirements","description":"Add new requirements to the Switchboard spec (openspec/changes/v1-mvp-spec/specs/switchboard/spec.md) covering message decomposition. The spec currently defines 1:1 classification (one message -\u003e one butler). New requirements should cover: multi-target classification output format, sequential fan-out dispatch, response aggregation, routing_log entries per sub-route, and backward compatibility with single-target classification.","acceptance_criteria":"1. New requirement: Message decomposition via CC classification\n2. New requirement: Sequential fan-out dispatch of decomposed sub-messages\n3. New requirement: Response aggregation for multi-butler replies\n4. New scenarios covering: multi-domain message, single-domain message (no regression), partial failure\n5. Spec is consistent with existing serial dispatch constraint","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:16:53.538920338+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:39:36.73156952+08:00","closed_at":"2026-02-09T21:39:36.73156952+08:00","close_reason":"Spec updated with decomposition requirements","dependencies":[{"issue_id":"butlers-hzx.6","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:16:53.540799694+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-hzx.7","title":"Write tests for multi-butler message decomposition","description":"Write pytest tests covering the full decomposition pipeline: classify_message returning multiple targets, the dispatch loop routing to each, response aggregation, and edge cases (single-domain no-regression, classification failure fallback, partial sub-route failure). Tests should mock the CC spawner and route() call_fn.","acceptance_criteria":"1. Test: multi-domain message produces multiple route() calls\n2. Test: single-domain message produces exactly one route() call\n3. Test: classification failure falls back to general with full original message\n4. Test: partial sub-route failure still processes remaining sub-routes\n5. Test: response aggregation combines multiple results into one reply\n6. Test: routing_log contains one entry per sub-route","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:17:00.148817572+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:47:10.689507393+08:00","closed_at":"2026-02-10T00:47:10.689507393+08:00","close_reason":"6 decomposition pipeline tests covering multi-domain, single-domain, fallback, partial failure, aggregation, and routing log","dependencies":[{"issue_id":"butlers-hzx.7","depends_on_id":"butlers-hzx","type":"parent-child","created_at":"2026-02-09T21:17:00.151169772+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-hzx.7","depends_on_id":"butlers-hzx.1","type":"blocks","created_at":"2026-02-09T21:17:06.806864901+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-hzx.7","depends_on_id":"butlers-hzx.2","type":"blocks","created_at":"2026-02-09T21:17:06.867942907+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-hzx.7","depends_on_id":"butlers-hzx.3","type":"blocks","created_at":"2026-02-09T21:17:06.94439071+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-ipy","title":"Port spec-aligned schema improvements from butlers-06j.38 to main","description":"Branch agent/butlers-06j.38 rewrote relationship butler tools to match spec, but main independently relocated files to roster/relationship/. The two diverged incompatibly. This bead tracks selectively porting the branch's spec improvements into main's current structure.\n\n## What to port (branch has spec improvements main lacks):\n\n1. **Contacts schema**: Replace name/details JSONB blob with proper columns (first_name, last_name, nickname, company, job_title, gender, pronouns, avatar_url, listed, metadata). Cascades through every tool that JOINs contacts.\n2. **Notes**: Add title field — main only has content, branch has title+body per spec.\n3. **Reminders**: Replace simple dismissed boolean with next_trigger_at/last_triggered_at recurring advancement model (one_time/recurring_yearly/recurring_monthly).\n4. **Loans**: Replace single-contact direction model with two-party lender_contact_id/borrower_contact_id, amount_cents (integer), currency.\n5. **Groups**: Add type field on groups table, role field on group_members.\n6. **Activity feed**: Add entity_type and entity_id columns for linking feed entries back to specific records.\n\n## What to keep from main (main is ahead):\n\n- Relationships: taxonomy-based relationship_types system with forward_label/reverse_label resolution\n- Interactions: direction validation + combined filtering\n- New modules: life_events, tasks, resolve, stay_in_touch, vcard\n\n## Reference:\n\n- Branch: origin/agent/butlers-06j.38 (commit 0665e08)\n- Original bead: butlers-06j.38\n- Files on branch: src/butlers/tools/relationship.py, tests/test_tools_relationship.py\n- Current main locations: roster/relationship/tools/, roster/relationship/tests/","acceptance_criteria":"1. contacts table uses proper columns per spec (first_name, last_name, etc.) not name/details blob\n2. All tools that JOIN contacts updated for new column names\n3. Notes have title+body fields\n4. Reminders use trigger-based advancement (not dismissed boolean)\n5. Loans use two-party lender/borrower model with amount_cents\n6. Groups have type and role fields\n7. Activity feed has entity_type and entity_id\n8. All existing main-only features preserved (life_events, tasks, resolve, stay_in_touch, vcard, relationship_types)\n9. Tests pass for all modified tools\n10. New migrations created (not editing existing ones)","notes":"Source branch can be deleted after this work is complete. The migration file (001_relationship_tables.py) is identical between branch and main — no migration porting needed for that. New 003+ migrations should be created for the schema changes.","status":"in_progress","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":480,"created_at":"2026-02-11T09:05:41.112435056+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T12:30:32.099357906+08:00"}
{"id":"butlers-jrk","title":"Blocker: a butlers-nxg is invalid","description":"The issue butlers-nxg is invalid. It asks to replace 'poetry install' with 'poetry env use python \u0026\u0026 poetry install' in .github/workflows/ci.yml. However, this file uses 'uv sync --dev' and has never used poetry. The issue's premise is incorrect, making it impossible to apply the requested change.","status":"in_progress","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-12T13:22:35.538325691+08:00","created_by":"Tzeusy","updated_at":"2026-02-13T01:23:23.70787954+08:00","dependencies":[{"issue_id":"butlers-jrk","depends_on_id":"butlers-nxg","type":"discovered-from","created_at":"2026-02-12T13:22:35.540679715+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-kdg","title":"Discovered-from c7q: idempotent ingestion failures for interaction/life-event","description":"During butlers-c7q verification, tests/integration/test_idempotent_ingestion.py fails for interaction_log and life_event_log scenarios (initial insert, duplicate skip, and type/date differentiation), while date/note flows pass. Investigate dedupe keying and conflict handling for these ingestion paths.","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T23:15:12.918571894+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.785045357+08:00","closed_at":"2026-02-11T23:30:11.785045357+08:00","close_reason":"Duplicate of butlers-xb5 (idempotent ingestion interaction/life-event regressions).","dependencies":[{"issue_id":"butlers-kdg","depends_on_id":"butlers-c7q","type":"discovered-from","created_at":"2026-02-11T23:15:12.921366531+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-kie","title":"Fix missing init_dependencies() call in API lifespan handler","description":"The dashboard API lifespan handler (app.py:55) only calls init_pricing() on startup but never calls init_dependencies(). This leaves _mcp_manager as None, so any route that depends on get_mcp_manager() raises:\n\nRuntimeError: MCPClientManager not initialized — call init_dependencies() first\n\nRoot cause: app.py lifespan() is missing init_dependencies() (and shutdown_dependencies()) calls.\n\nSteps to reproduce:\n1. Start the dashboard API (uvicorn butlers.api.app:create_app)\n2. Hit any route that uses MCPClientManager (e.g. GET /api/butlers/{name}/tools)\n3. RuntimeError is raised at deps.py:266","design":"Add init_dependencies() and shutdown_dependencies() calls to the lifespan() async context manager in app.py. The import for init_dependencies already exists partially (init_pricing is imported from deps). Add the missing imports and wire the calls:\n\n```python\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    try:\n        init_pricing()\n    except Exception:\n        logger.warning(...)\n    manager, configs = init_dependencies()\n    yield\n    await shutdown_dependencies()\n```","acceptance_criteria":"1. lifespan() calls init_dependencies() during startup\n2. lifespan() calls shutdown_dependencies() during shutdown\n3. Routes using get_mcp_manager() no longer raise RuntimeError\n4. Existing tests pass","notes":"The deps module already has init_dependencies() and shutdown_dependencies() fully implemented — this is purely a wiring issue in the app factory.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-11T06:58:47.75108115+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T10:02:15.721025715+08:00","closed_at":"2026-02-11T10:02:15.721025715+08:00","close_reason":"Completed: lifespan now initializes/shuts down API dependencies with tests"}
{"id":"butlers-klr","title":"Refactor heartbeat butler tools.py into tools/ directory","description":"Split roster/heartbeat/tools.py (207 lines) into a tools/ directory following the pattern established in butlers-30g. Create tools/__init__.py that re-exports all tools for backward compatibility. Group tool functions into logical category files. The dynamic tools loader already supports both tools.py and tools/__init__.py.","notes":"Follow the same structure as roster/health/tools/ and roster/relationship/tools/ from butlers-30g.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-11T03:48:29.763580373+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T03:52:49.199817549+08:00","closed_at":"2026-02-11T03:52:49.199817549+08:00","close_reason":"Refactored and pushed to agent branches"}
{"id":"butlers-kq5","title":"Session schema/migration mismatch breaks core session tests","description":"Full pytest gate reports multiple failures in tests/core/test_core_sessions.py plus dependent integration failures (tests/integration/test_integration.py session CRUD/session_log). Symptoms indicate asyncpg errors on session fields and expectations mismatch. This appears unrelated to switchboard routing work in butlers-t8m.1 and is a nontrivial baseline bug affecting core session persistence/migrations.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:42:43.734226131+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T10:56:00.821505505+08:00","closed_at":"2026-02-11T10:56:00.821505505+08:00","close_reason":"Completed","dependencies":[{"issue_id":"butlers-kq5","depends_on_id":"butlers-t8m.1","type":"discovered-from","created_at":"2026-02-11T10:42:43.737577671+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-ln3","title":"Organize test suite with markers and subdirectories","description":"The tests/ directory has grown to 50 flat files (1248 tests) with no structural organization. Unit tests (pure logic, no Docker) and integration tests (testcontainers PostgreSQL) are mixed together, making it impossible to run fast feedback loops during development.\n\nGoals:\n- Enable selective test execution: pytest -m unit (fast, no Docker) vs pytest -m integration (full, Docker)\n- Group test files by component area in subdirectories for navigability\n- Add Makefile targets for common test subsets\n- Stay compatible with butlers-vyn.3 (butler-specific tool tests will move to butler dirs later)\n\nNon-goals:\n- Moving butler-specific tool tests (that is butlers-vyn.3)\n- Changing test implementation or coverage","design":"Phase approach:\n1. Add pytest markers to pyproject.toml and annotate every test file\n2. Create subdirectories and move files\n3. Add conftest.py per subdirectory where scoped fixtures are needed\n4. Add Makefile targets\n\nMarker heuristic:\n- integration: any test file that imports testcontainers or has skipif not docker_available\n- unit: everything else\n\nKeep tests/conftest.py as root for shared fixtures.","acceptance_criteria":"1. All 1248 tests still pass\n2. pytest -m unit runs ~750 tests without Docker in \u003c10s\n3. pytest -m integration runs Docker-dependent tests\n4. tests/ has subdirectories grouping files by component area\n5. Makefile has test-unit, test-integration, and test (all) targets\n6. pyproject.toml has marker definitions (no unknown marker warnings)\n7. CI-compatible: markers allow splitting test stages","status":"closed","priority":3,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T10:48:09.854779859+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:45:51.035694787+08:00","closed_at":"2026-02-10T11:45:51.035694787+08:00","close_reason":"All children merged: markers (ln3.1), subdirectories (ln3.2), Makefile targets (ln3.3)."}
{"id":"butlers-ln3.1","title":"Add pytest markers for unit and integration tests","description":"Define pytest markers in pyproject.toml and annotate every test file with the appropriate marker. This enables selective test execution without moving any files.\n\nCurrent state: 20 test files have skipif not docker_available — these are integration tests. The remaining ~30 files are unit tests (mocked dependencies, no Docker).\n\nChanges needed:\n- Add markers section to pyproject.toml [tool.pytest.ini_options]\n- Add pytestmark = pytest.mark.unit or pytestmark = pytest.mark.integration to each test file\n- For files that mix both: split into separate files or use per-test markers","acceptance_criteria":"1. pyproject.toml defines unit and integration markers\n2. Every test file has a pytestmark module-level marker\n3. pytest -m unit runs without Docker and completes in \u003c10s\n4. pytest -m integration runs only Docker-dependent tests\n5. pytest (no marker filter) runs everything as before\n6. No PytestUnknownMarkWarning warnings","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-10T10:48:20.756377934+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:36:39.544710942+08:00","closed_at":"2026-02-10T11:36:39.544710942+08:00","close_reason":"Merged to main. All 50 test files annotated with unit/integration markers. pytest -m unit runs in ~5s.","dependencies":[{"issue_id":"butlers-ln3.1","depends_on_id":"butlers-ln3","type":"parent-child","created_at":"2026-02-10T10:48:20.757940807+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-ln3.2","title":"Reorganize tests/ into component subdirectories","description":"Move the 50 flat test files into subdirectories grouped by component area. This improves navigability as the suite grows.\n\nProposed structure:\n  tests/\n  ├── conftest.py              (shared fixtures — stays)\n  ├── test_smoke.py            (stays at root)\n  ├── core/\n  │   ├── test_state.py\n  │   ├── test_scheduler.py\n  │   ├── test_sessions.py\n  │   ├── test_spawner.py\n  │   ├── test_spawner_context.py\n  │   └── test_db.py\n  ├── modules/\n  │   ├── test_base.py\n  │   ├── test_registry.py\n  │   ├── test_config_validation.py\n  │   ├── test_email.py\n  │   ├── test_telegram.py\n  │   └── test_pipeline.py\n  ├── daemon/\n  │   ├── test_daemon.py\n  │   ├── test_butler_migrations.py\n  │   ├── test_graceful_shutdown.py\n  │   ├── test_heartbeat.py\n  │   └── test_daemon_spans.py\n  ├── cli/\n  │   ├── test_cli.py\n  │   └── test_cli_port_conflicts.py\n  ├── telemetry/\n  │   ├── test_telemetry.py\n  │   ├── test_telemetry_spans.py\n  │   └── test_trace_propagation.py\n  ├── adapters/\n  │   ├── test_runtime_adapter.py\n  │   ├── test_codex_adapter.py\n  │   └── test_gemini_adapter.py\n  ├── tools/\n  │   ├── test_tools_general.py\n  │   ├── test_tools_health.py\n  │   ├── test_tools_relationship.py\n  │   ├── test_tools_switchboard.py\n  │   ├── test_tools_contact_info.py\n  │   ├── test_tools_extraction_queue.py\n  │   ├── test_extraction.py\n  │   ├── test_decomposition.py\n  │   ├── test_aggregate_responses.py\n  │   └── test_relationship_types.py\n  ├── config/\n  │   ├── test_config.py\n  │   ├── test_config_env_vars.py\n  │   ├── test_credentials.py\n  │   └── test_migrations.py\n  ├── integration/\n  │   ├── test_integration.py\n  │   ├── test_email_pipeline.py\n  │   ├── test_telegram_pipeline.py\n  │   ├── test_mailbox_module.py\n  │   ├── test_mailbox_integration.py\n  │   ├── test_post_mail.py\n  │   └── test_idempotent_ingestion.py\n  └── features/\n      ├── test_skills.py\n      ├── test_skills_validation.py\n      └── test_vcard.py\n\nEach subdirectory gets an empty __init__.py. Add conftest.py only where directory-scoped fixtures are needed.\n\nNote: butler-specific tool tests (general, health, relationship, switchboard) will later move to butlers/\u003cname\u003e/tests/ per butlers-vyn.3 — keep them in tests/tools/ for now.","acceptance_criteria":"1. All test files moved to appropriate subdirectories\n2. Every subdirectory has __init__.py\n3. pytest still discovers and runs all tests\n4. No import errors from moved files\n5. conftest.py fixtures still accessible from subdirectories\n6. git history preserved via git mv","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T10:48:35.816760313+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:43:54.1513566+08:00","closed_at":"2026-02-10T11:43:54.1513566+08:00","close_reason":"Merged to main. 49 test files reorganized into 10 component subdirectories.","dependencies":[{"issue_id":"butlers-ln3.2","depends_on_id":"butlers-ln3","type":"parent-child","created_at":"2026-02-10T10:48:35.818596372+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-ln3.2","depends_on_id":"butlers-ln3.1","type":"blocks","created_at":"2026-02-10T10:48:46.476263362+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-ln3.3","title":"Add Makefile targets for test subsets","description":"Add convenient Makefile targets for running test subsets. Currently only 'make test' exists (runs everything).\n\nNew targets:\n- make test-unit      — pytest -m unit -v (fast, no Docker)\n- make test-integration — pytest -m integration -v (Docker required)\n- make test           — pytest -v (unchanged, runs all)\n- make test-core      — pytest tests/core/ -v\n- make test-modules   — pytest tests/modules/ -v\n\nAlso update pyproject.toml testpaths if needed to ensure discovery works with the new directory structure.","acceptance_criteria":"1. make test-unit runs only unit-marked tests\n2. make test-integration runs only integration-marked tests\n3. make test still runs the full suite\n4. Directory-scoped targets (test-core, test-modules) work\n5. All targets documented in Makefile comments","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T10:48:39.208063633+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:45:49.849263883+08:00","closed_at":"2026-02-10T11:45:49.849263883+08:00","close_reason":"Merged to main. Added test-unit, test-integration, test-core, test-modules Makefile targets.","dependencies":[{"issue_id":"butlers-ln3.3","depends_on_id":"butlers-ln3","type":"parent-child","created_at":"2026-02-10T10:48:39.209927254+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-ln3.3","depends_on_id":"butlers-ln3.1","type":"blocks","created_at":"2026-02-10T10:48:46.537459452+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-ma8","title":"Discovered-from c7q: switchboard decomposition API mismatch","description":"During butlers-c7q verification, tests/tools/test_decomposition.py fails because classify_message_multi and dispatch_to_targets are not importable from butlers.tools.switchboard, and aggregate_responses signature now requires dispatch_fn. Restore expected APIs or align tests/callers coherently.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T23:15:25.098632461+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.175170638+08:00","closed_at":"2026-02-11T23:30:11.175170638+08:00","close_reason":"Duplicate of butlers-cjj (switchboard decomposition API mismatch).","dependencies":[{"issue_id":"butlers-ma8","depends_on_id":"butlers-c7q","type":"discovered-from","created_at":"2026-02-11T23:15:25.100897509+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-mdw","title":"Update frontend-dashboard OpenSpec change to reference LGTM stack","description":"The openspec/changes/frontend-dashboard/ directory still contains 6 Jaeger references (design.md and specs/dashboard-traces/spec.md). These need to be updated to reference LGTM stack (Grafana Tempo) instead of Jaeger, consistent with all other spec files.","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T05:17:53.779617604+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:21:09.004705684+08:00","closed_at":"2026-02-10T05:21:09.004705684+08:00","close_reason":"All Jaeger references in frontend-dashboard specs replaced with LGTM stack"}
{"id":"butlers-mvf","title":"Discovered-from c7q: mailbox integration contract drift","description":"During butlers-c7q verification, tests/integration/test_mailbox_integration.py fails broadly (post return contract, metadata serialization type expectations, read/list/update/status assertions). Module-level mailbox tests still pass, indicating integration contract mismatch between switchboard post_mail and mailbox tools.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T23:15:20.356945244+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.074441485+08:00","closed_at":"2026-02-11T23:30:11.074441485+08:00","close_reason":"Duplicate of butlers-yvr (mailbox integration contract drift).","dependencies":[{"issue_id":"butlers-mvf","depends_on_id":"butlers-c7q","type":"discovered-from","created_at":"2026-02-11T23:15:20.359218517+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-nxg","title":"Fix alembic branch name collision in relationship butler migrations","description":"Alembic fails to run migrations due to a branch name collision. The branch name 'relationship' is used in both rel_004 and rel_005 migration files. This prevents any migrations from running. The branch_labels should be removed from rel_005.","status":"in_progress","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-12T13:04:57.138739438+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T13:21:11.07430007+08:00","dependencies":[{"issue_id":"butlers-nxg","depends_on_id":"butlers-pis","type":"discovered-from","created_at":"2026-02-12T13:04:57.141396255+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-o0z","title":"Quality gate failures in notifications and decomposition test suites","description":"Running the required quality gate uv run pytest tests/ -v --ignore=tests/test_db.py --ignore=tests/test_migrations.py on branch agent/butlers-yvr currently fails with 57 tests unrelated to mailbox changes. Failures are concentrated in tests/api/test_notification_endpoints.py, tests/api/test_notifications_router.py, tests/integration/test_idempotent_ingestion.py, tests/integration/test_integration.py::TestButlerStartupIntegration::test_daemon_tool_registration_logic, and tests/tools/test_decomposition.py. This blocks achieving a fully green full-suite gate for this issue and should be triaged separately.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-12T00:08:49.542352668+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T11:45:38.458610234+08:00","closed_at":"2026-02-12T11:45:38.458610234+08:00","close_reason":"Already fixed in commits a71f7bf, dd21800, 9b09b38 — agent forgot to close","dependencies":[{"issue_id":"butlers-o0z","depends_on_id":"butlers-yvr","type":"discovered-from","created_at":"2026-02-12T00:08:49.545577581+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-pis","title":"Log every Telegram message and its full routing decision to database","description":"The switchboard should persist a full audit trail of every Telegram message it receives — from the moment it arrives through classification and routing. Currently, routing_log captures the post-routing outcome (target butler, success/failure, duration), but doesn't capture:\n\n- The raw incoming message content and sender details\n- The classification reasoning (which butlers were considered, confidence levels)\n- The full lifecycle from receipt → classification → routing decision → response\n\nThis means we can't answer questions like 'what messages came in today?', 'why was this message routed to health instead of relationship?', or 'which messages failed classification?'\n\nA new message_inbox table should capture the full lifecycle of each message as it progresses through the pipeline.","design":"Single lifecycle table message_inbox in roster/switchboard/migrations/:\n\nCREATE TABLE message_inbox (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    -- Receipt (logged immediately on Telegram poll)\n    source_channel TEXT NOT NULL,         -- 'telegram'\n    sender_id TEXT NOT NULL,              -- chat_id\n    raw_content TEXT NOT NULL,            -- full message text\n    raw_metadata JSONB DEFAULT '{}',     -- Telegram update object\n    received_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n    -- Classification (logged after classify_message)\n    classification JSONB,                 -- [{butler, prompt, confidence}]\n    classified_at TIMESTAMPTZ,\n    classification_duration_ms INTEGER,\n    -- Routing (logged after route/dispatch)\n    routing_results JSONB,               -- [{butler, success, duration_ms, error}]\n    response_summary TEXT,\n    completed_at TIMESTAMPTZ,\n    -- Trace linkage\n    trace_id TEXT,\n    session_id UUID\n);\n\nIndexes: (source_channel, received_at DESC), (sender_id, received_at DESC)\n\nTwo-phase logging pattern:\n1. INSERT on receipt — in process_update() or pipeline.process() entry, before classification\n2. UPDATE after classification + routing — in pipeline.process() exit, with classification array, routing results, and timing\n\nThe existing routing_log continues to capture individual route() calls; message_inbox captures the full lifecycle from the user's perspective.","acceptance_criteria":"1. Every Telegram message received by the polling loop is persisted to message_inbox on receipt, before any classification begins\n2. After classification, the record is updated with the classification array (target butlers, decomposed prompts) and classification timing\n3. After routing completes, the record is updated with routing results (per-butler success/failure, duration) and response summary\n4. Failed classifications and routing errors are captured in the record, not lost\n5. Messages are queryable by sender_id and time range via indexes\n6. Migration follows existing Alembic pattern in roster/switchboard/migrations/","notes":"Complements butlers-t8m.3 (structured Python logging for ephemeral observability) — this is the persistent database audit trail. Consider adding an MCP tool to query message_inbox for debugging/transparency in a follow-up.\nAwaiting review: https://github.com/Tzeusy/butlers/pull/5","status":"blocked","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","created_at":"2026-02-11T09:45:10.980085424+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T13:19:44.403837377+08:00","external_ref":"gh-pr:5","labels":["observability","pr-review","state:OPEN","switchboard","telegram"],"dependencies":[{"issue_id":"butlers-pis","depends_on_id":"butlers-t8m.2","type":"blocks","created_at":"2026-02-11T09:45:15.329247657+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-pis.1","title":"State change: state → OPEN","description":"Set state to OPEN\n\nReason: User requested to set bead to OPEN","status":"in_progress","priority":4,"issue_type":"event","created_at":"2026-02-12T12:14:51.002628288+08:00","created_by":"Tzeusy","updated_at":"2026-02-13T01:28:18.086488059+08:00","dependencies":[{"issue_id":"butlers-pis.1","depends_on_id":"butlers-pis","type":"parent-child","created_at":"2026-02-12T12:14:51.00593728+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v","title":"Add autonomous multi-butler signal extraction to Switchboard","description":"The core differentiator over Monica CRM: eliminate manual data entry by having the Switchboard autonomously extract signals from ALL incoming messages (Telegram, email) and forward structured data to the appropriate butler(s) — regardless of which butler the message was primarily routed to.\n\nToday, a message like \"Hey, just had coffee with Sarah — she mentioned she is moving to Berlin next month and her birthday is March 15\" would be classified and routed to one butler. The user would then need to manually log the interaction, add the life event, and record the birthday. Instead, the Switchboard should extract all of this and dispatch it to the relevant butler(s) in parallel with normal routing.\n\nThis is a single-pass extraction pipeline:\n1. EXTRACT: A single CC invocation analyzes every incoming message against all registered butler signal schemas (relationship signals, health signals, finance signals, etc.)\n2. DISPATCH: Group extractions by target_butler and forward as tool calls to the appropriate butler(s)\n3. DEFAULT: If no butler-specific signals are detected, the extraction is a no-op (primary routing handles everything)\n\nThe extraction is confidence-gated: high-confidence extractions are dispatched silently, low-confidence ones are queued for user confirmation.\n\nKey constraint: All intelligence lives in the CC instance (no custom NLP). The Switchboard CC prompt and a unified extraction skill guide the LLM to produce structured output.\n\nComplementary to butlers-hzx (multi-butler decomposition): hzx handles explicit multi-domain requests (user asked for things spanning butlers), this epic handles implicit signal extraction (user did not ask, but the message contains data relevant to other butlers).","acceptance_criteria":"1. Every incoming message is analyzed for relationship signals regardless of primary routing target\n2. High-confidence extractions are autonomously dispatched to Relationship butler\n3. Low-confidence extractions are queued for user confirmation\n4. Extraction covers: contacts, interactions, life events, dates, facts, sentiments\n5. No duplicate data: idempotent ingestion handles repeated mentions gracefully\n6. Extraction runs in parallel with normal message routing (no added latency for primary response)\n7. User can review extraction history and correct mistakes","notes":"This epic is the \"zero manual input\" promise that differentiates Butlers from Monica CRM. Monica requires the user to manually create contacts, log interactions, record dates, etc. Butlers should do this automatically from natural conversation.\n\nDesign pivot: originally a relationship-only second pass with a separate task (butlers-r1v.7) to generalize to health. Now a single-pass multi-butler pipeline from the start — one CC call, one unified skill, one dispatch loop parameterized by ExtractorSchema registrations. butlers-r1v.7 has been closed as subsumed.\n\nRelated epics:\n- butlers-hzx: Multi-butler decomposition (complementary — decomposes explicit requests; this epic handles implicit extraction)\n- butlers-yue: Monica parity features (provides the tools extraction dispatches to)\n- butlers-06j.35: Inter-butler routing (hard blocker — extraction needs route() to work)\n- butlers-06j.36: Module-to-pipeline wiring (hard blocker — needs messages flowing in)\n- butlers-2jx: Mailbox module (could be used for confirmation queue)","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T21:20:15.75471685+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:42:40.851652037+08:00","closed_at":"2026-02-10T01:42:40.851652037+08:00","close_reason":"All children completed: r1v.1 (extractor skill), r1v.2 (extraction pipeline), r1v.3 (confirmation queue), r1v.4 (contact resolution), r1v.5 (idempotent guards), r1v.6 (audit log), r1v.7 (subsumed)","labels":["feature","relationship","switchboard"],"dependencies":[{"issue_id":"butlers-r1v","depends_on_id":"butlers-06j.35","type":"blocks","created_at":"2026-02-09T21:21:39.644153365+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v","depends_on_id":"butlers-06j.36","type":"blocks","created_at":"2026-02-09T21:21:39.717280958+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.1","title":"Create relationship-extractor skill for Switchboard butler","description":"Create a skill at butlers/switchboard/skills/relationship-extractor/ that instructs the Switchboard's CC instance how to extract structured relationship data from any incoming message.\n\nThis skill is the intelligence layer — it teaches the LLM what to look for and how to output structured extractions. The skill should define:\n\n1. Signal taxonomy — what relationship data to look for:\n   - Contact mentions (names, possibly new contacts)\n   - Interactions (met, called, texted, emailed someone)\n   - Life events (job change, moved, graduated, married, had a baby, passed away)\n   - Important dates (birthdays, anniversaries, deadlines)\n   - Facts (preferences, allergies, interests, job titles, companies)\n   - Sentiments/emotions (how the user feels about the interaction)\n   - Gifts (mentions of wanting to give/received something)\n   - Loans (mentions of lending/borrowing money)\n\n2. Output schema — structured JSON format for each extraction type, mapping to Relationship butler tool signatures\n\n3. Confidence scoring rubric:\n   - HIGH: Explicit statements ('Sarah's birthday is March 15')\n   - MEDIUM: Strong implication ('had lunch with Tom' → interaction)\n   - LOW: Ambiguous ('might see them next week')\n\n4. Deduplication hints — how to match extracted names to existing contacts\n\nInclude reference material mapping each extraction type to the Relationship butler tool it dispatches to.","acceptance_criteria":"1. Skill exists at butlers/switchboard/skills/relationship-extractor/SKILL.md\n2. Covers all 8 signal types in the taxonomy\n3. Defines structured JSON output schema per extraction type\n4. Includes confidence scoring rubric with examples\n5. Maps each extraction to a specific Relationship butler tool\n6. References include tool signature mappings","status":"closed","priority":1,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:20:31.125668679+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:38:36.225511393+08:00","closed_at":"2026-02-09T21:38:36.225511393+08:00","close_reason":"Skill created with all 8 signal types, JSON schemas, confidence rubric, dedup hints, and tool mappings","labels":["relationship","skills","switchboard"],"dependencies":[{"issue_id":"butlers-r1v.1","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:20:31.12766851+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.2","title":"Add multi-butler extraction pipeline to Switchboard message flow","description":"Add a single-pass extraction step to the Switchboard message handling pipeline. Instead of classify_message() picking one primary target and a separate second pass for relationship signals, the pipeline should perform a single extraction pass that can output signals for ANY butler — relationship, health, finance, etc. If no butler-specific signals are detected, the message defaults to the general butler.\n\nThis runs in parallel with message routing to avoid adding latency to the user-facing response.\n\nFlow:\n1. Message arrives (Telegram/Email)\n2. classify_message() determines primary target → route() [existing]\n3. IN PARALLEL: extract_signals() analyzes message for ALL butler-relevant signals in a single CC pass\n4. Each extraction includes a target_butler field — dispatch to appropriate butler(s)\n5. Primary response returned to user immediately\n6. Extraction results logged for audit\n\nKey design change from original: this is NOT a relationship-specific second pass. A single CC invocation with a unified extractor prompt produces structured JSON covering all registered butler signal types. The extractor skill is parameterized by which butler signal schemas are active.","design":"New function: extract_signals(pool, message, dispatch_fn, extractor_schemas: list[ExtractorSchema]) -\u003e list[Extraction]. Internally:\n1. Builds a unified extraction prompt from registered extractor schemas (each butler can register what signals it cares about)\n2. Spawns CC with the unified extraction context\n3. CC returns JSON array of extractions, each with: type, confidence, tool_name, tool_args, target_butler\n4. Filter by confidence \u003e= threshold (configurable, default: HIGH only for auto-dispatch)\n5. Group extractions by target_butler, dispatch each group via route(pool, target_butler, ...)\n6. For below-threshold: queue to confirmation store (see separate task)\n7. Return all extractions for logging\n\nExtractorSchema: { butler_name: str, signal_types: list[str], tool_mappings: dict[str, str] }\n- Relationship butler registers: contacts, interactions, life_events, dates, facts, sentiments\n- Health butler registers: symptoms, medications, measurements\n- Default: if no signals match any registered schema, route to general butler\n\nIntegration point: modify the message intake handler (post butlers-06j.36) to call extract_signals() concurrently with the primary route() using asyncio.gather().\n\nThe extraction skill itself is a single unified skill (not per-butler skills) that receives the active schemas as context.","acceptance_criteria":"1. extract_relationship_signals() implemented and tested\n2. Extraction runs concurrently with primary routing (asyncio)\n3. High-confidence extractions dispatched to Relationship butler\n4. Each dispatched extraction logged in routing_log\n5. Below-threshold extractions returned but not dispatched\n6. Pipeline handles extraction failures gracefully (never blocks primary response)\n7. Tests with mocked CC responses covering multi-signal messages","notes":"Design pivot: originally this was a relationship-only second pass with a separate butlers-r1v.7 to generalize later. Now building multi-butler from the start — simpler architecture (one CC call, one skill, one dispatch loop) and avoids the N-extractor-passes scaling problem.\n\nbutlers-r1v.7 (health signal extraction) is now subsumed by this task — health signals are just another registered ExtractorSchema rather than a separate pipeline extension.","status":"closed","priority":1,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":180,"created_at":"2026-02-09T21:20:42.417166641+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:34:26.942533427+08:00","closed_at":"2026-02-10T01:34:26.942533427+08:00","close_reason":"Extraction pipeline implemented: ExtractorSchema, Extraction, extract_signals(), handle_message_with_extraction(), confidence gating, concurrent execution, 41 tests, pushed to agent/butlers-r1v.2","labels":["feature","relationship","switchboard"],"dependencies":[{"issue_id":"butlers-r1v.2","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:20:42.41898534+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.2","depends_on_id":"butlers-r1v.1","type":"blocks","created_at":"2026-02-09T21:21:39.782003158+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.2","depends_on_id":"butlers-r1v.4","type":"blocks","created_at":"2026-02-09T21:21:39.921592901+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.2","depends_on_id":"butlers-yue.5","type":"blocks","created_at":"2026-02-09T21:21:40.258693189+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.2","depends_on_id":"butlers-yue.6","type":"blocks","created_at":"2026-02-09T21:21:40.338486044+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.3","title":"Add extraction confirmation queue for low-confidence signals","description":"Low-confidence extractions from the relationship-extractor should not be silently dispatched — they need user confirmation. Add a confirmation queue where pending extractions are stored and surfaced to the user for approval or dismissal.\n\nExample: Message says 'might grab dinner with Alex sometime'. Extraction: interaction with 'Alex', confidence MEDIUM. Rather than creating an interaction record, queue it and ask the user next time they interact: 'Did you end up having dinner with Alex?'\n\nThe confirmation queue should integrate with the mailbox module (butlers-2jx) or use a lightweight per-butler pending_actions table if mailbox isn't ready yet.","design":"New table in switchboard DB: extraction_queue (id UUID, source_message TEXT, extraction_type VARCHAR, extraction_data JSONB, confidence VARCHAR, status VARCHAR DEFAULT 'pending', created_at, resolved_at, resolved_by VARCHAR). Statuses: pending, confirmed, dismissed, expired.\n\nTools: extraction_queue_list(status?, limit?) — list pending extractions. extraction_queue_resolve(id, action: confirm|dismiss) — confirm dispatches to Relationship butler, dismiss discards. extraction_queue_stats() — counts by status.\n\nAuto-expiry: extractions older than 7 days auto-expire (configurable).\n\nThe Switchboard's tick handler (called by Heartbeat every 10min) should surface pending extractions count so the CC instance can proactively ask the user about them.","acceptance_criteria":"1. extraction_queue table created via migration\n2. Low/medium confidence extractions stored in queue\n3. Tools: extraction_queue_list, extraction_queue_resolve, extraction_queue_stats\n4. Confirming an extraction dispatches it to Relationship butler\n5. Dismissing discards without dispatch\n6. Auto-expiry after configurable TTL\n7. Tests cover queue lifecycle, confirm dispatch, dismiss, expiry","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:20:53.599554679+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:42:06.361171747+08:00","closed_at":"2026-02-10T01:42:06.361171747+08:00","close_reason":"Confirmation queue implemented: migration, 7 queue tools (add/list/resolve/stats/expire/get/pending_count), 30 tests, pushed to agent/butlers-r1v.3","labels":["database","feature","switchboard"],"dependencies":[{"issue_id":"butlers-r1v.3","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:20:53.601354321+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.3","depends_on_id":"butlers-r1v.2","type":"blocks","created_at":"2026-02-09T21:21:40.039995496+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.4","title":"Add contact name resolution for extracted mentions","description":"When the extraction pipeline identifies a contact mention (e.g., 'had coffee with Sarah'), it needs to resolve 'Sarah' to an existing contact ID in the Relationship butler, or flag it as a potential new contact.\n\nThis is critical for avoiding duplicate contacts and ensuring extracted data lands on the correct record. The resolver should:\n- Query existing contacts by name (fuzzy match)\n- Use context clues from the message to disambiguate (e.g., 'Sarah from work' vs 'my sister Sarah')\n- If no match: suggest creating a new contact (queue for confirmation)\n- If ambiguous: queue for user disambiguation\n- If confident match: use the contact_id in extraction dispatch\n\nThis tool lives on the Relationship butler side (it has the contact data) but is called by the Switchboard during extraction dispatch.","design":"New tool on Relationship butler: contact_resolve(name, context?) -\u003e {contact_id, confidence, candidates[]}.\n\nResolution strategy:\n1. Exact name match (case-insensitive) → HIGH confidence, return contact_id\n2. Partial/fuzzy match (first name only, nickname) → MEDIUM confidence, return candidates\n3. No match → return {contact_id: null, candidates: []}\n\nThe context param (optional freetext) is passed to a lightweight CC call that picks the best candidate from the list using relationship types, recent interactions, and facts as disambiguation signals.\n\nThe extraction pipeline uses this before dispatching: resolve contact → if HIGH, attach contact_id → if MEDIUM/none, queue for confirmation with candidates.","acceptance_criteria":"1. contact_resolve tool implemented on Relationship butler\n2. Exact match returns single result with HIGH confidence\n3. Partial match returns ranked candidates with MEDIUM confidence\n4. No match returns null contact_id\n5. Context parameter improves disambiguation accuracy\n6. Tests cover exact, partial, ambiguous, and no-match scenarios","status":"closed","priority":1,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:21:05.192427918+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:47:59.439830808+08:00","closed_at":"2026-02-09T21:47:59.439830808+08:00","close_reason":"Completed and pushed to agent branches","labels":["feature","relationship","switchboard"],"dependencies":[{"issue_id":"butlers-r1v.4","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:21:05.196140307+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.5","title":"Add idempotent ingestion guards to Relationship butler tools","description":"With autonomous extraction, the same data may be extracted multiple times (e.g., user mentions 'Sarah's birthday is March 15' in two separate messages). The Relationship butler's tools need idempotency guards to prevent duplicate records.\n\nCurrently tools blindly INSERT. They need to detect near-duplicates and either skip or merge.\n\nDedup logic per tool:\n- interaction_log: Skip if identical contact + type + date (within same day)\n- date_add: Skip if contact already has a date with same label + month + day\n- fact_set: Already idempotent (upsert on contact_id + key)\n- note_create: Skip if identical contact + content hash (within 1 hour window)\n- life_event_log: Skip if identical contact + type + date (within same day)\n- gift_add: No dedup (gifts are inherently unique)\n- loan_create: No dedup (loans are inherently unique)","acceptance_criteria":"1. interaction_log skips duplicate contact+type+date combinations\n2. date_add skips duplicate contact+label+month+day combinations\n3. note_create skips duplicate contact+content within 1 hour\n4. life_event_log skips duplicate contact+type+date combinations\n5. Dedup returns success with a 'skipped: duplicate' flag (not an error)\n6. Tests cover dedup for each tool with duplicate inputs","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:21:13.440810897+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:48:45.652283778+08:00","closed_at":"2026-02-10T00:48:45.652283778+08:00","close_reason":"Idempotent guards added to interaction_log, date_add, note_create, life_event_log with skip-duplicate responses","labels":["feature","relationship"],"dependencies":[{"issue_id":"butlers-r1v.5","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:21:13.443575074+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.6","title":"Add extraction audit log for transparency and correction","description":"Users need visibility into what data the extraction pipeline has autonomously created. Add an audit log tracking every extraction-originated write to the Relationship butler, with tools to review and undo.\n\nThis builds trust: users can see what was auto-extracted, verify accuracy, and correct mistakes. Without this, silent autonomous writes would feel opaque and untrustworthy.\n\nThe audit log should be queryable by time range, extraction type, contact, and source message.","design":"New table in switchboard DB: extraction_log (id UUID, source_message_preview TEXT(200), extraction_type VARCHAR, tool_name VARCHAR, tool_args JSONB, target_contact_id UUID, confidence VARCHAR, dispatched_at TIMESTAMPTZ, source_channel VARCHAR).\n\nTools: extraction_log_list(contact_id?, type?, since?, limit?) — review what was extracted. extraction_log_undo(id) — reverse an extraction by calling the appropriate delete/remove tool on the Relationship butler (best-effort).\n\nThe extraction pipeline (task .2) writes to this log on every successful dispatch.","acceptance_criteria":"1. extraction_log table created via migration\n2. Every auto-dispatched extraction logged with full context\n3. Tools: extraction_log_list, extraction_log_undo\n4. List supports filtering by contact, type, time range\n5. Undo reverses the original tool call on Relationship butler\n6. Tests cover logging, listing, filtering, and undo","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:21:21.331401083+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:41:40.585157146+08:00","closed_at":"2026-02-10T01:41:40.585157146+08:00","close_reason":"Extraction audit log implemented: migration, log_extraction/extraction_log_list/extraction_log_undo tools, 19 tests, pushed to agent/butlers-r1v.6","labels":["database","feature","switchboard"],"dependencies":[{"issue_id":"butlers-r1v.6","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:21:21.334876334+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.6","depends_on_id":"butlers-r1v.2","type":"blocks","created_at":"2026-02-09T21:21:40.120605205+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-r1v.7","title":"Add health signal extraction for cross-butler forwarding","description":"Extend the extraction pipeline pattern beyond relationships to also capture health signals. A message like 'feeling a headache coming on, took 200mg ibuprofen' should extract a symptom log and medication dose for the Health butler.\n\nThis uses the same extraction pipeline architecture but with a separate health-extractor skill for the Switchboard.\n\nLower priority than relationship extraction — start with relationship signals, generalize the pattern to health later.\n\nNon-goals: Full health-extractor skill creation (separate bead under butlers-bjr).","design":"Generalize extract_relationship_signals() into extract_signals(pool, message, extractors: list[str]) where each extractor is a skill name. The relationship-extractor and health-extractor skills both produce the same JSON schema (type, confidence, tool_name, tool_args, target_butler). The dispatch loop routes based on target_butler field.","acceptance_criteria":"1. Extraction pipeline generalized to support multiple extractor skills\n2. Health signals (symptoms, medications, measurements) extracted and routed\n3. Same confidence gating and confirmation queue applies\n4. Tests cover health extraction with mocked CC responses","status":"closed","priority":3,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:21:30.661284577+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:06:10.608293615+08:00","closed_at":"2026-02-10T00:06:10.608293615+08:00","close_reason":"Subsumed by redesigned butlers-r1v.2 — the extraction pipeline is now multi-butler from the start with ExtractorSchema registration, so health signals are just another registered schema rather than a separate generalization step.","labels":["feature","health","switchboard"],"dependencies":[{"issue_id":"butlers-r1v.7","depends_on_id":"butlers-r1v","type":"parent-child","created_at":"2026-02-09T21:21:30.662924588+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-r1v.7","depends_on_id":"butlers-r1v.2","type":"blocks","created_at":"2026-02-09T21:21:40.189755608+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-sle","title":"butlers-06j.10","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T22:15:53.180566517+08:00","updated_at":"2026-02-10T00:49:54.023568508+08:00","closed_at":"2026-02-10T00:49:54.023568508+08:00","close_reason":"Stale/duplicate issue — likely created in error by worker for butlers-06j.10 which is already closed"}
{"id":"butlers-sr5","title":"Refactor memory butler tools.py into tools/ directory","description":"Split roster/memory/tools.py (491 lines) into a tools/ directory following the pattern established in butlers-30g. Create tools/__init__.py that re-exports all tools for backward compatibility. Group tool functions into logical category files. The dynamic tools loader already supports both tools.py and tools/__init__.py. This is the largest remaining monolithic tools file.","notes":"Follow the same structure as roster/health/tools/ and roster/relationship/tools/ from butlers-30g. Highest priority of the three since it's the largest file.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-11T03:48:31.76630908+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T03:52:49.203039544+08:00","closed_at":"2026-02-11T03:52:49.203039544+08:00","close_reason":"Refactored and pushed to agent branches"}
{"id":"butlers-t8m","title":"Fix broken Telegram-to-butler message pipeline","description":"The Telegram message pipeline is broken end-to-end: messages are polled from Telegram but never classified or routed to specialist butlers. Three issues form a broken chain: (1) butlers.tools.switchboard module doesn't exist — pipeline.process() hits ImportError, (2) set_pipeline() is never called in daemon startup — even if imports worked, pipeline is None so process_update() silently skips, (3) happy-path logging is invisible — poll activity is DEBUG while app runs at INFO, no structured fields. Previously tracked as butlers-06j.36 which was closed prematurely.","acceptance_criteria":"1. Telegram messages are classified and routed to the correct specialist butler end-to-end\n2. Pipeline errors are logged with structured context (chat_id, target, latency)\n3. Happy-path activity is visible at INFO level","status":"closed","priority":1,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-11T09:36:52.227289646+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:31:47.622660937+08:00","closed_at":"2026-02-11T23:31:47.622660937+08:00","close_reason":"All child issues (t8m.1/t8m.2/t8m.3) implemented and merged to main.","labels":["modules","switchboard","telegram"],"dependencies":[{"issue_id":"butlers-t8m","depends_on_id":"butlers-06j.36","type":"discovered-from","created_at":"2026-02-11T09:36:52.230957119+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-t8m.1","title":"Create butlers.tools.switchboard module with classify_message and route","description":"pipeline.py:90 and extraction.py:465 do 'from butlers.tools.switchboard import classify_message, route' but src/butlers/tools/switchboard.py does not exist. Every call to pipeline.process() hits ImportError, caught by the except block at pipeline.py:98, which silently falls back to the general butler with a classification_error. The extraction.py handle_message_with_extraction() has the same broken import.\n\nclassify_message() should spawn an ephemeral CC instance with the Switchboard CLAUDE.md system prompt to classify which butler handles the message. route() should forward the classified message to the target butler's MCP endpoint via the Switchboard's inter-butler connection pool.","design":"classify_message(pool, message_text, dispatch_fn) -\u003e list[dict]: Spawns CC via dispatch_fn with the switchboard CLAUDE.md. CC returns JSON array of {butler, prompt} routing decisions. route(pool, target_butler, tool_name, tool_args, source_butler) -\u003e dict: Looks up target butler's MCP URL from butler_registry table, opens MCP client, calls tool_name with tool_args, returns result.","acceptance_criteria":"1. butlers.tools.switchboard module exists with classify_message() and route() functions\n2. classify_message() spawns CC with switchboard system prompt and returns target butler name(s)\n3. route() forwards message to target butler via MCP tool call\n4. pipeline.process() no longer hits ImportError\n5. extraction.py handle_message_with_extraction() import resolves","notes":"The Switchboard CLAUDE.md in roster/switchboard/CLAUDE.md already has classification rules and message decomposition examples. The routing should use the same MCP client pattern as daemon._connect_switchboard().","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":180,"created_at":"2026-02-11T09:37:07.856627414+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T10:44:51.918867491+08:00","closed_at":"2026-02-11T10:44:51.918867491+08:00","close_reason":"Completed","labels":["backend","switchboard"],"dependencies":[{"issue_id":"butlers-t8m.1","depends_on_id":"butlers-t8m","type":"parent-child","created_at":"2026-02-11T09:37:07.858300492+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-t8m.2","title":"Wire MessagePipeline to Telegram and Email modules in daemon startup","description":"TelegramModule.set_pipeline() and EmailModule.set_pipeline() are never called during ButlerDaemon.start(). The pipeline attribute stays None, so TelegramModule.process_update() returns None at line 147 without classifying or routing. Messages are polled and buffered in _updates_buffer but never processed.\n\nThe daemon startup (daemon.py) needs to construct a MessagePipeline after the spawner is created (step 9) and call set_pipeline() on Telegram/Email modules. This should only happen for the switchboard butler since it owns the classification pipeline.","design":"Add a _wire_pipelines() method to ButlerDaemon, called after spawner creation (step 9). Only runs for butler.name == 'switchboard'. Constructs MessagePipeline(pool, spawner.trigger, 'switchboard') and calls mod.set_pipeline(pipeline) for each module that has a set_pipeline method.","acceptance_criteria":"1. Switchboard butler's Telegram module has a MessagePipeline attached after startup\n2. Switchboard butler's Email module has a MessagePipeline attached after startup\n3. Non-switchboard butlers do NOT get pipelines (they don't classify)\n4. Polled Telegram messages are forwarded through classify then route\n5. Pipeline construction uses the daemon's spawner.trigger as dispatch_fn","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-11T09:37:19.06047499+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T10:58:32.264740672+08:00","closed_at":"2026-02-11T10:58:32.264740672+08:00","close_reason":"Completed","labels":["core","modules","switchboard"],"dependencies":[{"issue_id":"butlers-t8m.2","depends_on_id":"butlers-t8m","type":"parent-child","created_at":"2026-02-11T09:37:19.06206429+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-t8m.2","depends_on_id":"butlers-t8m.1","type":"blocks","created_at":"2026-02-11T09:37:39.564888981+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-t8m.3","title":"Add observability logging to message classification pipeline","description":"The happy path through the Telegram polling -\u003e classification -\u003e routing flow has almost no visible logging:\n\n- telegram.py:231 polls at DEBUG level (app runs at INFO) — invisible\n- telegram.py process_update() silently returns None when pipeline is None\n- pipeline.py process() has no entry/exit logging on success\n- No structured fields: chat_id, message length, target butler, classification latency, routing latency\n\nThe only INFO log is telegram.py:164 after successful routing, but it lacks structured context. Error paths log via logger.exception which is good, but the silent-skip and invisible-poll patterns make debugging impossible.","acceptance_criteria":"1. Poll activity logged at INFO with update count (not just DEBUG)\n2. process_update() logs a warning when pipeline is None (not silent skip)\n3. pipeline.process() logs entry with message preview and exit with target butler and latency\n4. All pipeline logs include structured fields: chat_id, source (telegram/email), target_butler, latency_ms\n5. Classification fallback to general butler logs at WARNING with the error reason","notes":"Consider using OpenTelemetry spans instead of or in addition to logging, since the project already has telemetry infrastructure (core/telemetry.py, _SpanWrappingMCP). The poll count log could stay at DEBUG to avoid noise if poll_interval is very short.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-11T09:37:34.58082664+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:17:57.207507644+08:00","closed_at":"2026-02-11T23:17:57.207507644+08:00","close_reason":"Implemented and pushed in agent/butlers-t8m.3 (commit edfd286).","labels":["modules","observability","switchboard"],"dependencies":[{"issue_id":"butlers-t8m.3","depends_on_id":"butlers-t8m","type":"parent-child","created_at":"2026-02-11T09:37:34.582462197+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-t8m.3","depends_on_id":"butlers-t8m.2","type":"blocks","created_at":"2026-02-11T09:37:39.622216748+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-t9a","title":"Mailbox integration contract drift (metadata encoding and route behavior)","description":"Full pytest gate shows broad failures in tests/integration/test_mailbox_integration.py including mailbox CRUD expectations and post_mail argument expectations (notably metadata format mismatch). tests/integration/test_post_mail.py still passes, suggesting contract drift between integration fixtures and current implementation rather than switchboard import bug. Nontrivial and out-of-scope for butlers-t8m.1.","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:42:51.226325264+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.125223381+08:00","closed_at":"2026-02-11T23:30:11.125223381+08:00","close_reason":"Duplicate of butlers-yvr (mailbox integration contract drift).","dependencies":[{"issue_id":"butlers-t9a","depends_on_id":"butlers-t8m.1","type":"discovered-from","created_at":"2026-02-11T10:42:51.229119711+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-tjz","title":"Migration chain metadata tests failing for core/memory/switchboard revisions","description":"Full pytest gate (2026-02-11) fails migration metadata tests: tests/config/test_migrations.py::test_alembic_version_tracking, tests/config/test_switchboard_notifications_migration_unit.py (missing/invalid notification migration metadata), and tests/daemon/test_memory_chain_registration.py (revision links/linearity failures). Verify migration files and revision graph consistency across core/memory/switchboard chains.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T23:13:12.591748446+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.526127462+08:00","closed_at":"2026-02-11T23:30:11.526127462+08:00","close_reason":"Duplicate of butlers-c7q (migration-chain consistency regressions).","dependencies":[{"issue_id":"butlers-tjz","depends_on_id":"butlers-4xh","type":"discovered-from","created_at":"2026-02-11T23:13:12.594641488+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-tx5","title":"Replace Jaeger with LGTM stack for observability","description":"Replace the Jaeger all-in-one container with the homelab LGTM stack (Alloy as OTLP gateway, Tempo for traces, Loki for logs, Grafana for dashboards). Butlers already use OpenTelemetry SDK with OTLP export — the change is purely at the infrastructure and documentation level. The OTLP endpoint changes from jaeger:4317 to the Alloy gateway. Local dev can either run the LGTM stack via docker-compose or point at the Tailnet Alloy endpoint.","design":"Remove the jaeger service from docker-compose.yml. For local dev, the OTLP endpoint should point to the Alloy gateway (http://otel.parrot-hen.ts.net:4318 via Tailnet, or an in-cluster Alloy if running in k8s). The OTel SDK setup in Python code does not change — only the OTEL_EXPORTER_OTLP_ENDPOINT env var target changes. Trace visualization moves from Jaeger UI (:16686) to Grafana Tempo (via Grafana Explore). Structured JSON logs with traceId/spanId enable cross-signal correlation in Grafana.","acceptance_criteria":"1. No references to Jaeger remain in codebase\n2. docker-compose.yml uses LGTM-compatible OTLP endpoint\n3. All specs updated to reference Tempo/Grafana instead of Jaeger\n4. README quickstart and architecture diagram updated\n5. Existing OTel instrumentation code unchanged (only env var target changes)","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T04:58:53.927647463+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:59.439115143+08:00","closed_at":"2026-02-10T05:17:59.439115143+08:00","close_reason":"All 6 child tasks completed: Jaeger references replaced with LGTM stack in docker-compose.yml, all v1-mvp-spec OpenSpec files, README.md, and project plan docs. Discovered one remaining area (frontend-dashboard specs) tracked as butlers-mdw.","labels":["infra","telemetry"]}
{"id":"butlers-tx5.1","title":"Replace Jaeger service with LGTM endpoints in docker-compose.yml","description":"Remove the jaeger service definition and replace all OTEL_EXPORTER_OTLP_ENDPOINT=http://jaeger:4317 env vars across the 5 butler services. For local dev, point to the Alloy OTLP gateway at http://otel.parrot-hen.ts.net:4318 (Tailnet). Update header comments to reference Grafana instead of Jaeger UI. Remove port 16686 and 4317 from the compose file since Alloy is external.\n\nAffected lines: service definition (42-49), env vars on switchboard (67), general (88), relationship (109), health (130), heartbeat (151), header comments (6, 20, 22).","acceptance_criteria":"1. No jaeger service in docker-compose.yml\n2. All butler services use OTEL_EXPORTER_OTLP_ENDPOINT pointing to Alloy\n3. Header comments reference Grafana/Tempo, not Jaeger\n4. docker compose config validates without errors","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T04:59:02.895302353+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:36.363504254+08:00","closed_at":"2026-02-10T05:17:36.363504254+08:00","close_reason":"Jaeger references replaced with LGTM stack across all files","labels":["infra","telemetry"],"dependencies":[{"issue_id":"butlers-tx5.1","depends_on_id":"butlers-tx5","type":"parent-child","created_at":"2026-02-10T04:59:02.896713239+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-tx5.2","title":"Update telemetry spec to reference LGTM stack instead of Jaeger","description":"Update openspec/changes/v1-mvp-spec/specs/telemetry/spec.md to replace all Jaeger references with the LGTM stack. The 'Local dev Jaeger setup' requirement section (lines 376-391) should become 'LGTM stack integration' describing Alloy as the OTLP gateway and Tempo/Grafana for trace visualization. Update the infrastructure context at line 11 and 33-36.\n\nKey changes:\n- Replace 'Jaeger all-in-one for local dev visualization' with 'LGTM stack (Alloy gateway, Tempo for traces, Grafana for visualization)'\n- Replace jaegertracing/all-in-one:1.62 image reference with Alloy OTLP endpoint\n- Replace 'Jaeger UI on port 16686' with 'Grafana Explore with Tempo datasource'\n- Update scenarios: 'Jaeger container runs with correct configuration' → 'OTLP gateway accepts telemetry'\n- Update scenarios: 'Butler spans appear in Jaeger' → 'Butler spans appear in Grafana Tempo'","acceptance_criteria":"1. No Jaeger references remain in telemetry spec\n2. LGTM components (Alloy, Tempo, Grafana) correctly described\n3. Scenario GIVEN/WHEN/THEN structure preserved\n4. OTLP endpoint references use Alloy gateway address","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T04:59:10.739030771+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:36.373092244+08:00","closed_at":"2026-02-10T05:17:36.373092244+08:00","close_reason":"Jaeger references replaced with LGTM stack across all files","labels":["docs","telemetry"],"dependencies":[{"issue_id":"butlers-tx5.2","depends_on_id":"butlers-tx5","type":"parent-child","created_at":"2026-02-10T04:59:10.74048578+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-tx5.3","title":"Update cli-and-deployment spec to reference LGTM stack","description":"Update openspec/changes/v1-mvp-spec/specs/cli-and-deployment/spec.md to replace Jaeger references. Affected areas:\n- Line 282: docker-compose service list should remove Jaeger\n- Line 288: Remove jaegertracing/all-in-one:1.62 image requirement\n- Lines 303-304, 319: Dev mode command 'docker compose up -d postgres jaeger' → 'docker compose up -d postgres'\n- Line 327: Remove jaeger from 'all services' list\n- OTLP endpoint in service definitions should reference Alloy gateway","acceptance_criteria":"1. No Jaeger references in cli-and-deployment spec\n2. Dev quickstart command updated\n3. docker-compose service requirements reflect external LGTM stack","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":20,"created_at":"2026-02-10T04:59:15.369410562+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:36.376665767+08:00","closed_at":"2026-02-10T05:17:36.376665767+08:00","close_reason":"Jaeger references replaced with LGTM stack across all files","labels":["docs","telemetry"],"dependencies":[{"issue_id":"butlers-tx5.3","depends_on_id":"butlers-tx5","type":"parent-child","created_at":"2026-02-10T04:59:15.371386416+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-tx5.4","title":"Update switchboard and design specs to reference Tempo instead of Jaeger","description":"Update remaining OpenSpec files that reference Jaeger:\n\n1. openspec/changes/v1-mvp-spec/specs/switchboard/spec.md:\n   - Line 352: Change 'traces in Jaeger' → 'traces in the telemetry backend (Grafana Tempo)'\n   - Line 362: Change 'trace in the telemetry backend (e.g., Jaeger)' → 'trace in the telemetry backend (Grafana Tempo)'\n\n2. openspec/changes/v1-mvp-spec/design.md:\n   - Line 90: Change 'D10: OpenTelemetry with Jaeger for local development' → 'D10: OpenTelemetry with LGTM stack'\n   - Lines 92-94: Update rationale to reference Alloy/Tempo/Grafana instead of Jaeger all-in-one\n\n3. openspec/changes/v1-mvp-spec/proposal.md:\n   - Line 15: Change 'Jaeger integration' → 'LGTM stack integration'\n   - Line 35: Remove Jaeger from docker-compose reference\n   - Line 36: Change 'Jaeger export' → 'OTLP export to LGTM stack'\n   - Line 48: Change 'Jaeger' → 'LGTM stack (Grafana, Tempo, Loki)'\n\n4. openspec/changes/v1-mvp-spec/tasks.md:\n   - Line 162: Remove jaeger from docker-compose service list\n   - Line 163: Update dev quickstart command","acceptance_criteria":"1. No Jaeger references remain in any OpenSpec files\n2. All references consistently use LGTM/Tempo/Grafana terminology","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T04:59:22.401925876+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:36.380385396+08:00","closed_at":"2026-02-10T05:17:36.380385396+08:00","close_reason":"Jaeger references replaced with LGTM stack across all files","labels":["docs","telemetry"],"dependencies":[{"issue_id":"butlers-tx5.4","depends_on_id":"butlers-tx5","type":"parent-child","created_at":"2026-02-10T04:59:22.408824181+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-tx5.5","title":"Update README.md to reference LGTM stack instead of Jaeger","description":"Update README.md to replace all Jaeger references:\n- Line 162: Mermaid diagram — change 'Jaeger :16686' → 'Grafana (Tempo/Loki)'\n- Line 165: Change 'OTLP gRPC :4317 → Jaeger' → 'OTLP HTTP :4318 → Alloy (LGTM)'\n- Lines 203-204: Dev quickstart — change 'docker compose up -d postgres jaeger' → 'docker compose up -d postgres'\n- Line 221: Change 'Jaeger tracing UI at http://localhost:16686' → reference to Grafana Tempo\n- Lines 254-255: Port table — remove Jaeger UI (16686) and Jaeger OTLP (4317) rows, add note about external Alloy OTLP endpoint\n- Line 294: Update OTEL_EXPORTER_OTLP_ENDPOINT documentation to reference Alloy","acceptance_criteria":"1. No Jaeger references in README\n2. Architecture diagram shows LGTM stack\n3. Quickstart commands work without jaeger service\n4. Port table accurate","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T04:59:27.760091944+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:36.384325763+08:00","closed_at":"2026-02-10T05:17:36.384325763+08:00","close_reason":"Jaeger references replaced with LGTM stack across all files","labels":["docs","telemetry"],"dependencies":[{"issue_id":"butlers-tx5.5","depends_on_id":"butlers-tx5","type":"parent-child","created_at":"2026-02-10T04:59:27.762132029+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-tx5.6","title":"Update PROJECT_PLAN.md and memory files to reference LGTM stack","description":"Update remaining project docs that reference Jaeger:\n\n1. PROJECT_PLAN.md (~16 mentions):\n   - Docker-compose examples: replace jaeger service definition and OTLP endpoint references\n   - Line 1202: Update companion services description\n   - Line 1347: Update dev mode command\n   - Lines 1365, 1395: Update milestone descriptions\n\n2. .genai/memory.md:\n   - Line 37: Change 'OTel + Jaeger for tracing' → 'OTel + LGTM stack (Alloy/Tempo/Grafana) for observability'\n\n3. FRONTEND_PROJECT_PLAN.md (2 mentions):\n   - Line 324, 1019: Update trace viewer references (these mention replacing Jaeger with inline viewer — update context to LGTM/Tempo)","acceptance_criteria":"1. No Jaeger references in PROJECT_PLAN.md\n2. No Jaeger references in .genai/memory.md\n3. FRONTEND_PROJECT_PLAN.md updated","status":"closed","priority":3,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":30,"created_at":"2026-02-10T04:59:33.573059024+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T05:17:36.388669823+08:00","closed_at":"2026-02-10T05:17:36.388669823+08:00","close_reason":"Jaeger references replaced with LGTM stack across all files","labels":["docs","telemetry"],"dependencies":[{"issue_id":"butlers-tx5.6","depends_on_id":"butlers-tx5","type":"parent-child","created_at":"2026-02-10T04:59:33.574652055+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-uu0","title":"Notifications API routes redirect due to trailing slash mismatch","description":"Full quality gate pytest run shows 40+ failures in tests/api/test_notification_endpoints.py and tests/api/test_notifications_router.py. Failures are dominated by 307 redirects for requests to /api/notifications/ where tests expect direct 200/422, indicating router/path mismatch and query assertions not executed. This is out of scope for butlers-t8m.1 but nontrivial and blocks full test gate. Investigate route declaration / include_router prefix + trailing slash behavior and align tests or route configuration.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:42:39.014267465+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T10:56:55.524649041+08:00","closed_at":"2026-02-11T10:56:55.524649041+08:00","close_reason":"Completed","dependencies":[{"issue_id":"butlers-uu0","depends_on_id":"butlers-t8m.1","type":"discovered-from","created_at":"2026-02-11T10:42:39.016593629+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-v96","title":"Wire DatabaseManager into API lifespan and router dependencies","description":"## What\n\nThe dashboard API raises `RuntimeError: DatabaseManager not initialized` on any endpoint that queries a butler's PostgreSQL database. All 14 DB-dependent routers define a local `_get_db_manager()` stub that raises this error, but nothing in the app startup creates a `DatabaseManager` instance or overrides these stubs.\n\n## Why\n\nEvery database-backed endpoint is broken in production: sessions, notifications, memory, health, state, schedules, traces, timeline, search, audit, general, switchboard views, butlers, and relationship. The API can serve only MCP-proxied and static endpoints.\n\n## Context\n\n- `butlers-kie` fixed the analogous issue for `MCPClientManager` by adding `init_dependencies()` to the lifespan — but `init_dependencies()` never creates a `DatabaseManager`.\n- `DatabaseManager` class exists at `src/butlers/api/db.py` and is fully implemented (pool management, `fan_out()`, `add_butler()`).\n- Tests work because they inject mock `DatabaseManager` via `app.dependency_overrides[_get_db_manager]`.\n- The gap: no production code instantiates `DatabaseManager`, adds butler DB pools, or wires it as a FastAPI dependency.\n\n## Affected files\n\n- `src/butlers/api/deps.py` — needs `DatabaseManager` singleton + `get_db_manager()` dependency\n- `src/butlers/api/app.py` — lifespan must init/shutdown the DB manager\n- 14 routers in `src/butlers/api/routers/` — each has a local `_get_db_manager` stub that should be replaced with the centralized dependency from `deps.py`\n\n## Steps to reproduce\n\n1. Start the dashboard API: `uvicorn butlers.api.app:create_app`\n2. Hit any DB-backed route (e.g. `GET /api/sessions`)\n3. `RuntimeError: DatabaseManager not initialized` is raised","design":"Follow the established pattern from `MCPClientManager`:\n\n1. **deps.py**: Add `_db_manager: DatabaseManager | None = None` singleton. In `init_dependencies()`, create `DatabaseManager(host, port, user, password)` from env/config, call `await db_manager.add_butler(name, db_name)` for each discovered butler, store in `_db_manager`. Add `get_db_manager()` function that returns the singleton or raises RuntimeError.\n\n2. **app.py lifespan**: Wire the new async init (pool creation is async via asyncpg). Call `await db_manager.close()` in shutdown.\n\n3. **Routers**: Replace all 14 local `_get_db_manager` stubs with `from butlers.api.deps import get_db_manager` and use `Depends(get_db_manager)`. The import-based approach matches how `get_mcp_manager` is used in routers that need MCP access.\n\nNote: `init_dependencies()` is currently sync but `DatabaseManager.add_butler()` likely needs async (asyncpg pool creation). May need to split into sync init + async pool warmup in lifespan, or make `init_dependencies()` async.","acceptance_criteria":"1. `init_dependencies()` creates a `DatabaseManager`, adds a pool for each discovered butler, and exposes it via `get_db_manager()`\n2. Lifespan handler calls DB manager startup (pool creation) and shutdown (pool close)\n3. All 14 routers use the centralized `get_db_manager` from deps.py instead of local stubs\n4. `GET /api/sessions` and `GET /api/butlers/{name}/sessions` return data without RuntimeError\n5. Existing tests continue to pass (mock injection pattern remains valid)","notes":"- The DB connection params (host, port, user, password) should come from the same config source used by butler daemons (likely env vars or butlers config).\n- Each butler's DB name convention: check `docker-compose.yml` and butler config for the naming pattern.\n- The previous fix (butlers-kie) is a good template for the wiring pattern.\n- 14 affected routers: sessions, notifications, memory, health, state, schedules, traces, timeline, search, audit, general, switchboard_views, butlers, relationship.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:11:20.466862938+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T10:37:20.137383264+08:00","closed_at":"2026-02-11T10:37:20.137383264+08:00","close_reason":"Completed"}
{"id":"butlers-vei","title":"Fix dashboard quality gate lint/format drift","description":"Running the mandated quality gates uncovered repository-wide lint/format drift unrelated to butlers-9du. I001 [*] Import block is un-sorted or un-formatted\n  --\u003e roster/memory/tools/__init__.py:7:1\n   |\n 5 |   \"\"\"\n 6 |\n 7 | / from butlers.tools.memory._helpers import (\n 8 | |     EmbeddingEngine,\n 9 | |     _serialize_row,\n10 | |     _storage,\n11 | |     _search,\n12 | |     get_embedding_engine,\n13 | | )\n14 | | from butlers.tools.memory.context import memory_context\n15 | | from butlers.tools.memory.feedback import (\n16 | |     memory_confirm,\n17 | |     memory_mark_harmful,\n18 | |     memory_mark_helpful,\n19 | | )\n20 | | from butlers.tools.memory.management import memory_forget, memory_stats\n21 | | from butlers.tools.memory.reading import memory_get, memory_recall, memory_search\n22 | | from butlers.tools.memory.writing import (\n23 | |     memory_store_episode,\n24 | |     memory_store_fact,\n25 | |     memory_store_rule,\n26 | | )\n   | |_^\n27 |\n28 |   __all__ = [\n   |\nhelp: Organize imports\n\nE501 Line too long (102 \u003e 100)\n   --\u003e src/butlers/daemon.py:530:101\n    |\n528 |             fields = {\n529 |                 k: v\n530 |                 for k, v in {\"name\": name, \"cron\": cron, \"prompt\": prompt, \"enabled\": enabled}.items()\n    |                                                                                                     ^^\n531 |                 if v is not None\n532 |             }\n    |\n\nE501 Line too long (107 \u003e 100)\n   --\u003e src/butlers/modules/approvals/module.py:115:101\n    |\n113 |     async def register_tools(self, mcp: Any, config: Any, db: Any) -\u003e None:\n114 |         \"\"\"Register all 13 approval MCP tools (7 queue + 6 rules CRUD).\"\"\"\n115 |         self._config = config if isinstance(config, ApprovalsConfig) else ApprovalsConfig(**(config or {}))\n    |                                                                                                     ^^^^^^^\n116 |         self._db = db\n117 |         module = self  # capture for closures\n    |\n\nE501 Line too long (107 \u003e 100)\n   --\u003e src/butlers/modules/approvals/module.py:223:101\n    |\n221 |     async def on_startup(self, config: Any, db: Any) -\u003e None:\n222 |         \"\"\"Initialize config and store db reference.\"\"\"\n223 |         self._config = config if isinstance(config, ApprovalsConfig) else ApprovalsConfig(**(config or {}))\n    |                                                                                                     ^^^^^^^\n224 |         self._db = db\n    |\n\nFound 4 errors.\n[*] 1 fixable with the `--fix` option. fails on import sorting/line length (e.g. roster/memory/tools/__init__.py, src/butlers/daemon.py, src/butlers/modules/approvals/module.py), and  reports 33 files needing reformat. This prevents clean gate passes for worker branches and should be resolved in a dedicated cleanup change.","status":"closed","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-12T00:01:12.828865139+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T11:45:38.518089829+08:00","closed_at":"2026-02-12T11:45:38.518089829+08:00","close_reason":"Already fixed in commits a71f7bf, dd21800, 9b09b38 — agent forgot to close","dependencies":[{"issue_id":"butlers-vei","depends_on_id":"butlers-9du","type":"discovered-from","created_at":"2026-02-12T00:01:12.832784344+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-vev","title":"Add API lifespan wiring regression test","description":"Salvage remaining value from stale branch agent/butlers-kie-20260211-094816 by adding a modernized lifespan unit test against current app startup/shutdown wiring (dependencies + DB manager lifecycle).","notes":"Coordinator: PR #4 opened from agent/butlers-vev for review.\nOutstanding work in agent/butlers-vev: startup MessagePipeline wiring for switchboard modules is active, but MessagePipeline.process() currently forwards classify_message() output directly into route(... target_butler ...). classify_message() returns list[{butler,prompt}] (decomposition entries), not a single target string. This causes route() failures and routing_error outcomes for Telegram/Email ingress, making inbound routing non-functional in switchboard polling deployments. Reopen to fix pipeline routing to handle decomposition output correctly (e.g., dispatch_decomposed/normalized targets).","status":"blocked","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-12T00:20:15.635186056+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T12:24:10.044520185+08:00","external_ref":"gh-pr:4","labels":["pr-review"],"dependencies":[{"issue_id":"butlers-vev","depends_on_id":"butlers-kie","type":"discovered-from","created_at":"2026-02-12T00:20:15.64346684+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-vyn","title":"Co-locate butler-specific artifacts under butlers/\u003cname\u003e/","description":"Butler-specific code, migrations, and tests are scattered across 5 separate directory trees (butlers/, src/butlers/tools/, alembic/versions/, tests/, openspec/). Moving all butler-specific artifacts under a single butlers/\u003cname\u003e/ folder makes adding new butlers a single-directory operation and improves modularity.\n\nCurrent layout (per butler):\n- butlers/\u003cname\u003e/ — config, manifesto, skills\n- src/butlers/tools/\u003cname\u003e.py — MCP tools\n- alembic/versions/\u003cname\u003e/ — DB migrations\n- tests/test_tools_\u003cname\u003e.py — tests\n\nTarget layout:\n  butlers/\u003cname\u003e/\n  ├── butler.toml, MANIFESTO.md, CLAUDE.md, AGENTS.md\n  ├── skills/\n  ├── tools.py          ← from src/butlers/tools/\u003cname\u003e.py\n  ├── migrations/       ← from alembic/versions/\u003cname\u003e/\n  └── tests/            ← from tests/test_tools_\u003cname\u003e.py\n\nShared code stays put: src/butlers/core/, src/butlers/modules/, alembic/versions/core/.","design":"Phase approach:\n1. Move tools: src/butlers/tools/\u003cname\u003e.py → butlers/\u003cname\u003e/tools.py; update imports in modules/registry\n2. Move migrations: alembic/versions/\u003cname\u003e/ → butlers/\u003cname\u003e/migrations/; update migrations.py to discover chains from butler dirs\n3. Move tests: tests/test_tools_\u003cname\u003e.py → butlers/\u003cname\u003e/tests/; update pytest discovery (conftest or pyproject.toml testpaths)\n4. Update framework wiring: config.py, migrations.py, daemon.py, cli.py to look for artifacts in butler dirs\n5. Keep shared tools (extraction.py, extraction_queue.py) in src/butlers/tools/ since they are cross-butler\n\nNote: openspec specs are change-scoped, not runtime artifacts — leave them where they are.","acceptance_criteria":"1. Each butler's tools, migrations, and tests live under butlers/\u003cname\u003e/\n2. Adding a new butler only requires creating one directory\n3. All existing tests pass\n4. Alembic migration discovery still works (versions detected from butler dirs)\n5. CLI butler discovery unchanged (still scans butlers/ dir)\n6. Import paths and tool registration updated\n7. Shared infrastructure (core/, modules/, core migrations) remains in src/butlers/","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-10T05:25:01.145939548+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:31:36.359355559+08:00","closed_at":"2026-02-10T11:31:36.359355559+08:00","close_reason":"All children merged: tools (vyn.1), migrations (vyn.2), tests (vyn.3), framework wiring (vyn.4). Butler artifacts fully co-located under butlers/\u003cname\u003e/.","labels":["architecture","refactoring"]}
{"id":"butlers-vyn.1","title":"Move butler-specific tools into butlers/\u003cname\u003e/tools.py","description":"Move each butler's tool file from src/butlers/tools/\u003cname\u003e.py to butlers/\u003cname\u003e/tools.py. Affected butlers: general, health, heartbeat, relationship, switchboard.\n\nShared/cross-butler tools (extraction.py, extraction_queue.py) stay in src/butlers/tools/.\n\nUpdate all import paths in:\n- src/butlers/modules/registry.py (or wherever tools are registered)\n- src/butlers/daemon.py (if it imports tools directly)\n- Any module that imports from butlers.tools.\u003cname\u003e\n\nThe butler config dirs need to be importable Python packages — either add them to sys.path at startup or use importlib to load tools.py dynamically from the config directory path.","design":"Option A (recommended): Dynamic import via importlib.import_module or importlib.util.spec_from_file_location — load tools.py from the butler config directory. No need to make butlers/ a Python package.\nOption B: Add butlers/ to sys.path and make each \u003cname\u003e/ an importable package. Risks namespace collisions.","acceptance_criteria":"1. src/butlers/tools/ only contains shared tools (extraction*.py, __init__.py)\n2. Each butler's tools.py lives in butlers/\u003cname\u003e/tools.py\n3. Tool registration still works at daemon startup\n4. No import errors","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T05:25:11.924166153+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:11:50.474343441+08:00","closed_at":"2026-02-10T11:11:50.474343441+08:00","close_reason":"Merged to main. Tools moved to butlers/\u003cname\u003e/tools.py with dynamic importlib loader.","labels":["refactoring"],"dependencies":[{"issue_id":"butlers-vyn.1","depends_on_id":"butlers-vyn","type":"parent-child","created_at":"2026-02-10T05:25:11.925723205+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-vyn.2","title":"Move butler-specific migrations into butlers/\u003cname\u003e/migrations/","description":"Move each butler's Alembic migration chain from alembic/versions/\u003cname\u003e/ to butlers/\u003cname\u003e/migrations/. Affected butlers: general, health, relationship, switchboard.\n\nCore migrations (alembic/versions/core/) and shared module migrations (alembic/versions/mailbox/) stay in alembic/versions/.\n\nUpdate migrations.py:\n- ALEMBIC_DIR constant and chain discovery logic\n- has_butler_chain() — look in butlers/\u003cname\u003e/migrations/ instead of alembic/versions/\u003cname\u003e/\n- _build_alembic_config() — version_locations should include butler-specific paths from butlers/ dir\n- VERSION_CHAINS — derive dynamically from butler dirs that have a migrations/ folder instead of hardcoding\n\nAlembic branch labels in existing migration files may reference the old chain names — verify these still resolve correctly.","acceptance_criteria":"1. alembic/versions/ only contains core/ and shared module chains (mailbox/)\n2. Each butler's migrations live in butlers/\u003cname\u003e/migrations/\n3. alembic upgrade heads still works\n4. has_butler_chain() discovers chains from butler dirs\n5. New butlers just add a migrations/ folder to their config dir","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T05:25:18.693120206+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T10:57:09.324708179+08:00","closed_at":"2026-02-10T10:57:09.324708179+08:00","close_reason":"Merged to main. Migrations moved to butlers/\u003cname\u003e/migrations/ with dynamic discovery.","labels":["database","refactoring"],"dependencies":[{"issue_id":"butlers-vyn.2","depends_on_id":"butlers-vyn","type":"parent-child","created_at":"2026-02-10T05:25:18.694805931+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-vyn.3","title":"Move butler-specific tests into butlers/\u003cname\u003e/tests/","description":"Move each butler's test file from tests/test_tools_\u003cname\u003e.py to butlers/\u003cname\u003e/tests/test_tools.py. Affected:\n- tests/test_tools_general.py → butlers/general/tests/test_tools.py\n- tests/test_tools_health.py → butlers/health/tests/test_tools.py\n- tests/test_tools_relationship.py → butlers/relationship/tests/test_tools.py\n- tests/test_tools_switchboard.py → butlers/switchboard/tests/test_tools.py\n- tests/test_tools_contact_info.py → butlers/relationship/tests/test_contact_info.py (relationship-specific)\n\nShared/cross-cutting tests stay in tests/.\n\nUpdate pyproject.toml testpaths to include butlers/ directories. Ensure conftest.py fixtures are accessible (may need a conftest.py in butlers/ or use pytest plugins).","acceptance_criteria":"1. pytest discovers and runs tests from both tests/ and butlers/*/tests/\n2. All existing tests still pass\n3. conftest.py fixtures accessible from butler test directories\n4. CI pipeline (if any) updated","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-10T05:25:23.572092611+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:24:21.59205289+08:00","closed_at":"2026-02-10T11:24:21.59205289+08:00","close_reason":"Merged to main. Tests moved to butlers/\u003cname\u003e/tests/ with root conftest.py and importlib discovery.","labels":["refactoring","testing"],"dependencies":[{"issue_id":"butlers-vyn.3","depends_on_id":"butlers-vyn","type":"parent-child","created_at":"2026-02-10T05:25:23.574012359+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-vyn.4","title":"Update framework wiring for butler-local artifact discovery","description":"Update the core framework code to discover tools, migrations, and tests from butler config directories instead of hardcoded paths.\n\nFiles to update:\n- src/butlers/migrations.py: Remove hardcoded VERSION_CHAINS list. Discover butler chains by scanning butlers/*/migrations/. Update has_butler_chain() and _build_alembic_config().\n- src/butlers/daemon.py: Load butler tools dynamically from butlers/\u003cname\u003e/tools.py instead of importing from butlers.tools.\u003cname\u003e.\n- src/butlers/cli.py: No changes expected (already discovers from butlers/ dir).\n- src/butlers/config.py: Optionally add config_dir path to ButlerConfig so daemon knows where to find tools.py and migrations/.\n\nThis task is the glue that makes the moved artifacts discoverable by the framework.","acceptance_criteria":"1. No hardcoded butler names in framework code (VERSION_CHAINS list removed)\n2. Framework dynamically discovers butler artifacts from butlers/\u003cname\u003e/\n3. Adding a new butler requires zero changes to framework code\n4. All tests pass","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-10T05:25:31.506029639+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T11:31:27.709455741+08:00","closed_at":"2026-02-10T11:31:27.709455741+08:00","close_reason":"Merged to main. Removed last hardcoded BUTLER_NAMES tuple, all discovery now filesystem-based.","labels":["architecture","refactoring"],"dependencies":[{"issue_id":"butlers-vyn.4","depends_on_id":"butlers-vyn","type":"parent-child","created_at":"2026-02-10T05:25:31.50754894+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-vyn.4","depends_on_id":"butlers-vyn.1","type":"blocks","created_at":"2026-02-10T05:25:35.119681194+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-vyn.4","depends_on_id":"butlers-vyn.2","type":"blocks","created_at":"2026-02-10T05:25:35.189762604+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-vyn.4","depends_on_id":"butlers-vyn.3","type":"blocks","created_at":"2026-02-10T05:25:35.255033924+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-vyn.5","title":"Move shared module migrations to module-local paths","description":"Mailbox migrations currently live in alembic/versions/mailbox/ as a '_SHARED_CHAIN', but mailbox is a regular opt-in Module subclass. This creates an inconsistent precedent — future modules with migrations wouldn't have a clear home. Move mailbox migrations to src/butlers/modules/mailbox/migrations/ (or similar module-local path) and update _SHARED_CHAINS, _resolve_chain_dir(), and alembic/env.py discovery to scan module dirs the same way butler chains are discovered. After this, alembic/versions/ should only contain core/.","notes":"Spawned from verifying butlers-vyn.2 — the asymmetry between butler-local and module-local migration paths was flagged as inconsistent.","status":"closed","priority":2,"issue_type":"task","owner":"uniquosity@gmail.com","created_at":"2026-02-10T11:42:41.418977703+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T13:45:22.954101567+08:00","closed_at":"2026-02-10T13:45:22.954101567+08:00","close_reason":"Closed","dependencies":[{"issue_id":"butlers-vyn.5","depends_on_id":"butlers-vyn","type":"parent-child","created_at":"2026-02-10T11:42:41.420525727+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-xb5","title":"Idempotent ingestion regressions in interaction/life-event dedup","description":"tests/integration/test_idempotent_ingestion.py fails multiple scenarios for interaction_log and life_event_log idempotency (first insert and duplicate handling). Investigate dedup keys/time windows and ensure deterministic idempotent behavior.","status":"in_progress","priority":2,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:56:00.999029987+08:00","created_by":"Tzeusy","updated_at":"2026-02-13T01:23:38.00470428+08:00","dependencies":[{"issue_id":"butlers-xb5","depends_on_id":"butlers-uu0","type":"discovered-from","created_at":"2026-02-11T10:56:01.030450518+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue","title":"Reach Monica CRM basic parity for Relationship butler","description":"Gap analysis against Monica CRM (monicahq/monica) reveals the Relationship butler has strong core CRM coverage (contacts, relationships, dates, notes, interactions, reminders, gifts, loans, groups, labels, facts, feed) but is missing several features needed for basic parity.\n\nHigh-priority gaps:\n- Structured contact info (email, phone, social handles) — currently stuffed into JSONB details\n- Addresses (structured, multi-per-contact) — completely missing\n- Relationship type taxonomy (love/family/friend/work groups) — currently freetext\n\nMedium-priority gaps:\n- Contact-scoped tasks/to-dos\n- Richer interactions (direction, duration, call reasons)\n- Life events (milestones, categorized)\n- Document/photo attachments per contact\n- vCard import/export for data portability\n- Stay-in-touch cadence per contact\n\nOut of scope for basic parity (future):\n- Pets, mood tracking, goals/streaks, journal, companies, occupation history\n\nExisting alignment work in butlers-06j.38 covers schema mismatches between implementation and spec. This epic covers net-new features not yet specified.","acceptance_criteria":"1. All high-priority gaps addressed (contact_info, addresses, relationship types)\n2. At least 3 of 6 medium-priority gaps addressed\n3. Each feature has migration, tools, and tests\n4. Activity feed integration for all new features","status":"closed","priority":2,"issue_type":"epic","owner":"uniquosity@gmail.com","created_at":"2026-02-09T21:09:38.753299946+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:21:09.035088198+08:00","closed_at":"2026-02-10T01:21:09.035088198+08:00","close_reason":"All 8 children completed: contact_info, addresses, relationship taxonomy, contact tasks, enrich interactions, life events, stay-in-touch, vCard","labels":["feature","relationship"]}
{"id":"butlers-yue.1","title":"Add contact_info table for structured contact details","description":"Replace the freeform JSONB details blob with a dedicated contact_info table storing typed contact information (email, phone, telegram, linkedin, twitter, website, etc.).\n\nMonica stores each piece of contact information as a row with a type and value, allowing multiple emails, phones, etc. per contact. Our spec already defines this table but it was not implemented.\n\nUser problem: Contact details are buried in an unstructured JSONB blob, making it impossible to search by email or phone number across all contacts.\n\nNon-goals: Social media API integration, contact info verification.","design":"New table: contact_info (id, contact_id FK, type VARCHAR, value TEXT, label VARCHAR, is_primary BOOLEAN, created_at). Types: email, phone, telegram, linkedin, twitter, website, other. Tools: contact_info_add, contact_info_list, contact_info_remove, contact_search_by_info (cross-contact lookup). Index on (type, value) for reverse lookups.","acceptance_criteria":"1. contact_info table created via Alembic migration\n2. Tools: contact_info_add, contact_info_list, contact_info_remove, contact_search_by_info\n3. Multiple entries per contact supported (e.g., 2 emails, 1 phone)\n4. Reverse lookup: find contact by email/phone across all contacts\n5. Activity feed logged for add/remove operations\n6. Tests cover CRUD, multi-value, reverse lookup, and feed integration","status":"closed","priority":1,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:09:50.487030056+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:32:45.693106549+08:00","closed_at":"2026-02-09T21:32:45.693106549+08:00","close_reason":"Implementation complete, branch pushed","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.1","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:09:50.488799548+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.2","title":"Add addresses table for structured contact addresses","description":"Add a dedicated addresses table for structured multi-address support per contact. Monica stores addresses with street, city, province, postal code, country, and a type label (home, work, etc.).\n\nCurrently the Relationship butler has no address support at all. This is a core CRM feature needed for:\n- Knowing where contacts live/work\n- Planning visits or sending physical mail/gifts\n- Geographic organization of contacts\n\nNon-goals: Geocoding, map integration, weather lookup.","design":"New table: addresses (id, contact_id FK, label VARCHAR, line_1 TEXT, line_2 TEXT, city VARCHAR, province VARCHAR, postal_code VARCHAR, country VARCHAR(2) ISO 3166-1, is_current BOOLEAN, created_at, updated_at). Tools: address_add, address_list, address_update, address_remove. Default labels: Home, Work, Other.","acceptance_criteria":"1. addresses table created via Alembic migration\n2. Tools: address_add, address_list, address_update, address_remove\n3. Multiple addresses per contact with labels\n4. is_current flag for primary address\n5. Activity feed logged for add/update/remove\n6. Tests cover CRUD, multi-address, current flag toggle","status":"closed","priority":1,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:09:56.206785412+08:00","created_by":"Tzeusy","updated_at":"2026-02-09T21:31:05.783456538+08:00","closed_at":"2026-02-09T21:31:05.783456538+08:00","close_reason":"Implemented addresses table, CRUD tools (address_add/list/update/remove), activity feed logging, and 20 tests. All 469 tests pass.","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.2","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:09:56.208750073+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.3","title":"Add relationship type taxonomy with group categories","description":"Replace freetext relationship types with a structured taxonomy organized into groups, matching Monica's approach. Monica defines 4 relationship groups (Love, Family, Friend, Work) each containing typed relationships with forward/reverse labels (e.g., parent/child, mentor/protege).\n\nCurrently our relationships table has a freetext type column with no validation or taxonomy. This makes it impossible to query 'show me all family relationships' or enforce bidirectional label consistency.\n\nNon-goals: User-customizable relationship types (future enhancement).","design":"New table: relationship_types (id, group VARCHAR, forward_label VARCHAR, reverse_label VARCHAR). Seed data: Love (spouse, partner, ex), Family (parent/child, sibling, grandparent/grandchild, uncle-aunt/nephew-niece, cousin), Friend (friend, best friend), Work (colleague, boss/subordinate, mentor/protege). Update relationships table: replace type VARCHAR with relationship_type_id FK. Tools: relationship_types_list (returns all types grouped). Update relationship_add to accept type_id and auto-set reverse label.","acceptance_criteria":"1. relationship_types table created and seeded via migration\n2. relationships.type replaced with relationship_type_id FK\n3. relationship_add auto-creates reverse with correct reverse_label\n4. relationship_types_list returns grouped taxonomy\n5. Backward-compatible: existing freetext types migrated to closest match or 'custom'\n6. Tests cover typed relationships, reverse labels, and listing by group","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:10:05.71679101+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:33:20.284506911+08:00","closed_at":"2026-02-10T00:33:20.284506911+08:00","close_reason":"Relationship type taxonomy added with 4 groups (Love, Family, Friend, Work), seeded types, FK migration, and auto-reverse labels","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.3","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:10:05.718369962+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.4","title":"Add contact-scoped tasks and to-dos","description":"Add a tasks/to-dos feature scoped to individual contacts. Monica allows creating tasks tied to contacts (e.g., 'Send thank-you note to Alice', 'Follow up on job referral with Bob').\n\nThis is distinct from reminders (which are time-triggered notifications) — tasks are action items that can be completed independently of time. They provide a lightweight way to track follow-ups without creating a full reminder.\n\nNon-goals: Task priorities, due dates (keep it simple — title + completed status).","design":"New table: tasks (id, contact_id FK, title VARCHAR, description TEXT, completed BOOLEAN DEFAULT false, completed_at TIMESTAMPTZ, created_at). Tools: task_create(contact_id, title, description?), task_list(contact_id?, include_completed?), task_complete(task_id), task_delete(task_id). Feed integration on create/complete.","acceptance_criteria":"1. tasks table created via Alembic migration\n2. Tools: task_create, task_list, task_complete, task_delete\n3. task_list supports filtering by contact and completion status\n4. Activity feed logged for create/complete\n5. Tests cover CRUD, completion, filtering, feed integration","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T21:10:11.768988435+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:30:28.333615709+08:00","closed_at":"2026-02-10T00:30:28.333615709+08:00","close_reason":"Contact-scoped tasks added with CRUD tools, feed integration, and tests","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.4","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:10:11.771209049+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.5","title":"Enrich interactions with direction, duration, and type","description":"Enhance the interactions table and tools to capture richer context matching Monica's call/activity model. Currently interactions only store type, summary, and occurred_at. Monica tracks who initiated the interaction, how long it lasted, and categorizes by reason.\n\nThis matters for the 'reconnect-planner' skill and relationship maintenance — knowing who reached out last and how substantial the interaction was helps prioritize outreach.\n\nNon-goals: Conversation message threads, multi-contact activities.","design":"Alter interactions table: add direction VARCHAR(10) (incoming/outgoing/mutual), duration_minutes INTEGER, metadata JSONB. Update interaction_log tool to accept optional direction, duration_minutes, metadata params. Update interaction_list to support filtering by direction and type. No breaking changes — new columns are nullable.","acceptance_criteria":"1. Migration adds direction, duration_minutes, metadata columns\n2. interaction_log accepts direction, duration_minutes, metadata\n3. interaction_list supports direction and type filters\n4. Existing interactions remain valid (new columns nullable)\n5. Activity feed entries include direction when present\n6. Tests cover new fields, filtering, backward compatibility","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T21:10:18.69167189+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:39:35.168032844+08:00","closed_at":"2026-02-10T00:39:35.168032844+08:00","close_reason":"Interactions enriched with direction, duration_minutes, metadata; filters and feed updated","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.5","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:10:18.693012823+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.6","title":"Add life events tracking with categories","description":"Add life event tracking to record significant milestones for contacts. Monica categorizes life events into groups (Work, Social, Transportation, Sport) with types within each. This provides a richer timeline than the activity feed alone.\n\nExamples: 'Alice got promoted', 'Bob moved to London', 'Charlie got married'. Life events differ from interactions (which are between you and the contact) — life events are things that happened to the contact.\n\nNon-goals: Cost tracking, distance/travel metrics, multi-participant events.","design":"New tables: life_event_categories (id, name), life_event_types (id, category_id FK, name), life_events (id, contact_id FK, life_event_type_id FK, summary TEXT, description TEXT, happened_at DATE, created_at). Seed categories: Career (new job, promotion, quit, retired, graduated), Personal (married, divorced, had a child, moved, passed away), Social (met for first time, reconnected). Tools: life_event_log(contact_id, type, summary, description?, happened_at?), life_event_list(contact_id?, type?, limit?), life_event_types_list(). Feed integration.","acceptance_criteria":"1. Tables created and seeded via migration\n2. Tools: life_event_log, life_event_list, life_event_types_list\n3. Events linked to contacts and categorized types\n4. Activity feed integration\n5. Tests cover logging, listing, type filtering, feed","status":"closed","priority":3,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":90,"created_at":"2026-02-09T21:10:25.942982516+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:18:39.435375222+08:00","closed_at":"2026-02-10T01:18:39.435375222+08:00","close_reason":"Implemented life events tracking with categories, types, and activity feed integration. Created migration 002_life_events_table.py with 3 new tables (life_event_categories, life_event_types, life_events) and seeded data. Added 3 new tools (life_event_types_list, life_event_log, life_event_list) with flexible filtering. All 67 tests passing including 11 new life event tests.","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.6","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:10:25.945147656+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.7","title":"Add stay-in-touch cadence per contact","description":"Add a per-contact 'stay in touch' frequency setting that automatically flags contacts who haven't been interacted with within their cadence window. Monica's v4 had this as a core feature (stay_in_touch_frequency + trigger_date).\n\nThis is the data backbone for the planned reconnect-planner skill and the spec's relationship-maintenance scheduled task. Without it, there's no way to know which contacts are 'overdue' for interaction.\n\nNon-goals: Auto-sending messages, notification delivery (that's the scheduled task's job).","design":"Alter contacts table: add stay_in_touch_days INTEGER (null = no cadence). New tool: stay_in_touch_set(contact_id, frequency_days) — set or clear cadence. New tool: contacts_overdue() — returns contacts where last interaction is older than their cadence, ordered by staleness. Uses: SELECT c.*, MAX(i.occurred_at) as last_interaction FROM contacts c LEFT JOIN interactions i ON c.id = i.contact_id WHERE c.stay_in_touch_days IS NOT NULL GROUP BY c.id HAVING MAX(i.occurred_at) \u003c NOW() - (c.stay_in_touch_days || ' days')::interval OR MAX(i.occurred_at) IS NULL.","acceptance_criteria":"1. Migration adds stay_in_touch_days column to contacts\n2. Tools: stay_in_touch_set, contacts_overdue\n3. contacts_overdue correctly computes staleness from last interaction\n4. Contacts with no interactions but a cadence show as overdue\n5. Clearing cadence (null) removes contact from overdue list\n6. Tests cover set, clear, overdue calculation, no-interaction edge case","status":"closed","priority":2,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":60,"created_at":"2026-02-09T21:10:35.708082334+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T00:39:02.017848403+08:00","closed_at":"2026-02-10T00:39:02.017848403+08:00","close_reason":"Stay-in-touch cadence added with overdue detection and tests","labels":["database","feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.7","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:10:35.709958428+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yue.8","title":"Add vCard import/export for contact portability","description":"Add vCard (.vcf) import and export to enable data portability with other CRM/contact tools. Monica supports vCard import/export and CardDAV sync. For basic parity, we need single-file import/export (not live sync).\n\nThis matters for onboarding (import existing contacts from phone/Google/Apple) and backup/migration scenarios.\n\nNon-goals: CardDAV live sync, CSV import, photo import.","design":"Tools: contact_export_vcard(contact_id?) — export one or all contacts as vCard 3.0. Returns VCF string. contact_import_vcard(vcf_content) — parse VCF and create contacts with name, contact_info, addresses, important_dates where available. Use python-vobject or vcard library. Map: FN→name, TEL→contact_info(phone), EMAIL→contact_info(email), ADR→addresses, BDAY→important_dates(birthday), ORG→quick_facts(company), TITLE→quick_facts(job_title).","acceptance_criteria":"1. Tools: contact_export_vcard, contact_import_vcard\n2. Export produces valid vCard 3.0 format\n3. Import parses standard vCard fields into appropriate tables\n4. Round-trip: export then import produces equivalent contact data\n5. Import handles missing/partial fields gracefully\n6. Tests cover export, import, round-trip, partial vCard","status":"closed","priority":3,"issue_type":"feature","owner":"uniquosity@gmail.com","estimated_minutes":120,"created_at":"2026-02-09T21:10:43.11557128+08:00","created_by":"Tzeusy","updated_at":"2026-02-10T01:17:29.919570796+08:00","closed_at":"2026-02-10T01:17:29.919570796+08:00","close_reason":"Implemented vCard import/export with 20 passing tests. Tools: contact_export_vcard (single/all contacts), contact_import_vcard (parses vCard 3.0). Maps FN→name, TEL→phones, EMAIL→emails, ADR→addresses, BDAY→important_dates, ORG→company, TITLE→job_title. Round-trip verified. All acceptance criteria met.","labels":["feature","relationship"],"dependencies":[{"issue_id":"butlers-yue.8","depends_on_id":"butlers-yue","type":"parent-child","created_at":"2026-02-09T21:10:43.120643622+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-yue.8","depends_on_id":"butlers-yue.1","type":"blocks","created_at":"2026-02-09T21:10:48.970605708+08:00","created_by":"Tzeusy"},{"issue_id":"butlers-yue.8","depends_on_id":"butlers-yue.2","type":"blocks","created_at":"2026-02-09T21:10:49.044513329+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-yvr","title":"Mailbox integration contract drift breaks mailbox integration suite","description":"tests/integration/test_mailbox_integration.py fails broadly due to missing MailboxModule internals (_mailbox_post/_mailbox_read), post_mail response shape mismatch, and metadata serialization expectations. Need to align mailbox module public/private API and switchboard post_mail contract with tests/spec.","notes":"Coordinator: PR #3 opened from agent/butlers-yvr for review.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T10:56:00.565855781+08:00","created_by":"Tzeusy","updated_at":"2026-02-12T00:12:56.917720309+08:00","closed_at":"2026-02-12T00:12:56.917720309+08:00","close_reason":"PR #3 merged","external_ref":"gh-pr:3","labels":["pr-review"],"dependencies":[{"issue_id":"butlers-yvr","depends_on_id":"butlers-uu0","type":"discovered-from","created_at":"2026-02-11T10:56:00.568419648+08:00","created_by":"Tzeusy"}]}
{"id":"butlers-zts","title":"Notifications list endpoints return 307 redirects instead of JSON responses","description":"Full pytest gate (2026-02-11) shows 40+ failures in tests/api/test_notification_endpoints.py and tests/api/test_notifications_router.py. Requests to /api/notifications/ return HTTP 307 Temporary Redirect instead of expected 200/422, causing query/assertion failures and empty response bodies. Investigate router path/trailing-slash behavior and align tests/routes so notifications list endpoints respond directly.","status":"closed","priority":1,"issue_type":"bug","owner":"uniquosity@gmail.com","created_at":"2026-02-11T23:13:12.436183789+08:00","created_by":"Tzeusy","updated_at":"2026-02-11T23:30:11.321852653+08:00","closed_at":"2026-02-11T23:30:11.321852653+08:00","close_reason":"Duplicate of butlers-9du (same 307 redirect root cause).","dependencies":[{"issue_id":"butlers-zts","depends_on_id":"butlers-4xh","type":"discovered-from","created_at":"2026-02-11T23:13:12.438939062+08:00","created_by":"Tzeusy"}]}
